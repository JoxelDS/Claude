import{r as Cl,g as xl,a as Gu}from"./react-N--QU9DW.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();var Kr={exports:{}},Bn={};var aa;function Wu(){if(aa)return Bn;aa=1;var n=Cl(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function a(u,d,f){var m,y={},T=null,S=null;f!==void 0&&(T=""+f),d.key!==void 0&&(T=""+d.key),d.ref!==void 0&&(S=d.ref);for(m in d)s.call(d,m)&&!o.hasOwnProperty(m)&&(y[m]=d[m]);if(u&&u.defaultProps)for(m in d=u.defaultProps,d)y[m]===void 0&&(y[m]=d[m]);return{$$typeof:e,type:u,key:T,ref:S,props:y,_owner:r.current}}return Bn.Fragment=t,Bn.jsx=a,Bn.jsxs=a,Bn}var la;function Qu(){return la||(la=1,Kr.exports=Wu()),Kr.exports}var c=Qu(),U=Cl();const Ju=xl(U);var Ns={},ca;function Yu(){if(ca)return Ns;ca=1;var n=Gu();return Ns.createRoot=n.createRoot,Ns.hydrateRoot=n.hydrateRoot,Ns}var Xu=Yu();const Zu=xl(Xu),eh=()=>{};var ua={};const Nl=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},th=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const r=n[t++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const o=n[t++];e[s++]=String.fromCharCode((r&31)<<6|o&63)}else if(r>239&&r<365){const o=n[t++],a=n[t++],u=n[t++],d=((r&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[s++]=String.fromCharCode(55296+(d>>10)),e[s++]=String.fromCharCode(56320+(d&1023))}else{const o=n[t++],a=n[t++];e[s++]=String.fromCharCode((r&15)<<12|(o&63)<<6|a&63)}}return e.join("")},Rl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const o=n[r],a=r+1<n.length,u=a?n[r+1]:0,d=r+2<n.length,f=d?n[r+2]:0,m=o>>2,y=(o&3)<<4|u>>4;let T=(u&15)<<2|f>>6,S=f&63;d||(S=64,a||(T=64)),s.push(t[m],t[y],t[T],t[S])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Nl(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):th(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const o=t[n.charAt(r++)],u=r<n.length?t[n.charAt(r)]:0;++r;const f=r<n.length?t[n.charAt(r)]:64;++r;const y=r<n.length?t[n.charAt(r)]:64;if(++r,o==null||u==null||f==null||y==null)throw new nh;const T=o<<2|u>>4;if(s.push(T),f!==64){const S=u<<4&240|f>>2;if(s.push(S),y!==64){const P=f<<6&192|y;s.push(P)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class nh extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const sh=function(n){const e=Nl(n);return Rl.encodeByteArray(e,!0)},Us=function(n){return sh(n).replace(/\./g,"")},rh=function(n){try{return Rl.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function ih(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const oh=()=>ih().__FIREBASE_DEFAULTS__,ah=()=>{if(typeof process>"u"||typeof ua>"u")return;const n=ua.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},lh=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&rh(n[1]);return e&&JSON.parse(e)},Ri=()=>{try{return eh()||oh()||ah()||lh()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},ch=n=>Ri()?.emulatorHosts?.[n],uh=n=>{const e=ch(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},Pl=()=>Ri()?.config;class hh{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}function Pi(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function dh(n){return(await fetch(n,{credentials:"include"})).ok}function fh(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",r=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Us(JSON.stringify(t)),Us(JSON.stringify(a)),""].join(".")}const Kn={};function mh(){const n={prod:[],emulator:[]};for(const e of Object.keys(Kn))Kn[e]?n.emulator.push(e):n.prod.push(e);return n}function ph(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let ha=!1;function gh(n,e){if(typeof window>"u"||typeof document>"u"||!Pi(window.location.host)||Kn[n]===e||Kn[n]||ha)return;Kn[n]=e;function t(T){return`__firebase__banner__${T}`}const s="__firebase__banner",o=mh().prod.length>0;function a(){const T=document.getElementById(s);T&&T.remove()}function u(T){T.style.display="flex",T.style.background="#7faaf0",T.style.position="fixed",T.style.bottom="5px",T.style.left="5px",T.style.padding=".5em",T.style.borderRadius="5px",T.style.alignItems="center"}function d(T,S){T.setAttribute("width","24"),T.setAttribute("id",S),T.setAttribute("height","24"),T.setAttribute("viewBox","0 0 24 24"),T.setAttribute("fill","none"),T.style.marginLeft="-6px"}function f(){const T=document.createElement("span");return T.style.cursor="pointer",T.style.marginLeft="16px",T.style.fontSize="24px",T.innerHTML=" &times;",T.onclick=()=>{ha=!0,a()},T}function m(T,S){T.setAttribute("id",S),T.innerText="Learn more",T.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",T.setAttribute("target","__blank"),T.style.paddingLeft="5px",T.style.textDecoration="underline"}function y(){const T=ph(s),S=t("text"),P=document.getElementById(S)||document.createElement("span"),R=t("learnmore"),F=document.getElementById(R)||document.createElement("a"),B=t("preprendIcon"),j=document.getElementById(B)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(T.created){const O=T.element;u(O),m(F,R);const V=f();d(j,B),O.append(j,P,F,V),document.body.appendChild(O)}o?(P.innerText="Preview backend disconnected.",j.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(j.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,P.innerText="Preview backend running in this workspace."),P.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",y):y()}function yh(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function _h(){const n=Ri()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function vh(){return!_h()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Eh(){try{return typeof indexedDB=="object"}catch{return!1}}function bh(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(t){e(t)}})}const Th="FirebaseError";class dn extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=Th,Object.setPrototypeOf(this,dn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Dl.prototype.create)}}class Dl{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,o=this.errors[e],a=o?wh(o,s):"Error",u=`${this.serviceName}: ${a} (${r}).`;return new dn(r,u,s)}}function wh(n,e){return n.replace(Ih,(t,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const Ih=/\{\$([^}]+)}/g;function qs(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const r of t){if(!s.includes(r))return!1;const o=n[r],a=e[r];if(da(o)&&da(a)){if(!qs(o,a))return!1}else if(o!==a)return!1}for(const r of s)if(!t.includes(r))return!1;return!0}function da(n){return n!==null&&typeof n=="object"}function Xn(n){return n&&n._delegate?n._delegate:n}class Zn{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Dt="[DEFAULT]";class Ah{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new hh;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Ch(e))try{this.getOrInitializeService({instanceIdentifier:Dt})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:r});s.resolve(o)}catch{}}}}clearInstance(e=Dt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Dt){return this.instances.has(e)}getOptions(e=Dt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[o,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);s===u&&a.resolve(r)}return r}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(s)??new Set;r.add(e),this.onInitCallbacks.set(s,r);const o=this.instances.get(s);return o&&e(o,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Sh(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Dt){return this.component?this.component.multipleInstances?e:Dt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Sh(n){return n===Dt?void 0:n}function Ch(n){return n.instantiationMode==="EAGER"}class xh{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Ah(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var Z;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Z||(Z={}));const Nh={debug:Z.DEBUG,verbose:Z.VERBOSE,info:Z.INFO,warn:Z.WARN,error:Z.ERROR,silent:Z.SILENT},Rh=Z.INFO,Ph={[Z.DEBUG]:"log",[Z.VERBOSE]:"log",[Z.INFO]:"info",[Z.WARN]:"warn",[Z.ERROR]:"error"},Dh=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),r=Ph[e];if(r)console[r](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class kl{constructor(e){this.name=e,this._logLevel=Rh,this._logHandler=Dh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Z))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Nh[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Z.DEBUG,...e),this._logHandler(this,Z.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Z.VERBOSE,...e),this._logHandler(this,Z.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Z.INFO,...e),this._logHandler(this,Z.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Z.WARN,...e),this._logHandler(this,Z.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Z.ERROR,...e),this._logHandler(this,Z.ERROR,...e)}}const kh=(n,e)=>e.some(t=>n instanceof t);let fa,ma;function Vh(){return fa||(fa=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function jh(){return ma||(ma=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Vl=new WeakMap,ai=new WeakMap,jl=new WeakMap,Gr=new WeakMap,Di=new WeakMap;function Fh(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(dt(n.result)),r()},a=()=>{s(n.error),r()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Vl.set(t,n)}).catch(()=>{}),Di.set(e,n),e}function Oh(n){if(ai.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),r()},a=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});ai.set(n,e)}let li={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ai.get(n);if(e==="objectStoreNames")return n.objectStoreNames||jl.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return dt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Lh(n){li=n(li)}function Mh(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(Wr(this),e,...t);return jl.set(s,e.sort?e.sort():[e]),dt(s)}:jh().includes(n)?function(...e){return n.apply(Wr(this),e),dt(Vl.get(this))}:function(...e){return dt(n.apply(Wr(this),e))}}function Bh(n){return typeof n=="function"?Mh(n):(n instanceof IDBTransaction&&Oh(n),kh(n,Vh())?new Proxy(n,li):n)}function dt(n){if(n instanceof IDBRequest)return Fh(n);if(Gr.has(n))return Gr.get(n);const e=Bh(n);return e!==n&&(Gr.set(n,e),Di.set(e,n)),e}const Wr=n=>Di.get(n);function $h(n,e,{blocked:t,upgrade:s,blocking:r,terminated:o}={}){const a=indexedDB.open(n,e),u=dt(a);return s&&a.addEventListener("upgradeneeded",d=>{s(dt(a.result),d.oldVersion,d.newVersion,dt(a.transaction),d)}),t&&a.addEventListener("blocked",d=>t(d.oldVersion,d.newVersion,d)),u.then(d=>{o&&d.addEventListener("close",()=>o()),r&&d.addEventListener("versionchange",f=>r(f.oldVersion,f.newVersion,f))}).catch(()=>{}),u}const Uh=["get","getKey","getAll","getAllKeys","count"],qh=["put","add","delete","clear"],Qr=new Map;function pa(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Qr.get(e))return Qr.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=qh.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||Uh.includes(t)))return;const o=async function(a,...u){const d=this.transaction(a,r?"readwrite":"readonly");let f=d.store;return s&&(f=f.index(u.shift())),(await Promise.all([f[t](...u),r&&d.done]))[0]};return Qr.set(e,o),o}Lh(n=>({...n,get:(e,t,s)=>pa(e,t)||n.get(e,t,s),has:(e,t)=>!!pa(e,t)||n.has(e,t)}));class zh{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Hh(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function Hh(n){return n.getComponent()?.type==="VERSION"}const ci="@firebase/app",ga="0.14.8";const Ze=new kl("@firebase/app"),Kh="@firebase/app-compat",Gh="@firebase/analytics-compat",Wh="@firebase/analytics",Qh="@firebase/app-check-compat",Jh="@firebase/app-check",Yh="@firebase/auth",Xh="@firebase/auth-compat",Zh="@firebase/database",ed="@firebase/data-connect",td="@firebase/database-compat",nd="@firebase/functions",sd="@firebase/functions-compat",rd="@firebase/installations",id="@firebase/installations-compat",od="@firebase/messaging",ad="@firebase/messaging-compat",ld="@firebase/performance",cd="@firebase/performance-compat",ud="@firebase/remote-config",hd="@firebase/remote-config-compat",dd="@firebase/storage",fd="@firebase/storage-compat",md="@firebase/firestore",pd="@firebase/ai",gd="@firebase/firestore-compat",yd="firebase",_d="12.9.0";const ui="[DEFAULT]",vd={[ci]:"fire-core",[Kh]:"fire-core-compat",[Wh]:"fire-analytics",[Gh]:"fire-analytics-compat",[Jh]:"fire-app-check",[Qh]:"fire-app-check-compat",[Yh]:"fire-auth",[Xh]:"fire-auth-compat",[Zh]:"fire-rtdb",[ed]:"fire-data-connect",[td]:"fire-rtdb-compat",[nd]:"fire-fn",[sd]:"fire-fn-compat",[rd]:"fire-iid",[id]:"fire-iid-compat",[od]:"fire-fcm",[ad]:"fire-fcm-compat",[ld]:"fire-perf",[cd]:"fire-perf-compat",[ud]:"fire-rc",[hd]:"fire-rc-compat",[dd]:"fire-gcs",[fd]:"fire-gcs-compat",[md]:"fire-fst",[gd]:"fire-fst-compat",[pd]:"fire-vertex","fire-js":"fire-js",[yd]:"fire-js-all"};const zs=new Map,Ed=new Map,hi=new Map;function ya(n,e){try{n.container.addComponent(e)}catch(t){Ze.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Hs(n){const e=n.name;if(hi.has(e))return Ze.debug(`There were multiple attempts to register component ${e}.`),!1;hi.set(e,n);for(const t of zs.values())ya(t,n);for(const t of Ed.values())ya(t,n);return!0}function bd(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Td(n){return n==null?!1:n.settings!==void 0}const wd={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ft=new Dl("app","Firebase",wd);class Id{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Zn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ft.create("app-deleted",{appName:this._name})}}const Ad=_d;function Fl(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:ui,automaticDataCollectionEnabled:!0,...e},r=s.name;if(typeof r!="string"||!r)throw ft.create("bad-app-name",{appName:String(r)});if(t||(t=Pl()),!t)throw ft.create("no-options");const o=zs.get(r);if(o){if(qs(t,o.options)&&qs(s,o.config))return o;throw ft.create("duplicate-app",{appName:r})}const a=new xh(r);for(const d of hi.values())a.addComponent(d);const u=new Id(t,s,a);return zs.set(r,u),u}function Sd(n=ui){const e=zs.get(n);if(!e&&n===ui&&Pl())return Fl();if(!e)throw ft.create("no-app",{appName:n});return e}function Yt(n,e,t){let s=vd[n]??n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const a=[`Unable to register library "${s}" with version "${e}":`];r&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ze.warn(a.join(" "));return}Hs(new Zn(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}const Cd="firebase-heartbeat-database",xd=1,es="firebase-heartbeat-store";let Jr=null;function Ol(){return Jr||(Jr=$h(Cd,xd,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(es)}catch(t){console.warn(t)}}}}).catch(n=>{throw ft.create("idb-open",{originalErrorMessage:n.message})})),Jr}async function Nd(n){try{const t=(await Ol()).transaction(es),s=await t.objectStore(es).get(Ll(n));return await t.done,s}catch(e){if(e instanceof dn)Ze.warn(e.message);else{const t=ft.create("idb-get",{originalErrorMessage:e?.message});Ze.warn(t.message)}}}async function _a(n,e){try{const s=(await Ol()).transaction(es,"readwrite");await s.objectStore(es).put(e,Ll(n)),await s.done}catch(t){if(t instanceof dn)Ze.warn(t.message);else{const s=ft.create("idb-set",{originalErrorMessage:t?.message});Ze.warn(s.message)}}}function Ll(n){return`${n.name}!${n.options.appId}`}const Rd=1024,Pd=30;class Dd{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Vd(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=va();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(r=>r.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>Pd){const r=jd(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Ze.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=va(),{heartbeatsToSend:t,unsentEntries:s}=kd(this._heartbeatsCache.heartbeats),r=Us(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return Ze.warn(e),""}}}function va(){return new Date().toISOString().substring(0,10)}function kd(n,e=Rd){const t=[];let s=n.slice();for(const r of n){const o=t.find(a=>a.agent===r.agent);if(o){if(o.dates.push(r.date),Ea(t)>e){o.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),Ea(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class Vd{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Eh()?bh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Nd(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return _a(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return _a(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Ea(n){return Us(JSON.stringify({version:2,heartbeats:n})).length}function jd(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}function Fd(n){Hs(new Zn("platform-logger",e=>new zh(e),"PRIVATE")),Hs(new Zn("heartbeat",e=>new Dd(e),"PRIVATE")),Yt(ci,ga,n),Yt(ci,ga,"esm2020"),Yt("fire-js","")}Fd("");var Od="firebase",Ld="12.9.0";Yt(Od,Ld,"app");var ba=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var mt,Ml;(function(){var n;function e(E,g){function _(){}_.prototype=g.prototype,E.F=g.prototype,E.prototype=new _,E.prototype.constructor=E,E.D=function(b,w,I){for(var v=Array(arguments.length-2),L=2;L<arguments.length;L++)v[L-2]=arguments[L];return g.prototype[w].apply(b,v)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,t),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(E,g,_){_||(_=0);const b=Array(16);if(typeof g=="string")for(var w=0;w<16;++w)b[w]=g.charCodeAt(_++)|g.charCodeAt(_++)<<8|g.charCodeAt(_++)<<16|g.charCodeAt(_++)<<24;else for(w=0;w<16;++w)b[w]=g[_++]|g[_++]<<8|g[_++]<<16|g[_++]<<24;g=E.g[0],_=E.g[1],w=E.g[2];let I=E.g[3],v;v=g+(I^_&(w^I))+b[0]+3614090360&4294967295,g=_+(v<<7&4294967295|v>>>25),v=I+(w^g&(_^w))+b[1]+3905402710&4294967295,I=g+(v<<12&4294967295|v>>>20),v=w+(_^I&(g^_))+b[2]+606105819&4294967295,w=I+(v<<17&4294967295|v>>>15),v=_+(g^w&(I^g))+b[3]+3250441966&4294967295,_=w+(v<<22&4294967295|v>>>10),v=g+(I^_&(w^I))+b[4]+4118548399&4294967295,g=_+(v<<7&4294967295|v>>>25),v=I+(w^g&(_^w))+b[5]+1200080426&4294967295,I=g+(v<<12&4294967295|v>>>20),v=w+(_^I&(g^_))+b[6]+2821735955&4294967295,w=I+(v<<17&4294967295|v>>>15),v=_+(g^w&(I^g))+b[7]+4249261313&4294967295,_=w+(v<<22&4294967295|v>>>10),v=g+(I^_&(w^I))+b[8]+1770035416&4294967295,g=_+(v<<7&4294967295|v>>>25),v=I+(w^g&(_^w))+b[9]+2336552879&4294967295,I=g+(v<<12&4294967295|v>>>20),v=w+(_^I&(g^_))+b[10]+4294925233&4294967295,w=I+(v<<17&4294967295|v>>>15),v=_+(g^w&(I^g))+b[11]+2304563134&4294967295,_=w+(v<<22&4294967295|v>>>10),v=g+(I^_&(w^I))+b[12]+1804603682&4294967295,g=_+(v<<7&4294967295|v>>>25),v=I+(w^g&(_^w))+b[13]+4254626195&4294967295,I=g+(v<<12&4294967295|v>>>20),v=w+(_^I&(g^_))+b[14]+2792965006&4294967295,w=I+(v<<17&4294967295|v>>>15),v=_+(g^w&(I^g))+b[15]+1236535329&4294967295,_=w+(v<<22&4294967295|v>>>10),v=g+(w^I&(_^w))+b[1]+4129170786&4294967295,g=_+(v<<5&4294967295|v>>>27),v=I+(_^w&(g^_))+b[6]+3225465664&4294967295,I=g+(v<<9&4294967295|v>>>23),v=w+(g^_&(I^g))+b[11]+643717713&4294967295,w=I+(v<<14&4294967295|v>>>18),v=_+(I^g&(w^I))+b[0]+3921069994&4294967295,_=w+(v<<20&4294967295|v>>>12),v=g+(w^I&(_^w))+b[5]+3593408605&4294967295,g=_+(v<<5&4294967295|v>>>27),v=I+(_^w&(g^_))+b[10]+38016083&4294967295,I=g+(v<<9&4294967295|v>>>23),v=w+(g^_&(I^g))+b[15]+3634488961&4294967295,w=I+(v<<14&4294967295|v>>>18),v=_+(I^g&(w^I))+b[4]+3889429448&4294967295,_=w+(v<<20&4294967295|v>>>12),v=g+(w^I&(_^w))+b[9]+568446438&4294967295,g=_+(v<<5&4294967295|v>>>27),v=I+(_^w&(g^_))+b[14]+3275163606&4294967295,I=g+(v<<9&4294967295|v>>>23),v=w+(g^_&(I^g))+b[3]+4107603335&4294967295,w=I+(v<<14&4294967295|v>>>18),v=_+(I^g&(w^I))+b[8]+1163531501&4294967295,_=w+(v<<20&4294967295|v>>>12),v=g+(w^I&(_^w))+b[13]+2850285829&4294967295,g=_+(v<<5&4294967295|v>>>27),v=I+(_^w&(g^_))+b[2]+4243563512&4294967295,I=g+(v<<9&4294967295|v>>>23),v=w+(g^_&(I^g))+b[7]+1735328473&4294967295,w=I+(v<<14&4294967295|v>>>18),v=_+(I^g&(w^I))+b[12]+2368359562&4294967295,_=w+(v<<20&4294967295|v>>>12),v=g+(_^w^I)+b[5]+4294588738&4294967295,g=_+(v<<4&4294967295|v>>>28),v=I+(g^_^w)+b[8]+2272392833&4294967295,I=g+(v<<11&4294967295|v>>>21),v=w+(I^g^_)+b[11]+1839030562&4294967295,w=I+(v<<16&4294967295|v>>>16),v=_+(w^I^g)+b[14]+4259657740&4294967295,_=w+(v<<23&4294967295|v>>>9),v=g+(_^w^I)+b[1]+2763975236&4294967295,g=_+(v<<4&4294967295|v>>>28),v=I+(g^_^w)+b[4]+1272893353&4294967295,I=g+(v<<11&4294967295|v>>>21),v=w+(I^g^_)+b[7]+4139469664&4294967295,w=I+(v<<16&4294967295|v>>>16),v=_+(w^I^g)+b[10]+3200236656&4294967295,_=w+(v<<23&4294967295|v>>>9),v=g+(_^w^I)+b[13]+681279174&4294967295,g=_+(v<<4&4294967295|v>>>28),v=I+(g^_^w)+b[0]+3936430074&4294967295,I=g+(v<<11&4294967295|v>>>21),v=w+(I^g^_)+b[3]+3572445317&4294967295,w=I+(v<<16&4294967295|v>>>16),v=_+(w^I^g)+b[6]+76029189&4294967295,_=w+(v<<23&4294967295|v>>>9),v=g+(_^w^I)+b[9]+3654602809&4294967295,g=_+(v<<4&4294967295|v>>>28),v=I+(g^_^w)+b[12]+3873151461&4294967295,I=g+(v<<11&4294967295|v>>>21),v=w+(I^g^_)+b[15]+530742520&4294967295,w=I+(v<<16&4294967295|v>>>16),v=_+(w^I^g)+b[2]+3299628645&4294967295,_=w+(v<<23&4294967295|v>>>9),v=g+(w^(_|~I))+b[0]+4096336452&4294967295,g=_+(v<<6&4294967295|v>>>26),v=I+(_^(g|~w))+b[7]+1126891415&4294967295,I=g+(v<<10&4294967295|v>>>22),v=w+(g^(I|~_))+b[14]+2878612391&4294967295,w=I+(v<<15&4294967295|v>>>17),v=_+(I^(w|~g))+b[5]+4237533241&4294967295,_=w+(v<<21&4294967295|v>>>11),v=g+(w^(_|~I))+b[12]+1700485571&4294967295,g=_+(v<<6&4294967295|v>>>26),v=I+(_^(g|~w))+b[3]+2399980690&4294967295,I=g+(v<<10&4294967295|v>>>22),v=w+(g^(I|~_))+b[10]+4293915773&4294967295,w=I+(v<<15&4294967295|v>>>17),v=_+(I^(w|~g))+b[1]+2240044497&4294967295,_=w+(v<<21&4294967295|v>>>11),v=g+(w^(_|~I))+b[8]+1873313359&4294967295,g=_+(v<<6&4294967295|v>>>26),v=I+(_^(g|~w))+b[15]+4264355552&4294967295,I=g+(v<<10&4294967295|v>>>22),v=w+(g^(I|~_))+b[6]+2734768916&4294967295,w=I+(v<<15&4294967295|v>>>17),v=_+(I^(w|~g))+b[13]+1309151649&4294967295,_=w+(v<<21&4294967295|v>>>11),v=g+(w^(_|~I))+b[4]+4149444226&4294967295,g=_+(v<<6&4294967295|v>>>26),v=I+(_^(g|~w))+b[11]+3174756917&4294967295,I=g+(v<<10&4294967295|v>>>22),v=w+(g^(I|~_))+b[2]+718787259&4294967295,w=I+(v<<15&4294967295|v>>>17),v=_+(I^(w|~g))+b[9]+3951481745&4294967295,E.g[0]=E.g[0]+g&4294967295,E.g[1]=E.g[1]+(w+(v<<21&4294967295|v>>>11))&4294967295,E.g[2]=E.g[2]+w&4294967295,E.g[3]=E.g[3]+I&4294967295}s.prototype.v=function(E,g){g===void 0&&(g=E.length);const _=g-this.blockSize,b=this.C;let w=this.h,I=0;for(;I<g;){if(w==0)for(;I<=_;)r(this,E,I),I+=this.blockSize;if(typeof E=="string"){for(;I<g;)if(b[w++]=E.charCodeAt(I++),w==this.blockSize){r(this,b),w=0;break}}else for(;I<g;)if(b[w++]=E[I++],w==this.blockSize){r(this,b),w=0;break}}this.h=w,this.o+=g},s.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var g=1;g<E.length-8;++g)E[g]=0;g=this.o*8;for(var _=E.length-8;_<E.length;++_)E[_]=g&255,g/=256;for(this.v(E),E=Array(16),g=0,_=0;_<4;++_)for(let b=0;b<32;b+=8)E[g++]=this.g[_]>>>b&255;return E};function o(E,g){var _=u;return Object.prototype.hasOwnProperty.call(_,E)?_[E]:_[E]=g(E)}function a(E,g){this.h=g;const _=[];let b=!0;for(let w=E.length-1;w>=0;w--){const I=E[w]|0;b&&I==g||(_[w]=I,b=!1)}this.g=_}var u={};function d(E){return-128<=E&&E<128?o(E,function(g){return new a([g|0],g<0?-1:0)}):new a([E|0],E<0?-1:0)}function f(E){if(isNaN(E)||!isFinite(E))return y;if(E<0)return F(f(-E));const g=[];let _=1;for(let b=0;E>=_;b++)g[b]=E/_|0,_*=4294967296;return new a(g,0)}function m(E,g){if(E.length==0)throw Error("number format error: empty string");if(g=g||10,g<2||36<g)throw Error("radix out of range: "+g);if(E.charAt(0)=="-")return F(m(E.substring(1),g));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const _=f(Math.pow(g,8));let b=y;for(let I=0;I<E.length;I+=8){var w=Math.min(8,E.length-I);const v=parseInt(E.substring(I,I+w),g);w<8?(w=f(Math.pow(g,w)),b=b.j(w).add(f(v))):(b=b.j(_),b=b.add(f(v)))}return b}var y=d(0),T=d(1),S=d(16777216);n=a.prototype,n.m=function(){if(R(this))return-F(this).m();let E=0,g=1;for(let _=0;_<this.g.length;_++){const b=this.i(_);E+=(b>=0?b:4294967296+b)*g,g*=4294967296}return E},n.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(P(this))return"0";if(R(this))return"-"+F(this).toString(E);const g=f(Math.pow(E,6));var _=this;let b="";for(;;){const w=V(_,g).g;_=B(_,w.j(g));let I=((_.g.length>0?_.g[0]:_.h)>>>0).toString(E);if(_=w,P(_))return I+b;for(;I.length<6;)I="0"+I;b=I+b}},n.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function P(E){if(E.h!=0)return!1;for(let g=0;g<E.g.length;g++)if(E.g[g]!=0)return!1;return!0}function R(E){return E.h==-1}n.l=function(E){return E=B(this,E),R(E)?-1:P(E)?0:1};function F(E){const g=E.g.length,_=[];for(let b=0;b<g;b++)_[b]=~E.g[b];return new a(_,~E.h).add(T)}n.abs=function(){return R(this)?F(this):this},n.add=function(E){const g=Math.max(this.g.length,E.g.length),_=[];let b=0;for(let w=0;w<=g;w++){let I=b+(this.i(w)&65535)+(E.i(w)&65535),v=(I>>>16)+(this.i(w)>>>16)+(E.i(w)>>>16);b=v>>>16,I&=65535,v&=65535,_[w]=v<<16|I}return new a(_,_[_.length-1]&-2147483648?-1:0)};function B(E,g){return E.add(F(g))}n.j=function(E){if(P(this)||P(E))return y;if(R(this))return R(E)?F(this).j(F(E)):F(F(this).j(E));if(R(E))return F(this.j(F(E)));if(this.l(S)<0&&E.l(S)<0)return f(this.m()*E.m());const g=this.g.length+E.g.length,_=[];for(var b=0;b<2*g;b++)_[b]=0;for(b=0;b<this.g.length;b++)for(let w=0;w<E.g.length;w++){const I=this.i(b)>>>16,v=this.i(b)&65535,L=E.i(w)>>>16,ee=E.i(w)&65535;_[2*b+2*w]+=v*ee,j(_,2*b+2*w),_[2*b+2*w+1]+=I*ee,j(_,2*b+2*w+1),_[2*b+2*w+1]+=v*L,j(_,2*b+2*w+1),_[2*b+2*w+2]+=I*L,j(_,2*b+2*w+2)}for(E=0;E<g;E++)_[E]=_[2*E+1]<<16|_[2*E];for(E=g;E<2*g;E++)_[E]=0;return new a(_,0)};function j(E,g){for(;(E[g]&65535)!=E[g];)E[g+1]+=E[g]>>>16,E[g]&=65535,g++}function O(E,g){this.g=E,this.h=g}function V(E,g){if(P(g))throw Error("division by zero");if(P(E))return new O(y,y);if(R(E))return g=V(F(E),g),new O(F(g.g),F(g.h));if(R(g))return g=V(E,F(g)),new O(F(g.g),g.h);if(E.g.length>30){if(R(E)||R(g))throw Error("slowDivide_ only works with positive integers.");for(var _=T,b=g;b.l(E)<=0;)_=x(_),b=x(b);var w=H(_,1),I=H(b,1);for(b=H(b,2),_=H(_,2);!P(b);){var v=I.add(b);v.l(E)<=0&&(w=w.add(_),I=v),b=H(b,1),_=H(_,1)}return g=B(E,w.j(g)),new O(w,g)}for(w=y;E.l(g)>=0;){for(_=Math.max(1,Math.floor(E.m()/g.m())),b=Math.ceil(Math.log(_)/Math.LN2),b=b<=48?1:Math.pow(2,b-48),I=f(_),v=I.j(g);R(v)||v.l(E)>0;)_-=b,I=f(_),v=I.j(g);P(I)&&(I=T),w=w.add(I),E=B(E,v)}return new O(w,E)}n.B=function(E){return V(this,E).h},n.and=function(E){const g=Math.max(this.g.length,E.g.length),_=[];for(let b=0;b<g;b++)_[b]=this.i(b)&E.i(b);return new a(_,this.h&E.h)},n.or=function(E){const g=Math.max(this.g.length,E.g.length),_=[];for(let b=0;b<g;b++)_[b]=this.i(b)|E.i(b);return new a(_,this.h|E.h)},n.xor=function(E){const g=Math.max(this.g.length,E.g.length),_=[];for(let b=0;b<g;b++)_[b]=this.i(b)^E.i(b);return new a(_,this.h^E.h)};function x(E){const g=E.g.length+1,_=[];for(let b=0;b<g;b++)_[b]=E.i(b)<<1|E.i(b-1)>>>31;return new a(_,E.h)}function H(E,g){const _=g>>5;g%=32;const b=E.g.length-_,w=[];for(let I=0;I<b;I++)w[I]=g>0?E.i(I+_)>>>g|E.i(I+_+1)<<32-g:E.i(I+_);return new a(w,E.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,Ml=s,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=f,a.fromString=m,mt=a}).apply(typeof ba<"u"?ba:typeof self<"u"?self:typeof window<"u"?window:{});var Rs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Bl,Un,$l,Fs,di,Ul,ql,zl;(function(){var n,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof Rs=="object"&&Rs];for(var l=0;l<i.length;++l){var h=i[l];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var s=t(this);function r(i,l){if(l)e:{var h=s;i=i.split(".");for(var p=0;p<i.length-1;p++){var A=i[p];if(!(A in h))break e;h=h[A]}i=i[i.length-1],p=h[i],l=l(p),l!=p&&l!=null&&e(h,i,{configurable:!0,writable:!0,value:l})}}r("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(i){return i||function(l){var h=[],p;for(p in l)Object.prototype.hasOwnProperty.call(l,p)&&h.push([p,l[p]]);return h}});var o=o||{},a=this||self;function u(i){var l=typeof i;return l=="object"&&i!=null||l=="function"}function d(i,l,h){return i.call.apply(i.bind,arguments)}function f(i,l,h){return f=d,f.apply(null,arguments)}function m(i,l){var h=Array.prototype.slice.call(arguments,1);return function(){var p=h.slice();return p.push.apply(p,arguments),i.apply(this,p)}}function y(i,l){function h(){}h.prototype=l.prototype,i.Z=l.prototype,i.prototype=new h,i.prototype.constructor=i,i.Ob=function(p,A,C){for(var M=Array(arguments.length-2),Q=2;Q<arguments.length;Q++)M[Q-2]=arguments[Q];return l.prototype[A].apply(p,M)}}var T=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function S(i){const l=i.length;if(l>0){const h=Array(l);for(let p=0;p<l;p++)h[p]=i[p];return h}return[]}function P(i,l){for(let p=1;p<arguments.length;p++){const A=arguments[p];var h=typeof A;if(h=h!="object"?h:A?Array.isArray(A)?"array":h:"null",h=="array"||h=="object"&&typeof A.length=="number"){h=i.length||0;const C=A.length||0;i.length=h+C;for(let M=0;M<C;M++)i[h+M]=A[M]}else i.push(A)}}class R{constructor(l,h){this.i=l,this.j=h,this.h=0,this.g=null}get(){let l;return this.h>0?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function F(i){a.setTimeout(()=>{throw i},0)}function B(){var i=E;let l=null;return i.g&&(l=i.g,i.g=i.g.next,i.g||(i.h=null),l.next=null),l}class j{constructor(){this.h=this.g=null}add(l,h){const p=O.get();p.set(l,h),this.h?this.h.next=p:this.g=p,this.h=p}}var O=new R(()=>new V,i=>i.reset());class V{constructor(){this.next=this.g=this.h=null}set(l,h){this.h=l,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let x,H=!1,E=new j,g=()=>{const i=Promise.resolve(void 0);x=()=>{i.then(_)}};function _(){for(var i;i=B();){try{i.h.call(i.g)}catch(h){F(h)}var l=O;l.j(i),l.h<100&&(l.h++,i.next=l.g,l.g=i)}H=!1}function b(){this.u=this.u,this.C=this.C}b.prototype.u=!1,b.prototype.dispose=function(){this.u||(this.u=!0,this.N())},b.prototype[Symbol.dispose]=function(){this.dispose()},b.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function w(i,l){this.type=i,this.g=this.target=l,this.defaultPrevented=!1}w.prototype.h=function(){this.defaultPrevented=!0};var I=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,l=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const h=()=>{};a.addEventListener("test",h,l),a.removeEventListener("test",h,l)}catch{}return i})();function v(i){return/^[\s\xa0]*$/.test(i)}function L(i,l){w.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,l)}y(L,w),L.prototype.init=function(i,l){const h=this.type=i.type,p=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=l,l=i.relatedTarget,l||(h=="mouseover"?l=i.fromElement:h=="mouseout"&&(l=i.toElement)),this.relatedTarget=l,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&L.Z.h.call(this)},L.prototype.h=function(){L.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var ee="closure_listenable_"+(Math.random()*1e6|0),Ut=0;function Le(i,l,h,p,A){this.listener=i,this.proxy=null,this.src=l,this.type=h,this.capture=!!p,this.ha=A,this.key=++Ut,this.da=this.fa=!1}function nt(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function wt(i,l,h){for(const p in i)l.call(h,i[p],p,i)}function fs(i,l){for(const h in i)l.call(void 0,i[h],h,i)}function vn(i){const l={};for(const h in i)l[h]=i[h];return l}const Qe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function En(i,l){let h,p;for(let A=1;A<arguments.length;A++){p=arguments[A];for(h in p)i[h]=p[h];for(let C=0;C<Qe.length;C++)h=Qe[C],Object.prototype.hasOwnProperty.call(p,h)&&(i[h]=p[h])}}function Je(i){this.src=i,this.g={},this.h=0}Je.prototype.add=function(i,l,h,p,A){const C=i.toString();i=this.g[C],i||(i=this.g[C]=[],this.h++);const M=Ye(i,l,p,A);return M>-1?(l=i[M],h||(l.fa=!1)):(l=new Le(l,this.src,C,!!p,A),l.fa=h,i.push(l)),l};function qt(i,l){const h=l.type;if(h in i.g){var p=i.g[h],A=Array.prototype.indexOf.call(p,l,void 0),C;(C=A>=0)&&Array.prototype.splice.call(p,A,1),C&&(nt(l),i.g[h].length==0&&(delete i.g[h],i.h--))}}function Ye(i,l,h,p){for(let A=0;A<i.length;++A){const C=i[A];if(!C.da&&C.listener==l&&C.capture==!!h&&C.ha==p)return A}return-1}var st="closure_lm_"+(Math.random()*1e6|0),It={};function At(i,l,h,p,A){if(Array.isArray(l)){for(let C=0;C<l.length;C++)At(i,l[C],h,p,A);return null}return h=ys(h),i&&i[ee]?i.J(l,h,u(p)?!!p.capture:!1,A):ms(i,l,h,!1,p,A)}function ms(i,l,h,p,A,C){if(!l)throw Error("Invalid event type");const M=u(A)?!!A.capture:!!A;let Q=Tn(i);if(Q||(i[st]=Q=new Je(i)),h=Q.add(l,h,p,M,C),h.proxy)return h;if(p=Cr(),h.proxy=p,p.src=i,p.listener=h,i.addEventListener)I||(A=M),A===void 0&&(A=!1),i.addEventListener(l.toString(),p,A);else if(i.attachEvent)i.attachEvent(gs(l.toString()),p);else if(i.addListener&&i.removeListener)i.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Cr(){function i(h){return l.call(i.src,i.listener,h)}const l=xr;return i}function ps(i,l,h,p,A){if(Array.isArray(l))for(var C=0;C<l.length;C++)ps(i,l[C],h,p,A);else p=u(p)?!!p.capture:!!p,h=ys(h),i&&i[ee]?(i=i.i,C=String(l).toString(),C in i.g&&(l=i.g[C],h=Ye(l,h,p,A),h>-1&&(nt(l[h]),Array.prototype.splice.call(l,h,1),l.length==0&&(delete i.g[C],i.h--)))):i&&(i=Tn(i))&&(l=i.g[l.toString()],i=-1,l&&(i=Ye(l,h,p,A)),(h=i>-1?l[i]:null)&&bn(h))}function bn(i){if(typeof i!="number"&&i&&!i.da){var l=i.src;if(l&&l[ee])qt(l.i,i);else{var h=i.type,p=i.proxy;l.removeEventListener?l.removeEventListener(h,p,i.capture):l.detachEvent?l.detachEvent(gs(h),p):l.addListener&&l.removeListener&&l.removeListener(p),(h=Tn(l))?(qt(h,i),h.h==0&&(h.src=null,l[st]=null)):nt(i)}}}function gs(i){return i in It?It[i]:It[i]="on"+i}function xr(i,l){if(i.da)i=!0;else{l=new L(l,this);const h=i.listener,p=i.ha||i.src;i.fa&&bn(i),i=h.call(p,l)}return i}function Tn(i){return i=i[st],i instanceof Je?i:null}var wn="__closure_events_fn_"+(Math.random()*1e9>>>0);function ys(i){return typeof i=="function"?i:(i[wn]||(i[wn]=function(l){return i.handleEvent(l)}),i[wn])}function ge(){b.call(this),this.i=new Je(this),this.M=this,this.G=null}y(ge,b),ge.prototype[ee]=!0,ge.prototype.removeEventListener=function(i,l,h,p){ps(this,i,l,h,p)};function k(i,l){var h,p=i.G;if(p)for(h=[];p;p=p.G)h.push(p);if(i=i.M,p=l.type||l,typeof l=="string")l=new w(l,i);else if(l instanceof w)l.target=l.target||i;else{var A=l;l=new w(p,i),En(l,A)}A=!0;let C,M;if(h)for(M=h.length-1;M>=0;M--)C=l.g=h[M],A=te(C,p,!0,l)&&A;if(C=l.g=i,A=te(C,p,!0,l)&&A,A=te(C,p,!1,l)&&A,h)for(M=0;M<h.length;M++)C=l.g=h[M],A=te(C,p,!1,l)&&A}ge.prototype.N=function(){if(ge.Z.N.call(this),this.i){var i=this.i;for(const l in i.g){const h=i.g[l];for(let p=0;p<h.length;p++)nt(h[p]);delete i.g[l],i.h--}}this.G=null},ge.prototype.J=function(i,l,h,p){return this.i.add(String(i),l,!1,h,p)},ge.prototype.K=function(i,l,h,p){return this.i.add(String(i),l,!0,h,p)};function te(i,l,h,p){if(l=i.i.g[String(l)],!l)return!0;l=l.concat();let A=!0;for(let C=0;C<l.length;++C){const M=l[C];if(M&&!M.da&&M.capture==h){const Q=M.listener,fe=M.ha||M.src;M.fa&&qt(i.i,M),A=Q.call(fe,p)!==!1&&A}}return A&&!p.defaultPrevented}function re(i,l){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=f(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(l)>2147483647?-1:a.setTimeout(i,l||0)}function De(i){i.g=re(()=>{i.g=null,i.i&&(i.i=!1,De(i))},i.l);const l=i.h;i.h=null,i.m.apply(null,l)}class In extends b{constructor(l,h){super(),this.m=l,this.l=h,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:De(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Xe(i){b.call(this),this.h=i,this.g={}}y(Xe,b);var St=[];function po(i){wt(i.g,function(l,h){this.g.hasOwnProperty(h)&&bn(l)},i),i.g={}}Xe.prototype.N=function(){Xe.Z.N.call(this),po(this)},Xe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Nr=a.JSON.stringify,wu=a.JSON.parse,Iu=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function go(){}function yo(){}var An={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Rr(){w.call(this,"d")}y(Rr,w);function Pr(){w.call(this,"c")}y(Pr,w);var Ct={},_o=null;function _s(){return _o=_o||new ge}Ct.Ia="serverreachability";function vo(i){w.call(this,Ct.Ia,i)}y(vo,w);function Sn(i){const l=_s();k(l,new vo(l))}Ct.STAT_EVENT="statevent";function Eo(i,l){w.call(this,Ct.STAT_EVENT,i),this.stat=l}y(Eo,w);function Ce(i){const l=_s();k(l,new Eo(l,i))}Ct.Ja="timingevent";function bo(i,l){w.call(this,Ct.Ja,i),this.size=l}y(bo,w);function Cn(i,l){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},l)}function xn(){this.g=!0}xn.prototype.ua=function(){this.g=!1};function Au(i,l,h,p,A,C){i.info(function(){if(i.g)if(C){var M="",Q=C.split("&");for(let se=0;se<Q.length;se++){var fe=Q[se].split("=");if(fe.length>1){const ye=fe[0];fe=fe[1];const Be=ye.split("_");M=Be.length>=2&&Be[1]=="type"?M+(ye+"="+fe+"&"):M+(ye+"=redacted&")}}}else M=null;else M=C;return"XMLHTTP REQ ("+p+") [attempt "+A+"]: "+l+`
`+h+`
`+M})}function Su(i,l,h,p,A,C,M){i.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+A+"]: "+l+`
`+h+`
`+C+" "+M})}function zt(i,l,h,p){i.info(function(){return"XMLHTTP TEXT ("+l+"): "+xu(i,h)+(p?" "+p:"")})}function Cu(i,l){i.info(function(){return"TIMEOUT: "+l})}xn.prototype.info=function(){};function xu(i,l){if(!i.g)return l;if(!l)return null;try{const C=JSON.parse(l);if(C){for(i=0;i<C.length;i++)if(Array.isArray(C[i])){var h=C[i];if(!(h.length<2)){var p=h[1];if(Array.isArray(p)&&!(p.length<1)){var A=p[0];if(A!="noop"&&A!="stop"&&A!="close")for(let M=1;M<p.length;M++)p[M]=""}}}}return Nr(C)}catch{return l}}var vs={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},To={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},wo;function Dr(){}y(Dr,go),Dr.prototype.g=function(){return new XMLHttpRequest},wo=new Dr;function Nn(i){return encodeURIComponent(String(i))}function Nu(i){var l=1;i=i.split(":");const h=[];for(;l>0&&i.length;)h.push(i.shift()),l--;return i.length&&h.push(i.join(":")),h}function rt(i,l,h,p){this.j=i,this.i=l,this.l=h,this.S=p||1,this.V=new Xe(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Io}function Io(){this.i=null,this.g="",this.h=!1}var Ao={},kr={};function Vr(i,l,h){i.M=1,i.A=bs(Me(l)),i.u=h,i.R=!0,So(i,null)}function So(i,l){i.F=Date.now(),Es(i),i.B=Me(i.A);var h=i.B,p=i.S;Array.isArray(p)||(p=[String(p)]),Mo(h.i,"t",p),i.C=0,h=i.j.L,i.h=new Io,i.g=sa(i.j,h?l:null,!i.u),i.P>0&&(i.O=new In(f(i.Y,i,i.g),i.P)),l=i.V,h=i.g,p=i.ba;var A="readystatechange";Array.isArray(A)||(A&&(St[0]=A.toString()),A=St);for(let C=0;C<A.length;C++){const M=At(h,A[C],p||l.handleEvent,!1,l.h||l);if(!M)break;l.g[M.key]=M}l=i.J?vn(i.J):{},i.u?(i.v||(i.v="POST"),l["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,l)):(i.v="GET",i.g.ea(i.B,i.v,null,l)),Sn(),Au(i.i,i.v,i.B,i.l,i.S,i.u)}rt.prototype.ba=function(i){i=i.target;const l=this.O;l&&at(i)==3?l.j():this.Y(i)},rt.prototype.Y=function(i){try{if(i==this.g)e:{const Q=at(this.g),fe=this.g.ya(),se=this.g.ca();if(!(Q<3)&&(Q!=3||this.g&&(this.h.h||this.g.la()||Ko(this.g)))){this.K||Q!=4||fe==7||(fe==8||se<=0?Sn(3):Sn(2)),jr(this);var l=this.g.ca();this.X=l;var h=Ru(this);if(this.o=l==200,Su(this.i,this.v,this.B,this.l,this.S,Q,l),this.o){if(this.U&&!this.L){t:{if(this.g){var p,A=this.g;if((p=A.g?A.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!v(p)){var C=p;break t}}C=null}if(i=C)zt(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Fr(this,i);else{this.o=!1,this.m=3,Ce(12),xt(this),Rn(this);break e}}if(this.R){i=!0;let ye;for(;!this.K&&this.C<h.length;)if(ye=Pu(this,h),ye==kr){Q==4&&(this.m=4,Ce(14),i=!1),zt(this.i,this.l,null,"[Incomplete Response]");break}else if(ye==Ao){this.m=4,Ce(15),zt(this.i,this.l,h,"[Invalid Chunk]"),i=!1;break}else zt(this.i,this.l,ye,null),Fr(this,ye);if(Co(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Q!=4||h.length!=0||this.h.h||(this.m=1,Ce(16),i=!1),this.o=this.o&&i,!i)zt(this.i,this.l,h,"[Invalid Chunked Response]"),xt(this),Rn(this);else if(h.length>0&&!this.W){this.W=!0;var M=this.j;M.g==this&&M.aa&&!M.P&&(M.j.info("Great, no buffering proxy detected. Bytes received: "+h.length),zr(M),M.P=!0,Ce(11))}}else zt(this.i,this.l,h,null),Fr(this,h);Q==4&&xt(this),this.o&&!this.K&&(Q==4?Zo(this.j,this):(this.o=!1,Es(this)))}else Hu(this.g),l==400&&h.indexOf("Unknown SID")>0?(this.m=3,Ce(12)):(this.m=0,Ce(13)),xt(this),Rn(this)}}}catch{}};function Ru(i){if(!Co(i))return i.g.la();const l=Ko(i.g);if(l==="")return"";let h="";const p=l.length,A=at(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return xt(i),Rn(i),"";i.h.i=new a.TextDecoder}for(let C=0;C<p;C++)i.h.h=!0,h+=i.h.i.decode(l[C],{stream:!(A&&C==p-1)});return l.length=0,i.h.g+=h,i.C=0,i.h.g}function Co(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function Pu(i,l){var h=i.C,p=l.indexOf(`
`,h);return p==-1?kr:(h=Number(l.substring(h,p)),isNaN(h)?Ao:(p+=1,p+h>l.length?kr:(l=l.slice(p,p+h),i.C=p+h,l)))}rt.prototype.cancel=function(){this.K=!0,xt(this)};function Es(i){i.T=Date.now()+i.H,xo(i,i.H)}function xo(i,l){if(i.D!=null)throw Error("WatchDog timer not null");i.D=Cn(f(i.aa,i),l)}function jr(i){i.D&&(a.clearTimeout(i.D),i.D=null)}rt.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(Cu(this.i,this.B),this.M!=2&&(Sn(),Ce(17)),xt(this),this.m=2,Rn(this)):xo(this,this.T-i)};function Rn(i){i.j.I==0||i.K||Zo(i.j,i)}function xt(i){jr(i);var l=i.O;l&&typeof l.dispose=="function"&&l.dispose(),i.O=null,po(i.V),i.g&&(l=i.g,i.g=null,l.abort(),l.dispose())}function Fr(i,l){try{var h=i.j;if(h.I!=0&&(h.g==i||Or(h.h,i))){if(!i.L&&Or(h.h,i)&&h.I==3){try{var p=h.Ba.g.parse(l)}catch{p=null}if(Array.isArray(p)&&p.length==3){var A=p;if(A[0]==0){e:if(!h.v){if(h.g)if(h.g.F+3e3<i.F)Ss(h),Is(h);else break e;qr(h),Ce(18)}}else h.xa=A[1],0<h.xa-h.K&&A[2]<37500&&h.F&&h.A==0&&!h.C&&(h.C=Cn(f(h.Va,h),6e3));Po(h.h)<=1&&h.ta&&(h.ta=void 0)}else Rt(h,11)}else if((i.L||h.g==i)&&Ss(h),!v(l))for(A=h.Ba.g.parse(l),l=0;l<A.length;l++){let se=A[l];const ye=se[0];if(!(ye<=h.K))if(h.K=ye,se=se[1],h.I==2)if(se[0]=="c"){h.M=se[1],h.ba=se[2];const Be=se[3];Be!=null&&(h.ka=Be,h.j.info("VER="+h.ka));const Pt=se[4];Pt!=null&&(h.za=Pt,h.j.info("SVER="+h.za));const lt=se[5];lt!=null&&typeof lt=="number"&&lt>0&&(p=1.5*lt,h.O=p,h.j.info("backChannelRequestTimeoutMs_="+p)),p=h;const ct=i.g;if(ct){const xs=ct.g?ct.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(xs){var C=p.h;C.g||xs.indexOf("spdy")==-1&&xs.indexOf("quic")==-1&&xs.indexOf("h2")==-1||(C.j=C.l,C.g=new Set,C.h&&(Lr(C,C.h),C.h=null))}if(p.G){const Hr=ct.g?ct.g.getResponseHeader("X-HTTP-Session-Id"):null;Hr&&(p.wa=Hr,ie(p.J,p.G,Hr))}}h.I=3,h.l&&h.l.ra(),h.aa&&(h.T=Date.now()-i.F,h.j.info("Handshake RTT: "+h.T+"ms")),p=h;var M=i;if(p.na=na(p,p.L?p.ba:null,p.W),M.L){Do(p.h,M);var Q=M,fe=p.O;fe&&(Q.H=fe),Q.D&&(jr(Q),Es(Q)),p.g=M}else Yo(p);h.i.length>0&&As(h)}else se[0]!="stop"&&se[0]!="close"||Rt(h,7);else h.I==3&&(se[0]=="stop"||se[0]=="close"?se[0]=="stop"?Rt(h,7):Ur(h):se[0]!="noop"&&h.l&&h.l.qa(se),h.A=0)}}Sn(4)}catch{}}var Du=class{constructor(i,l){this.g=i,this.map=l}};function No(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ro(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function Po(i){return i.h?1:i.g?i.g.size:0}function Or(i,l){return i.h?i.h==l:i.g?i.g.has(l):!1}function Lr(i,l){i.g?i.g.add(l):i.h=l}function Do(i,l){i.h&&i.h==l?i.h=null:i.g&&i.g.has(l)&&i.g.delete(l)}No.prototype.cancel=function(){if(this.i=ko(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function ko(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let l=i.i;for(const h of i.g.values())l=l.concat(h.G);return l}return S(i.i)}var Vo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ku(i,l){if(i){i=i.split("&");for(let h=0;h<i.length;h++){const p=i[h].indexOf("=");let A,C=null;p>=0?(A=i[h].substring(0,p),C=i[h].substring(p+1)):A=i[h],l(A,C?decodeURIComponent(C.replace(/\+/g," ")):"")}}}function it(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let l;i instanceof it?(this.l=i.l,Pn(this,i.j),this.o=i.o,this.g=i.g,Dn(this,i.u),this.h=i.h,Mr(this,Bo(i.i)),this.m=i.m):i&&(l=String(i).match(Vo))?(this.l=!1,Pn(this,l[1]||"",!0),this.o=kn(l[2]||""),this.g=kn(l[3]||"",!0),Dn(this,l[4]),this.h=kn(l[5]||"",!0),Mr(this,l[6]||"",!0),this.m=kn(l[7]||"")):(this.l=!1,this.i=new jn(null,this.l))}it.prototype.toString=function(){const i=[];var l=this.j;l&&i.push(Vn(l,jo,!0),":");var h=this.g;return(h||l=="file")&&(i.push("//"),(l=this.o)&&i.push(Vn(l,jo,!0),"@"),i.push(Nn(h).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.u,h!=null&&i.push(":",String(h))),(h=this.h)&&(this.g&&h.charAt(0)!="/"&&i.push("/"),i.push(Vn(h,h.charAt(0)=="/"?Fu:ju,!0))),(h=this.i.toString())&&i.push("?",h),(h=this.m)&&i.push("#",Vn(h,Lu)),i.join("")},it.prototype.resolve=function(i){const l=Me(this);let h=!!i.j;h?Pn(l,i.j):h=!!i.o,h?l.o=i.o:h=!!i.g,h?l.g=i.g:h=i.u!=null;var p=i.h;if(h)Dn(l,i.u);else if(h=!!i.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var A=l.h.lastIndexOf("/");A!=-1&&(p=l.h.slice(0,A+1)+p)}if(A=p,A==".."||A==".")p="";else if(A.indexOf("./")!=-1||A.indexOf("/.")!=-1){p=A.lastIndexOf("/",0)==0,A=A.split("/");const C=[];for(let M=0;M<A.length;){const Q=A[M++];Q=="."?p&&M==A.length&&C.push(""):Q==".."?((C.length>1||C.length==1&&C[0]!="")&&C.pop(),p&&M==A.length&&C.push("")):(C.push(Q),p=!0)}p=C.join("/")}else p=A}return h?l.h=p:h=i.i.toString()!=="",h?Mr(l,Bo(i.i)):h=!!i.m,h&&(l.m=i.m),l};function Me(i){return new it(i)}function Pn(i,l,h){i.j=h?kn(l,!0):l,i.j&&(i.j=i.j.replace(/:$/,""))}function Dn(i,l){if(l){if(l=Number(l),isNaN(l)||l<0)throw Error("Bad port number "+l);i.u=l}else i.u=null}function Mr(i,l,h){l instanceof jn?(i.i=l,Mu(i.i,i.l)):(h||(l=Vn(l,Ou)),i.i=new jn(l,i.l))}function ie(i,l,h){i.i.set(l,h)}function bs(i){return ie(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function kn(i,l){return i?l?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function Vn(i,l,h){return typeof i=="string"?(i=encodeURI(i).replace(l,Vu),h&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Vu(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var jo=/[#\/\?@]/g,ju=/[#\?:]/g,Fu=/[#\?]/g,Ou=/[#\?@]/g,Lu=/#/g;function jn(i,l){this.h=this.g=null,this.i=i||null,this.j=!!l}function Nt(i){i.g||(i.g=new Map,i.h=0,i.i&&ku(i.i,function(l,h){i.add(decodeURIComponent(l.replace(/\+/g," ")),h)}))}n=jn.prototype,n.add=function(i,l){Nt(this),this.i=null,i=Ht(this,i);let h=this.g.get(i);return h||this.g.set(i,h=[]),h.push(l),this.h+=1,this};function Fo(i,l){Nt(i),l=Ht(i,l),i.g.has(l)&&(i.i=null,i.h-=i.g.get(l).length,i.g.delete(l))}function Oo(i,l){return Nt(i),l=Ht(i,l),i.g.has(l)}n.forEach=function(i,l){Nt(this),this.g.forEach(function(h,p){h.forEach(function(A){i.call(l,A,p,this)},this)},this)};function Lo(i,l){Nt(i);let h=[];if(typeof l=="string")Oo(i,l)&&(h=h.concat(i.g.get(Ht(i,l))));else for(i=Array.from(i.g.values()),l=0;l<i.length;l++)h=h.concat(i[l]);return h}n.set=function(i,l){return Nt(this),this.i=null,i=Ht(this,i),Oo(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[l]),this.h+=1,this},n.get=function(i,l){return i?(i=Lo(this,i),i.length>0?String(i[0]):l):l};function Mo(i,l,h){Fo(i,l),h.length>0&&(i.i=null,i.g.set(Ht(i,l),S(h)),i.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],l=Array.from(this.g.keys());for(let p=0;p<l.length;p++){var h=l[p];const A=Nn(h);h=Lo(this,h);for(let C=0;C<h.length;C++){let M=A;h[C]!==""&&(M+="="+Nn(h[C])),i.push(M)}}return this.i=i.join("&")};function Bo(i){const l=new jn;return l.i=i.i,i.g&&(l.g=new Map(i.g),l.h=i.h),l}function Ht(i,l){return l=String(l),i.j&&(l=l.toLowerCase()),l}function Mu(i,l){l&&!i.j&&(Nt(i),i.i=null,i.g.forEach(function(h,p){const A=p.toLowerCase();p!=A&&(Fo(this,p),Mo(this,A,h))},i)),i.j=l}function Bu(i,l){const h=new xn;if(a.Image){const p=new Image;p.onload=m(ot,h,"TestLoadImage: loaded",!0,l,p),p.onerror=m(ot,h,"TestLoadImage: error",!1,l,p),p.onabort=m(ot,h,"TestLoadImage: abort",!1,l,p),p.ontimeout=m(ot,h,"TestLoadImage: timeout",!1,l,p),a.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=i}else l(!1)}function $u(i,l){const h=new xn,p=new AbortController,A=setTimeout(()=>{p.abort(),ot(h,"TestPingServer: timeout",!1,l)},1e4);fetch(i,{signal:p.signal}).then(C=>{clearTimeout(A),C.ok?ot(h,"TestPingServer: ok",!0,l):ot(h,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(A),ot(h,"TestPingServer: error",!1,l)})}function ot(i,l,h,p,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),p(h)}catch{}}function Uu(){this.g=new Iu}function Br(i){this.i=i.Sb||null,this.h=i.ab||!1}y(Br,go),Br.prototype.g=function(){return new Ts(this.i,this.h)};function Ts(i,l){ge.call(this),this.H=i,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}y(Ts,ge),n=Ts.prototype,n.open=function(i,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=l,this.readyState=1,On(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const l={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(l.body=i),(this.H||a).fetch(new Request(this.D,l)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Fn(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,On(this)),this.g&&(this.readyState=3,On(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;$o(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function $o(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var l=i.value?i.value:new Uint8Array(0);(l=this.B.decode(l,{stream:!i.done}))&&(this.response=this.responseText+=l)}i.done?Fn(this):On(this),this.readyState==3&&$o(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,Fn(this))},n.Na=function(i){this.g&&(this.response=i,Fn(this))},n.ga=function(){this.g&&Fn(this)};function Fn(i){i.readyState=4,i.l=null,i.j=null,i.B=null,On(i)}n.setRequestHeader=function(i,l){this.A.append(i,l)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],l=this.h.entries();for(var h=l.next();!h.done;)h=h.value,i.push(h[0]+": "+h[1]),h=l.next();return i.join(`\r
`)};function On(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(Ts.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function Uo(i){let l="";return wt(i,function(h,p){l+=p,l+=":",l+=h,l+=`\r
`}),l}function $r(i,l,h){e:{for(p in h){var p=!1;break e}p=!0}p||(h=Uo(h),typeof i=="string"?h!=null&&Nn(h):ie(i,l,h))}function ce(i){ge.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}y(ce,ge);var qu=/^https?$/i,zu=["POST","PUT"];n=ce.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,l,h,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);l=l?l.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():wo.g(),this.g.onreadystatechange=T(f(this.Ca,this));try{this.B=!0,this.g.open(l,String(i),!0),this.B=!1}catch(C){qo(this,C);return}if(i=h||"",h=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var A in p)h.set(A,p[A]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const C of p.keys())h.set(C,p.get(C));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(h.keys()).find(C=>C.toLowerCase()=="content-type"),A=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(zu,l,void 0)>=0)||p||A||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[C,M]of h)this.g.setRequestHeader(C,M);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(C){qo(this,C)}};function qo(i,l){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=l,i.o=5,zo(i),ws(i)}function zo(i){i.A||(i.A=!0,k(i,"complete"),k(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,k(this,"complete"),k(this,"abort"),ws(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ws(this,!0)),ce.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Ho(this):this.Xa())},n.Xa=function(){Ho(this)};function Ho(i){if(i.h&&typeof o<"u"){if(i.v&&at(i)==4)setTimeout(i.Ca.bind(i),0);else if(k(i,"readystatechange"),at(i)==4){i.h=!1;try{const C=i.ca();e:switch(C){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var h;if(!(h=l)){var p;if(p=C===0){let M=String(i.D).match(Vo)[1]||null;!M&&a.self&&a.self.location&&(M=a.self.location.protocol.slice(0,-1)),p=!qu.test(M?M.toLowerCase():"")}h=p}if(h)k(i,"complete"),k(i,"success");else{i.o=6;try{var A=at(i)>2?i.g.statusText:""}catch{A=""}i.l=A+" ["+i.ca()+"]",zo(i)}}finally{ws(i)}}}}function ws(i,l){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const h=i.g;i.g=null,l||k(i,"ready");try{h.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function at(i){return i.g?i.g.readyState:0}n.ca=function(){try{return at(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var l=this.g.responseText;return i&&l.indexOf(i)==0&&(l=l.substring(i.length)),wu(l)}};function Ko(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function Hu(i){const l={};i=(i.g&&at(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<i.length;p++){if(v(i[p]))continue;var h=Nu(i[p]);const A=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const C=l[A]||[];l[A]=C,C.push(h)}fs(l,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ln(i,l,h){return h&&h.internalChannelParams&&h.internalChannelParams[i]||l}function Go(i){this.za=0,this.i=[],this.j=new xn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ln("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ln("baseRetryDelayMs",5e3,i),this.Za=Ln("retryDelaySeedMs",1e4,i),this.Ta=Ln("forwardChannelMaxRetries",2,i),this.va=Ln("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new No(i&&i.concurrentRequestLimit),this.Ba=new Uu,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Go.prototype,n.ka=8,n.I=1,n.connect=function(i,l,h,p){Ce(0),this.W=i,this.H=l||{},h&&p!==void 0&&(this.H.OSID=h,this.H.OAID=p),this.F=this.X,this.J=na(this,null,this.W),As(this)};function Ur(i){if(Wo(i),i.I==3){var l=i.V++,h=Me(i.J);if(ie(h,"SID",i.M),ie(h,"RID",l),ie(h,"TYPE","terminate"),Mn(i,h),l=new rt(i,i.j,l),l.M=2,l.A=bs(Me(h)),h=!1,a.navigator&&a.navigator.sendBeacon)try{h=a.navigator.sendBeacon(l.A.toString(),"")}catch{}!h&&a.Image&&(new Image().src=l.A,h=!0),h||(l.g=sa(l.j,null),l.g.ea(l.A)),l.F=Date.now(),Es(l)}ta(i)}function Is(i){i.g&&(zr(i),i.g.cancel(),i.g=null)}function Wo(i){Is(i),i.v&&(a.clearTimeout(i.v),i.v=null),Ss(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function As(i){if(!Ro(i.h)&&!i.m){i.m=!0;var l=i.Ea;x||g(),H||(x(),H=!0),E.add(l,i),i.D=0}}function Ku(i,l){return Po(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=l.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=Cn(f(i.Ea,i,l),ea(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const A=new rt(this,this.j,i);let C=this.o;if(this.U&&(C?(C=vn(C),En(C,this.U)):C=this.U),this.u!==null||this.R||(A.J=C,C=null),this.S)e:{for(var l=0,h=0;h<this.i.length;h++){t:{var p=this.i[h];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(l+=p,l>4096){l=h;break e}if(l===4096||h===this.i.length-1){l=h+1;break e}}l=1e3}else l=1e3;l=Jo(this,A,l),h=Me(this.J),ie(h,"RID",i),ie(h,"CVER",22),this.G&&ie(h,"X-HTTP-Session-Id",this.G),Mn(this,h),C&&(this.R?l="headers="+Nn(Uo(C))+"&"+l:this.u&&$r(h,this.u,C)),Lr(this.h,A),this.Ra&&ie(h,"TYPE","init"),this.S?(ie(h,"$req",l),ie(h,"SID","null"),A.U=!0,Vr(A,h,null)):Vr(A,h,l),this.I=2}}else this.I==3&&(i?Qo(this,i):this.i.length==0||Ro(this.h)||Qo(this))};function Qo(i,l){var h;l?h=l.l:h=i.V++;const p=Me(i.J);ie(p,"SID",i.M),ie(p,"RID",h),ie(p,"AID",i.K),Mn(i,p),i.u&&i.o&&$r(p,i.u,i.o),h=new rt(i,i.j,h,i.D+1),i.u===null&&(h.J=i.o),l&&(i.i=l.G.concat(i.i)),l=Jo(i,h,1e3),h.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Lr(i.h,h),Vr(h,p,l)}function Mn(i,l){i.H&&wt(i.H,function(h,p){ie(l,p,h)}),i.l&&wt({},function(h,p){ie(l,p,h)})}function Jo(i,l,h){h=Math.min(i.i.length,h);const p=i.l?f(i.l.Ka,i.l,i):null;e:{var A=i.i;let Q=-1;for(;;){const fe=["count="+h];Q==-1?h>0?(Q=A[0].g,fe.push("ofs="+Q)):Q=0:fe.push("ofs="+Q);let se=!0;for(let ye=0;ye<h;ye++){var C=A[ye].g;const Be=A[ye].map;if(C-=Q,C<0)Q=Math.max(0,A[ye].g-100),se=!1;else try{C="req"+C+"_"||"";try{var M=Be instanceof Map?Be:Object.entries(Be);for(const[Pt,lt]of M){let ct=lt;u(lt)&&(ct=Nr(lt)),fe.push(C+Pt+"="+encodeURIComponent(ct))}}catch(Pt){throw fe.push(C+"type="+encodeURIComponent("_badmap")),Pt}}catch{p&&p(Be)}}if(se){M=fe.join("&");break e}}M=void 0}return i=i.i.splice(0,h),l.G=i,M}function Yo(i){if(!i.g&&!i.v){i.Y=1;var l=i.Da;x||g(),H||(x(),H=!0),E.add(l,i),i.A=0}}function qr(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=Cn(f(i.Da,i),ea(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,Xo(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=Cn(f(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ce(10),Is(this),Xo(this))};function zr(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function Xo(i){i.g=new rt(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var l=Me(i.na);ie(l,"RID","rpc"),ie(l,"SID",i.M),ie(l,"AID",i.K),ie(l,"CI",i.F?"0":"1"),!i.F&&i.ia&&ie(l,"TO",i.ia),ie(l,"TYPE","xmlhttp"),Mn(i,l),i.u&&i.o&&$r(l,i.u,i.o),i.O&&(i.g.H=i.O);var h=i.g;i=i.ba,h.M=1,h.A=bs(Me(l)),h.u=null,h.R=!0,So(h,i)}n.Va=function(){this.C!=null&&(this.C=null,Is(this),qr(this),Ce(19))};function Ss(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function Zo(i,l){var h=null;if(i.g==l){Ss(i),zr(i),i.g=null;var p=2}else if(Or(i.h,l))h=l.G,Do(i.h,l),p=1;else return;if(i.I!=0){if(l.o)if(p==1){h=l.u?l.u.length:0,l=Date.now()-l.F;var A=i.D;p=_s(),k(p,new bo(p,h)),As(i)}else Yo(i);else if(A=l.m,A==3||A==0&&l.X>0||!(p==1&&Ku(i,l)||p==2&&qr(i)))switch(h&&h.length>0&&(l=i.h,l.i=l.i.concat(h)),A){case 1:Rt(i,5);break;case 4:Rt(i,10);break;case 3:Rt(i,6);break;default:Rt(i,2)}}}function ea(i,l){let h=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(h*=2),h*l}function Rt(i,l){if(i.j.info("Error code "+l),l==2){var h=f(i.bb,i),p=i.Ua;const A=!p;p=new it(p||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Pn(p,"https"),bs(p),A?Bu(p.toString(),h):$u(p.toString(),h)}else Ce(2);i.I=0,i.l&&i.l.pa(l),ta(i),Wo(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),Ce(2)):(this.j.info("Failed to ping google.com"),Ce(1))};function ta(i){if(i.I=0,i.ja=[],i.l){const l=ko(i.h);(l.length!=0||i.i.length!=0)&&(P(i.ja,l),P(i.ja,i.i),i.h.i.length=0,S(i.i),i.i.length=0),i.l.oa()}}function na(i,l,h){var p=h instanceof it?Me(h):new it(h);if(p.g!="")l&&(p.g=l+"."+p.g),Dn(p,p.u);else{var A=a.location;p=A.protocol,l=l?l+"."+A.hostname:A.hostname,A=+A.port;const C=new it(null);p&&Pn(C,p),l&&(C.g=l),A&&Dn(C,A),h&&(C.h=h),p=C}return h=i.G,l=i.wa,h&&l&&ie(p,h,l),ie(p,"VER",i.ka),Mn(i,p),p}function sa(i,l,h){if(l&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return l=i.Aa&&!i.ma?new ce(new Br({ab:h})):new ce(i.ma),l.Fa(i.L),l}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ra(){}n=ra.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Cs(){}Cs.prototype.g=function(i,l){return new Re(i,l)};function Re(i,l){ge.call(this),this.g=new Go(l),this.l=i,this.h=l&&l.messageUrlParams||null,i=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(i?i["X-WebChannel-Content-Type"]=l.messageContentType:i={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.sa&&(i?i["X-WebChannel-Client-Profile"]=l.sa:i={"X-WebChannel-Client-Profile":l.sa}),this.g.U=i,(i=l&&l.Qb)&&!v(i)&&(this.g.u=i),this.A=l&&l.supportsCrossDomainXhr||!1,this.v=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!v(l)&&(this.g.G=l,i=this.h,i!==null&&l in i&&(i=this.h,l in i&&delete i[l])),this.j=new Kt(this)}y(Re,ge),Re.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Re.prototype.close=function(){Ur(this.g)},Re.prototype.o=function(i){var l=this.g;if(typeof i=="string"){var h={};h.__data__=i,i=h}else this.v&&(h={},h.__data__=Nr(i),i=h);l.i.push(new Du(l.Ya++,i)),l.I==3&&As(l)},Re.prototype.N=function(){this.g.l=null,delete this.j,Ur(this.g),delete this.g,Re.Z.N.call(this)};function ia(i){Rr.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var l=i.__sm__;if(l){e:{for(const h in l){i=h;break e}i=void 0}(this.i=i)&&(i=this.i,l=l!==null&&i in l?l[i]:void 0),this.data=l}else this.data=i}y(ia,Rr);function oa(){Pr.call(this),this.status=1}y(oa,Pr);function Kt(i){this.g=i}y(Kt,ra),Kt.prototype.ra=function(){k(this.g,"a")},Kt.prototype.qa=function(i){k(this.g,new ia(i))},Kt.prototype.pa=function(i){k(this.g,new oa)},Kt.prototype.oa=function(){k(this.g,"b")},Cs.prototype.createWebChannel=Cs.prototype.g,Re.prototype.send=Re.prototype.o,Re.prototype.open=Re.prototype.m,Re.prototype.close=Re.prototype.close,zl=function(){return new Cs},ql=function(){return _s()},Ul=Ct,di={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},vs.NO_ERROR=0,vs.TIMEOUT=8,vs.HTTP_ERROR=6,Fs=vs,To.COMPLETE="complete",$l=To,yo.EventType=An,An.OPEN="a",An.CLOSE="b",An.ERROR="c",An.MESSAGE="d",ge.prototype.listen=ge.prototype.J,Un=yo,ce.prototype.listenOnce=ce.prototype.K,ce.prototype.getLastError=ce.prototype.Ha,ce.prototype.getLastErrorCode=ce.prototype.ya,ce.prototype.getStatus=ce.prototype.ca,ce.prototype.getResponseJson=ce.prototype.La,ce.prototype.getResponseText=ce.prototype.la,ce.prototype.send=ce.prototype.ea,ce.prototype.setWithCredentials=ce.prototype.Fa,Bl=ce}).apply(typeof Rs<"u"?Rs:typeof self<"u"?self:typeof window<"u"?window:{});class Ae{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ae.UNAUTHENTICATED=new Ae(null),Ae.GOOGLE_CREDENTIALS=new Ae("google-credentials-uid"),Ae.FIRST_PARTY=new Ae("first-party-uid"),Ae.MOCK_USER=new Ae("mock-user");let fn="12.9.0";function Md(n){fn=n}const Vt=new kl("@firebase/firestore");function Gt(){return Vt.logLevel}function $(n,...e){if(Vt.logLevel<=Z.DEBUG){const t=e.map(ki);Vt.debug(`Firestore (${fn}): ${n}`,...t)}}function et(n,...e){if(Vt.logLevel<=Z.ERROR){const t=e.map(ki);Vt.error(`Firestore (${fn}): ${n}`,...t)}}function jt(n,...e){if(Vt.logLevel<=Z.WARN){const t=e.map(ki);Vt.warn(`Firestore (${fn}): ${n}`,...t)}}function ki(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function K(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,Hl(n,s,t)}function Hl(n,e,t){let s=`FIRESTORE (${fn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw et(s),new Error(s)}function ne(n,e,t,s){let r="Unexpected state";typeof t=="string"?r=t:s=t,n||Hl(e,r,s)}function W(n,e){return n}const D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class q extends dn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class pt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Kl{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Bd{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Ae.UNAUTHENTICATED)))}shutdown(){}}class $d{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Ud{constructor(e){this.t=e,this.currentUser=Ae.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ne(this.o===void 0,42304);let s=this.i;const r=d=>this.i!==s?(s=this.i,t(d)):Promise.resolve();let o=new pt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new pt,e.enqueueRetryable((()=>r(this.currentUser)))};const a=()=>{const d=o;e.enqueueRetryable((async()=>{await d.promise,await r(this.currentUser)}))},u=d=>{$("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((d=>u(d))),setTimeout((()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?u(d):($("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new pt)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((s=>this.i!==e?($("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(ne(typeof s.accessToken=="string",31837,{l:s}),new Kl(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ne(e===null||typeof e=="string",2055,{h:e}),new Ae(e)}}class qd{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=Ae.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class zd{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new qd(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Ae.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ta{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Hd{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Td(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ne(this.o===void 0,3512);const s=o=>{o.error!=null&&$("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,$("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>s(o)))};const r=o=>{$("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>r(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?r(o):$("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Ta(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(ne(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Ta(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Kd(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}class Vi{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const r=Kd(40);for(let o=0;o<r.length;++o)s.length<20&&r[o]<t&&(s+=e.charAt(r[o]%62))}return s}}function J(n,e){return n<e?-1:n>e?1:0}function fi(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const r=n.charAt(s),o=e.charAt(s);if(r!==o)return Yr(r)===Yr(o)?J(r,o):Yr(r)?1:-1}return J(n.length,e.length)}const Gd=55296,Wd=57343;function Yr(n){const e=n.charCodeAt(0);return e>=Gd&&e<=Wd}function sn(n,e,t){return n.length===e.length&&n.every(((s,r)=>t(s,e[r])))}const wa="__name__";class $e{constructor(e,t,s){t===void 0?t=0:t>e.length&&K(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&K(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return $e.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof $e?e.forEach((s=>{t.push(s)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const o=$e.compareSegments(e.get(r),t.get(r));if(o!==0)return o}return J(e.length,t.length)}static compareSegments(e,t){const s=$e.isNumericId(e),r=$e.isNumericId(t);return s&&!r?-1:!s&&r?1:s&&r?$e.extractNumericId(e).compare($e.extractNumericId(t)):fi(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return mt.fromString(e.substring(4,e.length-2))}}class oe extends $e{construct(e,t,s){return new oe(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new q(D.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter((r=>r.length>0)))}return new oe(t)}static emptyPath(){return new oe([])}}const Qd=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Te extends $e{construct(e,t,s){return new Te(e,t,s)}static isValidIdentifier(e){return Qd.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Te.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===wa}static keyField(){return new Te([wa])}static fromServerFormat(e){const t=[];let s="",r=0;const o=()=>{if(s.length===0)throw new q(D.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let a=!1;for(;r<e.length;){const u=e[r];if(u==="\\"){if(r+1===e.length)throw new q(D.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[r+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new q(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=d,r+=2}else u==="`"?(a=!a,r++):u!=="."||a?(s+=u,r++):(o(),r++)}if(o(),a)throw new q(D.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Te(t)}static emptyPath(){return new Te([])}}class z{constructor(e){this.path=e}static fromPath(e){return new z(oe.fromString(e))}static fromName(e){return new z(oe.fromString(e).popFirst(5))}static empty(){return new z(oe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&oe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return oe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new z(new oe(e.slice()))}}function Gl(n,e,t){if(!t)throw new q(D.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Jd(n,e,t,s){if(e===!0&&s===!0)throw new q(D.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Ia(n){if(!z.isDocumentKey(n))throw new q(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Aa(n){if(z.isDocumentKey(n))throw new q(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Wl(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function ji(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(s){return s.constructor?s.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":K(12329,{type:typeof n})}function rn(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new q(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ji(n);throw new q(D.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function de(n,e){const t={typeString:n};return e&&(t.value=e),t}function as(n,e){if(!Wl(n))throw new q(D.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const r=e[s].typeString,o="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const a=n[s];if(r&&typeof a!==r){t=`JSON field '${s}' must be a ${r}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${s}' field to equal '${o.value}'`;break}}if(t)throw new q(D.INVALID_ARGUMENT,t);return!0}const Sa=-62135596800,Ca=1e6;class ae{static now(){return ae.fromMillis(Date.now())}static fromDate(e){return ae.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*Ca);return new ae(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new q(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new q(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Sa)throw new q(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new q(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Ca}_compareTo(e){return this.seconds===e.seconds?J(this.nanoseconds,e.nanoseconds):J(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ae._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(as(e,ae._jsonSchema))return new ae(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Sa;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ae._jsonSchemaVersion="firestore/timestamp/1.0",ae._jsonSchema={type:de("string",ae._jsonSchemaVersion),seconds:de("number"),nanoseconds:de("number")};class G{static fromTimestamp(e){return new G(e)}static min(){return new G(new ae(0,0))}static max(){return new G(new ae(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const ts=-1;function Yd(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=G.fromTimestamp(s===1e9?new ae(t+1,0):new ae(t,s));return new yt(r,z.empty(),e)}function Xd(n){return new yt(n.readTime,n.key,ts)}class yt{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new yt(G.min(),z.empty(),ts)}static max(){return new yt(G.max(),z.empty(),ts)}}function Zd(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=z.comparator(n.documentKey,e.documentKey),t!==0?t:J(n.largestBatchId,e.largestBatchId))}const ef="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class tf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function mn(n){if(n.code!==D.FAILED_PRECONDITION||n.message!==ef)throw n;$("LocalStore","Unexpectedly lost primary lease")}class N{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&K(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new N(((s,r)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(s,r)},this.catchCallback=o=>{this.wrapFailure(t,o).next(s,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof N?t:N.resolve(t)}catch(t){return N.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):N.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):N.reject(t)}static resolve(e){return new N(((t,s)=>{t(e)}))}static reject(e){return new N(((t,s)=>{s(e)}))}static waitFor(e){return new N(((t,s)=>{let r=0,o=0,a=!1;e.forEach((u=>{++r,u.next((()=>{++o,a&&o===r&&t()}),(d=>s(d)))})),a=!0,o===r&&t()}))}static or(e){let t=N.resolve(!1);for(const s of e)t=t.next((r=>r?N.resolve(r):s()));return t}static forEach(e,t){const s=[];return e.forEach(((r,o)=>{s.push(t.call(this,r,o))})),this.waitFor(s)}static mapArray(e,t){return new N(((s,r)=>{const o=e.length,a=new Array(o);let u=0;for(let d=0;d<o;d++){const f=d;t(e[f]).next((m=>{a[f]=m,++u,u===o&&s(a)}),(m=>r(m)))}}))}static doWhile(e,t){return new N(((s,r)=>{const o=()=>{e()===!0?t().next((()=>{o()}),r):s()};o()}))}}function nf(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function pn(n){return n.name==="IndexedDbTransactionError"}class ir{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}ir.ce=-1;const Fi=-1;function or(n){return n==null}function Ks(n){return n===0&&1/n==-1/0}function sf(n){return typeof n=="number"&&Number.isInteger(n)&&!Ks(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const Ql="";function rf(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=xa(e)),e=of(n.get(t),e);return xa(e)}function of(n,e){let t=e;const s=n.length;for(let r=0;r<s;r++){const o=n.charAt(r);switch(o){case"\0":t+="";break;case Ql:t+="";break;default:t+=o}}return t}function xa(n){return n+Ql+""}function Na(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ot(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Jl(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class le{constructor(e,t){this.comparator=e,this.root=t||be.EMPTY}insert(e,t){return new le(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,be.BLACK,null,null))}remove(e){return new le(this.comparator,this.root.remove(e,this.comparator).copy(null,null,be.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,s)=>(e(t,s),!1)))}toString(){const e=[];return this.inorderTraversal(((t,s)=>(e.push(`${t}:${s}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ps(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ps(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ps(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ps(this.root,e,this.comparator,!0)}}class Ps{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?s(e.key,t):1,t&&r&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class be{constructor(e,t,s,r,o){this.key=e,this.value=t,this.color=s??be.RED,this.left=r??be.EMPTY,this.right=o??be.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,o){return new be(e??this.key,t??this.value,s??this.color,r??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const o=s(e,r.key);return r=o<0?r.copy(null,null,null,r.left.insert(e,t,s),null):o===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return be.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return be.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,be.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,be.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw K(43730,{key:this.key,value:this.value});if(this.right.isRed())throw K(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw K(27949);return e+(this.isRed()?0:1)}}be.EMPTY=null,be.RED=!0,be.BLACK=!1;be.EMPTY=new class{constructor(){this.size=0}get key(){throw K(57766)}get value(){throw K(16141)}get color(){throw K(16727)}get left(){throw K(29726)}get right(){throw K(36894)}copy(e,t,s,r,o){return this}insert(e,t,s){return new be(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class pe{constructor(e){this.comparator=e,this.data=new le(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,s)=>(e(t),!1)))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ra(this.data.getIterator())}getIteratorFrom(e){return new Ra(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((s=>{t=t.add(s)})),t}isEqual(e){if(!(e instanceof pe)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,o=s.getNext().key;if(this.comparator(r,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new pe(this.comparator);return t.data=e,t}}class Ra{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class je{constructor(e){this.fields=e,e.sort(Te.comparator)}static empty(){return new je([])}unionWith(e){let t=new pe(Te.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new je(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return sn(this.fields,e.fields,((t,s)=>t.isEqual(s)))}}class Yl extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class we{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(r){try{return atob(r)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Yl("Invalid base64 string: "+o):o}})(e);return new we(t)}static fromUint8Array(e){const t=(function(r){let o="";for(let a=0;a<r.length;++a)o+=String.fromCharCode(r[a]);return o})(e);return new we(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return J(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}we.EMPTY_BYTE_STRING=new we("");const af=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _t(n){if(ne(!!n,39018),typeof n=="string"){let e=0;const t=af.exec(n);if(ne(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:ue(n.seconds),nanos:ue(n.nanos)}}function ue(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function vt(n){return typeof n=="string"?we.fromBase64String(n):we.fromUint8Array(n)}const Xl="server_timestamp",Zl="__type__",ec="__previous_value__",tc="__local_write_time__";function Oi(n){return(n?.mapValue?.fields||{})[Zl]?.stringValue===Xl}function ar(n){const e=n.mapValue.fields[ec];return Oi(e)?ar(e):e}function ns(n){const e=_t(n.mapValue.fields[tc].timestampValue);return new ae(e.seconds,e.nanos)}class lf{constructor(e,t,s,r,o,a,u,d,f,m,y){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=d,this.useFetchStreams=f,this.isUsingEmulator=m,this.apiKey=y}}const Gs="(default)";class ss{constructor(e,t){this.projectId=e,this.database=t||Gs}static empty(){return new ss("","")}get isDefaultDatabase(){return this.database===Gs}isEqual(e){return e instanceof ss&&e.projectId===this.projectId&&e.database===this.database}}function cf(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new q(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ss(n.options.projectId,e)}const nc="__type__",uf="__max__",Ds={mapValue:{}},sc="__vector__",Ws="value";function Et(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Oi(n)?4:df(n)?9007199254740991:hf(n)?10:11:K(28295,{value:n})}function Ke(n,e){if(n===e)return!0;const t=Et(n);if(t!==Et(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ns(n).isEqual(ns(e));case 3:return(function(r,o){if(typeof r.timestampValue=="string"&&typeof o.timestampValue=="string"&&r.timestampValue.length===o.timestampValue.length)return r.timestampValue===o.timestampValue;const a=_t(r.timestampValue),u=_t(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(r,o){return vt(r.bytesValue).isEqual(vt(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(r,o){return ue(r.geoPointValue.latitude)===ue(o.geoPointValue.latitude)&&ue(r.geoPointValue.longitude)===ue(o.geoPointValue.longitude)})(n,e);case 2:return(function(r,o){if("integerValue"in r&&"integerValue"in o)return ue(r.integerValue)===ue(o.integerValue);if("doubleValue"in r&&"doubleValue"in o){const a=ue(r.doubleValue),u=ue(o.doubleValue);return a===u?Ks(a)===Ks(u):isNaN(a)&&isNaN(u)}return!1})(n,e);case 9:return sn(n.arrayValue.values||[],e.arrayValue.values||[],Ke);case 10:case 11:return(function(r,o){const a=r.mapValue.fields||{},u=o.mapValue.fields||{};if(Na(a)!==Na(u))return!1;for(const d in a)if(a.hasOwnProperty(d)&&(u[d]===void 0||!Ke(a[d],u[d])))return!1;return!0})(n,e);default:return K(52216,{left:n})}}function rs(n,e){return(n.values||[]).find((t=>Ke(t,e)))!==void 0}function on(n,e){if(n===e)return 0;const t=Et(n),s=Et(e);if(t!==s)return J(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return J(n.booleanValue,e.booleanValue);case 2:return(function(o,a){const u=ue(o.integerValue||o.doubleValue),d=ue(a.integerValue||a.doubleValue);return u<d?-1:u>d?1:u===d?0:isNaN(u)?isNaN(d)?0:-1:1})(n,e);case 3:return Pa(n.timestampValue,e.timestampValue);case 4:return Pa(ns(n),ns(e));case 5:return fi(n.stringValue,e.stringValue);case 6:return(function(o,a){const u=vt(o),d=vt(a);return u.compareTo(d)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){const u=o.split("/"),d=a.split("/");for(let f=0;f<u.length&&f<d.length;f++){const m=J(u[f],d[f]);if(m!==0)return m}return J(u.length,d.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){const u=J(ue(o.latitude),ue(a.latitude));return u!==0?u:J(ue(o.longitude),ue(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Da(n.arrayValue,e.arrayValue);case 10:return(function(o,a){const u=o.fields||{},d=a.fields||{},f=u[Ws]?.arrayValue,m=d[Ws]?.arrayValue,y=J(f?.values?.length||0,m?.values?.length||0);return y!==0?y:Da(f,m)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===Ds.mapValue&&a===Ds.mapValue)return 0;if(o===Ds.mapValue)return 1;if(a===Ds.mapValue)return-1;const u=o.fields||{},d=Object.keys(u),f=a.fields||{},m=Object.keys(f);d.sort(),m.sort();for(let y=0;y<d.length&&y<m.length;++y){const T=fi(d[y],m[y]);if(T!==0)return T;const S=on(u[d[y]],f[m[y]]);if(S!==0)return S}return J(d.length,m.length)})(n.mapValue,e.mapValue);default:throw K(23264,{he:t})}}function Pa(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return J(n,e);const t=_t(n),s=_t(e),r=J(t.seconds,s.seconds);return r!==0?r:J(t.nanos,s.nanos)}function Da(n,e){const t=n.values||[],s=e.values||[];for(let r=0;r<t.length&&r<s.length;++r){const o=on(t[r],s[r]);if(o)return o}return J(t.length,s.length)}function an(n){return mi(n)}function mi(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const s=_t(t);return`time(${s.seconds},${s.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return vt(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return z.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let s="[",r=!0;for(const o of t.values||[])r?r=!1:s+=",",s+=mi(o);return s+"]"})(n.arrayValue):"mapValue"in n?(function(t){const s=Object.keys(t.fields||{}).sort();let r="{",o=!0;for(const a of s)o?o=!1:r+=",",r+=`${a}:${mi(t.fields[a])}`;return r+"}"})(n.mapValue):K(61005,{value:n})}function Os(n){switch(Et(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=ar(n);return e?16+Os(e):16;case 5:return 2*n.stringValue.length;case 6:return vt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((r,o)=>r+Os(o)),0)})(n.arrayValue);case 10:case 11:return(function(s){let r=0;return Ot(s.fields,((o,a)=>{r+=o.length+Os(a)})),r})(n.mapValue);default:throw K(13486,{value:n})}}function pi(n){return!!n&&"integerValue"in n}function Li(n){return!!n&&"arrayValue"in n}function ka(n){return!!n&&"nullValue"in n}function Va(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ls(n){return!!n&&"mapValue"in n}function hf(n){return(n?.mapValue?.fields||{})[nc]?.stringValue===sc}function Gn(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Ot(n.mapValue.fields,((t,s)=>e.mapValue.fields[t]=Gn(s))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Gn(n.arrayValue.values[t]);return e}return{...n}}function df(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===uf}class ke{constructor(e){this.value=e}static empty(){return new ke({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!Ls(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Gn(t)}setAll(e){let t=Te.emptyPath(),s={},r=[];e.forEach(((a,u)=>{if(!t.isImmediateParentOf(u)){const d=this.getFieldsMap(t);this.applyChanges(d,s,r),s={},r=[],t=u.popLast()}a?s[u.lastSegment()]=Gn(a):r.push(u.lastSegment())}));const o=this.getFieldsMap(t);this.applyChanges(o,s,r)}delete(e){const t=this.field(e.popLast());Ls(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ke(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];Ls(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){Ot(t,((r,o)=>e[r]=o));for(const r of s)delete e[r]}clone(){return new ke(Gn(this.value))}}function rc(n){const e=[];return Ot(n.fields,((t,s)=>{const r=new Te([t]);if(Ls(s)){const o=rc(s.mapValue).fields;if(o.length===0)e.push(r);else for(const a of o)e.push(r.child(a))}else e.push(r)})),new je(e)}class Se{constructor(e,t,s,r,o,a,u){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new Se(e,0,G.min(),G.min(),G.min(),ke.empty(),0)}static newFoundDocument(e,t,s,r){return new Se(e,1,t,G.min(),s,r,0)}static newNoDocument(e,t){return new Se(e,2,t,G.min(),G.min(),ke.empty(),0)}static newUnknownDocument(e,t){return new Se(e,3,t,G.min(),G.min(),ke.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(G.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ke.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ke.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=G.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Se&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Se(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Qs{constructor(e,t){this.position=e,this.inclusive=t}}function ja(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const o=e[r],a=n.position[r];if(o.field.isKeyField()?s=z.comparator(z.fromName(a.referenceValue),t.key):s=on(a,t.data.field(o.field)),o.dir==="desc"&&(s*=-1),s!==0)break}return s}function Fa(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ke(n.position[t],e.position[t]))return!1;return!0}class Js{constructor(e,t="asc"){this.field=e,this.dir=t}}function ff(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class ic{}class me extends ic{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new pf(e,t,s):t==="array-contains"?new _f(e,s):t==="in"?new vf(e,s):t==="not-in"?new Ef(e,s):t==="array-contains-any"?new bf(e,s):new me(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new gf(e,s):new yf(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(on(t,this.value)):t!==null&&Et(this.value)===Et(t)&&this.matchesComparison(on(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return K(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ge extends ic{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ge(e,t)}matches(e){return oc(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function oc(n){return n.op==="and"}function ac(n){return mf(n)&&oc(n)}function mf(n){for(const e of n.filters)if(e instanceof Ge)return!1;return!0}function gi(n){if(n instanceof me)return n.field.canonicalString()+n.op.toString()+an(n.value);if(ac(n))return n.filters.map((e=>gi(e))).join(",");{const e=n.filters.map((t=>gi(t))).join(",");return`${n.op}(${e})`}}function lc(n,e){return n instanceof me?(function(s,r){return r instanceof me&&s.op===r.op&&s.field.isEqual(r.field)&&Ke(s.value,r.value)})(n,e):n instanceof Ge?(function(s,r){return r instanceof Ge&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce(((o,a,u)=>o&&lc(a,r.filters[u])),!0):!1})(n,e):void K(19439)}function cc(n){return n instanceof me?(function(t){return`${t.field.canonicalString()} ${t.op} ${an(t.value)}`})(n):n instanceof Ge?(function(t){return t.op.toString()+" {"+t.getFilters().map(cc).join(" ,")+"}"})(n):"Filter"}class pf extends me{constructor(e,t,s){super(e,t,s),this.key=z.fromName(s.referenceValue)}matches(e){const t=z.comparator(e.key,this.key);return this.matchesComparison(t)}}class gf extends me{constructor(e,t){super(e,"in",t),this.keys=uc("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class yf extends me{constructor(e,t){super(e,"not-in",t),this.keys=uc("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function uc(n,e){return(e.arrayValue?.values||[]).map((t=>z.fromName(t.referenceValue)))}class _f extends me{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Li(t)&&rs(t.arrayValue,this.value)}}class vf extends me{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&rs(this.value.arrayValue,t)}}class Ef extends me{constructor(e,t){super(e,"not-in",t)}matches(e){if(rs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!rs(this.value.arrayValue,t)}}class bf extends me{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Li(t)||!t.arrayValue.values)&&t.arrayValue.values.some((s=>rs(this.value.arrayValue,s)))}}class Tf{constructor(e,t=null,s=[],r=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}}function Oa(n,e=null,t=[],s=[],r=null,o=null,a=null){return new Tf(n,e,t,s,r,o,a)}function Mi(n){const e=W(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((s=>gi(s))).join(","),t+="|ob:",t+=e.orderBy.map((s=>(function(o){return o.field.canonicalString()+o.dir})(s))).join(","),or(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((s=>an(s))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((s=>an(s))).join(",")),e.Te=t}return e.Te}function Bi(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!ff(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!lc(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Fa(n.startAt,e.startAt)&&Fa(n.endAt,e.endAt)}function yi(n){return z.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class lr{constructor(e,t=null,s=[],r=[],o=null,a="F",u=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=d,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function wf(n,e,t,s,r,o,a,u){return new lr(n,e,t,s,r,o,a,u)}function hc(n){return new lr(n)}function La(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function If(n){return z.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Af(n){return n.collectionGroup!==null}function Wn(n){const e=W(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new pe(Te.comparator);return a.filters.forEach((d=>{d.getFlattenedFilters().forEach((f=>{f.isInequality()&&(u=u.add(f.field))}))})),u})(e).forEach((o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Js(o,s))})),t.has(Te.keyField().canonicalString())||e.Ie.push(new Js(Te.keyField(),s))}return e.Ie}function Ue(n){const e=W(n);return e.Ee||(e.Ee=Sf(e,Wn(n))),e.Ee}function Sf(n,e){if(n.limitType==="F")return Oa(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((r=>{const o=r.dir==="desc"?"asc":"desc";return new Js(r.field,o)}));const t=n.endAt?new Qs(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new Qs(n.startAt.position,n.startAt.inclusive):null;return Oa(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function _i(n,e,t){return new lr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function cr(n,e){return Bi(Ue(n),Ue(e))&&n.limitType===e.limitType}function dc(n){return`${Mi(Ue(n))}|lt:${n.limitType}`}function Wt(n){return`Query(target=${(function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map((r=>cc(r))).join(", ")}]`),or(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map((r=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(r))).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map((r=>an(r))).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map((r=>an(r))).join(",")),`Target(${s})`})(Ue(n))}; limitType=${n.limitType})`}function ur(n,e){return e.isFoundDocument()&&(function(s,r){const o=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(o):z.isDocumentKey(s.path)?s.path.isEqual(o):s.path.isImmediateParentOf(o)})(n,e)&&(function(s,r){for(const o of Wn(s))if(!o.field.isKeyField()&&r.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(s,r){for(const o of s.filters)if(!o.matches(r))return!1;return!0})(n,e)&&(function(s,r){return!(s.startAt&&!(function(a,u,d){const f=ja(a,u,d);return a.inclusive?f<=0:f<0})(s.startAt,Wn(s),r)||s.endAt&&!(function(a,u,d){const f=ja(a,u,d);return a.inclusive?f>=0:f>0})(s.endAt,Wn(s),r))})(n,e)}function Cf(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function fc(n){return(e,t)=>{let s=!1;for(const r of Wn(n)){const o=xf(r,e,t);if(o!==0)return o;s=s||r.field.isKeyField()}return 0}}function xf(n,e,t){const s=n.field.isKeyField()?z.comparator(e.key,t.key):(function(o,a,u){const d=a.data.field(o),f=u.data.field(o);return d!==null&&f!==null?on(d,f):K(42886)})(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return K(19790,{direction:n.dir})}}class Lt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[r,o]of s)if(this.equalsFn(r,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let o=0;o<r.length;o++)if(this.equalsFn(r[o][0],e))return void(r[o]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Ot(this.inner,((t,s)=>{for(const[r,o]of s)e(r,o)}))}isEmpty(){return Jl(this.inner)}size(){return this.innerSize}}const Nf=new le(z.comparator);function tt(){return Nf}const mc=new le(z.comparator);function qn(...n){let e=mc;for(const t of n)e=e.insert(t.key,t);return e}function pc(n){let e=mc;return n.forEach(((t,s)=>e=e.insert(t,s.overlayedDocument))),e}function kt(){return Qn()}function gc(){return Qn()}function Qn(){return new Lt((n=>n.toString()),((n,e)=>n.isEqual(e)))}const Rf=new le(z.comparator),Pf=new pe(z.comparator);function Y(...n){let e=Pf;for(const t of n)e=e.add(t);return e}const Df=new pe(J);function kf(){return Df}function $i(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ks(e)?"-0":e}}function yc(n){return{integerValue:""+n}}function Vf(n,e){return sf(e)?yc(e):$i(n,e)}class hr{constructor(){this._=void 0}}function jf(n,e,t){return n instanceof Ys?(function(r,o){const a={fields:{[Zl]:{stringValue:Xl},[tc]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return o&&Oi(o)&&(o=ar(o)),o&&(a.fields[ec]=o),{mapValue:a}})(t,e):n instanceof is?vc(n,e):n instanceof os?Ec(n,e):(function(r,o){const a=_c(r,o),u=Ma(a)+Ma(r.Ae);return pi(a)&&pi(r.Ae)?yc(u):$i(r.serializer,u)})(n,e)}function Ff(n,e,t){return n instanceof is?vc(n,e):n instanceof os?Ec(n,e):t}function _c(n,e){return n instanceof Xs?(function(s){return pi(s)||(function(o){return!!o&&"doubleValue"in o})(s)})(e)?e:{integerValue:0}:null}class Ys extends hr{}class is extends hr{constructor(e){super(),this.elements=e}}function vc(n,e){const t=bc(e);for(const s of n.elements)t.some((r=>Ke(r,s)))||t.push(s);return{arrayValue:{values:t}}}class os extends hr{constructor(e){super(),this.elements=e}}function Ec(n,e){let t=bc(e);for(const s of n.elements)t=t.filter((r=>!Ke(r,s)));return{arrayValue:{values:t}}}class Xs extends hr{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Ma(n){return ue(n.integerValue||n.doubleValue)}function bc(n){return Li(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Of(n,e){return n.field.isEqual(e.field)&&(function(s,r){return s instanceof is&&r instanceof is||s instanceof os&&r instanceof os?sn(s.elements,r.elements,Ke):s instanceof Xs&&r instanceof Xs?Ke(s.Ae,r.Ae):s instanceof Ys&&r instanceof Ys})(n.transform,e.transform)}class Lf{constructor(e,t){this.version=e,this.transformResults=t}}class qe{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new qe}static exists(e){return new qe(void 0,e)}static updateTime(e){return new qe(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ms(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class dr{}function Tc(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ui(n.key,qe.none()):new ls(n.key,n.data,qe.none());{const t=n.data,s=ke.empty();let r=new pe(Te.comparator);for(let o of e.fields)if(!r.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?s.delete(o):s.set(o,a),r=r.add(o)}return new Mt(n.key,s,new je(r.toArray()),qe.none())}}function Mf(n,e,t){n instanceof ls?(function(r,o,a){const u=r.value.clone(),d=$a(r.fieldTransforms,o,a.transformResults);u.setAll(d),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):n instanceof Mt?(function(r,o,a){if(!Ms(r.precondition,o))return void o.convertToUnknownDocument(a.version);const u=$a(r.fieldTransforms,o,a.transformResults),d=o.data;d.setAll(wc(r)),d.setAll(u),o.convertToFoundDocument(a.version,d).setHasCommittedMutations()})(n,e,t):(function(r,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function Jn(n,e,t,s){return n instanceof ls?(function(o,a,u,d){if(!Ms(o.precondition,a))return u;const f=o.value.clone(),m=Ua(o.fieldTransforms,d,a);return f.setAll(m),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null})(n,e,t,s):n instanceof Mt?(function(o,a,u,d){if(!Ms(o.precondition,a))return u;const f=Ua(o.fieldTransforms,d,a),m=a.data;return m.setAll(wc(o)),m.setAll(f),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((y=>y.field)))})(n,e,t,s):(function(o,a,u){return Ms(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,e,t)}function Bf(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),o=_c(s.transform,r||null);o!=null&&(t===null&&(t=ke.empty()),t.set(s.field,o))}return t||null}function Ba(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&sn(s,r,((o,a)=>Of(o,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class ls extends dr{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Mt extends dr{constructor(e,t,s,r,o=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function wc(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}})),e}function $a(n,e,t){const s=new Map;ne(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let r=0;r<t.length;r++){const o=n[r],a=o.transform,u=e.data.field(o.field);s.set(o.field,Ff(a,u,t[r]))}return s}function Ua(n,e,t){const s=new Map;for(const r of n){const o=r.transform,a=t.data.field(r.field);s.set(r.field,jf(o,a,e))}return s}class Ui extends dr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class $f extends dr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Uf{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const o=this.mutations[r];o.key.isEqual(e.key)&&Mf(o,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=Jn(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=Jn(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=gc();return this.mutations.forEach((r=>{const o=e.get(r.key),a=o.overlayedDocument;let u=this.applyToLocalView(a,o.mutatedFields);u=t.has(r.key)?null:u;const d=Tc(a,u);d!==null&&s.set(r.key,d),a.isValidDocument()||a.convertToNoDocument(G.min())})),s}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Y())}isEqual(e){return this.batchId===e.batchId&&sn(this.mutations,e.mutations,((t,s)=>Ba(t,s)))&&sn(this.baseMutations,e.baseMutations,((t,s)=>Ba(t,s)))}}class qi{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){ne(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let r=(function(){return Rf})();const o=e.mutations;for(let a=0;a<o.length;a++)r=r.insert(o[a].key,s[a].version);return new qi(e,t,s,r)}}class qf{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class zf{constructor(e,t){this.count=e,this.unchangedNames=t}}var he,X;function Hf(n){switch(n){case D.OK:return K(64938);case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0;default:return K(15467,{code:n})}}function Ic(n){if(n===void 0)return et("GRPC error has no .code"),D.UNKNOWN;switch(n){case he.OK:return D.OK;case he.CANCELLED:return D.CANCELLED;case he.UNKNOWN:return D.UNKNOWN;case he.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case he.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case he.INTERNAL:return D.INTERNAL;case he.UNAVAILABLE:return D.UNAVAILABLE;case he.UNAUTHENTICATED:return D.UNAUTHENTICATED;case he.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case he.NOT_FOUND:return D.NOT_FOUND;case he.ALREADY_EXISTS:return D.ALREADY_EXISTS;case he.PERMISSION_DENIED:return D.PERMISSION_DENIED;case he.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case he.ABORTED:return D.ABORTED;case he.OUT_OF_RANGE:return D.OUT_OF_RANGE;case he.UNIMPLEMENTED:return D.UNIMPLEMENTED;case he.DATA_LOSS:return D.DATA_LOSS;default:return K(39323,{code:n})}}(X=he||(he={}))[X.OK=0]="OK",X[X.CANCELLED=1]="CANCELLED",X[X.UNKNOWN=2]="UNKNOWN",X[X.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X[X.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X[X.NOT_FOUND=5]="NOT_FOUND",X[X.ALREADY_EXISTS=6]="ALREADY_EXISTS",X[X.PERMISSION_DENIED=7]="PERMISSION_DENIED",X[X.UNAUTHENTICATED=16]="UNAUTHENTICATED",X[X.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X[X.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X[X.ABORTED=10]="ABORTED",X[X.OUT_OF_RANGE=11]="OUT_OF_RANGE",X[X.UNIMPLEMENTED=12]="UNIMPLEMENTED",X[X.INTERNAL=13]="INTERNAL",X[X.UNAVAILABLE=14]="UNAVAILABLE",X[X.DATA_LOSS=15]="DATA_LOSS";function Kf(){return new TextEncoder}const Gf=new mt([4294967295,4294967295],0);function qa(n){const e=Kf().encode(n),t=new Ml;return t.update(e),new Uint8Array(t.digest())}function za(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new mt([t,s],0),new mt([r,o],0)]}class zi{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new zn(`Invalid padding: ${t}`);if(s<0)throw new zn(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new zn(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new zn(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=mt.fromNumber(this.ge)}ye(e,t,s){let r=e.add(t.multiply(mt.fromNumber(s)));return r.compare(Gf)===1&&(r=new mt([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=qa(e),[s,r]=za(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(s,r,o);if(!this.we(a))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new zi(o,r,t);return s.forEach((u=>a.insert(u))),a}insert(e){if(this.ge===0)return;const t=qa(e),[s,r]=za(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(s,r,o);this.be(a)}}be(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class zn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class fr{constructor(e,t,s,r,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,cs.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new fr(G.min(),r,new le(J),tt(),Y())}}class cs{constructor(e,t,s,r,o){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new cs(s,t,Y(),Y(),Y())}}class Bs{constructor(e,t,s,r){this.Se=e,this.removedTargetIds=t,this.key=s,this.De=r}}class Ac{constructor(e,t){this.targetId=e,this.Ce=t}}class Sc{constructor(e,t,s=we.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class Ha{constructor(){this.ve=0,this.Fe=Ka(),this.Me=we.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Y(),t=Y(),s=Y();return this.Fe.forEach(((r,o)=>{switch(o){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:K(38017,{changeType:o})}})),new cs(this.Me,this.xe,e,t,s)}Ke(){this.Oe=!1,this.Fe=Ka()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,ne(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class Wf{constructor(e){this.Ge=e,this.ze=new Map,this.je=tt(),this.He=ks(),this.Je=ks(),this.Ze=new le(J)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.We(),s.Ne||s.Ke(),s.Le(e.resumeToken);break;case 2:s.We(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.Qe(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:K(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((s,r)=>{this.rt(r)&&t(r)}))}st(e){const t=e.targetId,s=e.Ce.count,r=this.ot(t);if(r){const o=r.target;if(yi(o))if(s===0){const a=new z(o.path);this.et(t,a,Se.newNoDocument(a,G.min()))}else ne(s===1,20013,{expectedCount:s});else{const a=this._t(t);if(a!==s){const u=this.ut(e),d=u?this.ct(u,e,a):1;if(d!==0){this.it(t);const f=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,f)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:o=0}=t;let a,u;try{a=vt(s).toUint8Array()}catch(d){if(d instanceof Yl)return jt("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{u=new zi(a,r,o)}catch(d){return jt(d instanceof zn?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return u.ge===0?null:u}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let r=0;return s.forEach((o=>{const a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(t,o,null),r++)})),r}Tt(e){const t=new Map;this.ze.forEach(((o,a)=>{const u=this.ot(a);if(u){if(o.current&&yi(u.target)){const d=new z(u.target.path);this.It(d).has(a)||this.Et(a,d)||this.et(a,d,Se.newNoDocument(d,e))}o.Be&&(t.set(a,o.ke()),o.Ke())}}));let s=Y();this.Je.forEach(((o,a)=>{let u=!0;a.forEachWhile((d=>{const f=this.ot(d);return!f||f.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(s=s.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(e)));const r=new fr(e,t,this.Ze,this.je,s);return this.je=tt(),this.He=ks(),this.Je=ks(),this.Ze=new le(J),r}Ye(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,s),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.qe(t,1):r.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new Ha,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new pe(J),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new pe(J),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||$("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Ha),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ks(){return new le(z.comparator)}function Ka(){return new le(z.comparator)}const Qf={asc:"ASCENDING",desc:"DESCENDING"},Jf={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Yf={and:"AND",or:"OR"};class Xf{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function vi(n,e){return n.useProto3Json||or(e)?e:{value:e}}function Zs(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Cc(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Zf(n,e){return Zs(n,e.toTimestamp())}function ze(n){return ne(!!n,49232),G.fromTimestamp((function(t){const s=_t(t);return new ae(s.seconds,s.nanos)})(n))}function Hi(n,e){return Ei(n,e).canonicalString()}function Ei(n,e){const t=(function(r){return new oe(["projects",r.projectId,"databases",r.database])})(n).child("documents");return e===void 0?t:t.child(e)}function xc(n){const e=oe.fromString(n);return ne(kc(e),10190,{key:e.toString()}),e}function bi(n,e){return Hi(n.databaseId,e.path)}function Xr(n,e){const t=xc(e);if(t.get(1)!==n.databaseId.projectId)throw new q(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new q(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new z(Rc(t))}function Nc(n,e){return Hi(n.databaseId,e)}function em(n){const e=xc(n);return e.length===4?oe.emptyPath():Rc(e)}function Ti(n){return new oe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Rc(n){return ne(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Ga(n,e,t){return{name:bi(n,e),fields:t.value.mapValue.fields}}function tm(n,e){let t;if("targetChange"in e){e.targetChange;const s=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:K(39313,{state:f})})(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],o=(function(f,m){return f.useProto3Json?(ne(m===void 0||typeof m=="string",58123),we.fromBase64String(m||"")):(ne(m===void 0||m instanceof Buffer||m instanceof Uint8Array,16193),we.fromUint8Array(m||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&(function(f){const m=f.code===void 0?D.UNKNOWN:Ic(f.code);return new q(m,f.message||"")})(a);t=new Sc(s,r,o,u||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=Xr(n,s.document.name),o=ze(s.document.updateTime),a=s.document.createTime?ze(s.document.createTime):G.min(),u=new ke({mapValue:{fields:s.document.fields}}),d=Se.newFoundDocument(r,o,a,u),f=s.targetIds||[],m=s.removedTargetIds||[];t=new Bs(f,m,d.key,d)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=Xr(n,s.document),o=s.readTime?ze(s.readTime):G.min(),a=Se.newNoDocument(r,o),u=s.removedTargetIds||[];t=new Bs([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=Xr(n,s.document),o=s.removedTargetIds||[];t=new Bs([],o,r,null)}else{if(!("filter"in e))return K(11601,{Vt:e});{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:o}=s,a=new zf(r,o),u=s.targetId;t=new Ac(u,a)}}return t}function nm(n,e){let t;if(e instanceof ls)t={update:Ga(n,e.key,e.value)};else if(e instanceof Ui)t={delete:bi(n,e.key)};else if(e instanceof Mt)t={update:Ga(n,e.key,e.data),updateMask:hm(e.fieldMask)};else{if(!(e instanceof $f))return K(16599,{dt:e.type});t={verify:bi(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((s=>(function(o,a){const u=a.transform;if(u instanceof Ys)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof is)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof os)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Xs)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw K(20930,{transform:a.transform})})(0,s)))),e.precondition.isNone||(t.currentDocument=(function(r,o){return o.updateTime!==void 0?{updateTime:Zf(r,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:K(27497)})(n,e.precondition)),t}function sm(n,e){return n&&n.length>0?(ne(e!==void 0,14353),n.map((t=>(function(r,o){let a=r.updateTime?ze(r.updateTime):ze(o);return a.isEqual(G.min())&&(a=ze(o)),new Lf(a,r.transformResults||[])})(t,e)))):[]}function rm(n,e){return{documents:[Nc(n,e.path)]}}function im(n,e){const t={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=Nc(n,r);const o=(function(f){if(f.length!==0)return Dc(Ge.create(f,"and"))})(e.filters);o&&(t.structuredQuery.where=o);const a=(function(f){if(f.length!==0)return f.map((m=>(function(T){return{field:Qt(T.field),direction:lm(T.dir)}})(m)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=vi(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(e.endAt)),{ft:t,parent:r}}function om(n){let e=em(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){ne(s===1,65062);const m=t.from[0];m.allDescendants?r=m.collectionId:e=e.child(m.collectionId)}let o=[];t.where&&(o=(function(y){const T=Pc(y);return T instanceof Ge&&ac(T)?T.getFilters():[T]})(t.where));let a=[];t.orderBy&&(a=(function(y){return y.map((T=>(function(P){return new Js(Jt(P.field),(function(F){switch(F){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(P.direction))})(T)))})(t.orderBy));let u=null;t.limit&&(u=(function(y){let T;return T=typeof y=="object"?y.value:y,or(T)?null:T})(t.limit));let d=null;t.startAt&&(d=(function(y){const T=!!y.before,S=y.values||[];return new Qs(S,T)})(t.startAt));let f=null;return t.endAt&&(f=(function(y){const T=!y.before,S=y.values||[];return new Qs(S,T)})(t.endAt)),wf(e,r,a,o,u,"F",d,f)}function am(n,e){const t=(function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return K(28987,{purpose:r})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Pc(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=Jt(t.unaryFilter.field);return me.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=Jt(t.unaryFilter.field);return me.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Jt(t.unaryFilter.field);return me.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Jt(t.unaryFilter.field);return me.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return K(61313);default:return K(60726)}})(n):n.fieldFilter!==void 0?(function(t){return me.create(Jt(t.fieldFilter.field),(function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return K(58110);default:return K(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Ge.create(t.compositeFilter.filters.map((s=>Pc(s))),(function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return K(1026)}})(t.compositeFilter.op))})(n):K(30097,{filter:n})}function lm(n){return Qf[n]}function cm(n){return Jf[n]}function um(n){return Yf[n]}function Qt(n){return{fieldPath:n.canonicalString()}}function Jt(n){return Te.fromServerFormat(n.fieldPath)}function Dc(n){return n instanceof me?(function(t){if(t.op==="=="){if(Va(t.value))return{unaryFilter:{field:Qt(t.field),op:"IS_NAN"}};if(ka(t.value))return{unaryFilter:{field:Qt(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Va(t.value))return{unaryFilter:{field:Qt(t.field),op:"IS_NOT_NAN"}};if(ka(t.value))return{unaryFilter:{field:Qt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Qt(t.field),op:cm(t.op),value:t.value}}})(n):n instanceof Ge?(function(t){const s=t.getFilters().map((r=>Dc(r)));return s.length===1?s[0]:{compositeFilter:{op:um(t.op),filters:s}}})(n):K(54877,{filter:n})}function hm(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function kc(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function Vc(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}class ut{constructor(e,t,s,r,o=G.min(),a=G.min(),u=we.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=d}withSequenceNumber(e){return new ut(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ut(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ut(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ut(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class dm{constructor(e){this.yt=e}}function fm(n){const e=om({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?_i(e,e.limit,"L"):e}class mm{constructor(){this.Sn=new pm}addToCollectionParentIndex(e,t){return this.Sn.add(t),N.resolve()}getCollectionParents(e,t){return N.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return N.resolve()}deleteFieldIndex(e,t){return N.resolve()}deleteAllFieldIndexes(e){return N.resolve()}createTargetIndexes(e,t){return N.resolve()}getDocumentsMatchingTarget(e,t){return N.resolve(null)}getIndexType(e,t){return N.resolve(0)}getFieldIndexes(e,t){return N.resolve([])}getNextCollectionGroupToUpdate(e){return N.resolve(null)}getMinOffset(e,t){return N.resolve(yt.min())}getMinOffsetFromCollectionGroup(e,t){return N.resolve(yt.min())}updateCollectionGroup(e,t,s){return N.resolve()}updateIndexEntries(e,t){return N.resolve()}}class pm{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new pe(oe.comparator),o=!r.has(s);return this.index[t]=r.add(s),o}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new pe(oe.comparator)).toArray()}}const Wa={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},jc=41943040;class xe{static withCacheSize(e){return new xe(e,xe.DEFAULT_COLLECTION_PERCENTILE,xe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}xe.DEFAULT_COLLECTION_PERCENTILE=10,xe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,xe.DEFAULT=new xe(jc,xe.DEFAULT_COLLECTION_PERCENTILE,xe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),xe.DISABLED=new xe(-1,0,0);class ln{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new ln(0)}static ar(){return new ln(-1)}}const Qa="LruGarbageCollector",gm=1048576;function Ja([n,e],[t,s]){const r=J(n,t);return r===0?J(e,s):r}class ym{constructor(e){this.Pr=e,this.buffer=new pe(Ja),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();Ja(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class _m{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){$(Qa,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){pn(t)?$(Qa,"Ignoring IndexedDB error during garbage collection: ",t):await mn(t)}await this.Ar(3e5)}))}}class vm{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next((s=>Math.floor(t/100*s)))}nthSequenceNumber(e,t){if(t===0)return N.resolve(ir.ce);const s=new ym(t);return this.Vr.forEachTarget(e,(r=>s.Er(r.sequenceNumber))).next((()=>this.Vr.mr(e,(r=>s.Er(r))))).next((()=>s.maxValue))}removeTargets(e,t,s){return this.Vr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?($("LruGarbageCollector","Garbage collection skipped; disabled"),N.resolve(Wa)):this.getCacheSize(e).next((s=>s<this.params.cacheSizeCollectionThreshold?($("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Wa):this.gr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let s,r,o,a,u,d,f;const m=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((y=>(y>this.params.maximumSequenceNumbersToCollect?($("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${y}`),r=this.params.maximumSequenceNumbersToCollect):r=y,a=Date.now(),this.nthSequenceNumber(e,r)))).next((y=>(s=y,u=Date.now(),this.removeTargets(e,s,t)))).next((y=>(o=y,d=Date.now(),this.removeOrphanedDocuments(e,s)))).next((y=>(f=Date.now(),Gt()<=Z.DEBUG&&$("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-m}ms
	Determined least recently used ${r} in `+(u-a)+`ms
	Removed ${o} targets in `+(d-u)+`ms
	Removed ${y} documents in `+(f-d)+`ms
Total Duration: ${f-m}ms`),N.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:o,documentsRemoved:y}))))}}function Em(n,e){return new vm(n,e)}class bm{constructor(){this.changes=new Lt((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Se.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?N.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Tm{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class wm{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(s=r,this.remoteDocumentCache.getEntry(e,t)))).next((r=>(s!==null&&Jn(s.mutation,r,je.empty(),ae.now()),r)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.getLocalViewOfDocuments(e,s,Y()).next((()=>s))))}getLocalViewOfDocuments(e,t,s=Y()){const r=kt();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,s).next((o=>{let a=qn();return o.forEach(((u,d)=>{a=a.insert(u,d.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const s=kt();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,Y())))}populateOverlays(e,t,s){const r=[];return s.forEach((o=>{t.has(o)||r.push(o)})),this.documentOverlayCache.getOverlays(e,r).next((o=>{o.forEach(((a,u)=>{t.set(a,u)}))}))}computeViews(e,t,s,r){let o=tt();const a=Qn(),u=(function(){return Qn()})();return t.forEach(((d,f)=>{const m=s.get(f.key);r.has(f.key)&&(m===void 0||m.mutation instanceof Mt)?o=o.insert(f.key,f):m!==void 0?(a.set(f.key,m.mutation.getFieldMask()),Jn(m.mutation,f,m.mutation.getFieldMask(),ae.now())):a.set(f.key,je.empty())})),this.recalculateAndSaveOverlays(e,o).next((d=>(d.forEach(((f,m)=>a.set(f,m))),t.forEach(((f,m)=>u.set(f,new Tm(m,a.get(f)??null)))),u)))}recalculateAndSaveOverlays(e,t){const s=Qn();let r=new le(((a,u)=>a-u)),o=Y();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const u of a)u.keys().forEach((d=>{const f=t.get(d);if(f===null)return;let m=s.get(d)||je.empty();m=u.applyToLocalView(f,m),s.set(d,m);const y=(r.get(u.batchId)||Y()).add(d);r=r.insert(u.batchId,y)}))})).next((()=>{const a=[],u=r.getReverseIterator();for(;u.hasNext();){const d=u.getNext(),f=d.key,m=d.value,y=gc();m.forEach((T=>{if(!o.has(T)){const S=Tc(t.get(T),s.get(T));S!==null&&y.set(T,S),o=o.add(T)}})),a.push(this.documentOverlayCache.saveOverlays(e,f,y))}return N.waitFor(a)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.recalculateAndSaveOverlays(e,s)))}getDocumentsMatchingQuery(e,t,s,r){return If(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Af(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r)}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next((o=>{const a=r-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-o.size):N.resolve(kt());let u=ts,d=o;return a.next((f=>N.forEach(f,((m,y)=>(u<y.largestBatchId&&(u=y.largestBatchId),o.get(m)?N.resolve():this.remoteDocumentCache.getEntry(e,m).next((T=>{d=d.insert(m,T)}))))).next((()=>this.populateOverlays(e,f,o))).next((()=>this.computeViews(e,d,f,Y()))).next((m=>({batchId:u,changes:pc(m)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new z(t)).next((s=>{let r=qn();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r}))}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const o=t.collectionGroup;let a=qn();return this.indexManager.getCollectionParents(e,o).next((u=>N.forEach(u,(d=>{const f=(function(y,T){return new lr(T,null,y.explicitOrderBy.slice(),y.filters.slice(),y.limit,y.limitType,y.startAt,y.endAt)})(t,d.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,s,r).next((m=>{m.forEach(((y,T)=>{a=a.insert(y,T)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,s,r){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,o,r)))).next((a=>{o.forEach(((d,f)=>{const m=f.getKey();a.get(m)===null&&(a=a.insert(m,Se.newInvalidDocument(m)))}));let u=qn();return a.forEach(((d,f)=>{const m=o.get(d);m!==void 0&&Jn(m.mutation,f,je.empty(),ae.now()),ur(t,f)&&(u=u.insert(d,f))})),u}))}}class Im{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return N.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,(function(r){return{id:r.id,version:r.version,createTime:ze(r.createTime)}})(t)),N.resolve()}getNamedQuery(e,t){return N.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,(function(r){return{name:r.name,query:fm(r.bundledQuery),readTime:ze(r.readTime)}})(t)),N.resolve()}}class Am{constructor(){this.overlays=new le(z.comparator),this.Lr=new Map}getOverlay(e,t){return N.resolve(this.overlays.get(t))}getOverlays(e,t){const s=kt();return N.forEach(t,(r=>this.getOverlay(e,r).next((o=>{o!==null&&s.set(r,o)})))).next((()=>s))}saveOverlays(e,t,s){return s.forEach(((r,o)=>{this.bt(e,t,o)})),N.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.Lr.get(s);return r!==void 0&&(r.forEach((o=>this.overlays=this.overlays.remove(o))),this.Lr.delete(s)),N.resolve()}getOverlaysForCollection(e,t,s){const r=kt(),o=t.length+1,a=new z(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const d=u.getNext().value,f=d.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===o&&d.largestBatchId>s&&r.set(d.getKey(),d)}return N.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let o=new le(((f,m)=>f-m));const a=this.overlays.getIterator();for(;a.hasNext();){const f=a.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>s){let m=o.get(f.largestBatchId);m===null&&(m=kt(),o=o.insert(f.largestBatchId,m)),m.set(f.getKey(),f)}}const u=kt(),d=o.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach(((f,m)=>u.set(f,m))),!(u.size()>=r)););return N.resolve(u)}bt(e,t,s){const r=this.overlays.get(s.key);if(r!==null){const a=this.Lr.get(r.largestBatchId).delete(s.key);this.Lr.set(r.largestBatchId,a)}this.overlays=this.overlays.insert(s.key,new qf(t,s));let o=this.Lr.get(t);o===void 0&&(o=Y(),this.Lr.set(t,o)),this.Lr.set(t,o.add(s.key))}}class Sm{constructor(){this.sessionToken=we.EMPTY_BYTE_STRING}getSessionToken(e){return N.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,N.resolve()}}class Ki{constructor(){this.kr=new pe(ve.Kr),this.qr=new pe(ve.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const s=new ve(e,t);this.kr=this.kr.add(s),this.qr=this.qr.add(s)}$r(e,t){e.forEach((s=>this.addReference(s,t)))}removeReference(e,t){this.Wr(new ve(e,t))}Qr(e,t){e.forEach((s=>this.removeReference(s,t)))}Gr(e){const t=new z(new oe([])),s=new ve(t,e),r=new ve(t,e+1),o=[];return this.qr.forEachInRange([s,r],(a=>{this.Wr(a),o.push(a.key)})),o}zr(){this.kr.forEach((e=>this.Wr(e)))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new z(new oe([])),s=new ve(t,e),r=new ve(t,e+1);let o=Y();return this.qr.forEachInRange([s,r],(a=>{o=o.add(a.key)})),o}containsKey(e){const t=new ve(e,0),s=this.kr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class ve{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return z.comparator(e.key,t.key)||J(e.Hr,t.Hr)}static Ur(e,t){return J(e.Hr,t.Hr)||z.comparator(e.key,t.key)}}class Cm{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new pe(ve.Kr)}checkEmpty(e){return N.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,r){const o=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Uf(o,t,s,r);this.mutationQueue.push(a);for(const u of r)this.Jr=this.Jr.add(new ve(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return N.resolve(a)}lookupMutationBatch(e,t){return N.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.Xr(s),o=r<0?0:r;return N.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return N.resolve(this.mutationQueue.length===0?Fi:this.Yn-1)}getAllMutationBatches(e){return N.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new ve(t,0),r=new ve(t,Number.POSITIVE_INFINITY),o=[];return this.Jr.forEachInRange([s,r],(a=>{const u=this.Zr(a.Hr);o.push(u)})),N.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new pe(J);return t.forEach((r=>{const o=new ve(r,0),a=new ve(r,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([o,a],(u=>{s=s.add(u.Hr)}))})),N.resolve(this.Yr(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let o=s;z.isDocumentKey(o)||(o=o.child(""));const a=new ve(new z(o),0);let u=new pe(J);return this.Jr.forEachWhile((d=>{const f=d.key.path;return!!s.isPrefixOf(f)&&(f.length===r&&(u=u.add(d.Hr)),!0)}),a),N.resolve(this.Yr(u))}Yr(e){const t=[];return e.forEach((s=>{const r=this.Zr(s);r!==null&&t.push(r)})),t}removeMutationBatch(e,t){ne(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Jr;return N.forEach(t.mutations,(r=>{const o=new ve(r.key,t.batchId);return s=s.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Jr=s}))}nr(e){}containsKey(e,t){const s=new ve(t,0),r=this.Jr.firstAfterOrEqual(s);return N.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,N.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class xm{constructor(e){this.ti=e,this.docs=(function(){return new le(z.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),o=r?r.size:0,a=this.ti(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return N.resolve(s?s.document.mutableCopy():Se.newInvalidDocument(t))}getEntries(e,t){let s=tt();return t.forEach((r=>{const o=this.docs.get(r);s=s.insert(r,o?o.document.mutableCopy():Se.newInvalidDocument(r))})),N.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let o=tt();const a=t.path,u=new z(a.child("__id-9223372036854775808__")),d=this.docs.getIteratorFrom(u);for(;d.hasNext();){const{key:f,value:{document:m}}=d.getNext();if(!a.isPrefixOf(f.path))break;f.path.length>a.length+1||Zd(Xd(m),s)<=0||(r.has(m.key)||ur(t,m))&&(o=o.insert(m.key,m.mutableCopy()))}return N.resolve(o)}getAllFromCollectionGroup(e,t,s,r){K(9500)}ni(e,t){return N.forEach(this.docs,(s=>t(s)))}newChangeBuffer(e){return new Nm(this)}getSize(e){return N.resolve(this.size)}}class Nm extends bm{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach(((s,r)=>{r.isValidDocument()?t.push(this.Mr.addEntry(e,r)):this.Mr.removeEntry(s)})),N.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class Rm{constructor(e){this.persistence=e,this.ri=new Lt((t=>Mi(t)),Bi),this.lastRemoteSnapshotVersion=G.min(),this.highestTargetId=0,this.ii=0,this.si=new Ki,this.targetCount=0,this.oi=ln._r()}forEachTarget(e,t){return this.ri.forEach(((s,r)=>t(r))),N.resolve()}getLastRemoteSnapshotVersion(e){return N.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return N.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),N.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.ii&&(this.ii=t),N.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new ln(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,N.resolve()}updateTargetData(e,t){return this.lr(t),N.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,N.resolve()}removeTargets(e,t,s){let r=0;const o=[];return this.ri.forEach(((a,u)=>{u.sequenceNumber<=t&&s.get(u.targetId)===null&&(this.ri.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),r++)})),N.waitFor(o).next((()=>r))}getTargetCount(e){return N.resolve(this.targetCount)}getTargetData(e,t){const s=this.ri.get(t)||null;return N.resolve(s)}addMatchingKeys(e,t,s){return this.si.$r(t,s),N.resolve()}removeMatchingKeys(e,t,s){this.si.Qr(t,s);const r=this.persistence.referenceDelegate,o=[];return r&&t.forEach((a=>{o.push(r.markPotentiallyOrphaned(e,a))})),N.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),N.resolve()}getMatchingKeysForTargetId(e,t){const s=this.si.jr(t);return N.resolve(s)}containsKey(e,t){return N.resolve(this.si.containsKey(t))}}class Fc{constructor(e,t){this._i={},this.overlays={},this.ai=new ir(0),this.ui=!1,this.ui=!0,this.ci=new Sm,this.referenceDelegate=e(this),this.li=new Rm(this),this.indexManager=new mm,this.remoteDocumentCache=(function(r){return new xm(r)})((s=>this.referenceDelegate.hi(s))),this.serializer=new dm(t),this.Pi=new Im(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Am,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this._i[e.toKey()];return s||(s=new Cm(t,this.referenceDelegate),this._i[e.toKey()]=s),s}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,s){$("MemoryPersistence","Starting transaction:",e);const r=new Pm(this.ai.next());return this.referenceDelegate.Ti(),s(r).next((o=>this.referenceDelegate.Ii(r).next((()=>o)))).toPromise().then((o=>(r.raiseOnCommittedEvent(),o)))}Ei(e,t){return N.or(Object.values(this._i).map((s=>()=>s.containsKey(e,t))))}}class Pm extends tf{constructor(e){super(),this.currentSequenceNumber=e}}class Gi{constructor(e){this.persistence=e,this.Ri=new Ki,this.Ai=null}static Vi(e){return new Gi(e)}get di(){if(this.Ai)return this.Ai;throw K(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.di.delete(s.toString()),N.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.di.add(s.toString()),N.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),N.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach((r=>this.di.add(r.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next((r=>{r.forEach((o=>this.di.add(o.toString())))})).next((()=>s.removeTargetData(e,t)))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return N.forEach(this.di,(s=>{const r=z.fromPath(s);return this.mi(e,r).next((o=>{o||t.removeEntry(r,G.min())}))})).next((()=>(this.Ai=null,t.apply(e))))}updateLimboDocument(e,t){return this.mi(e,t).next((s=>{s?this.di.delete(t.toString()):this.di.add(t.toString())}))}hi(e){return 0}mi(e,t){return N.or([()=>N.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class er{constructor(e,t){this.persistence=e,this.fi=new Lt((s=>rf(s.path)),((s,r)=>s.isEqual(r))),this.garbageCollector=Em(this,t)}static Vi(e,t){return new er(e,t)}Ti(){}Ii(e){return N.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next((s=>t.next((r=>s+r))))}pr(e){let t=0;return this.mr(e,(s=>{t++})).next((()=>t))}mr(e,t){return N.forEach(this.fi,((s,r)=>this.wr(e,s,r).next((o=>o?N.resolve():t(r)))))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const r=this.persistence.getRemoteDocumentCache(),o=r.newChangeBuffer();return r.ni(e,(a=>this.wr(e,a,t).next((u=>{u||(s++,o.removeEntry(a,G.min()))})))).next((()=>o.apply(e))).next((()=>s))}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),N.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.fi.set(s,e.currentSequenceNumber),N.resolve()}removeReference(e,t,s){return this.fi.set(s,e.currentSequenceNumber),N.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),N.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Os(e.data.value)),t}wr(e,t,s){return N.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.fi.get(t);return N.resolve(r!==void 0&&r>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Wi{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Ts=s,this.Is=r}static Es(e,t){let s=Y(),r=Y();for(const o of t.docChanges)switch(o.type){case 0:s=s.add(o.doc.key);break;case 1:r=r.add(o.doc.key)}return new Wi(e,t.fromCache,s,r)}}class Dm{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class km{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return vh()?8:nf(yh())>0?6:4})()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,r){const o={result:null};return this.gs(e,t).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ps(e,t,r,s).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new Dm;return this.ys(e,t,a).next((u=>{if(o.result=u,this.As)return this.ws(e,t,a,u.size)}))})).next((()=>o.result))}ws(e,t,s,r){return s.documentReadCount<this.Vs?(Gt()<=Z.DEBUG&&$("QueryEngine","SDK will not create cache indexes for query:",Wt(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),N.resolve()):(Gt()<=Z.DEBUG&&$("QueryEngine","Query:",Wt(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.ds*r?(Gt()<=Z.DEBUG&&$("QueryEngine","The SDK decides to create cache indexes for query:",Wt(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ue(t))):N.resolve())}gs(e,t){if(La(t))return N.resolve(null);let s=Ue(t);return this.indexManager.getIndexType(e,s).next((r=>r===0?null:(t.limit!==null&&r===1&&(t=_i(t,null,"F"),s=Ue(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next((o=>{const a=Y(...o);return this.fs.getDocuments(e,a).next((u=>this.indexManager.getMinOffset(e,s).next((d=>{const f=this.bs(t,u);return this.Ss(t,f,a,d.readTime)?this.gs(e,_i(t,null,"F")):this.Ds(e,f,t,d)}))))})))))}ps(e,t,s,r){return La(t)||r.isEqual(G.min())?N.resolve(null):this.fs.getDocuments(e,s).next((o=>{const a=this.bs(t,o);return this.Ss(t,a,s,r)?N.resolve(null):(Gt()<=Z.DEBUG&&$("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Wt(t)),this.Ds(e,a,t,Yd(r,ts)).next((u=>u)))}))}bs(e,t){let s=new pe(fc(e));return t.forEach(((r,o)=>{ur(e,o)&&(s=s.add(o))})),s}Ss(e,t,s,r){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(r)>0)}ys(e,t,s){return Gt()<=Z.DEBUG&&$("QueryEngine","Using full collection scan to execute query:",Wt(t)),this.fs.getDocumentsMatchingQuery(e,t,yt.min(),s)}Ds(e,t,s,r){return this.fs.getDocumentsMatchingQuery(e,s,r).next((o=>(t.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const Qi="LocalStore",Vm=3e8;class jm{constructor(e,t,s,r){this.persistence=e,this.Cs=t,this.serializer=r,this.vs=new le(J),this.Fs=new Lt((o=>Mi(o)),Bi),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(s)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new wm(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.vs)))}}function Fm(n,e,t,s){return new jm(n,e,t,s)}async function Oc(n,e){const t=W(n);return await t.persistence.runTransaction("Handle user change","readonly",(s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next((o=>(r=o,t.Os(e),t.mutationQueue.getAllMutationBatches(s)))).next((o=>{const a=[],u=[];let d=Y();for(const f of r){a.push(f.batchId);for(const m of f.mutations)d=d.add(m.key)}for(const f of o){u.push(f.batchId);for(const m of f.mutations)d=d.add(m.key)}return t.localDocuments.getDocuments(s,d).next((f=>({Ns:f,removedBatchIds:a,addedBatchIds:u})))}))}))}function Om(n,e){const t=W(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(s=>{const r=e.batch.keys(),o=t.xs.newChangeBuffer({trackRemovals:!0});return(function(u,d,f,m){const y=f.batch,T=y.keys();let S=N.resolve();return T.forEach((P=>{S=S.next((()=>m.getEntry(d,P))).next((R=>{const F=f.docVersions.get(P);ne(F!==null,48541),R.version.compareTo(F)<0&&(y.applyToRemoteDocument(R,f),R.isValidDocument()&&(R.setReadTime(f.commitVersion),m.addEntry(R)))}))})),S.next((()=>u.mutationQueue.removeMutationBatch(d,y)))})(t,s,e,o).next((()=>o.apply(s))).next((()=>t.mutationQueue.performConsistencyCheck(s))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,(function(u){let d=Y();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(d=d.add(u.batch.mutations[f].key));return d})(e)))).next((()=>t.localDocuments.getDocuments(s,r)))}))}function Lc(n){const e=W(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.li.getLastRemoteSnapshotVersion(t)))}function Lm(n,e){const t=W(n),s=e.snapshotVersion;let r=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=t.xs.newChangeBuffer({trackRemovals:!0});r=t.vs;const u=[];e.targetChanges.forEach(((m,y)=>{const T=r.get(y);if(!T)return;u.push(t.li.removeMatchingKeys(o,m.removedDocuments,y).next((()=>t.li.addMatchingKeys(o,m.addedDocuments,y))));let S=T.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(y)!==null?S=S.withResumeToken(we.EMPTY_BYTE_STRING,G.min()).withLastLimboFreeSnapshotVersion(G.min()):m.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(m.resumeToken,s)),r=r.insert(y,S),(function(R,F,B){return R.resumeToken.approximateByteSize()===0||F.snapshotVersion.toMicroseconds()-R.snapshotVersion.toMicroseconds()>=Vm?!0:B.addedDocuments.size+B.modifiedDocuments.size+B.removedDocuments.size>0})(T,S,m)&&u.push(t.li.updateTargetData(o,S))}));let d=tt(),f=Y();if(e.documentUpdates.forEach((m=>{e.resolvedLimboDocuments.has(m)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,m))})),u.push(Mm(o,a,e.documentUpdates).next((m=>{d=m.Bs,f=m.Ls}))),!s.isEqual(G.min())){const m=t.li.getLastRemoteSnapshotVersion(o).next((y=>t.li.setTargetsMetadata(o,o.currentSequenceNumber,s)));u.push(m)}return N.waitFor(u).next((()=>a.apply(o))).next((()=>t.localDocuments.getLocalViewOfDocuments(o,d,f))).next((()=>d))})).then((o=>(t.vs=r,o)))}function Mm(n,e,t){let s=Y(),r=Y();return t.forEach((o=>s=s.add(o))),e.getEntries(n,s).next((o=>{let a=tt();return t.forEach(((u,d)=>{const f=o.get(u);d.isFoundDocument()!==f.isFoundDocument()&&(r=r.add(u)),d.isNoDocument()&&d.version.isEqual(G.min())?(e.removeEntry(u,d.readTime),a=a.insert(u,d)):!f.isValidDocument()||d.version.compareTo(f.version)>0||d.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(d),a=a.insert(u,d)):$(Qi,"Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",d.version)})),{Bs:a,Ls:r}}))}function Bm(n,e){const t=W(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(s=>(e===void 0&&(e=Fi),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e))))}function $m(n,e){const t=W(n);return t.persistence.runTransaction("Allocate target","readwrite",(s=>{let r;return t.li.getTargetData(s,e).next((o=>o?(r=o,N.resolve(r)):t.li.allocateTargetId(s).next((a=>(r=new ut(e,a,"TargetPurposeListen",s.currentSequenceNumber),t.li.addTargetData(s,r).next((()=>r)))))))})).then((s=>{const r=t.vs.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.vs=t.vs.insert(s.targetId,s),t.Fs.set(e,s.targetId)),s}))}async function wi(n,e,t){const s=W(n),r=s.vs.get(e),o=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",o,(a=>s.persistence.referenceDelegate.removeTarget(a,r)))}catch(a){if(!pn(a))throw a;$(Qi,`Failed to update sequence numbers for target ${e}: ${a}`)}s.vs=s.vs.remove(e),s.Fs.delete(r.target)}function Ya(n,e,t){const s=W(n);let r=G.min(),o=Y();return s.persistence.runTransaction("Execute query","readwrite",(a=>(function(d,f,m){const y=W(d),T=y.Fs.get(m);return T!==void 0?N.resolve(y.vs.get(T)):y.li.getTargetData(f,m)})(s,a,Ue(e)).next((u=>{if(u)return r=u.lastLimboFreeSnapshotVersion,s.li.getMatchingKeysForTargetId(a,u.targetId).next((d=>{o=d}))})).next((()=>s.Cs.getDocumentsMatchingQuery(a,e,t?r:G.min(),t?o:Y()))).next((u=>(Um(s,Cf(e),u),{documents:u,ks:o})))))}function Um(n,e,t){let s=n.Ms.get(e)||G.min();t.forEach(((r,o)=>{o.readTime.compareTo(s)>0&&(s=o.readTime)})),n.Ms.set(e,s)}class Xa{constructor(){this.activeTargetIds=kf()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class qm{constructor(){this.vo=new Xa,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,s){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new Xa,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class zm{Mo(e){}shutdown(){}}const Za="ConnectivityMonitor";class el{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){$(Za,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){$(Za,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Vs=null;function Ii(){return Vs===null?Vs=(function(){return 268435456+Math.round(2147483648*Math.random())})():Vs++,"0x"+Vs.toString(16)}const Zr="RestConnection",Hm={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class Km{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${s}/databases/${r}`,this.$o=this.databaseId.database===Gs?`project_id=${s}`:`project_id=${s}&database_id=${r}`}Wo(e,t,s,r,o){const a=Ii(),u=this.Qo(e,t.toUriEncodedString());$(Zr,`Sending RPC '${e}' ${a}:`,u,s);const d={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(d,r,o);const{host:f}=new URL(u),m=Pi(f);return this.zo(e,u,d,s,m).then((y=>($(Zr,`Received RPC '${e}' ${a}: `,y),y)),(y=>{throw jt(Zr,`RPC '${e}' ${a} failed with error: `,y,"url: ",u,"request:",s),y}))}jo(e,t,s,r,o,a){return this.Wo(e,t,s,r,o)}Go(e,t,s){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+fn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((r,o)=>e[o]=r)),s&&s.headers.forEach(((r,o)=>e[o]=r))}Qo(e,t){const s=Hm[e];let r=`${this.qo}/v1/${t}:${s}`;return this.databaseInfo.apiKey&&(r=`${r}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),r}terminate(){}}class Gm{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}const Ie="WebChannelConnection",$n=(n,e,t)=>{n.listen(e,(s=>{try{t(s)}catch(r){setTimeout((()=>{throw r}),0)}}))};class Xt extends Km{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!Xt.c_){const e=ql();$n(e,Ul.STAT_EVENT,(t=>{t.stat===di.PROXY?$(Ie,"STAT_EVENT: detected buffering proxy"):t.stat===di.NOPROXY&&$(Ie,"STAT_EVENT: detected no buffering proxy")})),Xt.c_=!0}}zo(e,t,s,r,o){const a=Ii();return new Promise(((u,d)=>{const f=new Bl;f.setWithCredentials(!0),f.listenOnce($l.COMPLETE,(()=>{try{switch(f.getLastErrorCode()){case Fs.NO_ERROR:const y=f.getResponseJson();$(Ie,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(y)),u(y);break;case Fs.TIMEOUT:$(Ie,`RPC '${e}' ${a} timed out`),d(new q(D.DEADLINE_EXCEEDED,"Request time out"));break;case Fs.HTTP_ERROR:const T=f.getStatus();if($(Ie,`RPC '${e}' ${a} failed with status:`,T,"response text:",f.getResponseText()),T>0){let S=f.getResponseJson();Array.isArray(S)&&(S=S[0]);const P=S?.error;if(P&&P.status&&P.message){const R=(function(B){const j=B.toLowerCase().replace(/_/g,"-");return Object.values(D).indexOf(j)>=0?j:D.UNKNOWN})(P.status);d(new q(R,P.message))}else d(new q(D.UNKNOWN,"Server responded with status "+f.getStatus()))}else d(new q(D.UNAVAILABLE,"Connection failed."));break;default:K(9055,{l_:e,streamId:a,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{$(Ie,`RPC '${e}' ${a} completed.`)}}));const m=JSON.stringify(r);$(Ie,`RPC '${e}' ${a} sending request:`,r),f.send(t,"POST",m,s,15)}))}T_(e,t,s){const r=Ii(),o=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Go(u.initMessageHeaders,t,s),u.encodeInitMessageHeaders=!0;const f=o.join("");$(Ie,`Creating RPC '${e}' stream ${r}: ${f}`,u);const m=a.createWebChannel(f,u);this.I_(m);let y=!1,T=!1;const S=new Gm({Ho:P=>{T?$(Ie,`Not sending because RPC '${e}' stream ${r} is closed:`,P):(y||($(Ie,`Opening RPC '${e}' stream ${r} transport.`),m.open(),y=!0),$(Ie,`RPC '${e}' stream ${r} sending:`,P),m.send(P))},Jo:()=>m.close()});return $n(m,Un.EventType.OPEN,(()=>{T||($(Ie,`RPC '${e}' stream ${r} transport opened.`),S.i_())})),$n(m,Un.EventType.CLOSE,(()=>{T||(T=!0,$(Ie,`RPC '${e}' stream ${r} transport closed`),S.o_(),this.E_(m))})),$n(m,Un.EventType.ERROR,(P=>{T||(T=!0,jt(Ie,`RPC '${e}' stream ${r} transport errored. Name:`,P.name,"Message:",P.message),S.o_(new q(D.UNAVAILABLE,"The operation could not be completed")))})),$n(m,Un.EventType.MESSAGE,(P=>{if(!T){const R=P.data[0];ne(!!R,16349);const F=R,B=F?.error||F[0]?.error;if(B){$(Ie,`RPC '${e}' stream ${r} received error:`,B);const j=B.status;let O=(function(H){const E=he[H];if(E!==void 0)return Ic(E)})(j),V=B.message;j==="NOT_FOUND"&&V.includes("database")&&V.includes("does not exist")&&V.includes(this.databaseId.database)&&jt(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),O===void 0&&(O=D.INTERNAL,V="Unknown error status: "+j+" with message "+B.message),T=!0,S.o_(new q(O,V)),m.close()}else $(Ie,`RPC '${e}' stream ${r} received:`,R),S.__(R)}})),Xt.u_(),setTimeout((()=>{S.s_()}),0),S}terminate(){this.a_.forEach((e=>e.close())),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter((t=>t===e))}Go(e,t,s){super.Go(e,t,s),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return zl()}}function Wm(n){return new Xt(n)}function ei(){return typeof document<"u"?document:null}function mr(n){return new Xf(n,!0)}Xt.c_=!1;class Mc{constructor(e,t,s=1e3,r=1.5,o=6e4){this.Ci=e,this.timerId=t,this.R_=s,this.A_=r,this.V_=o,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),s=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-s);r>0&&$("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const tl="PersistentStream";class Bc{constructor(e,t,s,r,o,a,u,d){this.Ci=e,this.b_=s,this.S_=r,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=d,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Mc(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===D.RESOURCE_EXHAUSTED?(et(t.toString()),et("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===D.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,r])=>{this.D_===t&&this.G_(s,r)}),(s=>{e((()=>{const r=new q(D.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(r)}))}))}G_(e,t){const s=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo((()=>{s((()=>this.listener.Zo()))})),this.stream.Yo((()=>{s((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((r=>{s((()=>this.z_(r)))})),this.stream.onMessage((r=>{s((()=>++this.F_==1?this.H_(r):this.onNext(r)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return $(tl,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget((()=>this.D_===e?t():($(tl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Qm extends Bc{constructor(e,t,s,r,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=tm(this.serializer,e),s=(function(o){if(!("targetChange"in o))return G.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?G.min():a.readTime?ze(a.readTime):G.min()})(e);return this.listener.J_(t,s)}Z_(e){const t={};t.database=Ti(this.serializer),t.addTarget=(function(o,a){let u;const d=a.target;if(u=yi(d)?{documents:rm(o,d)}:{query:im(o,d).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Cc(o,a.resumeToken);const f=vi(o,a.expectedCount);f!==null&&(u.expectedCount=f)}else if(a.snapshotVersion.compareTo(G.min())>0){u.readTime=Zs(o,a.snapshotVersion.toTimestamp());const f=vi(o,a.expectedCount);f!==null&&(u.expectedCount=f)}return u})(this.serializer,e);const s=am(this.serializer,e);s&&(t.labels=s),this.K_(t)}X_(e){const t={};t.database=Ti(this.serializer),t.removeTarget=e,this.K_(t)}}class Jm extends Bc{constructor(e,t,s,r,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,a),this.serializer=o}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return ne(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ne(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ne(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=sm(e.writeResults,e.commitTime),s=ze(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=Ti(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((s=>nm(this.serializer,s)))};this.K_(t)}}class Ym{}class Xm extends Ym{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new q(D.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Wo(e,Ei(t,s),r,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new q(D.UNKNOWN,o.toString())}))}jo(e,t,s,r,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,u])=>this.connection.jo(e,Ei(t,s),r,a,u,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new q(D.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function Zm(n,e,t,s){return new Xm(n,e,t,s)}class ep{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(et(t),this.aa=!1):$("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Ft="RemoteStore";class tp{constructor(e,t,s,r,o){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=o,this.Aa.Mo((a=>{s.enqueueAndForget((async()=>{Bt(this)&&($(Ft,"Restarting streams for network reachability change."),await(async function(d){const f=W(d);f.Ea.add(4),await us(f),f.Va.set("Unknown"),f.Ea.delete(4),await pr(f)})(this))}))})),this.Va=new ep(s,r)}}async function pr(n){if(Bt(n))for(const e of n.Ra)await e(!0)}async function us(n){for(const e of n.Ra)await e(!1)}function $c(n,e){const t=W(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),Zi(t)?Xi(t):gn(t).O_()&&Yi(t,e))}function Ji(n,e){const t=W(n),s=gn(t);t.Ia.delete(e),s.O_()&&Uc(t,e),t.Ia.size===0&&(s.O_()?s.L_():Bt(t)&&t.Va.set("Unknown"))}function Yi(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(G.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}gn(n).Z_(e)}function Uc(n,e){n.da.$e(e),gn(n).X_(e)}function Xi(n){n.da=new Wf({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),gn(n).start(),n.Va.ua()}function Zi(n){return Bt(n)&&!gn(n).x_()&&n.Ia.size>0}function Bt(n){return W(n).Ea.size===0}function qc(n){n.da=void 0}async function np(n){n.Va.set("Online")}async function sp(n){n.Ia.forEach(((e,t)=>{Yi(n,e)}))}async function rp(n,e){qc(n),Zi(n)?(n.Va.ha(e),Xi(n)):n.Va.set("Unknown")}async function ip(n,e,t){if(n.Va.set("Online"),e instanceof Sc&&e.state===2&&e.cause)try{await(async function(r,o){const a=o.cause;for(const u of o.targetIds)r.Ia.has(u)&&(await r.remoteSyncer.rejectListen(u,a),r.Ia.delete(u),r.da.removeTarget(u))})(n,e)}catch(s){$(Ft,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await tr(n,s)}else if(e instanceof Bs?n.da.Xe(e):e instanceof Ac?n.da.st(e):n.da.tt(e),!t.isEqual(G.min()))try{const s=await Lc(n.localStore);t.compareTo(s)>=0&&await(function(o,a){const u=o.da.Tt(a);return u.targetChanges.forEach(((d,f)=>{if(d.resumeToken.approximateByteSize()>0){const m=o.Ia.get(f);m&&o.Ia.set(f,m.withResumeToken(d.resumeToken,a))}})),u.targetMismatches.forEach(((d,f)=>{const m=o.Ia.get(d);if(!m)return;o.Ia.set(d,m.withResumeToken(we.EMPTY_BYTE_STRING,m.snapshotVersion)),Uc(o,d);const y=new ut(m.target,d,f,m.sequenceNumber);Yi(o,y)})),o.remoteSyncer.applyRemoteEvent(u)})(n,t)}catch(s){$(Ft,"Failed to raise snapshot:",s),await tr(n,s)}}async function tr(n,e,t){if(!pn(e))throw e;n.Ea.add(1),await us(n),n.Va.set("Offline"),t||(t=()=>Lc(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{$(Ft,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await pr(n)}))}function zc(n,e){return e().catch((t=>tr(n,t,e)))}async function gr(n){const e=W(n),t=bt(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Fi;for(;op(e);)try{const r=await Bm(e.localStore,s);if(r===null){e.Ta.length===0&&t.L_();break}s=r.batchId,ap(e,r)}catch(r){await tr(e,r)}Hc(e)&&Kc(e)}function op(n){return Bt(n)&&n.Ta.length<10}function ap(n,e){n.Ta.push(e);const t=bt(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function Hc(n){return Bt(n)&&!bt(n).x_()&&n.Ta.length>0}function Kc(n){bt(n).start()}async function lp(n){bt(n).ra()}async function cp(n){const e=bt(n);for(const t of n.Ta)e.ea(t.mutations)}async function up(n,e,t){const s=n.Ta.shift(),r=qi.from(s,e,t);await zc(n,(()=>n.remoteSyncer.applySuccessfulWrite(r))),await gr(n)}async function hp(n,e){e&&bt(n).Y_&&await(async function(s,r){if((function(a){return Hf(a)&&a!==D.ABORTED})(r.code)){const o=s.Ta.shift();bt(s).B_(),await zc(s,(()=>s.remoteSyncer.rejectFailedWrite(o.batchId,r))),await gr(s)}})(n,e),Hc(n)&&Kc(n)}async function nl(n,e){const t=W(n);t.asyncQueue.verifyOperationInProgress(),$(Ft,"RemoteStore received new credentials");const s=Bt(t);t.Ea.add(3),await us(t),s&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await pr(t)}async function dp(n,e){const t=W(n);e?(t.Ea.delete(2),await pr(t)):e||(t.Ea.add(2),await us(t),t.Va.set("Unknown"))}function gn(n){return n.ma||(n.ma=(function(t,s,r){const o=W(t);return o.sa(),new Qm(s,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,r)})(n.datastore,n.asyncQueue,{Zo:np.bind(null,n),Yo:sp.bind(null,n),t_:rp.bind(null,n),J_:ip.bind(null,n)}),n.Ra.push((async e=>{e?(n.ma.B_(),Zi(n)?Xi(n):n.Va.set("Unknown")):(await n.ma.stop(),qc(n))}))),n.ma}function bt(n){return n.fa||(n.fa=(function(t,s,r){const o=W(t);return o.sa(),new Jm(s,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,r)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:lp.bind(null,n),t_:hp.bind(null,n),ta:cp.bind(null,n),na:up.bind(null,n)}),n.Ra.push((async e=>{e?(n.fa.B_(),await gr(n)):(await n.fa.stop(),n.Ta.length>0&&($(Ft,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class eo{constructor(e,t,s,r,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=o,this.deferred=new pt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,o){const a=Date.now()+s,u=new eo(e,t,a,r,o);return u.start(s),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new q(D.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function to(n,e){if(et("AsyncQueue",`${e}: ${n}`),pn(n))return new q(D.UNAVAILABLE,`${e}: ${n}`);throw n}class Zt{static emptySet(e){return new Zt(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||z.comparator(t.key,s.key):(t,s)=>z.comparator(t.key,s.key),this.keyedMap=qn(),this.sortedSet=new le(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,s)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Zt)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,o=s.getNext().key;if(!r.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new Zt;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}class sl{constructor(){this.ga=new le(z.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):K(63341,{Vt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,s)=>{e.push(s)})),e}}class cn{constructor(e,t,s,r,o,a,u,d,f){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=d,this.hasCachedResults=f}static fromInitialDocuments(e,t,s,r,o){const a=[];return t.forEach((u=>{a.push({type:0,doc:u})})),new cn(e,t,Zt.emptySet(t),a,s,r,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&cr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}class fp{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((e=>e.Da()))}}class mp{constructor(){this.queries=rl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const r=W(t),o=r.queries;r.queries=rl(),o.forEach(((a,u)=>{for(const d of u.ba)d.onError(s)}))})(this,new q(D.ABORTED,"Firestore shutting down"))}}function rl(){return new Lt((n=>dc(n)),cr)}async function pp(n,e){const t=W(n);let s=3;const r=e.query;let o=t.queries.get(r);o?!o.Sa()&&e.Da()&&(s=2):(o=new fp,s=e.Da()?0:1);try{switch(s){case 0:o.wa=await t.onListen(r,!0);break;case 1:o.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(a){const u=to(a,`Initialization of query '${Wt(e.query)}' failed`);return void e.onError(u)}t.queries.set(r,o),o.ba.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&no(t)}async function gp(n,e){const t=W(n),s=e.query;let r=3;const o=t.queries.get(s);if(o){const a=o.ba.indexOf(e);a>=0&&(o.ba.splice(a,1),o.ba.length===0?r=e.Da()?0:1:!o.Sa()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function yp(n,e){const t=W(n);let s=!1;for(const r of e){const o=r.query,a=t.queries.get(o);if(a){for(const u of a.ba)u.Fa(r)&&(s=!0);a.wa=r}}s&&no(t)}function _p(n,e,t){const s=W(n),r=s.queries.get(e);if(r)for(const o of r.ba)o.onError(t);s.queries.delete(e)}function no(n){n.Ca.forEach((e=>{e.next()}))}var Ai,il;(il=Ai||(Ai={})).Ma="default",il.Cache="cache";class vp{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new cn(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.Ka||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=cn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ai.Cache}}class Gc{constructor(e){this.key=e}}class Wc{constructor(e){this.key=e}}class Ep{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=Y(),this.mutatedKeys=Y(),this.eu=fc(e),this.tu=new Zt(this.eu)}get nu(){return this.Za}ru(e,t){const s=t?t.iu:new sl,r=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,a=r,u=!1;const d=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,f=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((m,y)=>{const T=r.get(m),S=ur(this.query,y)?y:null,P=!!T&&this.mutatedKeys.has(T.key),R=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations);let F=!1;T&&S?T.data.isEqual(S.data)?P!==R&&(s.track({type:3,doc:S}),F=!0):this.su(T,S)||(s.track({type:2,doc:S}),F=!0,(d&&this.eu(S,d)>0||f&&this.eu(S,f)<0)&&(u=!0)):!T&&S?(s.track({type:0,doc:S}),F=!0):T&&!S&&(s.track({type:1,doc:T}),F=!0,(d||f)&&(u=!0)),F&&(S?(a=a.add(S),o=R?o.add(m):o.delete(m)):(a=a.delete(m),o=o.delete(m)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const m=this.query.limitType==="F"?a.last():a.first();a=a.delete(m.key),o=o.delete(m.key),s.track({type:1,doc:m})}return{tu:a,iu:s,Ss:u,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((m,y)=>(function(S,P){const R=F=>{switch(F){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return K(20277,{Vt:F})}};return R(S)-R(P)})(m.type,y.type)||this.eu(m.doc,y.doc))),this.ou(s),r=r??!1;const u=t&&!r?this._u():[],d=this.Ya.size===0&&this.current&&!r?1:0,f=d!==this.Xa;return this.Xa=d,a.length!==0||f?{snapshot:new cn(this.query,e.tu,o,a,e.mutatedKeys,d===0,f,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new sl,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Za=this.Za.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Za=this.Za.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=Y(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Ya=this.Ya.add(s.key))}));const t=[];return e.forEach((s=>{this.Ya.has(s)||t.push(new Wc(s))})),this.Ya.forEach((s=>{e.has(s)||t.push(new Gc(s))})),t}cu(e){this.Za=e.ks,this.Ya=Y();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return cn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const so="SyncEngine";class bp{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class Tp{constructor(e){this.key=e,this.hu=!1}}class wp{constructor(e,t,s,r,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Lt((u=>dc(u)),cr),this.Iu=new Map,this.Eu=new Set,this.Ru=new le(z.comparator),this.Au=new Map,this.Vu=new Ki,this.du={},this.mu=new Map,this.fu=ln.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Ip(n,e,t=!0){const s=eu(n);let r;const o=s.Tu.get(e);return o?(s.sharedClientState.addLocalQueryTarget(o.targetId),r=o.view.lu()):r=await Qc(s,e,t,!0),r}async function Ap(n,e){const t=eu(n);await Qc(t,e,!0,!1)}async function Qc(n,e,t,s){const r=await $m(n.localStore,Ue(e)),o=r.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t);let u;return s&&(u=await Sp(n,e,o,a==="current",r.resumeToken)),n.isPrimaryClient&&t&&$c(n.remoteStore,r),u}async function Sp(n,e,t,s,r){n.pu=(y,T,S)=>(async function(R,F,B,j){let O=F.view.ru(B);O.Ss&&(O=await Ya(R.localStore,F.query,!1).then((({documents:E})=>F.view.ru(E,O))));const V=j&&j.targetChanges.get(F.targetId),x=j&&j.targetMismatches.get(F.targetId)!=null,H=F.view.applyChanges(O,R.isPrimaryClient,V,x);return al(R,F.targetId,H.au),H.snapshot})(n,y,T,S);const o=await Ya(n.localStore,e,!0),a=new Ep(e,o.ks),u=a.ru(o.documents),d=cs.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",r),f=a.applyChanges(u,n.isPrimaryClient,d);al(n,t,f.au);const m=new bp(e,t,a);return n.Tu.set(e,m),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),f.snapshot}async function Cp(n,e,t){const s=W(n),r=s.Tu.get(e),o=s.Iu.get(r.targetId);if(o.length>1)return s.Iu.set(r.targetId,o.filter((a=>!cr(a,e)))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await wi(s.localStore,r.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(r.targetId),t&&Ji(s.remoteStore,r.targetId),Si(s,r.targetId)})).catch(mn)):(Si(s,r.targetId),await wi(s.localStore,r.targetId,!0))}async function xp(n,e){const t=W(n),s=t.Tu.get(e),r=t.Iu.get(s.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),Ji(t.remoteStore,s.targetId))}async function Np(n,e,t){const s=Fp(n);try{const r=await(function(a,u){const d=W(a),f=ae.now(),m=u.reduce(((S,P)=>S.add(P.key)),Y());let y,T;return d.persistence.runTransaction("Locally write mutations","readwrite",(S=>{let P=tt(),R=Y();return d.xs.getEntries(S,m).next((F=>{P=F,P.forEach(((B,j)=>{j.isValidDocument()||(R=R.add(B))}))})).next((()=>d.localDocuments.getOverlayedDocuments(S,P))).next((F=>{y=F;const B=[];for(const j of u){const O=Bf(j,y.get(j.key).overlayedDocument);O!=null&&B.push(new Mt(j.key,O,rc(O.value.mapValue),qe.exists(!0)))}return d.mutationQueue.addMutationBatch(S,f,B,u)})).next((F=>{T=F;const B=F.applyToLocalDocumentSet(y,R);return d.documentOverlayCache.saveOverlays(S,F.batchId,B)}))})).then((()=>({batchId:T.batchId,changes:pc(y)})))})(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),(function(a,u,d){let f=a.du[a.currentUser.toKey()];f||(f=new le(J)),f=f.insert(u,d),a.du[a.currentUser.toKey()]=f})(s,r.batchId,t),await hs(s,r.changes),await gr(s.remoteStore)}catch(r){const o=to(r,"Failed to persist write");t.reject(o)}}async function Jc(n,e){const t=W(n);try{const s=await Lm(t.localStore,e);e.targetChanges.forEach(((r,o)=>{const a=t.Au.get(o);a&&(ne(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?a.hu=!0:r.modifiedDocuments.size>0?ne(a.hu,14607):r.removedDocuments.size>0&&(ne(a.hu,42227),a.hu=!1))})),await hs(t,s,e)}catch(s){await mn(s)}}function ol(n,e,t){const s=W(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const r=[];s.Tu.forEach(((o,a)=>{const u=a.view.va(e);u.snapshot&&r.push(u.snapshot)})),(function(a,u){const d=W(a);d.onlineState=u;let f=!1;d.queries.forEach(((m,y)=>{for(const T of y.ba)T.va(u)&&(f=!0)})),f&&no(d)})(s.eventManager,e),r.length&&s.Pu.J_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function Rp(n,e,t){const s=W(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.Au.get(e),o=r&&r.key;if(o){let a=new le(z.comparator);a=a.insert(o,Se.newNoDocument(o,G.min()));const u=Y().add(o),d=new fr(G.min(),new Map,new le(J),a,u);await Jc(s,d),s.Ru=s.Ru.remove(o),s.Au.delete(e),ro(s)}else await wi(s.localStore,e,!1).then((()=>Si(s,e,t))).catch(mn)}async function Pp(n,e){const t=W(n),s=e.batch.batchId;try{const r=await Om(t.localStore,e);Xc(t,s,null),Yc(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await hs(t,r)}catch(r){await mn(r)}}async function Dp(n,e,t){const s=W(n);try{const r=await(function(a,u){const d=W(a);return d.persistence.runTransaction("Reject batch","readwrite-primary",(f=>{let m;return d.mutationQueue.lookupMutationBatch(f,u).next((y=>(ne(y!==null,37113),m=y.keys(),d.mutationQueue.removeMutationBatch(f,y)))).next((()=>d.mutationQueue.performConsistencyCheck(f))).next((()=>d.documentOverlayCache.removeOverlaysForBatchId(f,m,u))).next((()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,m))).next((()=>d.localDocuments.getDocuments(f,m)))}))})(s.localStore,e);Xc(s,e,t),Yc(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await hs(s,r)}catch(r){await mn(r)}}function Yc(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function Xc(n,e,t){const s=W(n);let r=s.du[s.currentUser.toKey()];if(r){const o=r.get(e);o&&(t?o.reject(t):o.resolve(),r=r.remove(e)),s.du[s.currentUser.toKey()]=r}}function Si(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach((s=>{n.Vu.containsKey(s)||Zc(n,s)}))}function Zc(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(Ji(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),ro(n))}function al(n,e,t){for(const s of t)s instanceof Gc?(n.Vu.addReference(s.key,e),kp(n,s)):s instanceof Wc?($(so,"Document no longer in limbo: "+s.key),n.Vu.removeReference(s.key,e),n.Vu.containsKey(s.key)||Zc(n,s.key)):K(19791,{wu:s})}function kp(n,e){const t=e.key,s=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(s)||($(so,"New document in limbo: "+t),n.Eu.add(s),ro(n))}function ro(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new z(oe.fromString(e)),s=n.fu.next();n.Au.set(s,new Tp(t)),n.Ru=n.Ru.insert(t,s),$c(n.remoteStore,new ut(Ue(hc(t.path)),s,"TargetPurposeLimboResolution",ir.ce))}}async function hs(n,e,t){const s=W(n),r=[],o=[],a=[];s.Tu.isEmpty()||(s.Tu.forEach(((u,d)=>{a.push(s.pu(d,e,t).then((f=>{if((f||t)&&s.isPrimaryClient){const m=f?!f.fromCache:t?.targetChanges.get(d.targetId)?.current;s.sharedClientState.updateQueryState(d.targetId,m?"current":"not-current")}if(f){r.push(f);const m=Wi.Es(d.targetId,f);o.push(m)}})))})),await Promise.all(a),s.Pu.J_(r),await(async function(d,f){const m=W(d);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",(y=>N.forEach(f,(T=>N.forEach(T.Ts,(S=>m.persistence.referenceDelegate.addReference(y,T.targetId,S))).next((()=>N.forEach(T.Is,(S=>m.persistence.referenceDelegate.removeReference(y,T.targetId,S)))))))))}catch(y){if(!pn(y))throw y;$(Qi,"Failed to update sequence numbers: "+y)}for(const y of f){const T=y.targetId;if(!y.fromCache){const S=m.vs.get(T),P=S.snapshotVersion,R=S.withLastLimboFreeSnapshotVersion(P);m.vs=m.vs.insert(T,R)}}})(s.localStore,o))}async function Vp(n,e){const t=W(n);if(!t.currentUser.isEqual(e)){$(so,"User change. New user:",e.toKey());const s=await Oc(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach((u=>{u.forEach((d=>{d.reject(new q(D.CANCELLED,a))}))})),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await hs(t,s.Ns)}}function jp(n,e){const t=W(n),s=t.Au.get(e);if(s&&s.hu)return Y().add(s.key);{let r=Y();const o=t.Iu.get(e);if(!o)return r;for(const a of o){const u=t.Tu.get(a);r=r.unionWith(u.view.nu)}return r}}function eu(n){const e=W(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Jc.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=jp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Rp.bind(null,e),e.Pu.J_=yp.bind(null,e.eventManager),e.Pu.yu=_p.bind(null,e.eventManager),e}function Fp(n){const e=W(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Pp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Dp.bind(null,e),e}class nr{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=mr(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Fm(this.persistence,new km,e.initialUser,this.serializer)}Cu(e){return new Fc(Gi.Vi,this.serializer)}Du(e){return new qm}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}nr.provider={build:()=>new nr};class Op extends nr{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ne(this.persistence.referenceDelegate instanceof er,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new _m(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?xe.withCacheSize(this.cacheSizeBytes):xe.DEFAULT;return new Fc((s=>er.Vi(s,t)),this.serializer)}}class Ci{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>ol(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Vp.bind(null,this.syncEngine),await dp(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new mp})()}createDatastore(e){const t=mr(e.databaseInfo.databaseId),s=Wm(e.databaseInfo);return Zm(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return(function(s,r,o,a,u){return new tp(s,r,o,a,u)})(this.localStore,this.datastore,e.asyncQueue,(t=>ol(this.syncEngine,t,0)),(function(){return el.v()?new el:new zm})())}createSyncEngine(e,t){return(function(r,o,a,u,d,f,m){const y=new wp(r,o,a,u,d,f);return m&&(y.gu=!0),y})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const s=W(t);$(Ft,"RemoteStore shutting down."),s.Ea.add(5),await us(s),s.Aa.shutdown(),s.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Ci.provider={build:()=>new Ci};class Lp{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):et("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const Tt="FirestoreClient";class Mp{constructor(e,t,s,r,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this._databaseInfo=r,this.user=Ae.UNAUTHENTICATED,this.clientId=Vi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(s,(async a=>{$(Tt,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(s,(a=>($(Tt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new pt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=to(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}async function ti(n,e){n.asyncQueue.verifyOperationInProgress(),$(Tt,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener((async r=>{s.isEqual(r)||(await Oc(e.localStore,r),s=r)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function ll(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Bp(n);$(Tt,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((s=>nl(e.remoteStore,s))),n.setAppCheckTokenChangeListener(((s,r)=>nl(e.remoteStore,r))),n._onlineComponents=e}async function Bp(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){$(Tt,"Using user provided OfflineComponentProvider");try{await ti(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(r){return r.name==="FirebaseError"?r.code===D.FAILED_PRECONDITION||r.code===D.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11})(t))throw t;jt("Error using user provided cache. Falling back to memory cache: "+t),await ti(n,new nr)}}else $(Tt,"Using default OfflineComponentProvider"),await ti(n,new Op(void 0));return n._offlineComponents}async function tu(n){return n._onlineComponents||(n._uninitializedComponentsProvider?($(Tt,"Using user provided OnlineComponentProvider"),await ll(n,n._uninitializedComponentsProvider._online)):($(Tt,"Using default OnlineComponentProvider"),await ll(n,new Ci))),n._onlineComponents}function $p(n){return tu(n).then((e=>e.syncEngine))}async function Up(n){const e=await tu(n),t=e.eventManager;return t.onListen=Ip.bind(null,e.syncEngine),t.onUnlisten=Cp.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Ap.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=xp.bind(null,e.syncEngine),t}function qp(n,e,t={}){const s=new pt;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,u,d,f){const m=new Lp({next:T=>{m.Nu(),a.enqueueAndForget((()=>gp(o,y))),T.fromCache&&d.source==="server"?f.reject(new q(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(T)},error:T=>f.reject(T)}),y=new vp(u,m,{includeMetadataChanges:!0,Ka:!0});return pp(o,y)})(await Up(n),n.asyncQueue,e,t,s))),s.promise}function zp(n,e){const t=new pt;return n.asyncQueue.enqueueAndForget((async()=>Np(await $p(n),e,t))),t.promise}function nu(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const Hp="ComponentProvider",cl=new Map;function Kp(n,e,t,s,r){return new lf(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,nu(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator,s)}const su="firestore.googleapis.com",ul=!0;class hl{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new q(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=su,this.ssl=ul}else this.host=e.host,this.ssl=e.ssl??ul;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=jc;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<gm)throw new q(D.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Jd("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=nu(e.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new q(D.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new q(D.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new q(D.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(s,r){return s.timeoutSeconds===r.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class yr{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new q(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new q(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hl(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new Bd;switch(s.type){case"firstParty":return new zd(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new q(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const s=cl.get(t);s&&($(Hp,"Removing Datastore"),cl.delete(t),s.terminate())})(this),Promise.resolve()}}function Gp(n,e,t,s={}){n=rn(n,yr);const r=Pi(e),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},u=`${e}:${t}`;r&&(dh(`https://${u}`),gh("Firestore",!0)),o.host!==su&&o.host!==u&&jt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const d={...o,host:u,ssl:r,emulatorOptions:s};if(!qs(d,a)&&(n._setSettings(d),s.mockUserToken)){let f,m;if(typeof s.mockUserToken=="string")f=s.mockUserToken,m=Ae.MOCK_USER;else{f=fh(s.mockUserToken,n._app?.options.projectId);const y=s.mockUserToken.sub||s.mockUserToken.user_id;if(!y)throw new q(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new Ae(y)}n._authCredentials=new $d(new Kl(f,m))}}class _r{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new _r(this.firestore,e,this._query)}}class Ee{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new gt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ee(this.firestore,e,this._key)}toJSON(){return{type:Ee._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(as(t,Ee._jsonSchema))return new Ee(e,s||null,new z(oe.fromString(t.referencePath)))}}Ee._jsonSchemaVersion="firestore/documentReference/1.0",Ee._jsonSchema={type:de("string",Ee._jsonSchemaVersion),referencePath:de("string")};class gt extends _r{constructor(e,t,s){super(e,t,hc(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ee(this.firestore,null,new z(e))}withConverter(e){return new gt(this.firestore,e,this._path)}}function io(n,e,...t){if(n=Xn(n),Gl("collection","path",e),n instanceof yr){const s=oe.fromString(e,...t);return Aa(s),new gt(n,null,s)}{if(!(n instanceof Ee||n instanceof gt))throw new q(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(oe.fromString(e,...t));return Aa(s),new gt(n.firestore,null,s)}}function yn(n,e,...t){if(n=Xn(n),arguments.length===1&&(e=Vi.newId()),Gl("doc","path",e),n instanceof yr){const s=oe.fromString(e,...t);return Ia(s),new Ee(n,null,new z(s))}{if(!(n instanceof Ee||n instanceof gt))throw new q(D.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(oe.fromString(e,...t));return Ia(s),new Ee(n.firestore,n instanceof gt?n.converter:null,new z(s))}}const dl="AsyncQueue";class fl{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Mc(this,"async_queue_retry"),this._c=()=>{const s=ei();s&&$(dl,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=ei();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=ei();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new pt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Yu.push(e),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!pn(e))throw e;$(dl,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((s=>{throw this.nc=s,this.rc=!1,et("INTERNAL UNHANDLED ERROR: ",ml(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=eo.createAndSchedule(this,e,t,s,(o=>this.hc(o)));return this.tc.push(r),r}uc(){this.nc&&K(47125,{Pc:ml(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,s)=>t.targetTimeMs-s.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function ml(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class vr extends yr{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new fl,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new fl(e),this._firestoreClient=void 0,await e}}}function Wp(n,e){const t=typeof n=="object"?n:Sd(),s=typeof n=="string"?n:Gs,r=bd(t,"firestore").getImmediate({identifier:s});if(!r._initialized){const o=uh("firestore");o&&Gp(r,...o)}return r}function ru(n){if(n._terminated)throw new q(D.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Qp(n),n._firestoreClient}function Qp(n){const e=n._freezeSettings(),t=Kp(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new Mp(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(r){const o=r?._online.build();return{_offline:r?._offline.build(o),_online:o}})(n._componentsProvider))}class Ve{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ve(we.fromBase64String(e))}catch(t){throw new q(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ve(we.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Ve._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(as(e,Ve._jsonSchema))return Ve.fromBase64String(e.bytes)}}Ve._jsonSchemaVersion="firestore/bytes/1.0",Ve._jsonSchema={type:de("string",Ve._jsonSchemaVersion),bytes:de("string")};class iu{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new q(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Te(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ou{constructor(e){this._methodName=e}}class He{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new q(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new q(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return J(this._lat,e._lat)||J(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:He._jsonSchemaVersion}}static fromJSON(e){if(as(e,He._jsonSchema))return new He(e.latitude,e.longitude)}}He._jsonSchemaVersion="firestore/geoPoint/1.0",He._jsonSchema={type:de("string",He._jsonSchemaVersion),latitude:de("number"),longitude:de("number")};class Fe{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(s,r){if(s.length!==r.length)return!1;for(let o=0;o<s.length;++o)if(s[o]!==r[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Fe._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(as(e,Fe._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Fe(e.vectorValues);throw new q(D.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Fe._jsonSchemaVersion="firestore/vectorValue/1.0",Fe._jsonSchema={type:de("string",Fe._jsonSchemaVersion),vectorValues:de("object")};const Jp=/^__.*__$/;class Yp{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new Mt(e,this.data,this.fieldMask,t,this.fieldTransforms):new ls(e,this.data,t,this.fieldTransforms)}}function au(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw K(40011,{dataSource:n})}}class oo{constructor(e,t,s,r,o,a){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,o===void 0&&this.validatePath(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new oo({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){const t=this.path?.child(e),s=this.contextWith({path:t,arrayElement:!1});return s.validatePathSegment(e),s}childContextForFieldPath(e){const t=this.path?.child(e),s=this.contextWith({path:t,arrayElement:!1});return s.validatePath(),s}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return sr(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(au(this.dataSource)&&Jp.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class Xp{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||mr(e)}createContext(e,t,s,r=!1){return new oo({dataSource:e,methodName:t,targetDoc:s,path:Te.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Zp(n){const e=n._freezeSettings(),t=mr(n._databaseId);return new Xp(n._databaseId,!!e.ignoreUndefinedProperties,t)}function eg(n,e,t,s,r,o={}){const a=n.createContext(o.merge||o.mergeFields?2:0,e,t,r);hu("Data must be an object, but it was:",a,s);const u=cu(s,a);let d,f;if(o.merge)d=new je(a.fieldMask),f=a.fieldTransforms;else if(o.mergeFields){const m=[];for(const y of o.mergeFields){const T=ao(e,y,t);if(!a.contains(T))throw new q(D.INVALID_ARGUMENT,`Field '${T}' is specified in your field mask but missing from your input data.`);sg(m,T)||m.push(T)}d=new je(m),f=a.fieldTransforms.filter((y=>d.covers(y.field)))}else d=null,f=a.fieldTransforms;return new Yp(new ke(u),d,f)}function lu(n,e){if(uu(n=Xn(n)))return hu("Unsupported field value:",e,n),cu(n,e);if(n instanceof ou)return(function(s,r){if(!au(r.dataSource))throw r.createError(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.createError(`${s._methodName}() is not currently supported inside arrays`);const o=s._toFieldTransform(r);o&&r.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return(function(s,r){const o=[];let a=0;for(const u of s){let d=lu(u,r.childContextForArray(a));d==null&&(d={nullValue:"NULL_VALUE"}),o.push(d),a++}return{arrayValue:{values:o}}})(n,e)}return(function(s,r){if((s=Xn(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return Vf(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const o=ae.fromDate(s);return{timestampValue:Zs(r.serializer,o)}}if(s instanceof ae){const o=new ae(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:Zs(r.serializer,o)}}if(s instanceof He)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Ve)return{bytesValue:Cc(r.serializer,s._byteString)};if(s instanceof Ee){const o=r.databaseId,a=s.firestore._databaseId;if(!a.isEqual(o))throw r.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Hi(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof Fe)return(function(a,u){const d=a instanceof Fe?a.toArray():a;return{mapValue:{fields:{[nc]:{stringValue:sc},[Ws]:{arrayValue:{values:d.map((m=>{if(typeof m!="number")throw u.createError("VectorValues must only contain numeric values.");return $i(u.serializer,m)}))}}}}}})(s,r);if(Vc(s))return s._toProto(r.serializer);throw r.createError(`Unsupported field value: ${ji(s)}`)})(n,e)}function cu(n,e){const t={};return Jl(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ot(n,((s,r)=>{const o=lu(r,e.childContextForField(s));o!=null&&(t[s]=o)})),{mapValue:{fields:t}}}function uu(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ae||n instanceof He||n instanceof Ve||n instanceof Ee||n instanceof ou||n instanceof Fe||Vc(n))}function hu(n,e,t){if(!uu(t)||!Wl(t)){const s=ji(t);throw s==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+s)}}function ao(n,e,t){if((e=Xn(e))instanceof iu)return e._internalPath;if(typeof e=="string")return ng(n,e);throw sr("Field path arguments must be of type string or ",n,!1,void 0,t)}const tg=new RegExp("[~\\*/\\[\\]]");function ng(n,e,t){if(e.search(tg)>=0)throw sr(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new iu(...e.split("."))._internalPath}catch{throw sr(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function sr(n,e,t,s,r){const o=s&&!s.isEmpty(),a=r!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let d="";return(o||a)&&(d+=" (found",o&&(d+=` in field ${s}`),a&&(d+=` in document ${r}`),d+=")"),new q(D.INVALID_ARGUMENT,u+n+d)}function sg(n,e){return n.some((t=>t.isEqual(e)))}class rg{convertValue(e,t="none"){switch(Et(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ue(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(vt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw K(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return Ot(e,((r,o)=>{s[r]=this.convertValue(o,t)})),s}convertVectorValue(e){const t=e.fields?.[Ws].arrayValue?.values?.map((s=>ue(s.doubleValue)));return new Fe(t)}convertGeoPoint(e){return new He(ue(e.latitude),ue(e.longitude))}convertArray(e,t){return(e.values||[]).map((s=>this.convertValue(s,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const s=ar(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(ns(e));default:return null}}convertTimestamp(e){const t=_t(e);return new ae(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=oe.fromString(e);ne(kc(s),9688,{name:e});const r=new ss(s.get(1),s.get(3)),o=new z(s.popFirst(5));return r.isEqual(t)||et(`Document ${o} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}class ig extends rg{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ve(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ee(this.firestore,null,t)}}const pl="@firebase/firestore",gl="4.11.0";class du{constructor(e,t,s,r,o){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Ee(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new og(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){const t=this._document.data.field(ao("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class og extends du{data(){return super.data()}}function ag(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new q(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function lg(n,e,t){let s;return s=n?n.toFirestore(e):e,s}class js{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class en extends du{constructor(e,t,s,r,o,a){super(e,t,s,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new $s(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(ao("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new q(D.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=en._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}en._jsonSchemaVersion="firestore/documentSnapshot/1.0",en._jsonSchema={type:de("string",en._jsonSchemaVersion),bundleSource:de("string","DocumentSnapshot"),bundleName:de("string"),bundle:de("string")};class $s extends en{data(e={}){return super.data(e)}}class tn{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new js(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((s=>{e.call(t,new $s(this._firestore,this._userDataWriter,s.key,s,new js(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new q(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(r,o){if(r._snapshot.oldDocs.isEmpty()){let a=0;return r._snapshot.docChanges.map((u=>{const d=new $s(r._firestore,r._userDataWriter,u.doc.key,u.doc,new js(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter);return u.doc,{type:"added",doc:d,oldIndex:-1,newIndex:a++}}))}{let a=r._snapshot.oldDocs;return r._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const d=new $s(r._firestore,r._userDataWriter,u.doc.key,u.doc,new js(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter);let f=-1,m=-1;return u.type!==0&&(f=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),m=a.indexOf(u.doc.key)),{type:cg(u.type),doc:d,oldIndex:f,newIndex:m}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new q(D.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=tn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Vi.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],r=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),s.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),r.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function cg(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return K(61501,{type:n})}}tn._jsonSchemaVersion="firestore/querySnapshot/1.0",tn._jsonSchema={type:de("string",tn._jsonSchemaVersion),bundleSource:de("string","QuerySnapshot"),bundleName:de("string"),bundle:de("string")};function lo(n){n=rn(n,_r);const e=rn(n.firestore,vr),t=ru(e),s=new ig(e);return ag(n._query),qp(t,n._query).then((r=>new tn(e,s,n,r)))}function Er(n,e,t){n=rn(n,Ee);const s=rn(n.firestore,vr),r=lg(n.converter,e),o=Zp(s);return fu(s,[eg(o,"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,qe.none())])}function co(n){return fu(rn(n.firestore,vr),[new Ui(n._key,qe.none())])}function fu(n,e){const t=ru(n);return zp(t,e)}(function(e,t=!0){Md(Ad),Hs(new Zn("firestore",((s,{instanceIdentifier:r,options:o})=>{const a=s.getProvider("app").getImmediate(),u=new vr(new Ud(s.getProvider("auth-internal")),new Hd(a,s.getProvider("app-check-internal")),cf(a,r),a);return o={useFetchStreams:t,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),Yt(pl,gl,e),Yt(pl,gl,"esm2020")})();const xi={apiKey:"",authDomain:"",projectId:"",storageBucket:"",messagingSenderId:"",appId:""},Ne=!!(xi.apiKey&&xi.projectId);let yl=null,We=null;Ne&&(yl=Fl(xi),We=Wp(yl));const mu="/Claude/",un=`${mu}sodexo-live-logo.svg`,pu=`${mu}sodexo-dark.svg`,_l="sdx_salt",br="sdx_users",gu="sdx_inspection_vault",vl="sdx_device_secret",ug=600*1e3,ni={name:"Joxel Da Silva",badge:"365582",department:"Safety Inspector"};async function yu(){let n=localStorage.getItem(_l);if(n)return new Uint8Array(JSON.parse(n));const e=crypto.getRandomValues(new Uint8Array(16));return localStorage.setItem(_l,JSON.stringify(Array.from(e))),e}async function hg(n){const e=new TextEncoder,t=await yu(),s=await crypto.subtle.importKey("raw",e.encode(n),"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},s,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function Tr(n){const e=new TextEncoder,t=await yu(),s=new Uint8Array([...t,...e.encode(n)]),r=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(r)).map(o=>o.toString(16).padStart(2,"0")).join("")}async function dg(n,e){const t=crypto.getRandomValues(new Uint8Array(12)),s=new TextEncoder,r=await crypto.subtle.encrypt({name:"AES-GCM",iv:t},e,s.encode(JSON.stringify(n)));return JSON.stringify({iv:Array.from(t),ct:Array.from(new Uint8Array(r))})}async function fg(n,e){if(!n)return[];try{const{iv:t,ct:s}=JSON.parse(n),r=await crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(t)},e,new Uint8Array(s));return JSON.parse(new TextDecoder().decode(r))}catch{return[]}}async function mg(){let n=localStorage.getItem(vl);if(!n){const e=crypto.getRandomValues(new Uint8Array(32));n=Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join(""),localStorage.setItem(vl,n)}return hg("sdx_master_"+n)}async function Oe(){if(Ne)try{return(await lo(io(We,"users"))).docs.map(e=>e.data())}catch{return[]}try{return JSON.parse(localStorage.getItem(br)||"[]")}catch{return[]}}async function ds(n){if(Ne){try{await Er(yn(We,"users",n.badgeHash),n)}catch{}return}const e=await Oe(),t=e.findIndex(s=>s.badgeHash===n.badgeHash);t>=0?e[t]=n:e.push(n),localStorage.setItem(br,JSON.stringify(e))}async function pg(n){if(Ne){try{await co(yn(We,"users",n))}catch{}return}const e=await Oe();localStorage.setItem(br,JSON.stringify(e.filter(t=>t.badgeHash!==n)))}async function _u(){if((await Oe()).length>0)return;const e=await Tr(ni.badge),t={badgeHash:e,name:ni.name,department:ni.department,role:"admin",approved:!0,registeredAt:new Date().toISOString()};Ne?await Er(yn(We,"users",e),t):localStorage.setItem(br,JSON.stringify([t]))}let hn=null,Ni=null;async function uo(){if(Ne)try{const t=(await lo(io(We,"inspections"))).docs.map(s=>s.data());return t.sort((s,r)=>(r.savedAt||"").localeCompare(s.savedAt||"")),t}catch{return[]}if(!hn)return[];const n=localStorage.getItem(gu);return fg(n,hn)}async function ho(n){if(Ne){try{for(const t of n)await Er(yn(We,"inspections",t.id),t)}catch(t){console.error("Firestore saveHistory error:",t)}return}if(!hn)return;const e=await dg(n,hn);localStorage.setItem(gu,e)}async function gg(n){if(Ne){try{await Er(yn(We,"inspections",n.id),n)}catch{}return}const e=await uo();e.unshift(n),await ho(e)}async function yg(n){if(Ne){try{await co(yn(We,"inspections",n))}catch{}return}const e=await uo();await ho(e.filter(t=>t.id!==n))}async function _g(){if(Ne){try{const n=await lo(io(We,"inspections"));for(const e of n.docs)await co(e.ref)}catch{}return}await ho([])}async function vg(n){await _u();const e=await Tr(n),s=(await Oe()).find(r=>r.badgeHash===e);return s?s.approved?(Ne||(hn=await mg()),Ni={...s},{ok:!0,user:Ni}):{ok:!1,reason:"pending"}:{ok:!1,reason:"not_found"}}async function Eg(n,e,t){const s=await Tr(n);if((await Oe()).find(a=>a.badgeHash===s))return{ok:!1,reason:"exists"};const o={badgeHash:s,name:e,department:t,role:"inspector",approved:!1,registeredAt:new Date().toISOString()};return await ds(o),{ok:!0}}function El(){hn=null,Ni=null}async function bg(n,e,t,s){const r=await Tr(n);if((await Oe()).find(u=>u.badgeHash===r))return{ok:!1,reason:"exists"};const a={badgeHash:r,name:e,department:t,role:s||"inspector",approved:!0,registeredAt:new Date().toISOString()};return await ds(a),{ok:!0}}async function Tg(n){const t=(await Oe()).find(s=>s.badgeHash===n);t&&(t.approved=!0,await ds(t))}async function bl(n){await pg(n)}async function wg(n){const t=(await Oe()).find(s=>s.badgeHash===n);t&&(t.role="admin",await ds(t))}async function Ig(n){const t=(await Oe()).find(s=>s.badgeHash===n);t&&(t.role="inspector",await ds(t))}function Ag({onUnlock:n}){const[e,t]=U.useState(""),[s,r]=U.useState("signin"),[o,a]=U.useState(""),[u,d]=U.useState(""),[f,m]=U.useState(""),[y,T]=U.useState(!1),[S,P]=U.useState(""),R=U.useRef(null);U.useEffect(()=>{_u()},[]),U.useEffect(()=>{R.current?.focus()},[s]);async function F(j){j.preventDefault(),m(""),T(!0);try{const O=await vg(e.trim());if(O.ok){n(O.user);return}O.reason==="pending"?r("pending"):m("Badge not recognized. Request access below if youre new.")}catch{m("Something went wrong. Try again.")}finally{T(!1)}}async function B(j){j.preventDefault(),m(""),T(!0);try{const O=await Eg(e.trim(),o.trim(),u.trim());O.ok?(P("Registration submitted! Ask an administrator to approve your badge."),r("pending")):O.reason==="exists"&&m("This badge is already registered. Try signing in.")}catch{m("Registration failed. Try again.")}finally{T(!1)}}return c.jsx("div",{className:"pinOverlay",children:c.jsxs("div",{className:"pinCard",children:[c.jsx("img",{src:pu,alt:"Sodexo",className:"pinLogo"}),s==="signin"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"pinTitle",children:"Badge Sign-In"}),c.jsx("div",{className:"pinSub",children:"Enter your work badge number to access inspections"}),c.jsxs("form",{onSubmit:F,className:"pinForm",children:[c.jsx("input",{ref:R,className:"pinInput badgeInput",type:"password",maxLength:20,value:e,onChange:j=>t(j.target.value),placeholder:"Badge #",autoComplete:"off"}),f&&c.jsx("div",{className:"pinError",children:f}),c.jsx("button",{className:"btn btnPrimary pinBtn",type:"submit",disabled:y||e.trim().length<3,children:y?"Verifying...":"Sign In"})]}),c.jsx("button",{className:"btnLink",type:"button",onClick:()=>{r("register"),m(""),t("")},children:"New here? Request access"})]}),s==="register"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"pinTitle",children:"Request Access"}),c.jsx("div",{className:"pinSub",children:"Fill in your details. An administrator will review your request."}),c.jsxs("form",{onSubmit:B,className:"pinForm",children:[c.jsx("input",{ref:R,className:"pinInput badgeInput",type:"password",maxLength:20,value:e,onChange:j=>t(j.target.value),placeholder:"Badge #",autoComplete:"off"}),c.jsx("input",{className:"input regInput",value:o,onChange:j=>a(j.target.value),placeholder:"Full name",autoComplete:"name"}),c.jsx("input",{className:"input regInput",value:u,onChange:j=>d(j.target.value),placeholder:"Department"}),f&&c.jsx("div",{className:"pinError",children:f}),c.jsx("button",{className:"btn btnPrimary pinBtn",type:"submit",disabled:y||e.trim().length<3||!o.trim()||!u.trim(),children:y?"Submitting...":"Request Access"})]}),c.jsx("button",{className:"btnLink",type:"button",onClick:()=>{r("signin"),m(""),t("")},children:"Already registered? Sign in"})]}),s==="pending"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"pinTitle",children:"Pending Approval"}),c.jsx("div",{className:"pinSub",children:S||"Your access request is awaiting administrator approval."}),c.jsx("div",{className:"pendingIcon",children:""}),c.jsx("button",{className:"btnLink",type:"button",onClick:()=>{r("signin"),m(""),P(""),t("")},children:"Back to sign in"})]}),c.jsxs("div",{className:"pinFooter",children:[c.jsx("span",{className:"pinLock",children:""})," AES-256 encrypted  stored only on this device"]})]})})}function fo(n,e){const t=URL.createObjectURL(n),s=document.createElement("a");s.href=t,s.download=e,document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),URL.revokeObjectURL(t)},100)}const nn={inspection:{label:"Kitchen Inspection",contextFields:[{key:"kitchen",label:"Kitchen / Location"},{key:"participants",label:"Participants"},{key:"date",label:"Date"},{key:"duration",label:"Duration"}],useCases:["Email Summary","Google Doc","Slack Update","Evaluation Scorecard"],sample:{meta:{inspectionType:"Event Day",inspectionDate:"2026-02-09",inspectorName:"J. Da Silva"},context:{kitchen:"Concourse Kitchen  North Stand",participants:"Chef Lead, Sanitation Lead, Ops Manager",date:"2026-02-09",duration:"25 min"},inspection:{facility:{ceiling:{status:"OK",notes:"",photos:[]},walls:{status:"OK",notes:"",photos:[]},floors:{status:"Needs Attention",notes:"Slip hazard near mop sink.",photos:[]},lighting:{status:"Needs Attention",notes:"Bulb out over dish station.",photos:[]}},operations:{employeePractices:{status:"Needs Attention",notes:"Coaching on hot holding.",photos:[]},handwashing:{status:"OK",notes:"Soap low at one hand sink.",photos:[]},labelingDating:{status:"Needs Attention",notes:"A few unlabeled containers.",photos:[]},logs:{status:"Needs Attention",notes:"Chemical logs missing 2/7.",photos:[]}},temps:{handSinkTempF:96,threeCompSinkTempF:110},equipment:{doubleDoorCooler:{status:"OK",notes:"38F",photos:[]},doubleDoorFreezer:{status:"OK",notes:"",photos:[]},walkInCooler:{status:"OK",notes:"",photos:[]},warmers:{status:"Needs Attention",notes:"Hot hold 142F (borderline).",photos:[]},ovens:{status:"OK",notes:"",photos:[]},threeCompSink:{status:"OK",notes:"",photos:[]},ecolab:{status:"OK",notes:"Sanitizer 150 ppm",photos:[]}}},rawNotes:"sitdown after svc. recap insp: cooler 38F ok. hot hold 142F (border). q: when calibrate therms? last wk. found: 3 cutting boards scored. chem logs missing 2/7. pest trap behind dry storage shifted. action: replace boards, backfill logs, reset trap + pic, coach hot holding. owner: chef lead. due: Fri."}}},Sg=["OK","Not Clean","Needs Attention","N/A"],si=6,Tl=8,Cg=["Event Day","Post Event","Regular Inspection"],xg=["Floor 1","Floor 2","Floor 3"],rr={"Event Day":{headline:"Event Day Readiness",opening:"This is an Event Day inspection focused on pre-service readiness and risk control before peak volume."},"Post Event":{headline:"Post-Event Close-Out",opening:"This is a Post Event inspection focused on close-out conditions, cleanup effectiveness, and immediate corrective actions after service."},"Regular Inspection":{headline:"Routine Compliance Review",opening:"This is a Regular Inspection focused on routine compliance, sanitation standards, and repeat-risk prevention."}},Ng=[[/\bw\//gi,"with"],[/\bKM\b/g,"Kitchen Manager"],[/\bq\b/gi,"question"],[/\btemp(s?)\b/gi,"temperature$1"],[/\bok\b/gi,"OK"],[/\bchk\b/gi,"check"],[/\bwk\b/gi,"week"],[/\b(\d+)x\b/gi,"$1"],[/\binsp\b/gi,"inspection"],[/\bsvc\b/gi,"service"],[/\btherm(s?)\b/gi,"thermometer$1"],[/\bchem\b/gi,"chemical"],[/\bdocs?\b/gi,"document(s)"],[/\bpic\b/gi,"photo"],[/\bborder\b/gi,"borderline"]];function wr(n){let e=n;for(const[t,s]of Ng)e=e.replace(t,s);return e}const Rg=[[/\bi\b/g,"I"],[/\bdoesnt\b/gi,"doesn't"],[/\bdidnt\b/gi,"didn't"],[/\bwasnt\b/gi,"wasn't"],[/\bwerent\b/gi,"weren't"],[/\bcant\b/gi,"can't"],[/\bwont\b/gi,"won't"],[/\bcouldnt\b/gi,"couldn't"],[/\bshouldnt\b/gi,"shouldn't"],[/\bwouldnt\b/gi,"wouldn't"],[/\bisnt\b/gi,"isn't"],[/\barent\b/gi,"aren't"],[/\bhasnt\b/gi,"hasn't"],[/\bhavent\b/gi,"haven't"],[/\btheyre\b/gi,"they're"],[/\btheres\b/gi,"there's"],[/\bwere\b(?!\s)/gi,"we're"],[/\bits\b(?=\s+[a-z])/gi,"it's"],[/\brecieved?\b/gi,"received"],[/\bseperately?\b/gi,"separately"],[/\boccured\b/gi,"occurred"],[/\buntill?\b/gi,"until"],[/\balot\b/gi,"a lot"],[/\bteh\b/gi,"the"],[/\bwich\b/gi,"which"],[/\bthere\s+is\b/gi,"there is"],[/\bthru\b/gi,"through"],[/\bppl\b/gi,"people"],[/\bmgr\b/gi,"manager"],[/\bmgmt\b/gi,"management"],[/\bequip\b/gi,"equipment"],[/\bmaint\b/gi,"maintenance"],[/\brefrig\b/gi,"refrigerator"],[/\binfo\b/gi,"information"],[/\bamt\b/gi,"amount"],[/\bapprox\b/gi,"approximately"],[/\bmin\b(?=\s|\.|\,|$)/gi,"minimum"],[/\bmax\b(?=\s|\.|\,|$)/gi,"maximum"],[/\bF\b(?=\s*[\.\,\)]|$)/g,"F"]],Pg=[{key:"action",patterns:[/\baction\b/i,/\breplace\b/i,/\bfix\b/i,/\brepair\b/i,/\bschedule\b/i,/\bcoach\b/i,/\bfollow\s*up\b/i,/\bbackfill\b/i,/\breset\b/i]},{key:"finding",patterns:[/\bfound\b/i,/\bnoted\b/i,/\bobserved\b/i,/\bscored\b/i,/\bmissing\b/i,/\bshifted\b/i,/\blow\b/i,/\bbroken\b/i,/\bdamaged\b/i,/\bflagged\b/i]},{key:"temp",patterns:[/\d+\s*?F/i,/\btemperature\b/i,/\bcooler\b/i,/\bfreezer\b/i,/\bhot\s*hold/i,/\bwarm/i]},{key:"question",patterns:[/\bquestion\b/i,/\basked\b/i,/\bwhen\b/i,/\?$/]},{key:"owner",patterns:[/\bowner\b/i,/\bdue\b/i,/\bassign/i,/\bchef\s*lead\b/i]},{key:"context",patterns:[/\bsitdown\b/i,/\bsit-down\b/i,/\brecap\b/i,/\bafter\b/i,/\bbefore\b/i,/\bduring\b/i]}];function Dg(n){for(const e of Pg)for(const t of e.patterns)if(t.test(n))return e.key;return"general"}const Ir={context:"Context",finding:"Findings",temp:"Temperatures",question:"Questions",action:"Action Items",owner:"Ownership & Deadlines",general:"Notes"},Ar=["context","temp","finding","question","action","owner","general"];function kg(n){let e=n;for(const[t,s]of Rg)e=e.replace(t,s);return e=e.replace(/^\s*([a-z])/,(t,s)=>s.toUpperCase()),e=e.replace(/\s{2,}/g," "),e=e.trim(),e&&!/[.!?]$/.test(e)&&(e+="."),e}function Sr(n){if(!n||!n.trim())return{bullets:[],grouped:{}};const s=wr(n).split(/(?<=\.)\s+|;\s*|\n+/).map(o=>o.trim()).filter(o=>o.length>2).map(o=>kg(o)),r={};for(const o of s){const a=Dg(o);r[a]||(r[a]=[]),r[a].push(o)}return{bullets:s,grouped:r}}function Yn(n){const{grouped:e}=Sr(n),t=[];for(const s of Ar)if(!(!e[s]||!e[s].length)){t.push(`${Ir[s]}:`);for(const r of e[s])t.push(`   ${r}`);t.push("")}return t.join(`
`).trim()||n||""}function Pe(...n){return n.filter(Boolean).join(" ")}function wl(n){const e=nn[n],t={};for(const s of e.contextFields)t[s.key]="";return t}function _e(n){return{...n,photos:[]}}function ri(){return{facility:{ceiling:_e({status:"OK",notes:""}),walls:_e({status:"OK",notes:""}),floors:_e({status:"OK",notes:""}),lighting:_e({status:"OK",notes:""})},operations:{employeePractices:_e({status:"OK",notes:""}),handwashing:_e({status:"OK",notes:""}),labelingDating:_e({status:"OK",notes:""}),logs:_e({status:"OK",notes:""})},temps:{handSinkTempF:"",threeCompSinkTempF:""},equipment:{doubleDoorCooler:_e({status:"OK",notes:""}),doubleDoorFreezer:_e({status:"OK",notes:""}),walkInCooler:_e({status:"OK",notes:""}),warmers:_e({status:"OK",notes:""}),ovens:_e({status:"OK",notes:""}),threeCompSink:_e({status:"OK",notes:""}),ecolab:_e({status:"OK",notes:""})}}}function Vg(n,e){return`${nn[n].label}  ${e}`}function ii(n,e){return e.reduce((t,s)=>t?t[s]:void 0,n)}function Hn(n,e,t){const[s,...r]=e;return s?{...n,[s]:r.length?Hn(n?.[s]??{},r,t):t}:t}function Il(n){return Math.round(n/(1024*1024)*10)/10}function jg(n,e=800,t=.6){return new Promise(s=>{const r=new Image;r.onload=()=>{let{width:o,height:a}=r;if(o>e||a>e){const f=Math.min(e/o,e/a);o=Math.round(o*f),a=Math.round(a*f)}const u=document.createElement("canvas");u.width=o,u.height=a,u.getContext("2d").drawImage(r,0,0,o,a),s(u.toDataURL("image/jpeg",t))},r.onerror=()=>s(null),r.src=URL.createObjectURL(n)})}function Fg(n){let e=0;const t=s=>{if(!(!s||typeof s!="object")){if(Array.isArray(s)){s.forEach(t);return}s.photos?.length&&(e+=s.photos.length);for(const r of Object.values(s))t(r)}};return t(n),e}function ht(n){return String(n||"").trim()}function vu(n){const t=String(n||"").match(/action\s*:\s*([\s\S]+)/i);return t?t[1].split(/next\s*chk|next\s*check|follow\s*up|owner\s*:/i)[0].trim().split(",").map(r=>ht(r)).filter(Boolean).map(r=>({issue:r})):[]}function $t(n){const e=[],t=o=>{if(!(!o||typeof o!="object")){o.status&&(o.status==="Needs Attention"||o.status==="Not Clean")&&e.push(!0);for(const a of Object.keys(o))t(o[a])}};t(n?.facility),t(n?.operations),t(n?.equipment);const s=Number(n?.temps?.handSinkTempF),r=Number(n?.temps?.threeCompSinkTempF);return!Number.isNaN(s)&&s&&s<95&&e.push(!0),!Number.isNaN(r)&&r&&r<110&&e.push(!0),e.length?"Needs Attention":"Pass"}function Og({inspectionDate:n,inspectorName:e,context:t,noteType:s,inspection:r}){const o=[];n||o.push({text:"Inspection Date is missing",fieldId:"field-inspectionDate"}),e||o.push({text:"Inspector Name is missing",fieldId:"field-inspectorName"});const a=nn[s].contextFields;for(const u of a)t[u.key]?.trim()||o.push({text:`${u.label} is missing`,fieldId:`field-ctx-${u.key}`});return r.temps.handSinkTempF||o.push({text:"Hand sink temperature not recorded",fieldId:"field-handSinkTempF"}),r.temps.threeCompSinkTempF||o.push({text:"3-comp sink temperature not recorded",fieldId:"field-threeCompSinkTempF"}),o}function Lg({noteType:n,context:e,inspection:t,inspectionType:s,inspectionDate:r,siteName:o,siteNumber:a}){const u=$t(t),d=o||e?.kitchen||"Kitchen",f=a?` (#${a})`:"",m=r||e?.date||"Date",y=s?`  ${s}`:"";return`Subject: ${d}${f} Kitchen Inspection${y}  ${m}  ${u}`}function mo(n){const e=[["facility","ceiling","Facility > Ceiling"],["facility","walls","Facility > Walls"],["facility","floors","Facility > Floors"],["facility","lighting","Facility > Lighting"],["operations","employeePractices","Operations > Employee practices"],["operations","handwashing","Operations > Handwashing / supplies"],["operations","labelingDating","Operations > Labeling / dating"],["operations","logs","Operations > Logs / documentation"],["equipment","doubleDoorCooler","Equipment > Double-door cooler"],["equipment","doubleDoorFreezer","Equipment > Double-door freezer"],["equipment","walkInCooler","Equipment > Walk-in cooler"],["equipment","warmers","Equipment > Warmers / hot holding"],["equipment","ovens","Equipment > Ovens"],["equipment","threeCompSink","Equipment > 3-compartment sink"],["equipment","ecolab","Equipment > Ecolab / chemicals"]];let t=0;const s=[],r={};for(const[o,a,u]of e){const d=n?.[o]?.[a],f=d?.photos||[];if(!f.length)continue;const m=`${o}.${a}`;r[m]=[];for(const y of f){t+=1,r[m].push(t);const T=ht(d?.notes)||ht(y?.name)||"";s.push({num:t,label:u,caption:T})}}return{index:s,mapByPath:r}}function _n({inspection:n,rawNotes:e}){const t=[],{mapByPath:s}=mo(n),r=(d,f,m)=>{m?.status&&(m.status==="Needs Attention"||m.status==="Not Clean")&&t.push({issue:`${f}: ${ht(m.notes)||"Issue noted"}`,owner:"",due:"",priority:m.status==="Not Clean"?"High":"Med",photos:s[d]||[]})};r("facility.ceiling","Ceiling",n?.facility?.ceiling),r("facility.walls","Walls",n?.facility?.walls),r("facility.floors","Floors",n?.facility?.floors),r("facility.lighting","Lighting",n?.facility?.lighting),r("operations.employeePractices","Employee practices",n?.operations?.employeePractices),r("operations.handwashing","Handwashing / supplies",n?.operations?.handwashing),r("operations.labelingDating","Labeling / dating",n?.operations?.labelingDating),r("operations.logs","Logs / documentation",n?.operations?.logs),r("equipment.doubleDoorCooler","Double-door cooler",n?.equipment?.doubleDoorCooler),r("equipment.doubleDoorFreezer","Double-door freezer",n?.equipment?.doubleDoorFreezer),r("equipment.walkInCooler","Walk-in cooler",n?.equipment?.walkInCooler),r("equipment.warmers","Warmers / hot holding",n?.equipment?.warmers),r("equipment.ovens","Ovens",n?.equipment?.ovens),r("equipment.threeCompSink","3-compartment sink",n?.equipment?.threeCompSink),r("equipment.ecolab","Ecolab / chemicals",n?.equipment?.ecolab);const o=Number(n?.temps?.handSinkTempF);!Number.isNaN(o)&&o&&o<95&&t.push({issue:`Hand sink temperature below minimum: ${o}F (min 95F)`,owner:"",due:"",priority:"High",photos:[]});const a=Number(n?.temps?.threeCompSinkTempF);!Number.isNaN(a)&&a&&a<110&&t.push({issue:`3-compartment sink wash temperature below minimum: ${a}F (min 110F)`,owner:"",due:"",priority:"High",photos:[]});for(const d of vu(e))t.push({issue:d.issue,owner:"",due:"",priority:"Med",photos:[]});const u=new Set;return t.filter(d=>{const f=d.issue.toLowerCase();return u.has(f)?!1:(u.add(f),!0)})}function Eu(n){const e=`| Issue | Owner | Due | Priority | Photo # |
|---|---|---|---|---|`,t=n.map(s=>{const r=(s.photos||[]).length?s.photos.join(", "):"";return`| ${ht(s.issue)} | ${ht(s.owner)} | ${ht(s.due)} | ${ht(s.priority)} | ${r} |`}).join(`
`);return`${e}
${t||"|  |  |  |  |  |"}`}function Al({noteType:n,context:e,inspection:t,rawNotes:s,inspectionType:r,inspectionDate:o,inspectorName:a,siteName:u,siteNumber:d,sitePhone:f,supervisorName:m,floor:y}){const T=rr[r]||rr["Regular Inspection"],S=Lg({noteType:n,context:e,inspection:t,inspectionType:r,inspectionDate:o,siteName:u,siteNumber:d}),P=$t(t),R=_n({inspection:t,rawNotes:s}),{index:F}=mo(t),B=u||e?.kitchen||"Kitchen",j=d?` (#${d})`:"",O=o||e?.date||"",V=[`- Inspection Type: ${r||""}`,`- Site: ${B}${j}`,y?`- Floor: ${y}`:null,`- Date: ${O}`,`- Inspector: ${a||""}`,`- Supervisor: ${m||""}`,f?`- Site Phone: ${f}`:null,`- Overall Status: ${P}`].filter(Boolean).join(`
`),x=[`- siteName: ${u||""}`,`- siteNumber: ${d||""}`,`- supervisorName: ${m||""}`,f?`- sitePhone: ${f}`:null,...Object.entries(e||{}).map(([L,ee])=>`- ${L}: ${ee||""}`)].filter(Boolean).join(`
`),H=F.length?F.map(L=>`Photo ${L.num}  ${L.label}${L.caption?`  ${L.caption}`:""}`).join(`
`):"No photos attached.",E=[],g=(L,ee)=>{ee&&ee.status&&ee.status!=="OK"&&ee.status!=="N/A"&&E.push(`- ${L}: ${ee.status}${ee.notes?`  ${ee.notes}`:""}`)};g("Facility > Ceiling",t?.facility?.ceiling),g("Facility > Walls",t?.facility?.walls),g("Facility > Floors",t?.facility?.floors),g("Facility > Lighting",t?.facility?.lighting),g("Operations > Employee practices",t?.operations?.employeePractices),g("Operations > Handwashing / supplies",t?.operations?.handwashing),g("Operations > Labeling / dating",t?.operations?.labelingDating),g("Operations > Logs / documentation",t?.operations?.logs),g("Equipment > Double-door cooler",t?.equipment?.doubleDoorCooler),g("Equipment > Double-door freezer",t?.equipment?.doubleDoorFreezer),g("Equipment > Walk-in cooler",t?.equipment?.walkInCooler),g("Equipment > Warmers / hot holding",t?.equipment?.warmers),g("Equipment > Ovens",t?.equipment?.ovens),g("Equipment > 3-compartment sink",t?.equipment?.threeCompSink),g("Equipment > Ecolab / chemicals",t?.equipment?.ecolab);const _=Number(t?.temps?.handSinkTempF),b=Number(t?.temps?.threeCompSinkTempF);!Number.isNaN(_)&&_&&_<95&&E.push(`- Temps > Hand sink: ${_}F (below 95F minimum)`),!Number.isNaN(b)&&b&&b<110&&E.push(`- Temps > 3-comp wash: ${b}F (below 110F minimum)`);const w=E.length?E.join(`
`):"- No exceptions noted from checklist/temps.",v=R.filter(L=>L.priority==="High").map(L=>`- ${L.issue}${L.photos?.length?` (Photo ${L.photos.join(", ")})`:""}`).join(`
`)||(r==="Event Day"?"- No critical blockers identified for service.":"- No critical issues flagged.");return[S,"","Hi team,","",T.opening,"",`## ${T.headline}  Snapshot`,V,"","## Context (from sit-down notes)",x||"- ","","## Critical Risks",v,"","## Findings by Area",w,"","## Corrective Actions (please assign Owner + Due)",Eu(R),"","## Photo Index",H,"","## Inspector Notes (organized)",Yn(s)||""].join(`
`)}function Mg({noteType:n,useCase:e,context:t,inspection:s,rawNotes:r,inspectionType:o,inspectionDate:a,inspectorName:u,siteName:d,siteNumber:f,sitePhone:m,supervisorName:y,floor:T}){const S=$t(s),P=_n({inspection:s,rawNotes:r});wr(r);const R=d||t?.kitchen||"Kitchen",F=a||t?.date||"";if(e==="Email Summary")return Al({noteType:n,context:t,inspection:s,rawNotes:r,inspectionType:o,inspectionDate:a,inspectorName:u,siteName:d,siteNumber:f,sitePhone:m,supervisorName:y,floor:T});if(e==="Slack Update"){const B=[`*${o||"Inspection"}  ${R}  ${F}*`,`Inspector: ${u||""} | Status: *${S}*`,"","*Summary:*",Yn(r),""];if(P.length){B.push(`*Action Items (${P.length}):*`);for(const j of P)B.push(`   [${j.priority}] ${j.issue}`)}else B.push("No corrective actions needed.");return B.join(`
`)}if(e==="Google Doc"){const B=[`# ${o||"Inspection"}  ${R}`,`Date: ${F} | Inspector: ${u||""} | Supervisor: ${y||""}`,`Overall Status: ${S}`,"","## Inspector Notes",Yn(r),"","## Findings"],j=(O,V)=>{V?.status&&V.status!=="OK"&&V.status!=="N/A"&&B.push(`- **${O}**: ${V.status}${V.notes?`  ${V.notes}`:""}`)};return j("Ceiling",s?.facility?.ceiling),j("Walls",s?.facility?.walls),j("Floors",s?.facility?.floors),j("Lighting",s?.facility?.lighting),j("Employee practices",s?.operations?.employeePractices),j("Handwashing",s?.operations?.handwashing),j("Labeling / dating",s?.operations?.labelingDating),j("Logs",s?.operations?.logs),j("Double-door cooler",s?.equipment?.doubleDoorCooler),j("Double-door freezer",s?.equipment?.doubleDoorFreezer),j("Walk-in cooler",s?.equipment?.walkInCooler),j("Warmers",s?.equipment?.warmers),j("Ovens",s?.equipment?.ovens),j("3-compartment sink",s?.equipment?.threeCompSink),j("Ecolab / chemicals",s?.equipment?.ecolab),B[B.length-1]==="## Findings"&&B.push("- All areas OK."),B.push("","## Action Items"),P.length?B.push(Eu(P)):B.push("No corrective actions needed."),B.join(`
`)}if(e==="Evaluation Scorecard"){const B=[{title:"Facility",items:[["Ceiling",s?.facility?.ceiling],["Walls",s?.facility?.walls],["Floors",s?.facility?.floors],["Lighting",s?.facility?.lighting]]},{title:"Operations",items:[["Employee practices",s?.operations?.employeePractices],["Handwashing",s?.operations?.handwashing],["Labeling / dating",s?.operations?.labelingDating],["Logs",s?.operations?.logs]]},{title:"Equipment",items:[["Double-door cooler",s?.equipment?.doubleDoorCooler],["Double-door freezer",s?.equipment?.doubleDoorFreezer],["Walk-in cooler",s?.equipment?.walkInCooler],["Warmers",s?.equipment?.warmers],["Ovens",s?.equipment?.ovens],["3-comp sink",s?.equipment?.threeCompSink],["Ecolab",s?.equipment?.ecolab]]}],j=["EVALUATION SCORECARD",`${"=".repeat(50)}`,`${o||"Inspection"}  ${R}  ${F}`,`Inspector: ${u||""}`,`Overall: ${S}`,""];for(const x of B){j.push(`--- ${x.title.toUpperCase()} ---`);for(const[H,E]of x.items){const g=E?.status||"N/A",_=g==="OK"?"[PASS]":g==="N/A"?"[ -- ]":"[FAIL]";j.push(`  ${_} ${H}${E?.notes?`  ${E.notes}`:""}`)}j.push("")}j.push("--- TEMPERATURES ---");const O=s?.temps?.handSinkTempF,V=s?.temps?.threeCompSinkTempF;j.push(`  Hand sink: ${O||""}F ${Number(O)>=95?"[PASS]":O?"[FAIL]":""}`),j.push(`  3-comp wash: ${V||""}F ${Number(V)>=110?"[PASS]":V?"[FAIL]":""}`),j.push("",`--- ACTION ITEMS (${P.length}) ---`);for(const x of P)j.push(`  [${x.priority}] ${x.issue}`);return P.length||j.push("  None."),j.push("","--- INSPECTOR NOTES ---",Yn(r)),j.join(`
`)}return Al({noteType:n,context:t,inspection:s,rawNotes:r,inspectionType:o,inspectionDate:a,inspectorName:u,siteName:d,siteNumber:f,sitePhone:m,supervisorName:y,floor:T})}function Sl({inspection:n,rawNotes:e,context:t,noteType:s}){const r=[],o=(e||"").toLowerCase(),a=(m,y)=>{y?.status==="Needs Attention"&&!y?.notes?.trim()&&r.push(`"${m}" is flagged Needs Attention but has no notes  add details so corrective actions are clear.`),y?.status==="Not Clean"&&!y?.notes?.trim()&&r.push(`"${m}" is flagged Not Clean but has no notes  describe the issue for the report.`)};a("Ceiling",n?.facility?.ceiling),a("Walls",n?.facility?.walls),a("Floors",n?.facility?.floors),a("Lighting",n?.facility?.lighting),a("Employee practices",n?.operations?.employeePractices),a("Handwashing",n?.operations?.handwashing),a("Labeling / dating",n?.operations?.labelingDating),a("Logs",n?.operations?.logs),a("Double-door cooler",n?.equipment?.doubleDoorCooler),a("Double-door freezer",n?.equipment?.doubleDoorFreezer),a("Walk-in cooler",n?.equipment?.walkInCooler),a("Warmers",n?.equipment?.warmers),a("Ovens",n?.equipment?.ovens),a("3-compartment sink",n?.equipment?.threeCompSink),a("Ecolab / chemicals",n?.equipment?.ecolab);const u=Number(n?.temps?.handSinkTempF),d=Number(n?.temps?.threeCompSinkTempF);u&&u<95&&r.push(`Hand sink temp is ${u}F (below 95F min). Flag for immediate maintenance.`),d&&d<110&&r.push(`3-comp sink wash temp is ${d}F (below 110F min). Check water heater.`),u&&u>=95&&u<100&&r.push(`Hand sink temp is ${u}F  passes but is close to the 95F minimum. Monitor.`),d&&d>=110&&d<115&&r.push(`3-comp wash temp is ${d}F  passes but is close to the 110F minimum. Monitor.`),o.includes("allergen")&&r.push("Allergen concerns detected in notes  ensure allergen training is scheduled and documented."),o.includes("haccp")&&r.push("HACCP mentioned  verify all HACCP logs are complete and signed before next inspection."),(o.includes("pest")||o.includes("trap"))&&r.push("Pest control mentioned  document trap locations and schedule pest vendor follow-up."),(o.includes("cutting board")||o.includes("scored"))&&r.push("Scored cutting boards noted  replace immediately per food safety protocol."),o.includes("calibrat")&&r.push("Thermometer calibration mentioned  document last calibration date and schedule next.");const f=vu(e);return f.length>3&&r.push(`${f.length} action items found in notes  consider prioritizing the top 3 for immediate follow-up.`),r.length||r.push("No issues detected. Inspection looks clean!"),r}function Bg({noteType:n,useCase:e,context:t,inspection:s,rawNotes:r,inspectionType:o,inspectionDate:a,inspectorName:u,siteName:d,siteNumber:f,sitePhone:m,supervisorName:y,floor:T}){const S=$t(s),P=_n({inspection:s,rawNotes:r});wr(r);const R=d||t?.kitchen||"Kitchen",F=a||t?.date||new Date().toLocaleDateString(),B=rr[o]||rr["Regular Inspection"],{index:j}=mo(s),O=Number(s?.temps?.handSinkTempF),V=Number(s?.temps?.threeCompSinkTempF),x=[{section:"Facility",label:"Ceiling",node:s?.facility?.ceiling},{section:"Facility",label:"Walls",node:s?.facility?.walls},{section:"Facility",label:"Floors",node:s?.facility?.floors},{section:"Facility",label:"Lighting",node:s?.facility?.lighting},{section:"Operations",label:"Employee Practices",node:s?.operations?.employeePractices},{section:"Operations",label:"Handwashing / Supplies",node:s?.operations?.handwashing},{section:"Operations",label:"Labeling / Dating",node:s?.operations?.labelingDating},{section:"Operations",label:"Logs / Documentation",node:s?.operations?.logs},{section:"Equipment",label:"Double-Door Cooler",node:s?.equipment?.doubleDoorCooler},{section:"Equipment",label:"Double-Door Freezer",node:s?.equipment?.doubleDoorFreezer},{section:"Equipment",label:"Walk-In Cooler",node:s?.equipment?.walkInCooler},{section:"Equipment",label:"Warmers / Hot Holding",node:s?.equipment?.warmers},{section:"Equipment",label:"Ovens",node:s?.equipment?.ovens},{section:"Equipment",label:"3-Compartment Sink",node:s?.equipment?.threeCompSink},{section:"Equipment",label:"Ecolab / Chemicals",node:s?.equipment?.ecolab}],H=x.filter(g=>g.node?.status&&g.node.status!=="OK"&&g.node.status!=="N/A");O&&O<95&&H.push({section:"Temperature",label:"Hand Sink",node:{status:"Not Clean",notes:`${O}F (below 95F minimum)`}}),V&&V<110&&H.push({section:"Temperature",label:"3-Comp Wash",node:{status:"Not Clean",notes:`${V}F (below 110F minimum)`}});const E=["Facility","Operations","Equipment"];return c.jsxs("div",{className:"rpt",children:[c.jsxs("div",{className:"rptHeader",children:[c.jsx("img",{src:pu,alt:"Sodexo",className:"rptLogo"}),c.jsxs("div",{className:"rptHeaderRight",children:[c.jsx("div",{className:"rptDocType",children:o||"Kitchen Inspection"}),c.jsxs("div",{className:"rptDocId",children:["Report #",Date.now().toString(36).toUpperCase()]})]})]}),c.jsxs("div",{className:"rptTitleBar",children:[c.jsxs("div",{children:[c.jsx("div",{className:"rptTitle",children:R}),c.jsx("div",{className:"rptDate",children:F})]}),c.jsx("div",{className:Pe("rptStatus",S==="Pass"?"rptStatusPass":"rptStatusFail"),children:S==="Pass"?"PASSED":"NEEDS ATTENTION"})]}),c.jsxs("div",{className:"rptInfoGrid",children:[c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Inspector"}),c.jsx("div",{className:"rptInfoValue",children:u||""})]}),c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Supervisor"}),c.jsx("div",{className:"rptInfoValue",children:y||""})]}),c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Unit / Location"}),c.jsx("div",{className:"rptInfoValue",children:f||""})]}),T&&c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Floor"}),c.jsx("div",{className:"rptInfoValue",children:T})]}),m&&c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Phone"}),c.jsx("div",{className:"rptInfoValue",children:m})]}),c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Hand Sink Temp"}),c.jsxs("div",{className:"rptInfoValue",children:[s?.temps?.handSinkTempF?`${s.temps.handSinkTempF}F`:"",O>=95&&c.jsx("span",{className:"rptCheck",children:" "}),O>0&&O<95&&c.jsx("span",{className:"rptWarn",children:"  Below 95F"})]})]}),c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"3-Comp Wash Temp"}),c.jsxs("div",{className:"rptInfoValue",children:[s?.temps?.threeCompSinkTempF?`${s.temps.threeCompSinkTempF}F`:"",V>=110&&c.jsx("span",{className:"rptCheck",children:" "}),V>0&&V<110&&c.jsx("span",{className:"rptWarn",children:"  Below 110F"})]})]})]}),(e==="Email Summary"||e==="Google Doc")&&B.opening&&c.jsx("div",{className:"rptBlock",children:c.jsx("p",{className:"rptParagraph",children:B.opening})}),c.jsxs("div",{className:"rptBlock",children:[c.jsx("div",{className:"rptBlockTitle",children:"Inspection Scorecard"}),c.jsxs("table",{className:"rptTable",children:[c.jsx("thead",{children:c.jsxs("tr",{children:[c.jsx("th",{children:"Section"}),c.jsx("th",{children:"Item"}),c.jsx("th",{children:"Status"}),c.jsx("th",{children:"Notes"})]})}),c.jsxs("tbody",{children:[E.map(g=>{const _=x.filter(b=>b.section===g);return _.map((b,w)=>c.jsxs("tr",{className:b.node?.status==="Not Clean"?"rptRowFail":b.node?.status==="Needs Attention"?"rptRowWarn":"",children:[w===0&&c.jsx("td",{rowSpan:_.length,className:"rptSectionCell",children:g}),c.jsx("td",{children:b.label}),c.jsx("td",{children:c.jsx("span",{className:Pe("rptStatusPill",b.node?.status==="OK"?"rptPillPass":b.node?.status==="Not Clean"?"rptPillFail":b.node?.status==="Needs Attention"?"rptPillWarn":"rptPillNa"),children:b.node?.status||"N/A"})}),c.jsx("td",{className:"rptNoteCell",children:b.node?.notes||""})]},b.label))}),c.jsxs("tr",{className:O>0&&O<95?"rptRowFail":"",children:[c.jsx("td",{rowSpan:2,className:"rptSectionCell",children:"Temps"}),c.jsx("td",{children:"Hand Sink"}),c.jsx("td",{children:c.jsx("span",{className:Pe("rptStatusPill",O>=95?"rptPillPass":O?"rptPillFail":"rptPillNa"),children:s?.temps?.handSinkTempF?`${s.temps.handSinkTempF}F`:"N/A"})}),c.jsx("td",{className:"rptNoteCell",children:O>=95?"Meets minimum":O?"Below 95F minimum":""})]}),c.jsxs("tr",{className:V>0&&V<110?"rptRowFail":"",children:[c.jsx("td",{children:"3-Comp Wash"}),c.jsx("td",{children:c.jsx("span",{className:Pe("rptStatusPill",V>=110?"rptPillPass":V?"rptPillFail":"rptPillNa"),children:s?.temps?.threeCompSinkTempF?`${s.temps.threeCompSinkTempF}F`:"N/A"})}),c.jsx("td",{className:"rptNoteCell",children:V>=110?"Meets minimum":V?"Below 110F minimum":""})]})]})]})]}),H.length>0&&c.jsxs("div",{className:"rptBlock rptBlockAlert",children:[c.jsxs("div",{className:"rptBlockTitle rptBlockTitleAlert",children:["Issues Found (",H.length,")"]}),H.map((g,_)=>c.jsxs("div",{className:"rptIssueRow",children:[c.jsx("span",{className:"rptIssueNum",children:_+1}),c.jsxs("div",{className:"rptIssueContent",children:[c.jsxs("div",{className:"rptIssueName",children:[g.label," ",c.jsxs("span",{className:"rptIssueSection",children:["(",g.section,")"]})]}),g.node?.notes&&c.jsx("div",{className:"rptIssueDetail",children:g.node.notes})]}),c.jsx("span",{className:Pe("rptStatusPill",g.node?.status==="Not Clean"?"rptPillFail":"rptPillWarn"),children:g.node?.status})]},_))]}),P.length>0&&c.jsxs("div",{className:"rptBlock",children:[c.jsx("div",{className:"rptBlockTitle",children:"Corrective Actions Required"}),P.map((g,_)=>c.jsxs("div",{className:"rptActionRow",children:[c.jsx("span",{className:Pe("rptPriorityDot",g.priority==="High"?"rptDotHigh":"rptDotMed")}),c.jsxs("div",{className:"rptActionContent",children:[c.jsx("span",{className:"rptActionText",children:g.issue}),c.jsxs("span",{className:Pe("rptPriorityLabel",g.priority==="High"?"rptLabelHigh":"rptLabelMed"),children:[g.priority," Priority"]})]})]},_))]}),j.length>0&&c.jsxs("div",{className:"rptBlock",children:[c.jsx("div",{className:"rptBlockTitle",children:"Photo Index"}),c.jsx("div",{className:"rptPhotoList",children:j.map(g=>c.jsxs("div",{className:"rptPhotoItem",children:[c.jsxs("span",{className:"rptPhotoNum",children:["Photo #",g.num]}),c.jsxs("span",{children:[g.label,g.caption?`  ${g.caption}`:""]})]},g.num))})]}),r&&(()=>{const{grouped:g}=Sr(r);return Object.values(g).some(b=>b.length>0)?c.jsxs("div",{className:"rptBlock",children:[c.jsx("div",{className:"rptBlockTitle",children:"Inspector Notes"}),c.jsx("div",{className:"rptNotesOrganized",children:Ar.map(b=>!g[b]||!g[b].length?null:c.jsxs("div",{className:"rptNoteCategory",children:[c.jsx("div",{className:Pe("rptNoteCatLabel",`rptNoteCat--${b}`),children:Ir[b]}),c.jsx("ul",{className:"rptNoteBullets",children:g[b].map((w,I)=>c.jsx("li",{children:w},I))})]},b))})]}):null})(),c.jsxs("div",{className:"rptFooter",children:[c.jsxs("div",{children:["Generated ",new Date().toLocaleDateString()," ",new Date().toLocaleTimeString(),"  Sodexo Kitchen Inspection System"]}),c.jsx("div",{children:"This report is confidential and intended for internal use only."})]})]})}function $g({inspection:n,rawNotes:e,inspectionType:t,inspectionDate:s,inspectorName:r,siteName:o,siteNumber:a,supervisorName:u}){const d=[["Section","Item","Status","Notes","Priority"]],f=(m,y,T)=>{if(!T)return;const S=T.status==="Not Clean"?"High":T.status==="Needs Attention"?"Med":"";d.push([m,y,T.status||"",(T.notes||"").replace(/"/g,'""'),S])};return f("Facility","Ceiling",n?.facility?.ceiling),f("Facility","Walls",n?.facility?.walls),f("Facility","Floors",n?.facility?.floors),f("Facility","Lighting",n?.facility?.lighting),f("Operations","Employee practices",n?.operations?.employeePractices),f("Operations","Handwashing / supplies",n?.operations?.handwashing),f("Operations","Labeling / dating",n?.operations?.labelingDating),f("Operations","Logs / documentation",n?.operations?.logs),f("Equipment","Double-door cooler",n?.equipment?.doubleDoorCooler),f("Equipment","Double-door freezer",n?.equipment?.doubleDoorFreezer),f("Equipment","Walk-in cooler",n?.equipment?.walkInCooler),f("Equipment","Warmers / hot holding",n?.equipment?.warmers),f("Equipment","Ovens",n?.equipment?.ovens),f("Equipment","3-compartment sink",n?.equipment?.threeCompSink),f("Equipment","Ecolab / chemicals",n?.equipment?.ecolab),d.push(["Temps","Hand sink (F)",n?.temps?.handSinkTempF||"",Number(n?.temps?.handSinkTempF)>=95?"Pass":"Below min",""]),d.push(["Temps","3-comp wash (F)",n?.temps?.threeCompSinkTempF||"",Number(n?.temps?.threeCompSinkTempF)>=110?"Pass":"Below min",""]),d}function Ug({inspection:n,rawNotes:e,inspectionType:t,inspectionDate:s,inspectorName:r,siteName:o,siteNumber:a,supervisorName:u,floor:d}){const f=$g({inspection:n,rawNotes:e,inspectionType:t,inspectionDate:s,inspectorName:r,siteName:o,siteNumber:a,supervisorName:u}),m=$t(n),y=_n({inspection:n,rawNotes:e}),T=`<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
<head><meta charset="utf-8">
<!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>
<x:Name>Inspection</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions>
</x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]-->
<style>
  td, th { mso-number-format:"\\@"; padding: 6px 10px; border: 1px solid #ccc; font-family: Calibri, Arial; font-size: 11pt; }
  th { background: #2A295C; color: white; font-weight: bold; }
  .section-header { background: #F0F1F5; font-weight: bold; color: #2A295C; font-size: 12pt; }
  .pass { background: #ECFDF5; color: #15803D; font-weight: bold; }
  .fail { background: #FEF2F2; color: #DC2626; font-weight: bold; }
  .warn { background: #FFFBEB; color: #D97706; }
  .meta-label { font-weight: bold; color: #2A295C; background: #F7F8FA; }
  .title { font-size: 16pt; font-weight: bold; color: #2A295C; }
</style></head><body>
<table>
  <tr><td class="title" colspan="5">SODEXO KITCHEN INSPECTION REPORT</td></tr>
  <tr><td colspan="5" style="border-bottom: 3px solid #EE0000; padding: 0;"></td></tr>
  <tr><td class="meta-label">Inspection Type</td><td colspan="4">${t||""}</td></tr>
  <tr><td class="meta-label">Date</td><td colspan="4">${s||""}</td></tr>
  <tr><td class="meta-label">Inspector</td><td colspan="4">${r||""}</td></tr>
  <tr><td class="meta-label">Site / Location</td><td colspan="4">${o||""}</td></tr>
  <tr><td class="meta-label">Unit #</td><td colspan="4">${a||""}</td></tr>
  <tr><td class="meta-label">Floor</td><td colspan="4">${d||""}</td></tr>
  <tr><td class="meta-label">Supervisor</td><td colspan="4">${u||""}</td></tr>
  <tr><td class="meta-label">Overall Status</td><td colspan="4" class="${m==="Pass"?"pass":"fail"}">${m}</td></tr>
  <tr><td colspan="5"></td></tr>
  <tr><td class="section-header" colspan="5">INSPECTION SCORECARD</td></tr>
  <tr><th>Section</th><th>Item</th><th>Status</th><th>Notes</th><th>Priority</th></tr>
  ${f.slice(1).map(R=>{const F=R[2]==="OK"?"pass":R[2]==="Not Clean"?"fail":R[2]==="Needs Attention"?"warn":"";return`<tr><td>${R[0]}</td><td>${R[1]}</td><td class="${F}">${R[2]}</td><td>${R[3]}</td><td>${R[4]}</td></tr>`}).join(`
  `)}
  <tr><td colspan="5"></td></tr>
  ${y.length>0?`
  <tr><td class="section-header" colspan="5">CORRECTIVE ACTIONS</td></tr>
  <tr><th>#</th><th colspan="3">Issue</th><th>Priority</th></tr>
  ${y.map((R,F)=>`<tr><td>${F+1}</td><td colspan="3">${R.issue}</td><td class="${R.priority==="High"?"fail":"warn"}">${R.priority}</td></tr>`).join(`
  `)}
  <tr><td colspan="5"></td></tr>`:""}
  <tr><td class="section-header" colspan="5">INSPECTOR NOTES</td></tr>
  <tr><td colspan="5" style="white-space:pre-wrap;font-size:10pt;">${Yn(e).replace(/</g,"&lt;")}</td></tr>
</table></body></html>`,S=new Blob([T],{type:"application/vnd.ms-excel"}),P=`inspection_${s||"undated"}_${(o||"site").replace(/\s+/g,"_")}.xls`;fo(S,P)}function bu({output:n,inspection:e,rawNotes:t,inspectionType:s,inspectionDate:r,siteName:o,siteNumber:a,sitePhone:u,inspectorName:d,supervisorName:f}){const m=$t(e),y=_n({inspection:e,rawNotes:t});wr(t);const T=[["Facility","Ceiling",e?.facility?.ceiling],["Facility","Walls",e?.facility?.walls],["Facility","Floors",e?.facility?.floors],["Facility","Lighting",e?.facility?.lighting],["Operations","Employee Practices",e?.operations?.employeePractices],["Operations","Handwashing / Supplies",e?.operations?.handwashing],["Operations","Labeling / Dating",e?.operations?.labelingDating],["Operations","Logs / Documentation",e?.operations?.logs],["Equipment","Double-Door Cooler",e?.equipment?.doubleDoorCooler],["Equipment","Double-Door Freezer",e?.equipment?.doubleDoorFreezer],["Equipment","Walk-In Cooler",e?.equipment?.walkInCooler],["Equipment","Warmers / Hot Holding",e?.equipment?.warmers],["Equipment","Ovens",e?.equipment?.ovens],["Equipment","3-Compartment Sink",e?.equipment?.threeCompSink],["Equipment","Ecolab / Chemicals",e?.equipment?.ecolab]],S=T.filter(([,,O])=>O?.status&&O.status!=="OK"&&O.status!=="N/A"),P=Number(e?.temps?.handSinkTempF),R=Number(e?.temps?.threeCompSinkTempF),F=`<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">
<head><meta charset="utf-8">
<!--[if gte mso 9]><xml><w:WordDocument><w:View>Print</w:View><w:Zoom>100</w:Zoom></w:WordDocument></xml><![endif]-->
<style>
  @page { size: letter; margin: 1in; }
  body { font-family: Calibri, Arial, sans-serif; font-size: 11pt; color: #1F2937; line-height: 1.5; }
  h1 { color: #2A295C; font-size: 22pt; margin-bottom: 4px; }
  h2 { color: #2A295C; font-size: 14pt; border-bottom: 2px solid #2A295C; padding-bottom: 4px; margin-top: 24px; }
  .red-line { border-bottom: 3px solid #EE0000; margin-bottom: 20px; }
  .info-table { width: 100%; border-collapse: collapse; margin: 16px 0; }
  .info-table td { padding: 8px 12px; border: 1px solid #E5E7EB; font-size: 10pt; }
  .info-label { background: #F7F8FA; font-weight: bold; color: #2A295C; width: 30%; }
  .status-pass { background: #ECFDF5; color: #15803D; font-weight: bold; font-size: 12pt; text-align: center; padding: 10px; }
  .status-fail { background: #FEF2F2; color: #DC2626; font-weight: bold; font-size: 12pt; text-align: center; padding: 10px; }
  table.scorecard { width: 100%; border-collapse: collapse; margin: 12px 0; }
  table.scorecard th { background: #2A295C; color: white; padding: 8px 12px; text-align: left; font-size: 10pt; }
  table.scorecard td { padding: 7px 12px; border: 1px solid #E5E7EB; font-size: 10pt; }
  .sc-section { background: #F0F1F5; font-weight: bold; color: #2A295C; }
  .pill-pass { background: #ECFDF5; color: #15803D; font-weight: bold; padding: 2px 8px; }
  .pill-fail { background: #FEF2F2; color: #DC2626; font-weight: bold; padding: 2px 8px; }
  .pill-warn { background: #FFFBEB; color: #D97706; font-weight: bold; padding: 2px 8px; }
  .pill-na { background: #F3F4F6; color: #9CA3AF; padding: 2px 8px; }
  .issue-num { background: #DC2626; color: white; font-weight: bold; padding: 2px 8px; text-align: center; width: 30px; }
  .notes-box { background: #F7F8FA; padding: 16px; border-left: 3px solid #2A295C; white-space: pre-wrap; font-size: 10pt; line-height: 1.7; }
  .footer { margin-top: 32px; padding-top: 12px; border-top: 1px solid #E5E7EB; font-size: 8pt; color: #9CA3AF; text-align: center; }
</style></head><body>

<h1>Sodexo Kitchen Inspection Report</h1>
<div class="red-line"></div>

<table class="info-table">
  <tr><td class="info-label">Inspection Type</td><td>${s||""}</td><td class="info-label">Date</td><td>${r||""}</td></tr>
  <tr><td class="info-label">Inspector</td><td>${d||""}</td><td class="info-label">Supervisor</td><td>${f||""}</td></tr>
  <tr><td class="info-label">Site / Location</td><td>${o||""}</td><td class="info-label">Unit #</td><td>${a||""}</td></tr>
  ${u?`<tr><td class="info-label">Phone</td><td>${u}</td><td></td><td></td></tr>`:""}
  <tr><td class="info-label">Hand Sink Temp</td><td>${e?.temps?.handSinkTempF?e.temps.handSinkTempF+"F":""} ${P>=95?"":P?" Below 95F":""}</td>
      <td class="info-label">3-Comp Wash Temp</td><td>${e?.temps?.threeCompSinkTempF?e.temps.threeCompSinkTempF+"F":""} ${R>=110?"":R?" Below 110F":""}</td></tr>
  <tr><td class="info-label">Overall Status</td><td colspan="3" class="${m==="Pass"?"status-pass":"status-fail"}">${m==="Pass"?"PASSED":"NEEDS ATTENTION"}</td></tr>
</table>

<h2>Inspection Scorecard</h2>
<table class="scorecard">
  <tr><th>Section</th><th>Item</th><th>Status</th><th>Notes</th></tr>
  ${T.map(([O,V,x])=>{const H=x?.status||"N/A";return`<tr><td>${O}</td><td>${V}</td><td><span class="${H==="OK"?"pill-pass":H==="Not Clean"?"pill-fail":H==="Needs Attention"?"pill-warn":"pill-na"}">${H}</span></td><td>${x?.notes||""}</td></tr>`}).join(`
  `)}
  <tr><td>Temps</td><td>Hand Sink</td><td><span class="${P>=95?"pill-pass":P?"pill-fail":"pill-na"}">${e?.temps?.handSinkTempF?e.temps.handSinkTempF+"F":"N/A"}</span></td><td>${P>=95?"Meets minimum":P?"Below 95F minimum":""}</td></tr>
  <tr><td>Temps</td><td>3-Comp Wash</td><td><span class="${R>=110?"pill-pass":R?"pill-fail":"pill-na"}">${e?.temps?.threeCompSinkTempF?e.temps.threeCompSinkTempF+"F":"N/A"}</span></td><td>${R>=110?"Meets minimum":R?"Below 110F minimum":""}</td></tr>
</table>

${S.length>0?`
<h2>Issues Found (${S.length})</h2>
<table class="scorecard">
  <tr><th>#</th><th>Area</th><th>Item</th><th>Status</th><th>Notes</th></tr>
  ${S.map(([O,V,x],H)=>`<tr><td class="issue-num">${H+1}</td><td>${O}</td><td>${V}</td><td><span class="pill-fail">${x.status}</span></td><td>${x.notes||""}</td></tr>`).join(`
  `)}
</table>`:'<h2>Issues</h2><p style="background:#ECFDF5;padding:12px;color:#15803D;font-weight:bold;text-align:center;">All areas passed inspection</p>'}

${y.length>0?`
<h2>Corrective Actions Required</h2>
<table class="scorecard">
  <tr><th>#</th><th>Issue</th><th>Priority</th></tr>
  ${y.map((O,V)=>`<tr><td style="text-align:center">${V+1}</td><td>${O.issue}</td><td><span class="${O.priority==="High"?"pill-fail":"pill-warn"}">${O.priority}</span></td></tr>`).join(`
  `)}
</table>`:""}

<h2>Inspector Notes</h2>
${(()=>{const{grouped:O}=Sr(t),V=Ar.filter(x=>O[x]?.length);return V.length?V.map(x=>`<div style="margin-bottom:12px;"><p style="font-weight:bold;color:#2A295C;font-size:10pt;margin:0 0 4px 0;">${Ir[x]}</p><ul style="margin:0;padding-left:20px;">${O[x].map(H=>`<li style="margin-bottom:4px;font-size:10pt;line-height:1.5;">${H.replace(/</g,"&lt;")}</li>`).join("")}</ul></div>`).join(""):'<div class="notes-box"></div>'})()}

<div class="footer">
  <p>Generated ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}  Sodexo Kitchen Inspection System</p>
  <p>This report is confidential and intended for internal use only.</p>
</div>
</body></html>`,B=new Blob([F],{type:"application/msword"}),j=`inspection_${r||"undated"}_${(o||"site").replace(/\s+/g,"_")}.doc`;fo(B,j)}function Tu({output:n,inspectionDate:e,siteName:t}){const s=new Blob([n||""],{type:"text/plain;charset=utf-8;"}),r=`inspection_${e||"undated"}_${(t||"site").replace(/\s+/g,"_")}.txt`;fo(s,r)}function qg({history:n}){const e=U.useMemo(()=>{const f={};for(const m of n){const y=`${m.siteName||m.location||"Unknown"}${m.floor?` - ${m.floor}`:""}`;f[y]||(f[y]=[]);const T=Number(m.temps?.handSinkTempF),S=Number(m.temps?.threeCompSinkTempF);(T||S)&&f[y].push({date:m.inspectionDate||m.savedAt?.slice(0,10)||"",handSink:T||null,threeComp:S||null,floor:m.floor||""})}for(const m of Object.keys(f))f[m].sort((y,T)=>y.date.localeCompare(T.date));return f},[n]),t=Object.keys(e);if(t.length===0)return null;const s=440,r=180,o=40,a=20,u=25,d=45;return c.jsxs("div",{className:"card",style:{marginBottom:24},children:[c.jsx("div",{className:"cardHeader",children:c.jsx("div",{className:"cardTitle",children:"Temperature Trends by Location"})}),c.jsx("div",{className:"cardBody",children:c.jsx("div",{className:"tempChartsGrid",children:t.map(f=>{const m=e[f],y=m.flatMap(V=>[V.handSink,V.threeComp]).filter(Boolean);if(y.length===0)return null;const T=Math.min(...y)-5,S=Math.max(...y)+5,P=S-T||1,R=m.length>1?(s-o-a)/(m.length-1):0,F=V=>o+V*R,B=V=>u+(r-u-d)*(1-(V-T)/P),j=m.map((V,x)=>V.handSink?`${F(x)},${B(V.handSink)}`:null).filter(Boolean),O=m.map((V,x)=>V.threeComp?`${F(x)},${B(V.threeComp)}`:null).filter(Boolean);return c.jsxs("div",{className:"tempChartItem",children:[c.jsx("div",{className:"tempChartLabel",children:f}),c.jsxs("svg",{viewBox:`0 0 ${s} ${r}`,className:"tempChartSvg",children:[[95,110].map(V=>{if(V<T||V>S)return null;const x=B(V);return c.jsxs("g",{children:[c.jsx("line",{x1:o,y1:x,x2:s-a,y2:x,stroke:V===95?"#3b82f6":"#8b5cf6",strokeDasharray:"4,3",strokeWidth:"1",opacity:"0.5"}),c.jsxs("text",{x:o-4,y:x+3,textAnchor:"end",fontSize:"9",fill:V===95?"#3b82f6":"#8b5cf6",children:[V,"F"]})]},V)}),c.jsxs("text",{x:o-4,y:B(S)+3,textAnchor:"end",fontSize:"9",fill:"#888",children:[Math.round(S),""]}),c.jsxs("text",{x:o-4,y:B(T)+3,textAnchor:"end",fontSize:"9",fill:"#888",children:[Math.round(T),""]}),m.map((V,x)=>c.jsx("text",{x:F(x),y:r-8,textAnchor:"middle",fontSize:"8",fill:"#888",transform:`rotate(-25, ${F(x)}, ${r-8})`,children:V.date.slice(5)},x)),j.length>1&&c.jsx("polyline",{points:j.join(" "),fill:"none",stroke:"#3b82f6",strokeWidth:"2"}),m.map((V,x)=>V.handSink?c.jsx("circle",{cx:F(x),cy:B(V.handSink),r:"3.5",fill:V.handSink>=95?"#3b82f6":"#ef4444"},`h${x}`):null),O.length>1&&c.jsx("polyline",{points:O.join(" "),fill:"none",stroke:"#8b5cf6",strokeWidth:"2"}),m.map((V,x)=>V.threeComp?c.jsx("circle",{cx:F(x),cy:B(V.threeComp),r:"3.5",fill:V.threeComp>=110?"#8b5cf6":"#ef4444"},`t${x}`):null)]}),c.jsxs("div",{className:"tempChartLegend",children:[c.jsx("span",{className:"tempLegendDot",style:{background:"#3b82f6"}})," Hand Sink (min 95F)",c.jsx("span",{className:"tempLegendDot",style:{background:"#8b5cf6",marginLeft:12}})," 3-Comp (min 110F)",c.jsx("span",{className:"tempLegendDot",style:{background:"#ef4444",marginLeft:12}})," Below min"]})]},f)})})})]})}function zg({history:n}){const e=U.useMemo(()=>{if(n.length<2)return null;const t={},s={},r={};for(const m of n){const y=`${m.siteName||m.location||"Unknown"}${m.floor?` (${m.floor})`:""}`;r[y]=(r[y]||0)+1;const T=new Set;for(const S of m.actionItems||[]){const P=S.issue?.split(":")[0]?.trim()||"Other";T.has(P)||(T.add(P),t[P]=(t[P]||0)+1,s[y]||(s[y]={}),s[y][P]=(s[y][P]||0)+1)}}const o=Object.entries(t).filter(([,m])=>m>=2).sort((m,y)=>y[1]-m[1]),a={};for(const[m,y]of Object.entries(s)){const T=r[m]||1,S=Object.entries(y).filter(([,P])=>P>=2).map(([P,R])=>({category:P,count:R,rate:Math.round(R/T*100)})).sort((P,R)=>R.rate-P.rate);S.length>0&&(a[m]=S)}let u=0,d=0;for(const m of n){const y=Number(m.temps?.handSinkTempF),T=Number(m.temps?.threeCompSinkTempF);y&&(u++,y<95&&d++),T&&(u++,T<110&&d++)}const f=u>0?Math.round((u-d)/u*100):null;return{recurring:o,locationRecurring:a,tempComplianceRate:f,tempChecks:u,tempFails:d,totalInspections:n.length}},[n]);return!e||e.recurring.length===0&&Object.keys(e.locationRecurring).length===0?null:c.jsxs("div",{className:"card",style:{marginBottom:24},children:[c.jsx("div",{className:"cardHeader",children:c.jsx("div",{className:"cardTitle",children:"Recurring Issues Tracker"})}),c.jsxs("div",{className:"cardBody",children:[c.jsxs("div",{className:"analysisStatsRow",children:[c.jsxs("div",{className:"analysisStat",children:[c.jsx("div",{className:"analysisStatNum",children:e.totalInspections}),c.jsx("div",{className:"analysisStatLabel",children:"Total Inspections"})]}),e.tempComplianceRate!==null&&c.jsxs("div",{className:"analysisStat",children:[c.jsxs("div",{className:"analysisStatNum",style:{color:e.tempComplianceRate>=90?"#15803D":"#EE0000"},children:[e.tempComplianceRate,"%"]}),c.jsx("div",{className:"analysisStatLabel",children:"Temp Compliance"})]}),c.jsxs("div",{className:"analysisStat",children:[c.jsx("div",{className:"analysisStatNum",style:{color:e.recurring.length>0?"#EE0000":"#15803D"},children:e.recurring.length}),c.jsx("div",{className:"analysisStatLabel",children:"Repeat Issues"})]})]}),e.recurring.length>0&&c.jsxs("div",{style:{marginTop:16},children:[c.jsx("div",{className:"guideSectionTitle",children:"Issues That Keep Coming Back"}),c.jsx("div",{className:"recurringList",children:e.recurring.map(([t,s])=>c.jsxs("div",{className:"recurringItem",children:[c.jsx("span",{className:"recurringBar",style:{width:`${Math.min(100,s/e.totalInspections*100)}%`}}),c.jsx("span",{className:"recurringLabel",children:t}),c.jsxs("span",{className:"recurringCount",children:[s," of ",e.totalInspections," inspections (",Math.round(s/e.totalInspections*100),"%)"]})]},t))})]}),Object.keys(e.locationRecurring).length>0&&c.jsxs("div",{style:{marginTop:20},children:[c.jsx("div",{className:"guideSectionTitle",children:"Flagged Locations"}),Object.entries(e.locationRecurring).map(([t,s])=>c.jsxs("div",{className:"flaggedLocation",children:[c.jsx("div",{className:"flaggedLocationName",children:t}),c.jsx("div",{className:"flaggedIssuesList",children:s.map((r,o)=>c.jsxs("div",{className:"flaggedIssue",children:[c.jsx("span",{className:"flaggedIssueCat",children:r.category}),c.jsxs("span",{className:"flaggedIssueRate",style:{color:r.rate>=50?"#EE0000":"#b45309"},children:[r.count,"x (",r.rate,"% of inspections)"]})]},o))})]},t))]})]})]})}function Hg({onBack:n}){const[e,t]=U.useState([]),[s,r]=U.useState(""),[o,a]=U.useState(""),[u,d]=U.useState(""),[f,m]=U.useState(""),[y,T]=U.useState(null),[S,P]=U.useState(!1);U.useEffect(()=>{uo().then(x=>{t(x),P(!0)})},[]),U.useMemo(()=>{const x=new Set;for(const H of e)for(const E of H.actionItems||[])x.add(E.issue?.split(":")[0]?.trim()||"Other");return Array.from(x).sort()},[e]);const R=U.useMemo(()=>e.filter(x=>!(s&&x.inspectionDate!==s||o&&x.inspectionType!==o||u&&x.floor!==u||f&&!(x.actionItems||[]).some(E=>E.issue?.toLowerCase().includes(f.toLowerCase())))),[e,s,o,u,f]);function F(x){const H=e.filter(E=>E.id!==x);t(H),yg(x).catch(()=>{})}function B(){confirm("Delete all inspection history? This cannot be undone.")&&(t([]),_g().catch(()=>{}))}const j=[...new Set(e.map(x=>x.inspectionDate).filter(Boolean))].sort().reverse(),O=[...new Set(e.map(x=>x.inspectionType).filter(Boolean))].sort(),V=[...new Set(e.map(x=>x.floor).filter(Boolean))].sort();return c.jsxs("div",{className:"appShell",children:[c.jsxs("header",{className:"topBar",children:[c.jsxs("div",{className:"brandLeft brandClickable",onClick:n,title:"Back to Inspector",children:[c.jsx("img",{src:un,alt:"Sodexo",className:"brandLogo"}),c.jsxs("div",{children:[c.jsx("div",{className:"brandTitle",children:"Inspection History"}),c.jsxs("div",{className:"brandSub",children:[e.length," saved inspection",e.length!==1?"s":""]})]})]}),c.jsxs("div",{className:"topActions",children:[c.jsx("button",{className:"btn btnGhost",onClick:n,type:"button",children:"Back to Inspector"}),e.length>0&&c.jsx("button",{className:"btn btnGhost",onClick:B,type:"button",style:{color:"#EE0000",borderColor:"#EE0000"},children:"Clear All"})]})]}),c.jsxs("main",{className:"pageMain pageMainWide",children:[c.jsxs("div",{className:"card",style:{marginBottom:24},children:[c.jsxs("div",{className:"cardHeader",children:[c.jsx("div",{className:"cardTitle",children:"Filters"}),(s||o||u||f)&&c.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{r(""),a(""),d(""),m("")},children:"Clear filters"})]}),c.jsx("div",{className:"cardBody",children:c.jsxs("div",{className:"fieldGrid filterGrid",children:[c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Date"}),c.jsxs("select",{className:"select",value:s,onChange:x=>r(x.target.value),children:[c.jsx("option",{value:"",children:"All dates"}),j.map(x=>c.jsx("option",{value:x,children:x},x))]})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Inspection Type"}),c.jsxs("select",{className:"select",value:o,onChange:x=>a(x.target.value),children:[c.jsx("option",{value:"",children:"All types"}),O.map(x=>c.jsx("option",{value:x,children:x},x))]})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Floor"}),c.jsxs("select",{className:"select",value:u,onChange:x=>d(x.target.value),children:[c.jsx("option",{value:"",children:"All floors"}),V.map(x=>c.jsx("option",{value:x,children:x},x))]})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Search Issues"}),c.jsx("input",{className:"input",value:f,onChange:x=>m(x.target.value),placeholder:"e.g., ceiling, temp, allergen..."})]})]})})]}),e.length>=2&&c.jsxs(c.Fragment,{children:[c.jsx(qg,{history:R.length>0?R:e}),c.jsx(zg,{history:R.length>0?R:e})]}),R.length===0?c.jsx("div",{className:"card",children:c.jsx("div",{className:"cardBody",children:c.jsxs("div",{className:"emptyState",children:[c.jsx("div",{className:"emptyTitle",children:e.length===0?"No inspections saved yet":"No matches"}),c.jsx("div",{className:"emptySub",children:e.length===0?"Complete an inspection and click Save to build your history.":"Try adjusting your filters."})]})})}):c.jsx("div",{className:"historyList",children:R.map(x=>{const H=y===x.id,E=x.actionItems||[],g=x.overallStatus==="Pass"?"#15803D":"#EE0000";return c.jsxs("div",{className:"card historyCard",style:{marginBottom:16},children:[c.jsxs("div",{className:"cardHeader",style:{cursor:"pointer"},onClick:()=>T(H?null:x.id),children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,flex:1},children:[c.jsx("span",{className:"historyStatus",style:{background:g},children:x.overallStatus}),c.jsxs("div",{children:[c.jsx("div",{className:"cardTitle",children:x.siteName||x.location||"Inspection"}),c.jsxs("div",{className:"cardSub",children:[x.inspectionDate," "," ",c.jsx("span",{className:Pe("typeBadge",x.inspectionType==="Event Day"?"typeBadgeEvent":x.inspectionType==="Post Event"?"typeBadgePost":"typeBadgeRegular"),children:x.inspectionType}),x.floor&&c.jsxs(c.Fragment,{children:[" "," ",c.jsx("span",{className:"typeBadge typeBadgeFloor",children:x.floor})]})," "," ",x.inspectorName||""]})]})]}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[E.length>0&&c.jsxs("span",{className:"pill",children:[E.length," issue",E.length!==1?"s":""]}),c.jsx("span",{style:{fontSize:"1.2rem",color:"var(--sdx-gray-400)"},children:H?"":""})]})]}),H&&c.jsxs("div",{className:"cardBody",children:[c.jsxs("div",{className:"historyMeta",children:[c.jsxs("div",{children:[c.jsx("strong",{children:"Inspector:"})," ",x.inspectorName||""]}),c.jsxs("div",{children:[c.jsx("strong",{children:"Supervisor:"})," ",x.supervisorName||""]}),c.jsxs("div",{children:[c.jsx("strong",{children:"Unit #:"})," ",x.siteNumber||""]}),c.jsxs("div",{children:[c.jsx("strong",{children:"Floor:"})," ",x.floor||""]}),c.jsxs("div",{children:[c.jsx("strong",{children:"Hand sink:"})," ",x.temps?.handSinkTempF||"","F"]}),c.jsxs("div",{children:[c.jsx("strong",{children:"3-comp wash:"})," ",x.temps?.threeCompSinkTempF||"","F"]})]}),E.length>0&&c.jsxs("div",{style:{marginTop:16},children:[c.jsx("div",{className:"guideSectionTitle",children:"Action Items"}),c.jsxs("table",{className:"historyTable",children:[c.jsx("thead",{children:c.jsxs("tr",{children:[c.jsx("th",{children:"Issue"}),c.jsx("th",{children:"Priority"})]})}),c.jsx("tbody",{children:E.map((_,b)=>c.jsxs("tr",{children:[c.jsx("td",{children:_.issue}),c.jsx("td",{children:c.jsx("span",{className:Pe("priorityBadge",_.priority==="High"?"priorityHigh":"priorityMed"),children:_.priority})})]},b))})]})]}),x.rawNotes&&c.jsxs("div",{style:{marginTop:16},children:[c.jsx("div",{className:"guideSectionTitle",children:"Inspector Notes"}),c.jsx("div",{className:"historyNotesFormatted",style:{maxHeight:250,overflowY:"auto"},children:(()=>{const{grouped:_}=Sr(x.rawNotes);return Ar.map(b=>_[b]?.length?c.jsxs("div",{style:{marginBottom:10},children:[c.jsx("div",{className:Pe("rptNoteCatLabel",`rptNoteCat--${b}`),children:Ir[b]}),c.jsx("ul",{className:"rptNoteBullets",children:_[b].map((w,I)=>c.jsx("li",{children:w},I))})]},b):null)})()})]}),c.jsxs("div",{style:{marginTop:16,display:"flex",gap:8},children:[c.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{Tu({output:x.output||x.rawNotes||"",inspectionDate:x.inspectionDate,siteName:x.siteName})},children:"Download TXT"}),c.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{bu({output:x.output||x.rawNotes||"",inspectionType:x.inspectionType,inspectionDate:x.inspectionDate,siteName:x.siteName,inspectorName:x.inspectorName})},children:"Download HTML"}),c.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>F(x.id),style:{color:"#EE0000",borderColor:"rgba(238,0,0,.3)",marginLeft:"auto"},children:"Delete"})]})]})]},x.id)})})]}),c.jsxs("footer",{className:"footer",children:[c.jsx("img",{src:un,alt:"Sodexo",className:"footerLogo"}),c.jsx("span",{children:Ne?" Inspection history synced to cloud database.":"Inspection history is stored locally in your browser."})]})]})}function Kg({currentUser:n,onBack:e}){const[t,s]=U.useState([]),[r,o]=U.useState(!1),[a,u]=U.useState(""),[d,f]=U.useState(""),[m,y]=U.useState(""),[T,S]=U.useState("inspector"),[P,R]=U.useState(""),[F,B]=U.useState(""),[j,O]=U.useState(!1);U.useEffect(()=>{Oe().then(s)},[]);async function V(){s(await Oe())}async function x(L){await Tg(L),await V()}async function H(L){confirm("Remove this access request?")&&(await bl(L),await V())}async function E(L){await wg(L),await V()}async function g(L){await Ig(L),await V()}async function _(L){confirm("Remove this user? They will need to request access again.")&&(await bl(L),await V())}async function b(L){L.preventDefault(),R(""),B(""),O(!0);try{if(a.trim().length<3){R("Badge number must be at least 3 characters.");return}const ee=await bg(a.trim(),d.trim(),m.trim(),T);ee.ok?(B(`${d.trim()} added as ${T==="admin"?"Admin":"Inspector"}.`),u(""),f(""),y(""),S("inspector"),await V(),setTimeout(()=>B(""),3e3)):ee.reason==="exists"&&R("This badge number is already registered.")}catch{R("Failed to add user. Try again.")}finally{O(!1)}}const w=t.filter(L=>!L.approved),I=t.filter(L=>L.approved),v=t.filter(L=>L.role==="admin"&&L.approved).length;return c.jsxs("div",{className:"appShell",children:[c.jsxs("header",{className:"topBar",children:[c.jsxs("div",{className:"brandLeft brandClickable",onClick:e,title:"Back to Inspector",children:[c.jsx("img",{src:un,alt:"Sodexo",className:"brandLogo"}),c.jsxs("div",{children:[c.jsx("div",{className:"brandTitle",children:"Admin Panel"}),c.jsx("div",{className:"brandSub",children:"Manage user access & permissions"})]})]}),c.jsx("div",{className:"topActions",children:c.jsx("button",{className:"btn btnGhost",onClick:e,type:"button",children:"Back to Inspector"})})]}),c.jsxs("main",{className:"pageMain pageMainNarrow",children:[c.jsxs("div",{className:"card adminCard",style:{marginBottom:24},children:[c.jsxs("div",{className:"cardHeader",children:[c.jsx("div",{className:"cardTitle",children:"Add New User"}),c.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{o(!r),R(""),B("")},children:r?"Cancel":"+ Add User"})]}),r&&c.jsx("div",{className:"cardBody",children:c.jsxs("form",{onSubmit:b,className:"addUserForm",children:[c.jsxs("div",{className:"fieldGrid",children:[c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Badge Number"}),c.jsx("input",{className:"input",type:"password",value:a,onChange:L=>u(L.target.value),placeholder:"Enter badge #",autoComplete:"off"})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Full Name"}),c.jsx("input",{className:"input",value:d,onChange:L=>f(L.target.value),placeholder:"e.g., Jane Smith"})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Department"}),c.jsx("input",{className:"input",value:m,onChange:L=>y(L.target.value),placeholder:"e.g., Safety Inspector"})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Role"}),c.jsxs("select",{className:"select",value:T,onChange:L=>S(L.target.value),children:[c.jsx("option",{value:"inspector",children:"Inspector"}),c.jsx("option",{value:"admin",children:"Admin"})]})]})]}),P&&c.jsx("div",{className:"pinError",style:{marginTop:8},children:P}),F&&c.jsx("div",{className:"addUserSuccess",children:F}),c.jsx("button",{className:"btn btnPrimary",type:"submit",style:{marginTop:12},disabled:j||a.trim().length<3||!d.trim()||!m.trim(),children:j?"Adding...":`Add as ${T==="admin"?"Admin":"Inspector"}`})]})})]}),w.length>0&&c.jsxs("div",{className:"card adminCard",style:{marginBottom:24},children:[c.jsx("div",{className:"cardHeader",children:c.jsxs("div",{className:"cardTitle",children:["Pending Approvals",c.jsx("span",{className:"adminCount",children:w.length})]})}),c.jsx("div",{className:"cardBody",children:w.map(L=>c.jsxs("div",{className:"adminUserRow",children:[c.jsxs("div",{className:"adminUserInfo",children:[c.jsx("div",{className:"adminUserName",children:L.name}),c.jsxs("div",{className:"adminUserMeta",children:[L.department,"  Requested ",new Date(L.registeredAt).toLocaleDateString()]})]}),c.jsxs("div",{className:"adminUserActions",children:[c.jsx("button",{className:"btn btnPrimary btnSmall",onClick:()=>x(L.badgeHash),children:"Approve"}),c.jsx("button",{className:"btn btnGhost btnSmall adminDenyBtn",onClick:()=>H(L.badgeHash),children:"Deny"})]})]},L.badgeHash))})]}),c.jsxs("div",{className:"card adminCard",children:[c.jsx("div",{className:"cardHeader",children:c.jsxs("div",{className:"cardTitle",children:["Team Members",c.jsx("span",{className:"adminCount",children:I.length})]})}),c.jsx("div",{className:"cardBody",children:I.length===0?c.jsx("div",{className:"emptyState",children:c.jsx("div",{className:"emptyTitle",children:"No approved users"})}):I.map(L=>{const ee=L.badgeHash===n?.badgeHash,Ut=L.role==="admin"&&v<=1;return c.jsxs("div",{className:"adminUserRow",children:[c.jsxs("div",{className:"adminUserInfo",children:[c.jsxs("div",{className:"adminUserName",children:[L.name,L.role==="admin"&&c.jsx("span",{className:"roleBadge adminRoleBadge",children:"Admin"}),L.role==="inspector"&&c.jsx("span",{className:"roleBadge inspectorRoleBadge",children:"Inspector"}),ee&&c.jsx("span",{className:"roleBadge youRoleBadge",children:"You"})]}),c.jsxs("div",{className:"adminUserMeta",children:[L.department,"  Since ",new Date(L.registeredAt).toLocaleDateString()]})]}),c.jsxs("div",{className:"adminUserActions",children:[L.role==="inspector"&&c.jsx("button",{className:"btn btnGhost btnSmall",onClick:()=>E(L.badgeHash),children:"Make Admin"}),L.role==="admin"&&!Ut&&!ee&&c.jsx("button",{className:"btn btnGhost btnSmall",onClick:()=>g(L.badgeHash),children:"Remove Admin"}),!ee&&c.jsx("button",{className:"btn btnGhost btnSmall adminDenyBtn",onClick:()=>_(L.badgeHash),children:"Remove"})]})]},L.badgeHash)})})]})]}),c.jsxs("footer",{className:"footer",children:[c.jsx("img",{src:un,alt:"Sodexo",className:"footerLogo"}),c.jsx("span",{children:Ne?" User accounts synced to cloud database.":"User accounts are stored locally on this device."})]})]})}function Gg({photos:n,onRemove:e}){return n?.length?c.jsx("div",{className:"photoStrip",children:n.map(t=>c.jsxs("div",{className:"photoThumb",children:[c.jsx("img",{src:t.previewUrl,alt:t.name}),c.jsx("button",{className:"thumbX",type:"button",onClick:()=>e(t.id),"aria-label":"Remove photo",children:""})]},t.id))}):null}function oi({title:n,items:e,inspection:t,setInspection:s}){const r=U.useRef({});async function o(u,d){const f=Array.from(d||[]).slice(0,si),m=[];for(const y of f){if(!y.type.startsWith("image/")||Il(y.size)>Tl)continue;const T=await jg(y);T&&m.push({id:`${Date.now()}_${Math.random().toString(16).slice(2)}`,name:y.name,sizeMb:Il(y.size),type:"image/jpeg",previewUrl:T})}m.length!==0&&s(y=>{const T=u.split("."),S=ii(y,T)||_e({status:"OK",notes:""}),P={...S,photos:[...S.photos||[],...m].slice(0,si)};return Hn(y,T,P)})}function a(u,d){s(f=>{const m=u.split("."),y=ii(f,m)||_e({status:"OK",notes:""}),T={...y,photos:(y.photos||[]).filter(S=>S.id!==d)};return Hn(f,m,T)})}return c.jsxs("div",{className:"guideSection",children:[c.jsx("div",{className:"guideSectionTitle",children:n}),c.jsx("div",{className:"guideItems",children:e.map(u=>{const d=u.path.join("."),f=ii(t,u.path)||_e({status:"OK",notes:""});return c.jsxs("div",{className:"guideItem",children:[c.jsxs("div",{className:"guideItemHead",children:[c.jsx("div",{className:"guideLabel",children:u.label}),c.jsx("select",{className:"select selectSmall",value:f.status,onChange:m=>s(y=>Hn(y,u.path,{...f,status:m.target.value})),children:Sg.map(m=>c.jsx("option",{value:m,children:m},m))})]}),c.jsx("input",{className:"input inputSmall",value:f.notes,onChange:m=>s(y=>Hn(y,u.path,{...f,notes:m.target.value})),placeholder:"Issue / observation (optional)"}),c.jsxs("div",{className:"photoRow",children:[c.jsx("input",{ref:m=>r.current[d]=m,className:"fileInput",type:"file",accept:"image/*",capture:"environment",multiple:!0,onChange:m=>{o(d,m.target.files),m.target.value=""}}),c.jsx("button",{className:"btn btnGhost btnSmall photoBtn",type:"button",onClick:()=>r.current[d]?.click(),children:" Add photos"}),c.jsxs("span",{className:"hint",children:["Up to ",si," (",Tl,"MB each)"]})]}),c.jsx(Gg,{photos:f.photos,onRemove:m=>a(d,m)})]},d)})}),c.jsx("div",{className:"guideNote",children:"Photos are stored locally for preview. For production: upload images and store URLs."})]})}function Wg(){const[n,e]=U.useState(!0),[t,s]=U.useState(null),[r,o]=U.useState("inspector"),a=U.useRef(Date.now());U.useEffect(()=>{const k=document.getElementById("splash");k&&(k.classList.add("hide"),setTimeout(()=>k.remove(),350))},[]),U.useEffect(()=>{const k="sdx_last_cache_clean";function te(){const De=new Date().toISOString().slice(0,10);localStorage.getItem(k)!==De&&(localStorage.setItem(k,De),navigator.serviceWorker?.controller&&navigator.serviceWorker.controller.postMessage("CLEAN_CACHE"))}te();const re=setInterval(te,3600*1e3);return()=>clearInterval(re)},[]);const[u,d]=U.useState("inspection"),[f,m]=U.useState(()=>wl("inspection")),[y,T]=U.useState(()=>ri()),[S,P]=U.useState(""),[R,F]=U.useState(nn.inspection.useCases[0]),[B,j]=U.useState("Regular Inspection"),[O,V]=U.useState(()=>new Date().toISOString().slice(0,10)),[x,H]=U.useState(""),[E,g]=U.useState(""),[_,b]=U.useState(""),[w,I]=U.useState(""),[v,L]=U.useState(""),[ee,Ut]=U.useState("Floor 1"),[Le,nt]=U.useState(""),[wt,fs]=U.useState(!1),[vn,Qe]=U.useState(""),[En,Je]=U.useState([]),[qt,Ye]=U.useState([]),[st,It]=U.useState(!1),At=U.useCallback(()=>{a.current=Date.now()},[]);if(U.useEffect(()=>{if(n)return;const k=["mousedown","keydown","touchstart","scroll"];k.forEach(re=>window.addEventListener(re,At,{passive:!0}));const te=setInterval(()=>{Date.now()-a.current>ug&&(El(),e(!0))},3e4);return()=>{k.forEach(re=>window.removeEventListener(re,At)),clearInterval(te)}},[n,At]),U.useEffect(()=>{function k(te){S.trim()&&!st&&(te.preventDefault(),te.returnValue="")}return window.addEventListener("beforeunload",k),()=>window.removeEventListener("beforeunload",k)},[S,st]),n)return c.jsx(Ag,{onUnlock:k=>{s(k),e(!1),At(),k?.name&&!x&&H(k.name)}});if(r==="history")return c.jsx(Hg,{onBack:()=>o("inspector")});if(r==="admin")return c.jsx(Kg,{currentUser:t,onBack:()=>o("inspector")});const ms=nn[u];function Cr(){m(wl(u)),T(ri()),P(""),nt(""),Qe(""),Je([]),Ye([]),It(!1),j("Regular Inspection"),V(new Date().toISOString().slice(0,10)),H(t?.name||""),g(""),b(""),I(""),L(""),Ut("Floor 1"),window.scrollTo({top:0,behavior:"smooth"})}function ps(){const k=nn[u].sample;m({...k.context}),T(k.inspection?{...k.inspection}:ri()),P(k.rawNotes||""),j(k.meta?.inspectionType||"Regular Inspection"),V(k.meta?.inspectionDate||k.context?.date||""),H(k.meta?.inspectorName||""),g(""),b(""),I(""),L(""),nt(""),Qe(""),Je([]),Ye([])}function bn(){Qe(""),Je([]),Ye([]);const k=Og({inspectionDate:O,inspectorName:x,context:f,noteType:u,inspection:y});if(k.length&&Je(k),!S.trim()){Qe("Please enter raw notes before transforming.");return}fs(!0);try{const te=Mg({noteType:u,useCase:R,context:f,inspection:y,rawNotes:S,inspectionType:B,inspectionDate:O,inspectorName:x,siteName:E,siteNumber:_,sitePhone:v,supervisorName:w,floor:ee});nt(te);const re=Sl({inspection:y,rawNotes:S,context:f,noteType:u});Ye(re)}catch(te){Qe(te?.message||"Something went wrong")}finally{fs(!1)}}async function gs(){Le&&await navigator.clipboard.writeText(Le)}function xr(){const k=Sl({inspection:y,rawNotes:S,context:f,noteType:u});Ye(k)}async function Tn(){function k(re){if(!re||typeof re!="object")return re;if(Array.isArray(re))return re.map(k);const De={};for(const[In,Xe]of Object.entries(re))In==="photos"&&Array.isArray(Xe)?De.photos=Xe.map(St=>({id:St.id,name:St.name,sizeMb:St.sizeMb,type:St.type})):De[In]=k(Xe);return De}const te={id:`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,savedAt:new Date().toISOString(),noteType:u,inspectionType:B,inspectionDate:O,inspectorName:x,siteName:E,siteNumber:_,supervisorName:w,sitePhone:v,floor:ee,location:E||f?.kitchen||"Kitchen",context:{...f},temps:{...y.temps},overallStatus:$t(y),actionItems:_n({inspection:y,rawNotes:S}),rawNotes:S,output:Le,inspection:k(y),photoCount:Fg(y)};try{await gg(te),It(!0),setTimeout(()=>It(!1),2500)}catch(re){console.error("Save failed:",re),Qe("Save failed  record may be too large. Try removing some photos.")}}function wn(){Ug({inspection:y,rawNotes:S,inspectionType:B,inspectionDate:O,inspectorName:x,siteName:E,siteNumber:_,supervisorName:w,floor:ee})}function ys(){bu({output:Le,inspection:y,rawNotes:S,inspectionType:B,inspectionDate:O,siteName:E,siteNumber:_,sitePhone:v,inspectorName:x,supervisorName:w})}function ge(){Tu({output:Le,inspectionDate:O,siteName:E})}return c.jsxs("div",{className:"appShell",children:[c.jsxs("header",{className:"topBar",children:[c.jsxs("div",{className:"brandLeft brandClickable",onClick:()=>{o("inspector"),window.scrollTo({top:0,behavior:"smooth"})},title:"Home",children:[c.jsx("img",{src:un,alt:"Sodexo",className:"brandLogo"}),c.jsxs("div",{children:[c.jsx("div",{className:"brandTitle",children:"Kitchen Inspection"}),c.jsx("div",{className:"brandSub",children:"Turn sit-down inspection notes into organized documents"})]})]}),c.jsxs("div",{className:"topActions",children:[t&&c.jsxs("span",{className:"userBadgeLabel",children:[t.name,t.role==="admin"?" (Admin)":""]}),c.jsx("button",{className:"btn btnLock",onClick:()=>{El(),s(null),e(!0)},type:"button",title:"Lock app",children:""}),t?.role==="admin"&&c.jsx("button",{className:"btn btnAdmin",onClick:()=>o("admin"),type:"button",children:"Admin"}),c.jsx("button",{className:"btn btnNew",onClick:Cr,type:"button",title:"Start a fresh inspection",children:"+ New"}),c.jsx("button",{className:"btn btnGhost",onClick:()=>o("history"),type:"button",children:"Past Reports"}),c.jsx("button",{className:Pe("btn","btnPrimary"),onClick:bn,type:"button",disabled:wt,children:wt?"Generating...":"Generate Report"})]})]}),c.jsxs("main",{className:"grid",children:[c.jsxs("section",{className:"card",children:[c.jsx("div",{className:"cardHeader",children:c.jsx("div",{className:"cardTitle",children:"Inspection Details"})}),c.jsxs("div",{className:"cardBody",children:[c.jsxs("div",{className:"fieldGrid",children:[c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Inspection Type"}),c.jsx("select",{className:"select",value:B,onChange:k=>j(k.target.value),children:Cg.map(k=>c.jsx("option",{value:k,children:k},k))})]}),c.jsxs("label",{className:"field",id:"field-inspectionDate",children:[c.jsx("span",{className:"fieldLabel",children:"Inspection Date"}),c.jsx("input",{className:"input",type:"date",value:O,onChange:k=>V(k.target.value)})]}),c.jsxs("label",{className:"field",id:"field-inspectorName",children:[c.jsx("span",{className:"fieldLabel",children:"Inspector Name"}),c.jsx("input",{className:"input",value:x,onChange:k=>H(k.target.value),placeholder:"e.g., J. Da Silva"})]}),c.jsxs("label",{className:"field",id:"field-supervisorName",children:[c.jsx("span",{className:"fieldLabel",children:"Supervisor Name"}),c.jsx("input",{className:"input",value:w,onChange:k=>I(k.target.value),placeholder:"e.g., GM / Chef Lead"})]}),c.jsxs("label",{className:"field",id:"field-siteName",children:[c.jsx("span",{className:"fieldLabel",children:"Restaurant / Local Name"}),c.jsx("input",{className:"input",value:E,onChange:k=>g(k.target.value),placeholder:"e.g., North Stand Kitchen"})]}),c.jsxs("label",{className:"field",id:"field-siteNumber",children:[c.jsx("span",{className:"fieldLabel",children:"Location / Unit Number"}),c.jsx("input",{className:"input",value:_,onChange:k=>b(k.target.value),placeholder:"e.g., Unit 12 / Loc-204"})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Location Phone (optional)"}),c.jsx("input",{className:"input",value:v,onChange:k=>L(k.target.value),placeholder:"e.g., (305) 555-0123"})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Floor"}),c.jsx("select",{className:"select",value:ee,onChange:k=>Ut(k.target.value),children:xg.map(k=>c.jsx("option",{value:k,children:k},k))})]})]}),c.jsx("div",{className:"fieldGrid",children:ms.contextFields.map(k=>c.jsxs("label",{className:"field",id:`field-ctx-${k.key}`,children:[c.jsx("span",{className:"fieldLabel",children:k.label}),c.jsx("input",{className:"input",value:f[k.key]??"",onChange:te=>m(re=>({...re,[k.key]:te.target.value})),placeholder:k.label})]},k.key))}),c.jsxs("div",{className:"field",children:[c.jsxs("div",{className:"fieldLabelRow",children:[c.jsx("span",{className:"fieldLabel",children:"Final output format"}),c.jsx("span",{className:"hint",children:"Adapts to the selected note type"})]}),c.jsx("select",{className:"select",value:R,onChange:k=>F(k.target.value),children:ms.useCases.map(k=>c.jsx("option",{value:k,children:k},k))})]}),c.jsxs("div",{className:"guide",children:[c.jsxs("div",{className:"guideHeader",children:[c.jsxs("div",{children:[c.jsx("div",{className:"guideTitle",children:"Inspector guide"}),c.jsx("div",{className:"guideSub",children:"Fast checklist for sit-down kitchen inspections"})]}),c.jsxs("div",{className:"pillRow",children:[c.jsxs("span",{className:"pill",children:["Hand sink ",""," 95 F"]}),c.jsxs("span",{className:"pill",children:["3-comp wash ",""," 110 F"]})]})]}),c.jsx(oi,{title:"Facility: ceiling, walls, floors, lighting",items:[{path:["facility","ceiling"],label:"Ceiling"},{path:["facility","walls"],label:"Walls"},{path:["facility","floors"],label:"Floors"},{path:["facility","lighting"],label:"Lighting"}],inspection:y,setInspection:T}),c.jsx(oi,{title:"Operations: employees + process controls",items:[{path:["operations","employeePractices"],label:"Employee practices"},{path:["operations","handwashing"],label:"Handwashing / supplies"},{path:["operations","labelingDating"],label:"Labeling / dating"},{path:["operations","logs"],label:"Logs / documentation"}],inspection:y,setInspection:T}),c.jsxs("div",{className:"tempsRow",children:[c.jsx("div",{className:"tempsTitle",children:"Key temperatures"}),c.jsxs("div",{className:"tempsGrid",children:[c.jsxs("label",{className:"field",id:"field-handSinkTempF",style:{marginTop:0},children:[c.jsx("span",{className:"fieldLabel",children:"Hand sink temp (F)"}),c.jsx("input",{className:"input",inputMode:"numeric",value:y.temps.handSinkTempF,onChange:k=>T(te=>({...te,temps:{...te.temps,handSinkTempF:k.target.value}})),placeholder:"e.g., 97"}),c.jsx("span",{className:"hint",children:Number(y.temps.handSinkTempF)>=95?"Meets >=95 F":y.temps.handSinkTempF?"Below 95 F - flag":""})]}),c.jsxs("label",{className:"field",id:"field-threeCompSinkTempF",style:{marginTop:0},children:[c.jsx("span",{className:"fieldLabel",children:"3-comp wash temp (F)"}),c.jsx("input",{className:"input",inputMode:"numeric",value:y.temps.threeCompSinkTempF,onChange:k=>T(te=>({...te,temps:{...te.temps,threeCompSinkTempF:k.target.value}})),placeholder:"e.g., 112"}),c.jsx("span",{className:"hint",children:Number(y.temps.threeCompSinkTempF)>=110?"Meets >=110 F":y.temps.threeCompSinkTempF?"Below 110 F - flag":""})]})]})]}),c.jsx(oi,{title:"Equipment check",items:[{path:["equipment","doubleDoorCooler"],label:"Double-door cooler"},{path:["equipment","doubleDoorFreezer"],label:"Double-door freezer"},{path:["equipment","walkInCooler"],label:"Walk-in cooler"},{path:["equipment","warmers"],label:"Warmers / hot holding"},{path:["equipment","ovens"],label:"Ovens"},{path:["equipment","threeCompSink"],label:"3-compartment sink"},{path:["equipment","ecolab"],label:"Ecolab / chemicals"}],inspection:y,setInspection:T})]}),c.jsxs("div",{className:"field",children:[c.jsxs("div",{className:"fieldLabelRow",children:[c.jsx("span",{className:"fieldLabel",children:"Raw notes"}),c.jsx("span",{className:"hint",children:"Abbreviations are expanded while preserving meaning"})]}),c.jsx("textarea",{className:"textarea",value:S,onChange:k=>P(k.target.value),placeholder:"Paste quick inspection notes here...",rows:10})]}),En.length>0&&c.jsxs("div",{className:"warningBox",children:[c.jsx("strong",{children:"Missing information:"}),c.jsx("ul",{children:En.map((k,te)=>c.jsx("li",{className:"warningLink",onClick:()=>{const re=document.getElementById(k.fieldId);if(re){re.scrollIntoView({behavior:"smooth",block:"center"});const De=re.querySelector("input, select, textarea");De&&setTimeout(()=>De.focus(),400),re.classList.add("fieldHighlight"),setTimeout(()=>re.classList.remove("fieldHighlight"),2e3)}},children:k.text},te))})]}),vn?c.jsx("div",{className:"errorBox",children:vn}):null]})]}),c.jsxs("section",{className:"card",children:[c.jsxs("div",{className:"cardHeader",children:[c.jsxs("div",{children:[c.jsx("div",{className:"cardTitle",children:"Output"}),c.jsx("div",{className:"cardSub",children:Vg(u,R)})]}),c.jsxs("div",{className:"outputActions",children:[c.jsx("button",{className:"btn btnGhost",type:"button",onClick:gs,disabled:!Le,children:"Copy"}),c.jsx("button",{className:Pe("btn",st?"btnSaved":"btnSave"),type:"button",onClick:Tn,disabled:!Le,children:st?"Saved!":"Save"})]})]}),c.jsxs("div",{className:"cardBody",children:[qt.length>0&&c.jsxs("div",{className:"aiBox",children:[c.jsx("div",{className:"aiBoxTitle",children:"AI Assistant"}),c.jsx("ul",{children:qt.map((k,te)=>c.jsx("li",{children:k},te))})]}),Le?c.jsxs(c.Fragment,{children:[c.jsx(Bg,{noteType:u,useCase:R,context:f,inspection:y,rawNotes:S,inspectionType:B,inspectionDate:O,inspectorName:x,siteName:E,siteNumber:_,sitePhone:v,supervisorName:w,floor:ee}),c.jsxs("div",{className:"downloadBar",children:[c.jsx("span",{className:"downloadLabel",children:"Download:"}),c.jsx("button",{className:"btn btnDownload",type:"button",onClick:wn,children:"Excel (.xls)"}),c.jsx("button",{className:"btn btnDownload",type:"button",onClick:ys,children:"Word (.doc)"}),c.jsx("button",{className:"btn btnDownload",type:"button",onClick:ge,children:"Text (.txt)"})]})]}):c.jsxs("div",{className:"emptyState",children:[c.jsx("div",{className:"emptyIcon",children:""}),c.jsx("div",{className:"emptyTitle",children:"Ready to generate your report"}),c.jsxs("div",{className:"emptySub",children:["Fill in the inspection details on the left, then click ",c.jsx("strong",{children:"Generate Report"}),"."]})]})]})]})]}),c.jsx("button",{className:"fab fabLeft",onClick:ps,type:"button",title:"Try Example",children:" Try Example"}),c.jsx("button",{className:"fab fabRight",onClick:xr,type:"button",title:"AI Tips",children:" AI Tips"}),c.jsxs("footer",{className:"footer",children:[c.jsx("img",{src:un,alt:"Sodexo",className:"footerLogo"}),c.jsx("span",{children:Ne?" Cloud database connected  data syncs across all devices.":"U0001F512 Data stored locally on this device."})]})]})}Zu.createRoot(document.getElementById("root")).render(c.jsx(Ju.StrictMode,{children:c.jsx(Wg,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/Claude/sw.js").catch(()=>{})});
