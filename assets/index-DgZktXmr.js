import{r as Re,g as Pe,a as at}from"./react-N--QU9DW.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const m of o.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function a(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=a(i);fetch(i.href,o)}})();var ce={exports:{}},G={};var ke;function it(){if(ke)return G;ke=1;var t=Re(),n=Symbol.for("react.element"),a=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function m(p,u,c){var r,d={},y=null,j=null;c!==void 0&&(y=""+c),u.key!==void 0&&(y=""+u.key),u.ref!==void 0&&(j=u.ref);for(r in u)s.call(u,r)&&!o.hasOwnProperty(r)&&(d[r]=u[r]);if(p&&p.defaultProps)for(r in u=p.defaultProps,u)d[r]===void 0&&(d[r]=u[r]);return{$$typeof:n,type:p,key:y,ref:j,props:d,_owner:i.current}}return G.Fragment=a,G.jsx=m,G.jsxs=m,G}var Ce;function ot(){return Ce||(Ce=1,ce.exports=it()),ce.exports}var e=ot(),x=Re();const lt=Pe(x);var te={},Fe;function rt(){if(Fe)return te;Fe=1;var t=at();return te.createRoot=t.createRoot,te.hydrateRoot=t.hydrateRoot,te}var ct=rt();const dt=Pe(ct),Be="/Claude/",M=`${Be}sodexo-live-logo.svg`,He=`${Be}sodexo-dark.svg`,Ie="sdx_salt",Ke="sdx_users",_e="sdx_inspection_vault",Te="sdx_device_secret",pt=600*1e3,de={name:"Joxel Da Silva",badge:"365582",department:"Safety Inspector"};async function Ue(){let t=localStorage.getItem(Ie);if(t)return new Uint8Array(JSON.parse(t));const n=crypto.getRandomValues(new Uint8Array(16));return localStorage.setItem(Ie,JSON.stringify(Array.from(n))),n}async function mt(t){const n=new TextEncoder,a=await Ue(),s=await crypto.subtle.importKey("raw",n.encode(t),"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:a,iterations:1e5,hash:"SHA-256"},s,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function ne(t){const n=new TextEncoder,a=await Ue(),s=new Uint8Array([...a,...n.encode(t)]),i=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(i)).map(o=>o.toString(16).padStart(2,"0")).join("")}async function ut(t,n){const a=crypto.getRandomValues(new Uint8Array(12)),s=new TextEncoder,i=await crypto.subtle.encrypt({name:"AES-GCM",iv:a},n,s.encode(JSON.stringify(t)));return JSON.stringify({iv:Array.from(a),ct:Array.from(new Uint8Array(i))})}async function ht(t,n){if(!t)return[];try{const{iv:a,ct:s}=JSON.parse(t),i=await crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(a)},n,new Uint8Array(s));return JSON.parse(new TextDecoder().decode(i))}catch{return[]}}async function bt(){let t=localStorage.getItem(Te);if(!t){const n=crypto.getRandomValues(new Uint8Array(32));t=Array.from(n).map(a=>a.toString(16).padStart(2,"0")).join(""),localStorage.setItem(Te,t)}return mt("sdx_master_"+t)}function R(){try{return JSON.parse(localStorage.getItem(Ke)||"[]")}catch{return[]}}function K(t){localStorage.setItem(Ke,JSON.stringify(t))}async function Me(){if(R().length>0)return;const n=await ne(de.badge);K([{badgeHash:n,name:de.name,department:de.department,role:"admin",approved:!0,registeredAt:new Date().toISOString()}])}let W=null,he=null;async function We(){if(!W)return[];const t=localStorage.getItem(_e);return ht(t,W)}async function be(t){if(!W)return;const n=await ut(t,W);localStorage.setItem(_e,n)}async function gt(t){await Me();const n=await ne(t),s=R().find(i=>i.badgeHash===n);return s?s.approved?(W=await bt(),he={...s},{ok:!0,user:he}):{ok:!1,reason:"pending"}:{ok:!1,reason:"not_found"}}async function ft(t,n,a){const s=await ne(t),i=R();return i.find(o=>o.badgeHash===s)?{ok:!1,reason:"exists"}:(i.push({badgeHash:s,name:n,department:a,role:"inspector",approved:!1,registeredAt:new Date().toISOString()}),K(i),{ok:!0})}function Ee(){W=null,he=null}async function xt(t,n,a,s){const i=await ne(t),o=R();return o.find(m=>m.badgeHash===i)?{ok:!1,reason:"exists"}:(o.push({badgeHash:i,name:n,department:a,role:s||"inspector",approved:!0,registeredAt:new Date().toISOString()}),K(o),{ok:!0})}function Nt(t){const n=R(),a=n.find(s=>s.badgeHash===t);a&&(a.approved=!0,K(n))}function Ae(t){K(R().filter(n=>n.badgeHash!==t))}function yt(t){const n=R(),a=n.find(s=>s.badgeHash===t);a&&(a.role="admin",K(n))}function jt(t){const n=R(),a=n.find(s=>s.badgeHash===t);a&&(a.role="inspector",K(n))}function vt({onUnlock:t}){const[n,a]=x.useState(""),[s,i]=x.useState("signin"),[o,m]=x.useState(""),[p,u]=x.useState(""),[c,r]=x.useState(""),[d,y]=x.useState(!1),[j,v]=x.useState(""),w=x.useRef(null);x.useEffect(()=>{Me()},[]),x.useEffect(()=>{w.current?.focus()},[s]);async function I(l){l.preventDefault(),r(""),y(!0);try{const h=await gt(n.trim());if(h.ok){t(h.user);return}h.reason==="pending"?i("pending"):r("Badge not recognized. Request access below if you‚Äôre new.")}catch{r("Something went wrong. Try again.")}finally{y(!1)}}async function N(l){l.preventDefault(),r(""),y(!0);try{const h=await ft(n.trim(),o.trim(),p.trim());h.ok?(v("Registration submitted! Ask an administrator to approve your badge."),i("pending")):h.reason==="exists"&&r("This badge is already registered. Try signing in.")}catch{r("Registration failed. Try again.")}finally{y(!1)}}return e.jsx("div",{className:"pinOverlay",children:e.jsxs("div",{className:"pinCard",children:[e.jsx("img",{src:He,alt:"Sodexo",className:"pinLogo"}),s==="signin"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pinTitle",children:"Badge Sign-In"}),e.jsx("div",{className:"pinSub",children:"Enter your work badge number to access inspections"}),e.jsxs("form",{onSubmit:I,className:"pinForm",children:[e.jsx("input",{ref:w,className:"pinInput badgeInput",type:"password",maxLength:20,value:n,onChange:l=>a(l.target.value),placeholder:"Badge #",autoComplete:"off"}),c&&e.jsx("div",{className:"pinError",children:c}),e.jsx("button",{className:"btn btnPrimary pinBtn",type:"submit",disabled:d||n.trim().length<3,children:d?"Verifying...":"Sign In"})]}),e.jsx("button",{className:"btnLink",type:"button",onClick:()=>{i("register"),r(""),a("")},children:"New here? Request access"})]}),s==="register"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pinTitle",children:"Request Access"}),e.jsx("div",{className:"pinSub",children:"Fill in your details. An administrator will review your request."}),e.jsxs("form",{onSubmit:N,className:"pinForm",children:[e.jsx("input",{ref:w,className:"pinInput badgeInput",type:"password",maxLength:20,value:n,onChange:l=>a(l.target.value),placeholder:"Badge #",autoComplete:"off"}),e.jsx("input",{className:"input regInput",value:o,onChange:l=>m(l.target.value),placeholder:"Full name",autoComplete:"name"}),e.jsx("input",{className:"input regInput",value:p,onChange:l=>u(l.target.value),placeholder:"Department"}),c&&e.jsx("div",{className:"pinError",children:c}),e.jsx("button",{className:"btn btnPrimary pinBtn",type:"submit",disabled:d||n.trim().length<3||!o.trim()||!p.trim(),children:d?"Submitting...":"Request Access"})]}),e.jsx("button",{className:"btnLink",type:"button",onClick:()=>{i("signin"),r(""),a("")},children:"Already registered? Sign in"})]}),s==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pinTitle",children:"Pending Approval"}),e.jsx("div",{className:"pinSub",children:j||"Your access request is awaiting administrator approval."}),e.jsx("div",{className:"pendingIcon",children:"‚è≥"}),e.jsx("button",{className:"btnLink",type:"button",onClick:()=>{i("signin"),r(""),v(""),a("")},children:"Back to sign in"})]}),e.jsxs("div",{className:"pinFooter",children:[e.jsx("span",{className:"pinLock",children:"üîí"})," AES-256 encrypted ¬∑ stored only on this device"]})]})})}function ge(t,n){const a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=n,document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),URL.revokeObjectURL(a)},100)}const U={inspection:{label:"Kitchen Inspection",contextFields:[{key:"kitchen",label:"Kitchen / Location"},{key:"participants",label:"Participants"},{key:"date",label:"Date"},{key:"duration",label:"Duration"}],useCases:["Email Summary","Google Doc","Slack Update","Evaluation Scorecard"],sample:{meta:{inspectionType:"Event Day",inspectionDate:"2026-02-09",inspectorName:"J. Da Silva"},context:{kitchen:"Concourse Kitchen ‚Äî North Stand",participants:"Chef Lead, Sanitation Lead, Ops Manager",date:"2026-02-09",duration:"25 min"},inspection:{facility:{ceiling:{status:"OK",notes:"",photos:[]},walls:{status:"OK",notes:"",photos:[]},floors:{status:"Needs Attention",notes:"Slip hazard near mop sink.",photos:[]},lighting:{status:"Needs Attention",notes:"Bulb out over dish station.",photos:[]}},operations:{employeePractices:{status:"Needs Attention",notes:"Coaching on hot holding.",photos:[]},handwashing:{status:"OK",notes:"Soap low at one hand sink.",photos:[]},labelingDating:{status:"Needs Attention",notes:"A few unlabeled containers.",photos:[]},logs:{status:"Needs Attention",notes:"Chemical logs missing 2/7.",photos:[]}},temps:{handSinkTempF:96,threeCompSinkTempF:110},equipment:{doubleDoorCooler:{status:"OK",notes:"38¬∞F",photos:[]},doubleDoorFreezer:{status:"OK",notes:"",photos:[]},walkInCooler:{status:"OK",notes:"",photos:[]},warmers:{status:"Needs Attention",notes:"Hot hold 142¬∞F (borderline).",photos:[]},ovens:{status:"OK",notes:"",photos:[]},threeCompSink:{status:"OK",notes:"",photos:[]},ecolab:{status:"OK",notes:"Sanitizer 150 ppm",photos:[]}}},rawNotes:"sitdown after svc. recap insp: cooler 38F ok. hot hold 142F (border). q: when calibrate therms? last wk. found: 3 cutting boards scored. chem logs missing 2/7. pest trap behind dry storage shifted. action: replace boards, backfill logs, reset trap + pic, coach hot holding. owner: chef lead. due: Fri."}}},St=["OK","Not Clean","Needs Attention","N/A"],pe=6,De=8,wt=["Event Day","Post Event","Regular Inspection"],se={"Event Day":{headline:"Event Day Readiness",opening:"This is an Event Day inspection focused on pre-service readiness and risk control before peak volume."},"Post Event":{headline:"Post-Event Close-Out",opening:"This is a Post Event inspection focused on close-out conditions, cleanup effectiveness, and immediate corrective actions after service."},"Regular Inspection":{headline:"Routine Compliance Review",opening:"This is a Regular Inspection focused on routine compliance, sanitation standards, and repeat-risk prevention."}},kt=[[/\bw\//gi,"with"],[/\bKM\b/g,"Kitchen Manager"],[/\bq\b/gi,"question"],[/\btemp(s?)\b/gi,"temperature$1"],[/\bok\b/gi,"OK"],[/\bchk\b/gi,"check"],[/\bwk\b/gi,"week"],[/\b(\d+)x\b/gi,"$1√ó"],[/\binsp\b/gi,"inspection"],[/\bsvc\b/gi,"service"],[/\btherm(s?)\b/gi,"thermometer$1"],[/\bchem\b/gi,"chemical"],[/\bdocs?\b/gi,"document(s)"],[/\bpic\b/gi,"photo"],[/\bborder\b/gi,"borderline"]];function ae(t){let n=t;for(const[a,s]of kt)n=n.replace(a,s);return n}const Ct=[[/\bi\b/g,"I"],[/\bdoesnt\b/gi,"doesn't"],[/\bdidnt\b/gi,"didn't"],[/\bwasnt\b/gi,"wasn't"],[/\bwerent\b/gi,"weren't"],[/\bcant\b/gi,"can't"],[/\bwont\b/gi,"won't"],[/\bcouldnt\b/gi,"couldn't"],[/\bshouldnt\b/gi,"shouldn't"],[/\bwouldnt\b/gi,"wouldn't"],[/\bisnt\b/gi,"isn't"],[/\barent\b/gi,"aren't"],[/\bhasnt\b/gi,"hasn't"],[/\bhavent\b/gi,"haven't"],[/\btheyre\b/gi,"they're"],[/\btheres\b/gi,"there's"],[/\bwere\b(?!\s)/gi,"we're"],[/\bits\b(?=\s+[a-z])/gi,"it's"],[/\brecieved?\b/gi,"received"],[/\bseperately?\b/gi,"separately"],[/\boccured\b/gi,"occurred"],[/\buntill?\b/gi,"until"],[/\balot\b/gi,"a lot"],[/\bteh\b/gi,"the"],[/\bwich\b/gi,"which"],[/\bthere\s+is\b/gi,"there is"],[/\bthru\b/gi,"through"],[/\bppl\b/gi,"people"],[/\bmgr\b/gi,"manager"],[/\bmgmt\b/gi,"management"],[/\bequip\b/gi,"equipment"],[/\bmaint\b/gi,"maintenance"],[/\brefrig\b/gi,"refrigerator"],[/\binfo\b/gi,"information"],[/\bamt\b/gi,"amount"],[/\bapprox\b/gi,"approximately"],[/\bmin\b(?=\s|\.|\,|$)/gi,"minimum"],[/\bmax\b(?=\s|\.|\,|$)/gi,"maximum"],[/\bF\b(?=\s*[\.\,\)]|$)/g,"¬∞F"]],Ft=[{key:"action",patterns:[/\baction\b/i,/\breplace\b/i,/\bfix\b/i,/\brepair\b/i,/\bschedule\b/i,/\bcoach\b/i,/\bfollow\s*up\b/i,/\bbackfill\b/i,/\breset\b/i]},{key:"finding",patterns:[/\bfound\b/i,/\bnoted\b/i,/\bobserved\b/i,/\bscored\b/i,/\bmissing\b/i,/\bshifted\b/i,/\blow\b/i,/\bbroken\b/i,/\bdamaged\b/i,/\bflagged\b/i]},{key:"temp",patterns:[/\d+\s*¬∞?F/i,/\btemperature\b/i,/\bcooler\b/i,/\bfreezer\b/i,/\bhot\s*hold/i,/\bwarm/i]},{key:"question",patterns:[/\bquestion\b/i,/\basked\b/i,/\bwhen\b/i,/\?$/]},{key:"owner",patterns:[/\bowner\b/i,/\bdue\b/i,/\bassign/i,/\bchef\s*lead\b/i]},{key:"context",patterns:[/\bsitdown\b/i,/\bsit-down\b/i,/\brecap\b/i,/\bafter\b/i,/\bbefore\b/i,/\bduring\b/i]}];function It(t){for(const n of Ft)for(const a of n.patterns)if(a.test(t))return n.key;return"general"}const ie={context:"Context",finding:"Findings",temp:"Temperatures",question:"Questions",action:"Action Items",owner:"Ownership & Deadlines",general:"Notes"},oe=["context","temp","finding","question","action","owner","general"];function Tt(t){let n=t;for(const[a,s]of Ct)n=n.replace(a,s);return n=n.replace(/^\s*([a-z])/,(a,s)=>s.toUpperCase()),n=n.replace(/\s{2,}/g," "),n=n.trim(),n&&!/[.!?]$/.test(n)&&(n+="."),n}function le(t){if(!t||!t.trim())return{bullets:[],grouped:{}};const s=ae(t).split(/(?<=\.)\s+|;\s*|\n+/).map(o=>o.trim()).filter(o=>o.length>2).map(o=>Tt(o)),i={};for(const o of s){const m=It(o);i[m]||(i[m]=[]),i[m].push(o)}return{bullets:s,grouped:i}}function V(t){const{grouped:n}=le(t),a=[];for(const s of oe)if(!(!n[s]||!n[s].length)){a.push(`${ie[s]}:`);for(const i of n[s])a.push(`  ‚Ä¢ ${i}`);a.push("")}return a.join(`
`).trim()||t||""}function L(...t){return t.filter(Boolean).join(" ")}function Et(t){const n=U[t],a={};for(const s of n.contextFields)a[s.key]="";return a}function D(t){return{...t,photos:[]}}function $e(){return{facility:{ceiling:D({status:"OK",notes:""}),walls:D({status:"OK",notes:""}),floors:D({status:"OK",notes:""}),lighting:D({status:"OK",notes:""})},operations:{employeePractices:D({status:"OK",notes:""}),handwashing:D({status:"OK",notes:""}),labelingDating:D({status:"OK",notes:""}),logs:D({status:"OK",notes:""})},temps:{handSinkTempF:"",threeCompSinkTempF:""},equipment:{doubleDoorCooler:D({status:"OK",notes:""}),doubleDoorFreezer:D({status:"OK",notes:""}),walkInCooler:D({status:"OK",notes:""}),warmers:D({status:"OK",notes:""}),ovens:D({status:"OK",notes:""}),threeCompSink:D({status:"OK",notes:""}),ecolab:D({status:"OK",notes:""})}}}function At(t,n){return`${U[t].label} ‚Üí ${n}`}function me(t,n){return n.reduce((a,s)=>a?a[s]:void 0,t)}function J(t,n,a){const[s,...i]=n;return s?{...t,[s]:i.length?J(t?.[s]??{},i,a):a}:a}function Oe(t){return Math.round(t/(1024*1024)*10)/10}function Dt(t){return new Promise(n=>{const a=new FileReader;a.onload=()=>n(String(a.result)),a.readAsDataURL(t)})}function B(t){return String(t||"").trim()}function ze(t){const a=String(t||"").match(/action\s*:\s*([\s\S]+)/i);return a?a[1].split(/next\s*chk|next\s*check|follow\s*up|owner\s*:/i)[0].trim().split(",").map(i=>B(i)).filter(Boolean).map(i=>({issue:i})):[]}function _(t){const n=[],a=o=>{if(!(!o||typeof o!="object")){o.status&&(o.status==="Needs Attention"||o.status==="Not Clean")&&n.push(!0);for(const m of Object.keys(o))a(o[m])}};a(t?.facility),a(t?.operations),a(t?.equipment);const s=Number(t?.temps?.handSinkTempF),i=Number(t?.temps?.threeCompSinkTempF);return!Number.isNaN(s)&&s&&s<95&&n.push(!0),!Number.isNaN(i)&&i&&i<110&&n.push(!0),n.length?"Needs Attention":"Pass"}function $t({inspectionDate:t,inspectorName:n,context:a,noteType:s,inspection:i}){const o=[];t||o.push("Inspection Date is missing"),n||o.push("Inspector Name is missing");const m=U[s].contextFields;for(const p of m)a[p.key]?.trim()||o.push(`${p.label} is missing`);return i.temps.handSinkTempF||o.push("Hand sink temperature not recorded"),i.temps.threeCompSinkTempF||o.push("3-comp sink temperature not recorded"),o}function Ot({noteType:t,context:n,inspection:a,inspectionType:s,inspectionDate:i,siteName:o,siteNumber:m}){const p=_(a),u=o||n?.kitchen||"Kitchen",c=m?` (#${m})`:"",r=i||n?.date||"Date",d=s?` ‚Äì ${s}`:"";return`Subject: ${u}${c} Kitchen Inspection${d} ‚Äì ${r} ‚Äì ${p}`}function fe(t){const n=[["facility","ceiling","Facility > Ceiling"],["facility","walls","Facility > Walls"],["facility","floors","Facility > Floors"],["facility","lighting","Facility > Lighting"],["operations","employeePractices","Operations > Employee practices"],["operations","handwashing","Operations > Handwashing / supplies"],["operations","labelingDating","Operations > Labeling / dating"],["operations","logs","Operations > Logs / documentation"],["equipment","doubleDoorCooler","Equipment > Double-door cooler"],["equipment","doubleDoorFreezer","Equipment > Double-door freezer"],["equipment","walkInCooler","Equipment > Walk-in cooler"],["equipment","warmers","Equipment > Warmers / hot holding"],["equipment","ovens","Equipment > Ovens"],["equipment","threeCompSink","Equipment > 3-compartment sink"],["equipment","ecolab","Equipment > Ecolab / chemicals"]];let a=0;const s=[],i={};for(const[o,m,p]of n){const u=t?.[o]?.[m],c=u?.photos||[];if(!c.length)continue;const r=`${o}.${m}`;i[r]=[];for(const d of c){a+=1,i[r].push(a);const y=B(u?.notes)||B(d?.name)||"";s.push({num:a,label:p,caption:y})}}return{index:s,mapByPath:i}}function z({inspection:t,rawNotes:n}){const a=[],{mapByPath:s}=fe(t),i=(u,c,r)=>{r?.status&&(r.status==="Needs Attention"||r.status==="Not Clean")&&a.push({issue:`${c}: ${B(r.notes)||"Issue noted"}`,owner:"",due:"",priority:r.status==="Not Clean"?"High":"Med",photos:s[u]||[]})};i("facility.ceiling","Ceiling",t?.facility?.ceiling),i("facility.walls","Walls",t?.facility?.walls),i("facility.floors","Floors",t?.facility?.floors),i("facility.lighting","Lighting",t?.facility?.lighting),i("operations.employeePractices","Employee practices",t?.operations?.employeePractices),i("operations.handwashing","Handwashing / supplies",t?.operations?.handwashing),i("operations.labelingDating","Labeling / dating",t?.operations?.labelingDating),i("operations.logs","Logs / documentation",t?.operations?.logs),i("equipment.doubleDoorCooler","Double-door cooler",t?.equipment?.doubleDoorCooler),i("equipment.doubleDoorFreezer","Double-door freezer",t?.equipment?.doubleDoorFreezer),i("equipment.walkInCooler","Walk-in cooler",t?.equipment?.walkInCooler),i("equipment.warmers","Warmers / hot holding",t?.equipment?.warmers),i("equipment.ovens","Ovens",t?.equipment?.ovens),i("equipment.threeCompSink","3-compartment sink",t?.equipment?.threeCompSink),i("equipment.ecolab","Ecolab / chemicals",t?.equipment?.ecolab);const o=Number(t?.temps?.handSinkTempF);!Number.isNaN(o)&&o&&o<95&&a.push({issue:`Hand sink temperature below minimum: ${o}¬∞F (min 95¬∞F)`,owner:"",due:"",priority:"High",photos:[]});const m=Number(t?.temps?.threeCompSinkTempF);!Number.isNaN(m)&&m&&m<110&&a.push({issue:`3-compartment sink wash temperature below minimum: ${m}¬∞F (min 110¬∞F)`,owner:"",due:"",priority:"High",photos:[]});for(const u of ze(n))a.push({issue:u.issue,owner:"",due:"",priority:"Med",photos:[]});const p=new Set;return a.filter(u=>{const c=u.issue.toLowerCase();return p.has(c)?!1:(p.add(c),!0)})}function Ge(t){const n=`| Issue | Owner | Due | Priority | Photo # |
|---|---|---|---|---|`,a=t.map(s=>{const i=(s.photos||[]).length?s.photos.join(", "):"";return`| ${B(s.issue)} | ${B(s.owner)} | ${B(s.due)} | ${B(s.priority)} | ${i} |`}).join(`
`);return`${n}
${a||"|  |  |  |  |  |"}`}function Le({noteType:t,context:n,inspection:a,rawNotes:s,inspectionType:i,inspectionDate:o,inspectorName:m,siteName:p,siteNumber:u,sitePhone:c,supervisorName:r}){const d=se[i]||se["Regular Inspection"],y=Ot({noteType:t,context:n,inspection:a,inspectionType:i,inspectionDate:o,siteName:p,siteNumber:u}),j=_(a),v=z({inspection:a,rawNotes:s}),{index:w}=fe(a),I=p||n?.kitchen||"Kitchen",N=u?` (#${u})`:"",l=o||n?.date||"‚Äî",h=[`- Inspection Type: ${i||"‚Äî"}`,`- Site: ${I}${N}`,`- Date: ${l}`,`- Inspector: ${m||"‚Äî"}`,`- Supervisor: ${r||"‚Äî"}`,c?`- Site Phone: ${c}`:null,`- Overall Status: ${j}`].filter(Boolean).join(`
`),S=[`- siteName: ${p||"‚Äî"}`,`- siteNumber: ${u||"‚Äî"}`,`- supervisorName: ${r||"‚Äî"}`,c?`- sitePhone: ${c}`:null,...Object.entries(n||{}).map(([A,f])=>`- ${A}: ${f||"‚Äî"}`)].filter(Boolean).join(`
`),C=w.length?w.map(A=>`Photo ${A.num} ‚Äî ${A.label}${A.caption?` ‚Äî ${A.caption}`:""}`).join(`
`):"No photos attached.",F=[],b=(A,f)=>{f&&f.status&&f.status!=="OK"&&f.status!=="N/A"&&F.push(`- ${A}: ${f.status}${f.notes?` ‚Äî ${f.notes}`:""}`)};b("Facility > Ceiling",a?.facility?.ceiling),b("Facility > Walls",a?.facility?.walls),b("Facility > Floors",a?.facility?.floors),b("Facility > Lighting",a?.facility?.lighting),b("Operations > Employee practices",a?.operations?.employeePractices),b("Operations > Handwashing / supplies",a?.operations?.handwashing),b("Operations > Labeling / dating",a?.operations?.labelingDating),b("Operations > Logs / documentation",a?.operations?.logs),b("Equipment > Double-door cooler",a?.equipment?.doubleDoorCooler),b("Equipment > Double-door freezer",a?.equipment?.doubleDoorFreezer),b("Equipment > Walk-in cooler",a?.equipment?.walkInCooler),b("Equipment > Warmers / hot holding",a?.equipment?.warmers),b("Equipment > Ovens",a?.equipment?.ovens),b("Equipment > 3-compartment sink",a?.equipment?.threeCompSink),b("Equipment > Ecolab / chemicals",a?.equipment?.ecolab);const E=Number(a?.temps?.handSinkTempF),k=Number(a?.temps?.threeCompSinkTempF);!Number.isNaN(E)&&E&&E<95&&F.push(`- Temps > Hand sink: ${E}¬∞F (below 95¬∞F minimum)`),!Number.isNaN(k)&&k&&k<110&&F.push(`- Temps > 3-comp wash: ${k}¬∞F (below 110¬∞F minimum)`);const q=F.length?F.join(`
`):"- No exceptions noted from checklist/temps.",P=v.filter(A=>A.priority==="High").map(A=>`- ${A.issue}${A.photos?.length?` (Photo ${A.photos.join(", ")})`:""}`).join(`
`)||(i==="Event Day"?"- No critical blockers identified for service.":"- No critical issues flagged.");return[y,"","Hi team,","",d.opening,"",`## ${d.headline} ‚Äî Snapshot`,h,"","## Context (from sit-down notes)",S||"- ‚Äî","","## Critical Risks",P,"","## Findings by Area",q,"","## Corrective Actions (please assign Owner + Due)",Ge(v),"","## Photo Index",C,"","## Inspector Notes (organized)",V(s)||"‚Äî"].join(`
`)}function Lt({noteType:t,useCase:n,context:a,inspection:s,rawNotes:i,inspectionType:o,inspectionDate:m,inspectorName:p,siteName:u,siteNumber:c,sitePhone:r,supervisorName:d}){const y=_(s),j=z({inspection:s,rawNotes:i});ae(i);const v=u||a?.kitchen||"Kitchen",w=m||a?.date||"‚Äî";if(n==="Email Summary")return Le({noteType:t,context:a,inspection:s,rawNotes:i,inspectionType:o,inspectionDate:m,inspectorName:p,siteName:u,siteNumber:c,sitePhone:r,supervisorName:d});if(n==="Slack Update"){const I=[`*${o||"Inspection"} ‚Äî ${v} ‚Äî ${w}*`,`Inspector: ${p||"‚Äî"} | Status: *${y}*`,"","*Summary:*",V(i),""];if(j.length){I.push(`*Action Items (${j.length}):*`);for(const N of j)I.push(`  ‚Ä¢ [${N.priority}] ${N.issue}`)}else I.push("No corrective actions needed.");return I.join(`
`)}if(n==="Google Doc"){const I=[`# ${o||"Inspection"} ‚Äî ${v}`,`Date: ${w} | Inspector: ${p||"‚Äî"} | Supervisor: ${d||"‚Äî"}`,`Overall Status: ${y}`,"","## Inspector Notes",V(i),"","## Findings"],N=(l,h)=>{h?.status&&h.status!=="OK"&&h.status!=="N/A"&&I.push(`- **${l}**: ${h.status}${h.notes?` ‚Äî ${h.notes}`:""}`)};return N("Ceiling",s?.facility?.ceiling),N("Walls",s?.facility?.walls),N("Floors",s?.facility?.floors),N("Lighting",s?.facility?.lighting),N("Employee practices",s?.operations?.employeePractices),N("Handwashing",s?.operations?.handwashing),N("Labeling / dating",s?.operations?.labelingDating),N("Logs",s?.operations?.logs),N("Double-door cooler",s?.equipment?.doubleDoorCooler),N("Double-door freezer",s?.equipment?.doubleDoorFreezer),N("Walk-in cooler",s?.equipment?.walkInCooler),N("Warmers",s?.equipment?.warmers),N("Ovens",s?.equipment?.ovens),N("3-compartment sink",s?.equipment?.threeCompSink),N("Ecolab / chemicals",s?.equipment?.ecolab),I[I.length-1]==="## Findings"&&I.push("- All areas OK."),I.push("","## Action Items"),j.length?I.push(Ge(j)):I.push("No corrective actions needed."),I.join(`
`)}if(n==="Evaluation Scorecard"){const I=[{title:"Facility",items:[["Ceiling",s?.facility?.ceiling],["Walls",s?.facility?.walls],["Floors",s?.facility?.floors],["Lighting",s?.facility?.lighting]]},{title:"Operations",items:[["Employee practices",s?.operations?.employeePractices],["Handwashing",s?.operations?.handwashing],["Labeling / dating",s?.operations?.labelingDating],["Logs",s?.operations?.logs]]},{title:"Equipment",items:[["Double-door cooler",s?.equipment?.doubleDoorCooler],["Double-door freezer",s?.equipment?.doubleDoorFreezer],["Walk-in cooler",s?.equipment?.walkInCooler],["Warmers",s?.equipment?.warmers],["Ovens",s?.equipment?.ovens],["3-comp sink",s?.equipment?.threeCompSink],["Ecolab",s?.equipment?.ecolab]]}],N=["EVALUATION SCORECARD",`${"=".repeat(50)}`,`${o||"Inspection"} ‚Äî ${v} ‚Äî ${w}`,`Inspector: ${p||"‚Äî"}`,`Overall: ${y}`,""];for(const S of I){N.push(`--- ${S.title.toUpperCase()} ---`);for(const[C,F]of S.items){const b=F?.status||"N/A",E=b==="OK"?"[PASS]":b==="N/A"?"[ -- ]":"[FAIL]";N.push(`  ${E} ${C}${F?.notes?` ‚Äî ${F.notes}`:""}`)}N.push("")}N.push("--- TEMPERATURES ---");const l=s?.temps?.handSinkTempF,h=s?.temps?.threeCompSinkTempF;N.push(`  Hand sink: ${l||"‚Äî"}¬∞F ${Number(l)>=95?"[PASS]":l?"[FAIL]":""}`),N.push(`  3-comp wash: ${h||"‚Äî"}¬∞F ${Number(h)>=110?"[PASS]":h?"[FAIL]":""}`),N.push("",`--- ACTION ITEMS (${j.length}) ---`);for(const S of j)N.push(`  [${S.priority}] ${S.issue}`);return j.length||N.push("  None."),N.push("","--- INSPECTOR NOTES ---",V(i)),N.join(`
`)}return Le({noteType:t,context:a,inspection:s,rawNotes:i,inspectionType:o,inspectionDate:m,inspectorName:p,siteName:u,siteNumber:c,sitePhone:r,supervisorName:d})}function qe({inspection:t,rawNotes:n,context:a,noteType:s}){const i=[],o=(n||"").toLowerCase(),m=(r,d)=>{d?.status==="Needs Attention"&&!d?.notes?.trim()&&i.push(`"${r}" is flagged Needs Attention but has no notes ‚Äî add details so corrective actions are clear.`),d?.status==="Not Clean"&&!d?.notes?.trim()&&i.push(`"${r}" is flagged Not Clean but has no notes ‚Äî describe the issue for the report.`)};m("Ceiling",t?.facility?.ceiling),m("Walls",t?.facility?.walls),m("Floors",t?.facility?.floors),m("Lighting",t?.facility?.lighting),m("Employee practices",t?.operations?.employeePractices),m("Handwashing",t?.operations?.handwashing),m("Labeling / dating",t?.operations?.labelingDating),m("Logs",t?.operations?.logs),m("Double-door cooler",t?.equipment?.doubleDoorCooler),m("Double-door freezer",t?.equipment?.doubleDoorFreezer),m("Walk-in cooler",t?.equipment?.walkInCooler),m("Warmers",t?.equipment?.warmers),m("Ovens",t?.equipment?.ovens),m("3-compartment sink",t?.equipment?.threeCompSink),m("Ecolab / chemicals",t?.equipment?.ecolab);const p=Number(t?.temps?.handSinkTempF),u=Number(t?.temps?.threeCompSinkTempF);p&&p<95&&i.push(`Hand sink temp is ${p}¬∞F (below 95¬∞F min). Flag for immediate maintenance.`),u&&u<110&&i.push(`3-comp sink wash temp is ${u}¬∞F (below 110¬∞F min). Check water heater.`),p&&p>=95&&p<100&&i.push(`Hand sink temp is ${p}¬∞F ‚Äî passes but is close to the 95¬∞F minimum. Monitor.`),u&&u>=110&&u<115&&i.push(`3-comp wash temp is ${u}¬∞F ‚Äî passes but is close to the 110¬∞F minimum. Monitor.`),o.includes("allergen")&&i.push("Allergen concerns detected in notes ‚Äî ensure allergen training is scheduled and documented."),o.includes("haccp")&&i.push("HACCP mentioned ‚Äî verify all HACCP logs are complete and signed before next inspection."),(o.includes("pest")||o.includes("trap"))&&i.push("Pest control mentioned ‚Äî document trap locations and schedule pest vendor follow-up."),(o.includes("cutting board")||o.includes("scored"))&&i.push("Scored cutting boards noted ‚Äî replace immediately per food safety protocol."),o.includes("calibrat")&&i.push("Thermometer calibration mentioned ‚Äî document last calibration date and schedule next.");const c=ze(n);return c.length>3&&i.push(`${c.length} action items found in notes ‚Äî consider prioritizing the top 3 for immediate follow-up.`),i.length||i.push("No issues detected. Inspection looks clean!"),i}function qt({noteType:t,useCase:n,context:a,inspection:s,rawNotes:i,inspectionType:o,inspectionDate:m,inspectorName:p,siteName:u,siteNumber:c,sitePhone:r,supervisorName:d}){const y=_(s),j=z({inspection:s,rawNotes:i});ae(i);const v=u||a?.kitchen||"Kitchen",w=m||a?.date||new Date().toLocaleDateString(),I=se[o]||se["Regular Inspection"],{index:N}=fe(s),l=Number(s?.temps?.handSinkTempF),h=Number(s?.temps?.threeCompSinkTempF),S=[{section:"Facility",label:"Ceiling",node:s?.facility?.ceiling},{section:"Facility",label:"Walls",node:s?.facility?.walls},{section:"Facility",label:"Floors",node:s?.facility?.floors},{section:"Facility",label:"Lighting",node:s?.facility?.lighting},{section:"Operations",label:"Employee Practices",node:s?.operations?.employeePractices},{section:"Operations",label:"Handwashing / Supplies",node:s?.operations?.handwashing},{section:"Operations",label:"Labeling / Dating",node:s?.operations?.labelingDating},{section:"Operations",label:"Logs / Documentation",node:s?.operations?.logs},{section:"Equipment",label:"Double-Door Cooler",node:s?.equipment?.doubleDoorCooler},{section:"Equipment",label:"Double-Door Freezer",node:s?.equipment?.doubleDoorFreezer},{section:"Equipment",label:"Walk-In Cooler",node:s?.equipment?.walkInCooler},{section:"Equipment",label:"Warmers / Hot Holding",node:s?.equipment?.warmers},{section:"Equipment",label:"Ovens",node:s?.equipment?.ovens},{section:"Equipment",label:"3-Compartment Sink",node:s?.equipment?.threeCompSink},{section:"Equipment",label:"Ecolab / Chemicals",node:s?.equipment?.ecolab}],C=S.filter(b=>b.node?.status&&b.node.status!=="OK"&&b.node.status!=="N/A");l&&l<95&&C.push({section:"Temperature",label:"Hand Sink",node:{status:"Not Clean",notes:`${l}¬∞F (below 95¬∞F minimum)`}}),h&&h<110&&C.push({section:"Temperature",label:"3-Comp Wash",node:{status:"Not Clean",notes:`${h}¬∞F (below 110¬∞F minimum)`}});const F=["Facility","Operations","Equipment"];return e.jsxs("div",{className:"rpt",children:[e.jsxs("div",{className:"rptHeader",children:[e.jsx("img",{src:He,alt:"Sodexo",className:"rptLogo"}),e.jsxs("div",{className:"rptHeaderRight",children:[e.jsx("div",{className:"rptDocType",children:o||"Kitchen Inspection"}),e.jsxs("div",{className:"rptDocId",children:["Report #",Date.now().toString(36).toUpperCase()]})]})]}),e.jsxs("div",{className:"rptTitleBar",children:[e.jsxs("div",{children:[e.jsx("div",{className:"rptTitle",children:v}),e.jsx("div",{className:"rptDate",children:w})]}),e.jsx("div",{className:L("rptStatus",y==="Pass"?"rptStatusPass":"rptStatusFail"),children:y==="Pass"?"PASSED":"NEEDS ATTENTION"})]}),e.jsxs("div",{className:"rptInfoGrid",children:[e.jsxs("div",{className:"rptInfoItem",children:[e.jsx("div",{className:"rptInfoLabel",children:"Inspector"}),e.jsx("div",{className:"rptInfoValue",children:p||"‚Äî"})]}),e.jsxs("div",{className:"rptInfoItem",children:[e.jsx("div",{className:"rptInfoLabel",children:"Supervisor"}),e.jsx("div",{className:"rptInfoValue",children:d||"‚Äî"})]}),e.jsxs("div",{className:"rptInfoItem",children:[e.jsx("div",{className:"rptInfoLabel",children:"Unit / Location"}),e.jsx("div",{className:"rptInfoValue",children:c||"‚Äî"})]}),r&&e.jsxs("div",{className:"rptInfoItem",children:[e.jsx("div",{className:"rptInfoLabel",children:"Phone"}),e.jsx("div",{className:"rptInfoValue",children:r})]}),e.jsxs("div",{className:"rptInfoItem",children:[e.jsx("div",{className:"rptInfoLabel",children:"Hand Sink Temp"}),e.jsxs("div",{className:"rptInfoValue",children:[s?.temps?.handSinkTempF?`${s.temps.handSinkTempF}¬∞F`:"‚Äî",l>=95&&e.jsx("span",{className:"rptCheck",children:" ‚úÖ"}),l>0&&l<95&&e.jsx("span",{className:"rptWarn",children:" ‚ö†Ô∏è Below 95¬∞F"})]})]}),e.jsxs("div",{className:"rptInfoItem",children:[e.jsx("div",{className:"rptInfoLabel",children:"3-Comp Wash Temp"}),e.jsxs("div",{className:"rptInfoValue",children:[s?.temps?.threeCompSinkTempF?`${s.temps.threeCompSinkTempF}¬∞F`:"‚Äî",h>=110&&e.jsx("span",{className:"rptCheck",children:" ‚úÖ"}),h>0&&h<110&&e.jsx("span",{className:"rptWarn",children:" ‚ö†Ô∏è Below 110¬∞F"})]})]})]}),(n==="Email Summary"||n==="Google Doc")&&I.opening&&e.jsx("div",{className:"rptBlock",children:e.jsx("p",{className:"rptParagraph",children:I.opening})}),e.jsxs("div",{className:"rptBlock",children:[e.jsx("div",{className:"rptBlockTitle",children:"Inspection Scorecard"}),e.jsxs("table",{className:"rptTable",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Section"}),e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Notes"})]})}),e.jsxs("tbody",{children:[F.map(b=>{const E=S.filter(k=>k.section===b);return E.map((k,q)=>e.jsxs("tr",{className:k.node?.status==="Not Clean"?"rptRowFail":k.node?.status==="Needs Attention"?"rptRowWarn":"",children:[q===0&&e.jsx("td",{rowSpan:E.length,className:"rptSectionCell",children:b}),e.jsx("td",{children:k.label}),e.jsx("td",{children:e.jsx("span",{className:L("rptStatusPill",k.node?.status==="OK"?"rptPillPass":k.node?.status==="Not Clean"?"rptPillFail":k.node?.status==="Needs Attention"?"rptPillWarn":"rptPillNa"),children:k.node?.status||"N/A"})}),e.jsx("td",{className:"rptNoteCell",children:k.node?.notes||"‚Äî"})]},k.label))}),e.jsxs("tr",{className:l>0&&l<95?"rptRowFail":"",children:[e.jsx("td",{rowSpan:2,className:"rptSectionCell",children:"Temps"}),e.jsx("td",{children:"Hand Sink"}),e.jsx("td",{children:e.jsx("span",{className:L("rptStatusPill",l>=95?"rptPillPass":l?"rptPillFail":"rptPillNa"),children:s?.temps?.handSinkTempF?`${s.temps.handSinkTempF}¬∞F`:"N/A"})}),e.jsx("td",{className:"rptNoteCell",children:l>=95?"Meets minimum":l?"Below 95¬∞F minimum":"‚Äî"})]}),e.jsxs("tr",{className:h>0&&h<110?"rptRowFail":"",children:[e.jsx("td",{children:"3-Comp Wash"}),e.jsx("td",{children:e.jsx("span",{className:L("rptStatusPill",h>=110?"rptPillPass":h?"rptPillFail":"rptPillNa"),children:s?.temps?.threeCompSinkTempF?`${s.temps.threeCompSinkTempF}¬∞F`:"N/A"})}),e.jsx("td",{className:"rptNoteCell",children:h>=110?"Meets minimum":h?"Below 110¬∞F minimum":"‚Äî"})]})]})]})]}),C.length>0&&e.jsxs("div",{className:"rptBlock rptBlockAlert",children:[e.jsxs("div",{className:"rptBlockTitle rptBlockTitleAlert",children:["Issues Found (",C.length,")"]}),C.map((b,E)=>e.jsxs("div",{className:"rptIssueRow",children:[e.jsx("span",{className:"rptIssueNum",children:E+1}),e.jsxs("div",{className:"rptIssueContent",children:[e.jsxs("div",{className:"rptIssueName",children:[b.label," ",e.jsxs("span",{className:"rptIssueSection",children:["(",b.section,")"]})]}),b.node?.notes&&e.jsx("div",{className:"rptIssueDetail",children:b.node.notes})]}),e.jsx("span",{className:L("rptStatusPill",b.node?.status==="Not Clean"?"rptPillFail":"rptPillWarn"),children:b.node?.status})]},E))]}),j.length>0&&e.jsxs("div",{className:"rptBlock",children:[e.jsx("div",{className:"rptBlockTitle",children:"Corrective Actions Required"}),j.map((b,E)=>e.jsxs("div",{className:"rptActionRow",children:[e.jsx("span",{className:L("rptPriorityDot",b.priority==="High"?"rptDotHigh":"rptDotMed")}),e.jsxs("div",{className:"rptActionContent",children:[e.jsx("span",{className:"rptActionText",children:b.issue}),e.jsxs("span",{className:L("rptPriorityLabel",b.priority==="High"?"rptLabelHigh":"rptLabelMed"),children:[b.priority," Priority"]})]})]},E))]}),N.length>0&&e.jsxs("div",{className:"rptBlock",children:[e.jsx("div",{className:"rptBlockTitle",children:"Photo Index"}),e.jsx("div",{className:"rptPhotoList",children:N.map(b=>e.jsxs("div",{className:"rptPhotoItem",children:[e.jsxs("span",{className:"rptPhotoNum",children:["Photo #",b.num]}),e.jsxs("span",{children:[b.label,b.caption?` ‚Äî ${b.caption}`:""]})]},b.num))})]}),i&&(()=>{const{grouped:b}=le(i);return Object.values(b).some(k=>k.length>0)?e.jsxs("div",{className:"rptBlock",children:[e.jsx("div",{className:"rptBlockTitle",children:"Inspector Notes"}),e.jsx("div",{className:"rptNotesOrganized",children:oe.map(k=>!b[k]||!b[k].length?null:e.jsxs("div",{className:"rptNoteCategory",children:[e.jsx("div",{className:L("rptNoteCatLabel",`rptNoteCat--${k}`),children:ie[k]}),e.jsx("ul",{className:"rptNoteBullets",children:b[k].map((q,O)=>e.jsx("li",{children:q},O))})]},k))})]}):null})(),e.jsxs("div",{className:"rptFooter",children:[e.jsxs("div",{children:["Generated ",new Date().toLocaleDateString()," ",new Date().toLocaleTimeString()," ¬∑ Sodexo Kitchen Inspection System"]}),e.jsx("div",{children:"This report is confidential and intended for internal use only."})]})]})}function Rt({inspection:t,rawNotes:n,inspectionType:a,inspectionDate:s,inspectorName:i,siteName:o,siteNumber:m,supervisorName:p}){const u=[["Section","Item","Status","Notes","Priority"]],c=(r,d,y)=>{if(!y)return;const j=y.status==="Not Clean"?"High":y.status==="Needs Attention"?"Med":"";u.push([r,d,y.status||"",(y.notes||"").replace(/"/g,'""'),j])};return c("Facility","Ceiling",t?.facility?.ceiling),c("Facility","Walls",t?.facility?.walls),c("Facility","Floors",t?.facility?.floors),c("Facility","Lighting",t?.facility?.lighting),c("Operations","Employee practices",t?.operations?.employeePractices),c("Operations","Handwashing / supplies",t?.operations?.handwashing),c("Operations","Labeling / dating",t?.operations?.labelingDating),c("Operations","Logs / documentation",t?.operations?.logs),c("Equipment","Double-door cooler",t?.equipment?.doubleDoorCooler),c("Equipment","Double-door freezer",t?.equipment?.doubleDoorFreezer),c("Equipment","Walk-in cooler",t?.equipment?.walkInCooler),c("Equipment","Warmers / hot holding",t?.equipment?.warmers),c("Equipment","Ovens",t?.equipment?.ovens),c("Equipment","3-compartment sink",t?.equipment?.threeCompSink),c("Equipment","Ecolab / chemicals",t?.equipment?.ecolab),u.push(["Temps","Hand sink (F)",t?.temps?.handSinkTempF||"",Number(t?.temps?.handSinkTempF)>=95?"Pass":"Below min",""]),u.push(["Temps","3-comp wash (F)",t?.temps?.threeCompSinkTempF||"",Number(t?.temps?.threeCompSinkTempF)>=110?"Pass":"Below min",""]),u}function Pt({inspection:t,rawNotes:n,inspectionType:a,inspectionDate:s,inspectorName:i,siteName:o,siteNumber:m,supervisorName:p}){const u=Rt({inspection:t,rawNotes:n,inspectionType:a,inspectionDate:s,inspectorName:i,siteName:o,siteNumber:m,supervisorName:p}),c=_(t),r=z({inspection:t,rawNotes:n}),d=`<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
<head><meta charset="utf-8">
<!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>
<x:Name>Inspection</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions>
</x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]-->
<style>
  td, th { mso-number-format:"\\@"; padding: 6px 10px; border: 1px solid #ccc; font-family: Calibri, Arial; font-size: 11pt; }
  th { background: #2A295C; color: white; font-weight: bold; }
  .section-header { background: #F0F1F5; font-weight: bold; color: #2A295C; font-size: 12pt; }
  .pass { background: #ECFDF5; color: #15803D; font-weight: bold; }
  .fail { background: #FEF2F2; color: #DC2626; font-weight: bold; }
  .warn { background: #FFFBEB; color: #D97706; }
  .meta-label { font-weight: bold; color: #2A295C; background: #F7F8FA; }
  .title { font-size: 16pt; font-weight: bold; color: #2A295C; }
</style></head><body>
<table>
  <tr><td class="title" colspan="5">SODEXO KITCHEN INSPECTION REPORT</td></tr>
  <tr><td colspan="5" style="border-bottom: 3px solid #EE0000; padding: 0;"></td></tr>
  <tr><td class="meta-label">Inspection Type</td><td colspan="4">${a||""}</td></tr>
  <tr><td class="meta-label">Date</td><td colspan="4">${s||""}</td></tr>
  <tr><td class="meta-label">Inspector</td><td colspan="4">${i||""}</td></tr>
  <tr><td class="meta-label">Site / Location</td><td colspan="4">${o||""}</td></tr>
  <tr><td class="meta-label">Unit #</td><td colspan="4">${m||""}</td></tr>
  <tr><td class="meta-label">Supervisor</td><td colspan="4">${p||""}</td></tr>
  <tr><td class="meta-label">Overall Status</td><td colspan="4" class="${c==="Pass"?"pass":"fail"}">${c}</td></tr>
  <tr><td colspan="5"></td></tr>
  <tr><td class="section-header" colspan="5">INSPECTION SCORECARD</td></tr>
  <tr><th>Section</th><th>Item</th><th>Status</th><th>Notes</th><th>Priority</th></tr>
  ${u.slice(1).map(v=>{const w=v[2]==="OK"?"pass":v[2]==="Not Clean"?"fail":v[2]==="Needs Attention"?"warn":"";return`<tr><td>${v[0]}</td><td>${v[1]}</td><td class="${w}">${v[2]}</td><td>${v[3]}</td><td>${v[4]}</td></tr>`}).join(`
  `)}
  <tr><td colspan="5"></td></tr>
  ${r.length>0?`
  <tr><td class="section-header" colspan="5">CORRECTIVE ACTIONS</td></tr>
  <tr><th>#</th><th colspan="3">Issue</th><th>Priority</th></tr>
  ${r.map((v,w)=>`<tr><td>${w+1}</td><td colspan="3">${v.issue}</td><td class="${v.priority==="High"?"fail":"warn"}">${v.priority}</td></tr>`).join(`
  `)}
  <tr><td colspan="5"></td></tr>`:""}
  <tr><td class="section-header" colspan="5">INSPECTOR NOTES</td></tr>
  <tr><td colspan="5" style="white-space:pre-wrap;font-size:10pt;">${V(n).replace(/</g,"&lt;")}</td></tr>
</table></body></html>`,y=new Blob([d],{type:"application/vnd.ms-excel"}),j=`inspection_${s||"undated"}_${(o||"site").replace(/\s+/g,"_")}.xls`;ge(y,j)}function Je({output:t,inspection:n,rawNotes:a,inspectionType:s,inspectionDate:i,siteName:o,siteNumber:m,sitePhone:p,inspectorName:u,supervisorName:c}){const r=_(n),d=z({inspection:n,rawNotes:a});ae(a);const y=[["Facility","Ceiling",n?.facility?.ceiling],["Facility","Walls",n?.facility?.walls],["Facility","Floors",n?.facility?.floors],["Facility","Lighting",n?.facility?.lighting],["Operations","Employee Practices",n?.operations?.employeePractices],["Operations","Handwashing / Supplies",n?.operations?.handwashing],["Operations","Labeling / Dating",n?.operations?.labelingDating],["Operations","Logs / Documentation",n?.operations?.logs],["Equipment","Double-Door Cooler",n?.equipment?.doubleDoorCooler],["Equipment","Double-Door Freezer",n?.equipment?.doubleDoorFreezer],["Equipment","Walk-In Cooler",n?.equipment?.walkInCooler],["Equipment","Warmers / Hot Holding",n?.equipment?.warmers],["Equipment","Ovens",n?.equipment?.ovens],["Equipment","3-Compartment Sink",n?.equipment?.threeCompSink],["Equipment","Ecolab / Chemicals",n?.equipment?.ecolab]],j=y.filter(([,,h])=>h?.status&&h.status!=="OK"&&h.status!=="N/A"),v=Number(n?.temps?.handSinkTempF),w=Number(n?.temps?.threeCompSinkTempF),I=`<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">
<head><meta charset="utf-8">
<!--[if gte mso 9]><xml><w:WordDocument><w:View>Print</w:View><w:Zoom>100</w:Zoom></w:WordDocument></xml><![endif]-->
<style>
  @page { size: letter; margin: 1in; }
  body { font-family: Calibri, Arial, sans-serif; font-size: 11pt; color: #1F2937; line-height: 1.5; }
  h1 { color: #2A295C; font-size: 22pt; margin-bottom: 4px; }
  h2 { color: #2A295C; font-size: 14pt; border-bottom: 2px solid #2A295C; padding-bottom: 4px; margin-top: 24px; }
  .red-line { border-bottom: 3px solid #EE0000; margin-bottom: 20px; }
  .info-table { width: 100%; border-collapse: collapse; margin: 16px 0; }
  .info-table td { padding: 8px 12px; border: 1px solid #E5E7EB; font-size: 10pt; }
  .info-label { background: #F7F8FA; font-weight: bold; color: #2A295C; width: 30%; }
  .status-pass { background: #ECFDF5; color: #15803D; font-weight: bold; font-size: 12pt; text-align: center; padding: 10px; }
  .status-fail { background: #FEF2F2; color: #DC2626; font-weight: bold; font-size: 12pt; text-align: center; padding: 10px; }
  table.scorecard { width: 100%; border-collapse: collapse; margin: 12px 0; }
  table.scorecard th { background: #2A295C; color: white; padding: 8px 12px; text-align: left; font-size: 10pt; }
  table.scorecard td { padding: 7px 12px; border: 1px solid #E5E7EB; font-size: 10pt; }
  .sc-section { background: #F0F1F5; font-weight: bold; color: #2A295C; }
  .pill-pass { background: #ECFDF5; color: #15803D; font-weight: bold; padding: 2px 8px; }
  .pill-fail { background: #FEF2F2; color: #DC2626; font-weight: bold; padding: 2px 8px; }
  .pill-warn { background: #FFFBEB; color: #D97706; font-weight: bold; padding: 2px 8px; }
  .pill-na { background: #F3F4F6; color: #9CA3AF; padding: 2px 8px; }
  .issue-num { background: #DC2626; color: white; font-weight: bold; padding: 2px 8px; text-align: center; width: 30px; }
  .notes-box { background: #F7F8FA; padding: 16px; border-left: 3px solid #2A295C; white-space: pre-wrap; font-size: 10pt; line-height: 1.7; }
  .footer { margin-top: 32px; padding-top: 12px; border-top: 1px solid #E5E7EB; font-size: 8pt; color: #9CA3AF; text-align: center; }
</style></head><body>

<h1>Sodexo Kitchen Inspection Report</h1>
<div class="red-line"></div>

<table class="info-table">
  <tr><td class="info-label">Inspection Type</td><td>${s||"‚Äî"}</td><td class="info-label">Date</td><td>${i||"‚Äî"}</td></tr>
  <tr><td class="info-label">Inspector</td><td>${u||"‚Äî"}</td><td class="info-label">Supervisor</td><td>${c||"‚Äî"}</td></tr>
  <tr><td class="info-label">Site / Location</td><td>${o||"‚Äî"}</td><td class="info-label">Unit #</td><td>${m||"‚Äî"}</td></tr>
  ${p?`<tr><td class="info-label">Phone</td><td>${p}</td><td></td><td></td></tr>`:""}
  <tr><td class="info-label">Hand Sink Temp</td><td>${n?.temps?.handSinkTempF?n.temps.handSinkTempF+"¬∞F":"‚Äî"} ${v>=95?"‚úÖ":v?"‚ö†Ô∏è Below 95¬∞F":""}</td>
      <td class="info-label">3-Comp Wash Temp</td><td>${n?.temps?.threeCompSinkTempF?n.temps.threeCompSinkTempF+"¬∞F":"‚Äî"} ${w>=110?"‚úÖ":w?"‚ö†Ô∏è Below 110¬∞F":""}</td></tr>
  <tr><td class="info-label">Overall Status</td><td colspan="3" class="${r==="Pass"?"status-pass":"status-fail"}">${r==="Pass"?"PASSED":"NEEDS ATTENTION"}</td></tr>
</table>

<h2>Inspection Scorecard</h2>
<table class="scorecard">
  <tr><th>Section</th><th>Item</th><th>Status</th><th>Notes</th></tr>
  ${y.map(([h,S,C])=>{const F=C?.status||"N/A";return`<tr><td>${h}</td><td>${S}</td><td><span class="${F==="OK"?"pill-pass":F==="Not Clean"?"pill-fail":F==="Needs Attention"?"pill-warn":"pill-na"}">${F}</span></td><td>${C?.notes||"‚Äî"}</td></tr>`}).join(`
  `)}
  <tr><td>Temps</td><td>Hand Sink</td><td><span class="${v>=95?"pill-pass":v?"pill-fail":"pill-na"}">${n?.temps?.handSinkTempF?n.temps.handSinkTempF+"¬∞F":"N/A"}</span></td><td>${v>=95?"Meets minimum":v?"Below 95¬∞F minimum":"‚Äî"}</td></tr>
  <tr><td>Temps</td><td>3-Comp Wash</td><td><span class="${w>=110?"pill-pass":w?"pill-fail":"pill-na"}">${n?.temps?.threeCompSinkTempF?n.temps.threeCompSinkTempF+"¬∞F":"N/A"}</span></td><td>${w>=110?"Meets minimum":w?"Below 110¬∞F minimum":"‚Äî"}</td></tr>
</table>

${j.length>0?`
<h2>Issues Found (${j.length})</h2>
<table class="scorecard">
  <tr><th>#</th><th>Area</th><th>Item</th><th>Status</th><th>Notes</th></tr>
  ${j.map(([h,S,C],F)=>`<tr><td class="issue-num">${F+1}</td><td>${h}</td><td>${S}</td><td><span class="pill-fail">${C.status}</span></td><td>${C.notes||""}</td></tr>`).join(`
  `)}
</table>`:'<h2>Issues</h2><p style="background:#ECFDF5;padding:12px;color:#15803D;font-weight:bold;text-align:center;">All areas passed inspection</p>'}

${d.length>0?`
<h2>Corrective Actions Required</h2>
<table class="scorecard">
  <tr><th>#</th><th>Issue</th><th>Priority</th></tr>
  ${d.map((h,S)=>`<tr><td style="text-align:center">${S+1}</td><td>${h.issue}</td><td><span class="${h.priority==="High"?"pill-fail":"pill-warn"}">${h.priority}</span></td></tr>`).join(`
  `)}
</table>`:""}

<h2>Inspector Notes</h2>
${(()=>{const{grouped:h}=le(a),S=oe.filter(C=>h[C]?.length);return S.length?S.map(C=>`<div style="margin-bottom:12px;"><p style="font-weight:bold;color:#2A295C;font-size:10pt;margin:0 0 4px 0;">${ie[C]}</p><ul style="margin:0;padding-left:20px;">${h[C].map(F=>`<li style="margin-bottom:4px;font-size:10pt;line-height:1.5;">${F.replace(/</g,"&lt;")}</li>`).join("")}</ul></div>`).join(""):'<div class="notes-box">‚Äî</div>'})()}

<div class="footer">
  <p>Generated ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()} ‚Ä¢ Sodexo Kitchen Inspection System</p>
  <p>This report is confidential and intended for internal use only.</p>
</div>
</body></html>`,N=new Blob([I],{type:"application/msword"}),l=`inspection_${i||"undated"}_${(o||"site").replace(/\s+/g,"_")}.doc`;ge(N,l)}function Ve({output:t,inspectionDate:n,siteName:a}){const s=new Blob([t||""],{type:"text/plain;charset=utf-8;"}),i=`inspection_${n||"undated"}_${(a||"site").replace(/\s+/g,"_")}.txt`;ge(s,i)}function Bt({onBack:t}){const[n,a]=x.useState([]),[s,i]=x.useState(""),[o,m]=x.useState(""),[p,u]=x.useState(""),[c,r]=x.useState(null),[d,y]=x.useState(!1);x.useEffect(()=>{We().then(l=>{a(l),y(!0)})},[]),x.useMemo(()=>{const l=new Set;for(const h of n)for(const S of h.actionItems||[])l.add(S.issue?.split(":")[0]?.trim()||"Other");return Array.from(l).sort()},[n]);const j=x.useMemo(()=>n.filter(l=>!(s&&l.inspectionDate!==s||o&&l.inspectionType!==o||p&&!(l.actionItems||[]).some(S=>S.issue?.toLowerCase().includes(p.toLowerCase())))),[n,s,o,p]);function v(l){const h=n.filter(S=>S.id!==l);a(h),be(h).catch(()=>{})}function w(){confirm("Delete all inspection history? This cannot be undone.")&&(a([]),be([]).catch(()=>{}))}const I=[...new Set(n.map(l=>l.inspectionDate).filter(Boolean))].sort().reverse(),N=[...new Set(n.map(l=>l.inspectionType).filter(Boolean))].sort();return e.jsxs("div",{className:"appShell",children:[e.jsxs("header",{className:"topBar",children:[e.jsxs("div",{className:"brandLeft brandClickable",onClick:t,title:"Back to Inspector",children:[e.jsx("img",{src:M,alt:"Sodexo",className:"brandLogo"}),e.jsxs("div",{children:[e.jsx("div",{className:"brandTitle",children:"Inspection History"}),e.jsxs("div",{className:"brandSub",children:[n.length," saved inspection",n.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"topActions",children:[e.jsx("button",{className:"btn btnGhost",onClick:t,type:"button",children:"Back to Inspector"}),n.length>0&&e.jsx("button",{className:"btn btnGhost",onClick:w,type:"button",style:{color:"#EE0000",borderColor:"#EE0000"},children:"Clear All"})]})]}),e.jsxs("main",{className:"pageMain pageMainWide",children:[e.jsxs("div",{className:"card",style:{marginBottom:24},children:[e.jsxs("div",{className:"cardHeader",children:[e.jsx("div",{className:"cardTitle",children:"Filters"}),(s||o||p)&&e.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{i(""),m(""),u("")},children:"Clear filters"})]}),e.jsx("div",{className:"cardBody",children:e.jsxs("div",{className:"fieldGrid filterGrid",children:[e.jsxs("label",{className:"field",children:[e.jsx("span",{className:"fieldLabel",children:"Date"}),e.jsxs("select",{className:"select",value:s,onChange:l=>i(l.target.value),children:[e.jsx("option",{value:"",children:"All dates"}),I.map(l=>e.jsx("option",{value:l,children:l},l))]})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{className:"fieldLabel",children:"Inspection Type"}),e.jsxs("select",{className:"select",value:o,onChange:l=>m(l.target.value),children:[e.jsx("option",{value:"",children:"All types"}),N.map(l=>e.jsx("option",{value:l,children:l},l))]})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{className:"fieldLabel",children:"Search Issues"}),e.jsx("input",{className:"input",value:p,onChange:l=>u(l.target.value),placeholder:"e.g., floor, temp, allergen..."})]})]})})]}),j.length===0?e.jsx("div",{className:"card",children:e.jsx("div",{className:"cardBody",children:e.jsxs("div",{className:"emptyState",children:[e.jsx("div",{className:"emptyTitle",children:n.length===0?"No inspections saved yet":"No matches"}),e.jsx("div",{className:"emptySub",children:n.length===0?"Complete an inspection and click Save to build your history.":"Try adjusting your filters."})]})})}):e.jsx("div",{className:"historyList",children:j.map(l=>{const h=c===l.id,S=l.actionItems||[],C=l.overallStatus==="Pass"?"#15803D":"#EE0000";return e.jsxs("div",{className:"card historyCard",style:{marginBottom:16},children:[e.jsxs("div",{className:"cardHeader",style:{cursor:"pointer"},onClick:()=>r(h?null:l.id),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,flex:1},children:[e.jsx("span",{className:"historyStatus",style:{background:C},children:l.overallStatus}),e.jsxs("div",{children:[e.jsx("div",{className:"cardTitle",children:l.siteName||l.location||"Inspection"}),e.jsxs("div",{className:"cardSub",children:[l.inspectionDate," ¬∑ ",l.inspectionType," ¬∑ ",l.inspectorName||"‚Äî"]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[S.length>0&&e.jsxs("span",{className:"pill",children:[S.length," issue",S.length!==1?"s":""]}),e.jsx("span",{style:{fontSize:"1.2rem",color:"var(--sdx-gray-400)"},children:h?"‚ñ≤":"‚ñº"})]})]}),h&&e.jsxs("div",{className:"cardBody",children:[e.jsxs("div",{className:"historyMeta",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Inspector:"})," ",l.inspectorName||"‚Äî"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Supervisor:"})," ",l.supervisorName||"‚Äî"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Unit #:"})," ",l.siteNumber||"‚Äî"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Hand sink:"})," ",l.temps?.handSinkTempF||"‚Äî","¬∞F"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"3-comp wash:"})," ",l.temps?.threeCompSinkTempF||"‚Äî","¬∞F"]})]}),S.length>0&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx("div",{className:"guideSectionTitle",children:"Action Items"}),e.jsxs("table",{className:"historyTable",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Issue"}),e.jsx("th",{children:"Priority"})]})}),e.jsx("tbody",{children:S.map((F,b)=>e.jsxs("tr",{children:[e.jsx("td",{children:F.issue}),e.jsx("td",{children:e.jsx("span",{className:L("priorityBadge",F.priority==="High"?"priorityHigh":"priorityMed"),children:F.priority})})]},b))})]})]}),l.rawNotes&&e.jsxs("div",{style:{marginTop:16},children:[e.jsx("div",{className:"guideSectionTitle",children:"Inspector Notes"}),e.jsx("div",{className:"historyNotesFormatted",style:{maxHeight:250,overflowY:"auto"},children:(()=>{const{grouped:F}=le(l.rawNotes);return oe.map(b=>F[b]?.length?e.jsxs("div",{style:{marginBottom:10},children:[e.jsx("div",{className:L("rptNoteCatLabel",`rptNoteCat--${b}`),children:ie[b]}),e.jsx("ul",{className:"rptNoteBullets",children:F[b].map((E,k)=>e.jsx("li",{children:E},k))})]},b):null)})()})]}),e.jsxs("div",{style:{marginTop:16,display:"flex",gap:8},children:[e.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{Ve({output:l.output||l.rawNotes||"",inspectionDate:l.inspectionDate,siteName:l.siteName})},children:"Download TXT"}),e.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{Je({output:l.output||l.rawNotes||"",inspectionType:l.inspectionType,inspectionDate:l.inspectionDate,siteName:l.siteName,inspectorName:l.inspectorName})},children:"Download HTML"}),e.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>v(l.id),style:{color:"#EE0000",borderColor:"rgba(238,0,0,.3)",marginLeft:"auto"},children:"Delete"})]})]})]},l.id)})})]}),e.jsxs("footer",{className:"footer",children:[e.jsx("img",{src:M,alt:"Sodexo",className:"footerLogo"}),e.jsx("span",{children:"Inspection history is stored locally in your browser."})]})]})}function Ht({currentUser:t,onBack:n}){const[a,s]=x.useState(()=>R()),[i,o]=x.useState(!1),[m,p]=x.useState(""),[u,c]=x.useState(""),[r,d]=x.useState(""),[y,j]=x.useState("inspector"),[v,w]=x.useState(""),[I,N]=x.useState(""),[l,h]=x.useState(!1);function S(){s(R())}function C(f){Nt(f),S()}function F(f){confirm("Remove this access request?")&&(Ae(f),S())}function b(f){yt(f),S()}function E(f){jt(f),S()}function k(f){confirm("Remove this user? They will need to request access again.")&&(Ae(f),S())}async function q(f){f.preventDefault(),w(""),N(""),h(!0);try{if(m.trim().length<3){w("Badge number must be at least 3 characters.");return}const $=await xt(m.trim(),u.trim(),r.trim(),y);$.ok?(N(`${u.trim()} added as ${y==="admin"?"Admin":"Inspector"}.`),p(""),c(""),d(""),j("inspector"),S(),setTimeout(()=>N(""),3e3)):$.reason==="exists"&&w("This badge number is already registered.")}catch{w("Failed to add user. Try again.")}finally{h(!1)}}const O=a.filter(f=>!f.approved),P=a.filter(f=>f.approved),A=a.filter(f=>f.role==="admin"&&f.approved).length;return e.jsxs("div",{className:"appShell",children:[e.jsxs("header",{className:"topBar",children:[e.jsxs("div",{className:"brandLeft brandClickable",onClick:n,title:"Back to Inspector",children:[e.jsx("img",{src:M,alt:"Sodexo",className:"brandLogo"}),e.jsxs("div",{children:[e.jsx("div",{className:"brandTitle",children:"Admin Panel"}),e.jsx("div",{className:"brandSub",children:"Manage user access & permissions"})]})]}),e.jsx("div",{className:"topActions",children:e.jsx("button",{className:"btn btnGhost",onClick:n,type:"button",children:"Back to Inspector"})})]}),e.jsxs("main",{className:"pageMain pageMainNarrow",children:[e.jsxs("div",{className:"card adminCard",style:{marginBottom:24},children:[e.jsxs("div",{className:"cardHeader",children:[e.jsx("div",{className:"cardTitle",children:"Add New User"}),e.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{o(!i),w(""),N("")},children:i?"Cancel":"+ Add User"})]}),i&&e.jsx("div",{className:"cardBody",children:e.jsxs("form",{onSubmit:q,className:"addUserForm",children:[e.jsxs("div",{className:"fieldGrid",children:[e.jsxs("label",{className:"field",children:[e.jsx("span",{className:"fieldLabel",children:"Badge Number"}),e.jsx("input",{className:"input",type:"password",value:m,onChange:f=>p(f.target.value),placeholder:"Enter badge #",autoComplete:"off"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{className:"fieldLabel",children:"Full Name"}),e.jsx("input",{className:"input",value:u,onChange:f=>c(f.target.value),placeholder:"e.g., Jane Smith"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{className:"fieldLabel",children:"Department"}),e.jsx("input",{className:"input",value:r,onChange:f=>d(f.target.value),placeholder:"e.g., Safety Inspector"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{className:"fieldLabel",children:"Role"}),e.jsxs("select",{className:"select",value:y,onChange:f=>j(f.target.value),children:[e.jsx("option",{value:"inspector",children:"Inspector"}),e.jsx("option",{value:"admin",children:"Admin"})]})]})]}),v&&e.jsx("div",{className:"pinError",style:{marginTop:8},children:v}),I&&e.jsx("div",{className:"addUserSuccess",children:I}),e.jsx("button",{className:"btn btnPrimary",type:"submit",style:{marginTop:12},disabled:l||m.trim().length<3||!u.trim()||!r.trim(),children:l?"Adding...":`Add as ${y==="admin"?"Admin":"Inspector"}`})]})})]}),O.length>0&&e.jsxs("div",{className:"card adminCard",style:{marginBottom:24},children:[e.jsx("div",{className:"cardHeader",children:e.jsxs("div",{className:"cardTitle",children:["Pending Approvals",e.jsx("span",{className:"adminCount",children:O.length})]})}),e.jsx("div",{className:"cardBody",children:O.map(f=>e.jsxs("div",{className:"adminUserRow",children:[e.jsxs("div",{className:"adminUserInfo",children:[e.jsx("div",{className:"adminUserName",children:f.name}),e.jsxs("div",{className:"adminUserMeta",children:[f.department," ¬∑ Requested ",new Date(f.registeredAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"adminUserActions",children:[e.jsx("button",{className:"btn btnPrimary btnSmall",onClick:()=>C(f.badgeHash),children:"Approve"}),e.jsx("button",{className:"btn btnGhost btnSmall adminDenyBtn",onClick:()=>F(f.badgeHash),children:"Deny"})]})]},f.badgeHash))})]}),e.jsxs("div",{className:"card adminCard",children:[e.jsx("div",{className:"cardHeader",children:e.jsxs("div",{className:"cardTitle",children:["Team Members",e.jsx("span",{className:"adminCount",children:P.length})]})}),e.jsx("div",{className:"cardBody",children:P.length===0?e.jsx("div",{className:"emptyState",children:e.jsx("div",{className:"emptyTitle",children:"No approved users"})}):P.map(f=>{const $=f.badgeHash===t?.badgeHash,Y=f.role==="admin"&&A<=1;return e.jsxs("div",{className:"adminUserRow",children:[e.jsxs("div",{className:"adminUserInfo",children:[e.jsxs("div",{className:"adminUserName",children:[f.name,f.role==="admin"&&e.jsx("span",{className:"roleBadge adminRoleBadge",children:"Admin"}),f.role==="inspector"&&e.jsx("span",{className:"roleBadge inspectorRoleBadge",children:"Inspector"}),$&&e.jsx("span",{className:"roleBadge youRoleBadge",children:"You"})]}),e.jsxs("div",{className:"adminUserMeta",children:[f.department," ¬∑ Since ",new Date(f.registeredAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"adminUserActions",children:[f.role==="inspector"&&e.jsx("button",{className:"btn btnGhost btnSmall",onClick:()=>b(f.badgeHash),children:"Make Admin"}),f.role==="admin"&&!Y&&!$&&e.jsx("button",{className:"btn btnGhost btnSmall",onClick:()=>E(f.badgeHash),children:"Remove Admin"}),!$&&e.jsx("button",{className:"btn btnGhost btnSmall adminDenyBtn",onClick:()=>k(f.badgeHash),children:"Remove"})]})]},f.badgeHash)})})]})]}),e.jsxs("footer",{className:"footer",children:[e.jsx("img",{src:M,alt:"Sodexo",className:"footerLogo"}),e.jsx("span",{children:"User accounts are stored locally on this device."})]})]})}function Kt({photos:t,onRemove:n}){return t?.length?e.jsx("div",{className:"photoStrip",children:t.map(a=>e.jsxs("div",{className:"photoThumb",children:[e.jsx("img",{src:a.previewUrl,alt:a.name}),e.jsx("button",{className:"thumbX",type:"button",onClick:()=>n(a.id),"aria-label":"Remove photo",children:"√ó"})]},a.id))}):null}function ue({title:t,items:n,inspection:a,setInspection:s}){const i=x.useRef({});async function o(p,u){const c=Array.from(u||[]).slice(0,pe),r=[];for(const d of c){if(!d.type.startsWith("image/")||Oe(d.size)>De)continue;const y=await Dt(d);r.push({id:`${Date.now()}_${Math.random().toString(16).slice(2)}`,name:d.name,sizeMb:Oe(d.size),type:d.type,previewUrl:y})}s(d=>{const y=p.split("."),j=me(d,y)||D({status:"OK",notes:""}),v={...j,photos:[...j.photos||[],...r].slice(0,pe)};return J(d,y,v)})}function m(p,u){s(c=>{const r=p.split("."),d=me(c,r)||D({status:"OK",notes:""}),y={...d,photos:(d.photos||[]).filter(j=>j.id!==u)};return J(c,r,y)})}return e.jsxs("div",{className:"guideSection",children:[e.jsx("div",{className:"guideSectionTitle",children:t}),e.jsx("div",{className:"guideItems",children:n.map(p=>{const u=p.path.join("."),c=me(a,p.path)||D({status:"OK",notes:""});return e.jsxs("div",{className:"guideItem",children:[e.jsxs("div",{className:"guideItemHead",children:[e.jsx("div",{className:"guideLabel",children:p.label}),e.jsx("select",{className:"select selectSmall",value:c.status,onChange:r=>s(d=>J(d,p.path,{...c,status:r.target.value})),children:St.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsx("input",{className:"input inputSmall",value:c.notes,onChange:r=>s(d=>J(d,p.path,{...c,notes:r.target.value})),placeholder:"Issue / observation (optional)"}),e.jsxs("div",{className:"photoRow",children:[e.jsx("input",{ref:r=>i.current[u]=r,className:"fileInput",type:"file",accept:"image/*",multiple:!0,onChange:r=>{o(u,r.target.files),r.target.value=""}}),e.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>i.current[u]?.click(),children:"Add photos"}),e.jsxs("span",{className:"hint",children:["Up to ",pe," (",De,"MB each)"]})]}),e.jsx(Kt,{photos:c.photos,onRemove:r=>m(u,r)})]},u)})}),e.jsx("div",{className:"guideNote",children:"Photos are stored locally for preview. For production: upload images and store URLs."})]})}function _t(){const[t,n]=x.useState(!0),[a,s]=x.useState(null),[i,o]=x.useState("inspector"),m=x.useRef(Date.now());x.useEffect(()=>{const g=document.getElementById("splash");g&&(g.classList.add("hide"),setTimeout(()=>g.remove(),350))},[]);const[p,u]=x.useState("inspection"),[c,r]=x.useState(()=>Et("inspection")),[d,y]=x.useState(()=>$e()),[j,v]=x.useState(""),[w,I]=x.useState(U.inspection.useCases[0]),[N,l]=x.useState("Regular Inspection"),[h,S]=x.useState(""),[C,F]=x.useState(""),[b,E]=x.useState(""),[k,q]=x.useState(""),[O,P]=x.useState(""),[A,f]=x.useState(""),[$,Y]=x.useState(""),[xe,Ne]=x.useState(!1),[ye,X]=x.useState(""),[je,re]=x.useState([]),[ve,Z]=x.useState([]),[Q,Se]=x.useState(!1),ee=x.useCallback(()=>{m.current=Date.now()},[]);if(x.useEffect(()=>{if(t)return;const g=["mousedown","keydown","touchstart","scroll"];g.forEach(H=>window.addEventListener(H,ee,{passive:!0}));const T=setInterval(()=>{Date.now()-m.current>pt&&(Ee(),n(!0))},3e4);return()=>{g.forEach(H=>window.removeEventListener(H,ee)),clearInterval(T)}},[t,ee]),x.useEffect(()=>{function g(T){j.trim()&&!Q&&(T.preventDefault(),T.returnValue="")}return window.addEventListener("beforeunload",g),()=>window.removeEventListener("beforeunload",g)},[j,Q]),t)return e.jsx(vt,{onUnlock:g=>{s(g),n(!1),ee()}});if(i==="history")return e.jsx(Bt,{onBack:()=>o("inspector")});if(i==="admin")return e.jsx(Ht,{currentUser:a,onBack:()=>o("inspector")});const we=U[p];function Ye(){const g=U[p].sample;r({...g.context}),y(g.inspection?{...g.inspection}:$e()),v(g.rawNotes||""),l(g.meta?.inspectionType||"Regular Inspection"),S(g.meta?.inspectionDate||g.context?.date||""),F(g.meta?.inspectorName||""),E(""),q(""),P(""),f(""),Y(""),X(""),re([]),Z([])}function Xe(){X(""),re([]),Z([]);const g=$t({inspectionDate:h,inspectorName:C,context:c,noteType:p,inspection:d});if(g.length&&re(g),!j.trim()){X("Please enter raw notes before transforming.");return}Ne(!0);try{const T=Lt({noteType:p,useCase:w,context:c,inspection:d,rawNotes:j,inspectionType:N,inspectionDate:h,inspectorName:C,siteName:b,siteNumber:k,sitePhone:A,supervisorName:O});Y(T);const H=qe({inspection:d,rawNotes:j,context:c,noteType:p});Z(H)}catch(T){X(T?.message||"Something went wrong")}finally{Ne(!1)}}async function Ze(){$&&await navigator.clipboard.writeText($)}function Qe(){const g=qe({inspection:d,rawNotes:j,context:c,noteType:p});Z(g)}async function et(){const g={id:`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,savedAt:new Date().toISOString(),noteType:p,inspectionType:N,inspectionDate:h,inspectorName:C,siteName:b,siteNumber:k,supervisorName:O,sitePhone:A,location:b||c?.kitchen||"Kitchen",context:{...c},temps:{...d.temps},overallStatus:_(d),actionItems:z({inspection:d,rawNotes:j}),rawNotes:j,output:$,inspection:d},T=await We();T.unshift(g),await be(T),Se(!0),setTimeout(()=>Se(!1),2500)}function tt(){Pt({inspection:d,rawNotes:j,inspectionType:N,inspectionDate:h,inspectorName:C,siteName:b,siteNumber:k,supervisorName:O})}function st(){Je({output:$,inspection:d,rawNotes:j,inspectionType:N,inspectionDate:h,siteName:b,siteNumber:k,sitePhone:A,inspectorName:C,supervisorName:O})}function nt(){Ve({output:$,inspectionDate:h,siteName:b})}return e.jsxs("div",{className:"appShell",children:[e.jsxs("header",{className:"topBar",children:[e.jsxs("div",{className:"brandLeft brandClickable",onClick:()=>{o("inspector"),window.scrollTo({top:0,behavior:"smooth"})},title:"Home",children:[e.jsx("img",{src:M,alt:"Sodexo",className:"brandLogo"}),e.jsxs("div",{children:[e.jsx("div",{className:"brandTitle",children:"Kitchen Inspection"}),e.jsx("div",{className:"brandSub",children:"Turn sit-down inspection notes into organized documents"})]})]}),e.jsxs("div",{className:"topActions",children:[a&&e.jsxs("span",{className:"userBadgeLabel",children:[a.name,a.role==="admin"?" (Admin)":""]}),e.jsx("button",{className:"btn btnLock",onClick:()=>{Ee(),s(null),n(!0)},type:"button",title:"Lock app",children:"üîí"}),a?.role==="admin"&&e.jsx("button",{className:"btn btnAdmin",onClick:()=>o("admin"),type:"button",children:"Admin"}),e.jsx("button",{className:"btn btnGhost",onClick:()=>o("history"),type:"button",children:"Past Reports"}),e.jsx("button",{className:L("btn","btnPrimary"),onClick:Xe,type:"button",disabled:xe,children:xe?"Generating...":"Generate Report"})]})]}),e.jsxs("main",{className:"grid",children:[e.jsxs("section",{className:"card",children:[e.jsx("div",{className:"cardHeader",children:e.jsx("div",{className:"cardTitle",children:"Inspection Details"})}),e.jsxs("div",{className:"cardBody",children:[e.jsxs("div",{className:"fieldGrid",children:[e.jsxs("label",{className:"field",children:[e.jsx("span",{className:"fieldLabel",children:"Inspection Type"}),e.jsx("select",{className:"select",value:N,onChange:g=>l(g.target.value),children:wt.map(g=>e.jsx("option",{value:g,children:g},g))})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{className:"fieldLabel",children:"Inspection Date"}),e.jsx("input",{className:"input",value:h,onChange:g=>S(g.target.value),placeholder:"YYYY-MM-DD"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{className:"fieldLabel",children:"Inspector Name"}),e.jsx("input",{className:"input",value:C,onChange:g=>F(g.target.value),placeholder:"e.g., J. Da Silva"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{className:"fieldLabel",children:"Supervisor Name"}),e.jsx("input",{className:"input",value:O,onChange:g=>P(g.target.value),placeholder:"e.g., GM / Chef Lead"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{className:"fieldLabel",children:"Restaurant / Local Name"}),e.jsx("input",{className:"input",value:b,onChange:g=>E(g.target.value),placeholder:"e.g., North Stand Kitchen"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{className:"fieldLabel",children:"Location / Unit Number"}),e.jsx("input",{className:"input",value:k,onChange:g=>q(g.target.value),placeholder:"e.g., Unit 12 / Loc-204"})]}),e.jsxs("label",{className:"field",children:[e.jsx("span",{className:"fieldLabel",children:"Location Phone (optional)"}),e.jsx("input",{className:"input",value:A,onChange:g=>f(g.target.value),placeholder:"e.g., (305) 555-0123"})]}),e.jsx("div",{className:"field"})]}),e.jsx("div",{className:"fieldGrid",children:we.contextFields.map(g=>e.jsxs("label",{className:"field",children:[e.jsx("span",{className:"fieldLabel",children:g.label}),e.jsx("input",{className:"input",value:c[g.key]??"",onChange:T=>r(H=>({...H,[g.key]:T.target.value})),placeholder:g.label})]},g.key))}),e.jsxs("div",{className:"field",children:[e.jsxs("div",{className:"fieldLabelRow",children:[e.jsx("span",{className:"fieldLabel",children:"Final output format"}),e.jsx("span",{className:"hint",children:"Adapts to the selected note type"})]}),e.jsx("select",{className:"select",value:w,onChange:g=>I(g.target.value),children:we.useCases.map(g=>e.jsx("option",{value:g,children:g},g))})]}),e.jsxs("div",{className:"guide",children:[e.jsxs("div",{className:"guideHeader",children:[e.jsxs("div",{children:[e.jsx("div",{className:"guideTitle",children:"Inspector guide"}),e.jsx("div",{className:"guideSub",children:"Fast checklist for sit-down kitchen inspections"})]}),e.jsxs("div",{className:"pillRow",children:[e.jsxs("span",{className:"pill",children:["Hand sink ","‚â•"," 95 F"]}),e.jsxs("span",{className:"pill",children:["3-comp wash ","‚â•"," 110 F"]})]})]}),e.jsx(ue,{title:"Facility: ceiling, walls, floors, lighting",items:[{path:["facility","ceiling"],label:"Ceiling"},{path:["facility","walls"],label:"Walls"},{path:["facility","floors"],label:"Floors"},{path:["facility","lighting"],label:"Lighting"}],inspection:d,setInspection:y}),e.jsx(ue,{title:"Operations: employees + process controls",items:[{path:["operations","employeePractices"],label:"Employee practices"},{path:["operations","handwashing"],label:"Handwashing / supplies"},{path:["operations","labelingDating"],label:"Labeling / dating"},{path:["operations","logs"],label:"Logs / documentation"}],inspection:d,setInspection:y}),e.jsxs("div",{className:"tempsRow",children:[e.jsx("div",{className:"tempsTitle",children:"Key temperatures"}),e.jsxs("div",{className:"tempsGrid",children:[e.jsxs("label",{className:"field",style:{marginTop:0},children:[e.jsx("span",{className:"fieldLabel",children:"Hand sink temp (F)"}),e.jsx("input",{className:"input",inputMode:"numeric",value:d.temps.handSinkTempF,onChange:g=>y(T=>({...T,temps:{...T.temps,handSinkTempF:g.target.value}})),placeholder:"e.g., 97"}),e.jsx("span",{className:"hint",children:Number(d.temps.handSinkTempF)>=95?"Meets >=95 F":d.temps.handSinkTempF?"Below 95 F - flag":""})]}),e.jsxs("label",{className:"field",style:{marginTop:0},children:[e.jsx("span",{className:"fieldLabel",children:"3-comp wash temp (F)"}),e.jsx("input",{className:"input",inputMode:"numeric",value:d.temps.threeCompSinkTempF,onChange:g=>y(T=>({...T,temps:{...T.temps,threeCompSinkTempF:g.target.value}})),placeholder:"e.g., 112"}),e.jsx("span",{className:"hint",children:Number(d.temps.threeCompSinkTempF)>=110?"Meets >=110 F":d.temps.threeCompSinkTempF?"Below 110 F - flag":""})]})]})]}),e.jsx(ue,{title:"Equipment check",items:[{path:["equipment","doubleDoorCooler"],label:"Double-door cooler"},{path:["equipment","doubleDoorFreezer"],label:"Double-door freezer"},{path:["equipment","walkInCooler"],label:"Walk-in cooler"},{path:["equipment","warmers"],label:"Warmers / hot holding"},{path:["equipment","ovens"],label:"Ovens"},{path:["equipment","threeCompSink"],label:"3-compartment sink"},{path:["equipment","ecolab"],label:"Ecolab / chemicals"}],inspection:d,setInspection:y})]}),e.jsxs("div",{className:"field",children:[e.jsxs("div",{className:"fieldLabelRow",children:[e.jsx("span",{className:"fieldLabel",children:"Raw notes"}),e.jsx("span",{className:"hint",children:"Abbreviations are expanded while preserving meaning"})]}),e.jsx("textarea",{className:"textarea",value:j,onChange:g=>v(g.target.value),placeholder:"Paste quick inspection notes here...",rows:10})]}),je.length>0&&e.jsxs("div",{className:"warningBox",children:[e.jsx("strong",{children:"Missing information:"}),e.jsx("ul",{children:je.map((g,T)=>e.jsx("li",{children:g},T))})]}),ye?e.jsx("div",{className:"errorBox",children:ye}):null]})]}),e.jsxs("section",{className:"card",children:[e.jsxs("div",{className:"cardHeader",children:[e.jsxs("div",{children:[e.jsx("div",{className:"cardTitle",children:"Output"}),e.jsx("div",{className:"cardSub",children:At(p,w)})]}),e.jsxs("div",{className:"outputActions",children:[e.jsx("button",{className:"btn btnGhost",type:"button",onClick:Ze,disabled:!$,children:"Copy"}),e.jsx("button",{className:L("btn",Q?"btnSaved":"btnSave"),type:"button",onClick:et,disabled:!$,children:Q?"Saved!":"Save"})]})]}),e.jsxs("div",{className:"cardBody",children:[ve.length>0&&e.jsxs("div",{className:"aiBox",children:[e.jsx("div",{className:"aiBoxTitle",children:"AI Assistant"}),e.jsx("ul",{children:ve.map((g,T)=>e.jsx("li",{children:g},T))})]}),$?e.jsxs(e.Fragment,{children:[e.jsx(qt,{noteType:p,useCase:w,context:c,inspection:d,rawNotes:j,inspectionType:N,inspectionDate:h,inspectorName:C,siteName:b,siteNumber:k,sitePhone:A,supervisorName:O}),e.jsxs("div",{className:"downloadBar",children:[e.jsx("span",{className:"downloadLabel",children:"Download:"}),e.jsx("button",{className:"btn btnDownload",type:"button",onClick:tt,children:"Excel (.xls)"}),e.jsx("button",{className:"btn btnDownload",type:"button",onClick:st,children:"Word (.doc)"}),e.jsx("button",{className:"btn btnDownload",type:"button",onClick:nt,children:"Text (.txt)"})]})]}):e.jsxs("div",{className:"emptyState",children:[e.jsx("div",{className:"emptyIcon",children:"‚úé"}),e.jsx("div",{className:"emptyTitle",children:"Ready to generate your report"}),e.jsxs("div",{className:"emptySub",children:["Fill in the inspection details on the left, then click ",e.jsx("strong",{children:"Generate Report"}),"."]})]})]})]})]}),e.jsx("button",{className:"fab fabLeft",onClick:Ye,type:"button",title:"Try Example",children:"üìù Try Example"}),e.jsx("button",{className:"fab fabRight",onClick:Qe,type:"button",title:"AI Tips",children:"‚ö° AI Tips"}),e.jsxs("footer",{className:"footer",children:[e.jsx("img",{src:M,alt:"Sodexo",className:"footerLogo"}),e.jsx("span",{children:"Tip: Attach the same photos listed in the Photo Index so the email references match."})]})]})}dt.createRoot(document.getElementById("root")).render(e.jsx(lt.StrictMode,{children:e.jsx(_t,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/Claude/sw.js").catch(()=>{})});
