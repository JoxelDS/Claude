import{r as Rl,g as Pl,a as Qu}from"./react-N--QU9DW.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();var Xr={exports:{}},Jn={};var ua;function Ju(){if(ua)return Jn;ua=1;var n=Rl(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function a(u,d,f){var g,b={},I=null,x=null;f!==void 0&&(I=""+f),d.key!==void 0&&(I=""+d.key),d.ref!==void 0&&(x=d.ref);for(g in d)s.call(d,g)&&!o.hasOwnProperty(g)&&(b[g]=d[g]);if(u&&u.defaultProps)for(g in d=u.defaultProps,d)b[g]===void 0&&(b[g]=d[g]);return{$$typeof:e,type:u,key:I,ref:x,props:b,_owner:r.current}}return Jn.Fragment=t,Jn.jsx=a,Jn.jsxs=a,Jn}var ha;function Yu(){return ha||(ha=1,Xr.exports=Ju()),Xr.exports}var c=Yu(),B=Rl();const Xu=Pl(B);var Ls={},da;function Zu(){if(da)return Ls;da=1;var n=Qu();return Ls.createRoot=n.createRoot,Ls.hydrateRoot=n.hydrateRoot,Ls}var eh=Zu();const th=Pl(eh),nh=()=>{};var fa={};const kl=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},sh=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const r=n[t++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const o=n[t++];e[s++]=String.fromCharCode((r&31)<<6|o&63)}else if(r>239&&r<365){const o=n[t++],a=n[t++],u=n[t++],d=((r&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[s++]=String.fromCharCode(55296+(d>>10)),e[s++]=String.fromCharCode(56320+(d&1023))}else{const o=n[t++],a=n[t++];e[s++]=String.fromCharCode((r&15)<<12|(o&63)<<6|a&63)}}return e.join("")},Dl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const o=n[r],a=r+1<n.length,u=a?n[r+1]:0,d=r+2<n.length,f=d?n[r+2]:0,g=o>>2,b=(o&3)<<4|u>>4;let I=(u&15)<<2|f>>6,x=f&63;d||(x=64,a||(I=64)),s.push(t[g],t[b],t[I],t[x])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(kl(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):sh(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const o=t[n.charAt(r++)],u=r<n.length?t[n.charAt(r)]:0;++r;const f=r<n.length?t[n.charAt(r)]:64;++r;const b=r<n.length?t[n.charAt(r)]:64;if(++r,o==null||u==null||f==null||b==null)throw new rh;const I=o<<2|u>>4;if(s.push(I),f!==64){const x=u<<4&240|f>>2;if(s.push(x),b!==64){const A=f<<6&192|b;s.push(A)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class rh extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ih=function(n){const e=kl(n);return Dl.encodeByteArray(e,!0)},Ys=function(n){return ih(n).replace(/\./g,"")},oh=function(n){try{return Dl.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function ah(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const lh=()=>ah().__FIREBASE_DEFAULTS__,ch=()=>{if(typeof process>"u"||typeof fa>"u")return;const n=fa.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},uh=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&oh(n[1]);return e&&JSON.parse(e)},Oi=()=>{try{return nh()||lh()||ch()||uh()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},hh=n=>Oi()?.emulatorHosts?.[n],dh=n=>{const e=hh(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},Vl=()=>Oi()?.config;class fh{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}function Fi(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function mh(n){return(await fetch(n,{credentials:"include"})).ok}function ph(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",r=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Ys(JSON.stringify(t)),Ys(JSON.stringify(a)),""].join(".")}const ns={};function gh(){const n={prod:[],emulator:[]};for(const e of Object.keys(ns))ns[e]?n.emulator.push(e):n.prod.push(e);return n}function yh(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let ma=!1;function _h(n,e){if(typeof window>"u"||typeof document>"u"||!Fi(window.location.host)||ns[n]===e||ns[n]||ma)return;ns[n]=e;function t(I){return`__firebase__banner__${I}`}const s="__firebase__banner",o=gh().prod.length>0;function a(){const I=document.getElementById(s);I&&I.remove()}function u(I){I.style.display="flex",I.style.background="#7faaf0",I.style.position="fixed",I.style.bottom="5px",I.style.left="5px",I.style.padding=".5em",I.style.borderRadius="5px",I.style.alignItems="center"}function d(I,x){I.setAttribute("width","24"),I.setAttribute("id",x),I.setAttribute("height","24"),I.setAttribute("viewBox","0 0 24 24"),I.setAttribute("fill","none"),I.style.marginLeft="-6px"}function f(){const I=document.createElement("span");return I.style.cursor="pointer",I.style.marginLeft="16px",I.style.fontSize="24px",I.innerHTML=" &times;",I.onclick=()=>{ma=!0,a()},I}function g(I,x){I.setAttribute("id",x),I.innerText="Learn more",I.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",I.setAttribute("target","__blank"),I.style.paddingLeft="5px",I.style.textDecoration="underline"}function b(){const I=yh(s),x=t("text"),A=document.getElementById(x)||document.createElement("span"),R=t("learnmore"),C=document.getElementById(R)||document.createElement("a"),L=t("preprendIcon"),P=document.getElementById(L)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(I.created){const O=I.element;u(O),g(C,R);const $=f();d(P,L),O.append(P,A,C,$),document.body.appendChild(O)}o?(A.innerText="Preview backend disconnected.",P.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(P.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,A.innerText="Preview backend running in this workspace."),A.setAttribute("id",x)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",b):b()}function vh(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function bh(){const n=Oi()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Eh(){return!bh()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Th(){try{return typeof indexedDB=="object"}catch{return!1}}function wh(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(t){e(t)}})}const Ih="FirebaseError";class An extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=Ih,Object.setPrototypeOf(this,An.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,jl.prototype.create)}}class jl{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,o=this.errors[e],a=o?Ah(o,s):"Error",u=`${this.serviceName}: ${a} (${r}).`;return new An(r,u,s)}}function Ah(n,e){return n.replace(Sh,(t,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const Sh=/\{\$([^}]+)}/g;function Xs(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const r of t){if(!s.includes(r))return!1;const o=n[r],a=e[r];if(pa(o)&&pa(a)){if(!Xs(o,a))return!1}else if(o!==a)return!1}for(const r of s)if(!t.includes(r))return!1;return!0}function pa(n){return n!==null&&typeof n=="object"}function ls(n){return n&&n._delegate?n._delegate:n}class cs{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const $t="[DEFAULT]";class xh{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new fh;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Nh(e))try{this.getOrInitializeService({instanceIdentifier:$t})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:r});s.resolve(o)}catch{}}}}clearInstance(e=$t){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=$t){return this.instances.has(e)}getOptions(e=$t){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[o,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);s===u&&a.resolve(r)}return r}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(s)??new Set;r.add(e),this.onInitCallbacks.set(s,r);const o=this.instances.get(s);return o&&e(o,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Ch(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=$t){return this.component?this.component.multipleInstances?e:$t:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Ch(n){return n===$t?void 0:n}function Nh(n){return n.instantiationMode==="EAGER"}class Rh{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new xh(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var ne;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ne||(ne={}));const Ph={debug:ne.DEBUG,verbose:ne.VERBOSE,info:ne.INFO,warn:ne.WARN,error:ne.ERROR,silent:ne.SILENT},kh=ne.INFO,Dh={[ne.DEBUG]:"log",[ne.VERBOSE]:"log",[ne.INFO]:"info",[ne.WARN]:"warn",[ne.ERROR]:"error"},Vh=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),r=Dh[e];if(r)console[r](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Ol{constructor(e){this.name=e,this._logLevel=kh,this._logHandler=Vh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ne))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Ph[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ne.DEBUG,...e),this._logHandler(this,ne.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ne.VERBOSE,...e),this._logHandler(this,ne.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ne.INFO,...e),this._logHandler(this,ne.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ne.WARN,...e),this._logHandler(this,ne.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ne.ERROR,...e),this._logHandler(this,ne.ERROR,...e)}}const jh=(n,e)=>e.some(t=>n instanceof t);let ga,ya;function Oh(){return ga||(ga=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Fh(){return ya||(ya=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Fl=new WeakMap,fi=new WeakMap,Ll=new WeakMap,Zr=new WeakMap,Li=new WeakMap;function Lh(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(vt(n.result)),r()},a=()=>{s(n.error),r()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Fl.set(t,n)}).catch(()=>{}),Li.set(e,n),e}function Mh(n){if(fi.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),r()},a=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});fi.set(n,e)}let mi={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return fi.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Ll.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return vt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Bh(n){mi=n(mi)}function $h(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(ei(this),e,...t);return Ll.set(s,e.sort?e.sort():[e]),vt(s)}:Fh().includes(n)?function(...e){return n.apply(ei(this),e),vt(Fl.get(this))}:function(...e){return vt(n.apply(ei(this),e))}}function Uh(n){return typeof n=="function"?$h(n):(n instanceof IDBTransaction&&Mh(n),jh(n,Oh())?new Proxy(n,mi):n)}function vt(n){if(n instanceof IDBRequest)return Lh(n);if(Zr.has(n))return Zr.get(n);const e=Uh(n);return e!==n&&(Zr.set(n,e),Li.set(e,n)),e}const ei=n=>Li.get(n);function qh(n,e,{blocked:t,upgrade:s,blocking:r,terminated:o}={}){const a=indexedDB.open(n,e),u=vt(a);return s&&a.addEventListener("upgradeneeded",d=>{s(vt(a.result),d.oldVersion,d.newVersion,vt(a.transaction),d)}),t&&a.addEventListener("blocked",d=>t(d.oldVersion,d.newVersion,d)),u.then(d=>{o&&d.addEventListener("close",()=>o()),r&&d.addEventListener("versionchange",f=>r(f.oldVersion,f.newVersion,f))}).catch(()=>{}),u}const Hh=["get","getKey","getAll","getAllKeys","count"],zh=["put","add","delete","clear"],ti=new Map;function _a(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ti.get(e))return ti.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=zh.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||Hh.includes(t)))return;const o=async function(a,...u){const d=this.transaction(a,r?"readwrite":"readonly");let f=d.store;return s&&(f=f.index(u.shift())),(await Promise.all([f[t](...u),r&&d.done]))[0]};return ti.set(e,o),o}Bh(n=>({...n,get:(e,t,s)=>_a(e,t)||n.get(e,t,s),has:(e,t)=>!!_a(e,t)||n.has(e,t)}));class Kh{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Wh(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function Wh(n){return n.getComponent()?.type==="VERSION"}const pi="@firebase/app",va="0.14.8";const nt=new Ol("@firebase/app"),Gh="@firebase/app-compat",Qh="@firebase/analytics-compat",Jh="@firebase/analytics",Yh="@firebase/app-check-compat",Xh="@firebase/app-check",Zh="@firebase/auth",ed="@firebase/auth-compat",td="@firebase/database",nd="@firebase/data-connect",sd="@firebase/database-compat",rd="@firebase/functions",id="@firebase/functions-compat",od="@firebase/installations",ad="@firebase/installations-compat",ld="@firebase/messaging",cd="@firebase/messaging-compat",ud="@firebase/performance",hd="@firebase/performance-compat",dd="@firebase/remote-config",fd="@firebase/remote-config-compat",md="@firebase/storage",pd="@firebase/storage-compat",gd="@firebase/firestore",yd="@firebase/ai",_d="@firebase/firestore-compat",vd="firebase",bd="12.9.0";const gi="[DEFAULT]",Ed={[pi]:"fire-core",[Gh]:"fire-core-compat",[Jh]:"fire-analytics",[Qh]:"fire-analytics-compat",[Xh]:"fire-app-check",[Yh]:"fire-app-check-compat",[Zh]:"fire-auth",[ed]:"fire-auth-compat",[td]:"fire-rtdb",[nd]:"fire-data-connect",[sd]:"fire-rtdb-compat",[rd]:"fire-fn",[id]:"fire-fn-compat",[od]:"fire-iid",[ad]:"fire-iid-compat",[ld]:"fire-fcm",[cd]:"fire-fcm-compat",[ud]:"fire-perf",[hd]:"fire-perf-compat",[dd]:"fire-rc",[fd]:"fire-rc-compat",[md]:"fire-gcs",[pd]:"fire-gcs-compat",[gd]:"fire-fst",[_d]:"fire-fst-compat",[yd]:"fire-vertex","fire-js":"fire-js",[vd]:"fire-js-all"};const Zs=new Map,Td=new Map,yi=new Map;function ba(n,e){try{n.container.addComponent(e)}catch(t){nt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function er(n){const e=n.name;if(yi.has(e))return nt.debug(`There were multiple attempts to register component ${e}.`),!1;yi.set(e,n);for(const t of Zs.values())ba(t,n);for(const t of Td.values())ba(t,n);return!0}function wd(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Id(n){return n==null?!1:n.settings!==void 0}const Ad={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},bt=new jl("app","Firebase",Ad);class Sd{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new cs("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw bt.create("app-deleted",{appName:this._name})}}const xd=bd;function Ml(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:gi,automaticDataCollectionEnabled:!0,...e},r=s.name;if(typeof r!="string"||!r)throw bt.create("bad-app-name",{appName:String(r)});if(t||(t=Vl()),!t)throw bt.create("no-options");const o=Zs.get(r);if(o){if(Xs(t,o.options)&&Xs(s,o.config))return o;throw bt.create("duplicate-app",{appName:r})}const a=new Rh(r);for(const d of yi.values())a.addComponent(d);const u=new Sd(t,s,a);return Zs.set(r,u),u}function Cd(n=gi){const e=Zs.get(n);if(!e&&n===gi&&Vl())return Ml();if(!e)throw bt.create("no-app",{appName:n});return e}function hn(n,e,t){let s=Ed[n]??n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const a=[`Unable to register library "${s}" with version "${e}":`];r&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),nt.warn(a.join(" "));return}er(new cs(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}const Nd="firebase-heartbeat-database",Rd=1,us="firebase-heartbeat-store";let ni=null;function Bl(){return ni||(ni=qh(Nd,Rd,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(us)}catch(t){console.warn(t)}}}}).catch(n=>{throw bt.create("idb-open",{originalErrorMessage:n.message})})),ni}async function Pd(n){try{const t=(await Bl()).transaction(us),s=await t.objectStore(us).get($l(n));return await t.done,s}catch(e){if(e instanceof An)nt.warn(e.message);else{const t=bt.create("idb-get",{originalErrorMessage:e?.message});nt.warn(t.message)}}}async function Ea(n,e){try{const s=(await Bl()).transaction(us,"readwrite");await s.objectStore(us).put(e,$l(n)),await s.done}catch(t){if(t instanceof An)nt.warn(t.message);else{const s=bt.create("idb-set",{originalErrorMessage:t?.message});nt.warn(s.message)}}}function $l(n){return`${n.name}!${n.options.appId}`}const kd=1024,Dd=30;class Vd{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Od(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Ta();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(r=>r.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>Dd){const r=Fd(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){nt.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Ta(),{heartbeatsToSend:t,unsentEntries:s}=jd(this._heartbeatsCache.heartbeats),r=Ys(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return nt.warn(e),""}}}function Ta(){return new Date().toISOString().substring(0,10)}function jd(n,e=kd){const t=[];let s=n.slice();for(const r of n){const o=t.find(a=>a.agent===r.agent);if(o){if(o.dates.push(r.date),wa(t)>e){o.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),wa(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class Od{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Th()?wh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Pd(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return Ea(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return Ea(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function wa(n){return Ys(JSON.stringify({version:2,heartbeats:n})).length}function Fd(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}function Ld(n){er(new cs("platform-logger",e=>new Kh(e),"PRIVATE")),er(new cs("heartbeat",e=>new Vd(e),"PRIVATE")),hn(pi,va,n),hn(pi,va,"esm2020"),hn("fire-js","")}Ld("");var Md="firebase",Bd="12.9.0";hn(Md,Bd,"app");var Ia=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Et,Ul;(function(){var n;function e(E,y){function v(){}v.prototype=y.prototype,E.F=y.prototype,E.prototype=new v,E.prototype.constructor=E,E.D=function(_,T,w){for(var m=Array(arguments.length-2),V=2;V<arguments.length;V++)m[V-2]=arguments[V];return y.prototype[T].apply(_,m)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,t),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(E,y,v){v||(v=0);const _=Array(16);if(typeof y=="string")for(var T=0;T<16;++T)_[T]=y.charCodeAt(v++)|y.charCodeAt(v++)<<8|y.charCodeAt(v++)<<16|y.charCodeAt(v++)<<24;else for(T=0;T<16;++T)_[T]=y[v++]|y[v++]<<8|y[v++]<<16|y[v++]<<24;y=E.g[0],v=E.g[1],T=E.g[2];let w=E.g[3],m;m=y+(w^v&(T^w))+_[0]+3614090360&4294967295,y=v+(m<<7&4294967295|m>>>25),m=w+(T^y&(v^T))+_[1]+3905402710&4294967295,w=y+(m<<12&4294967295|m>>>20),m=T+(v^w&(y^v))+_[2]+606105819&4294967295,T=w+(m<<17&4294967295|m>>>15),m=v+(y^T&(w^y))+_[3]+3250441966&4294967295,v=T+(m<<22&4294967295|m>>>10),m=y+(w^v&(T^w))+_[4]+4118548399&4294967295,y=v+(m<<7&4294967295|m>>>25),m=w+(T^y&(v^T))+_[5]+1200080426&4294967295,w=y+(m<<12&4294967295|m>>>20),m=T+(v^w&(y^v))+_[6]+2821735955&4294967295,T=w+(m<<17&4294967295|m>>>15),m=v+(y^T&(w^y))+_[7]+4249261313&4294967295,v=T+(m<<22&4294967295|m>>>10),m=y+(w^v&(T^w))+_[8]+1770035416&4294967295,y=v+(m<<7&4294967295|m>>>25),m=w+(T^y&(v^T))+_[9]+2336552879&4294967295,w=y+(m<<12&4294967295|m>>>20),m=T+(v^w&(y^v))+_[10]+4294925233&4294967295,T=w+(m<<17&4294967295|m>>>15),m=v+(y^T&(w^y))+_[11]+2304563134&4294967295,v=T+(m<<22&4294967295|m>>>10),m=y+(w^v&(T^w))+_[12]+1804603682&4294967295,y=v+(m<<7&4294967295|m>>>25),m=w+(T^y&(v^T))+_[13]+4254626195&4294967295,w=y+(m<<12&4294967295|m>>>20),m=T+(v^w&(y^v))+_[14]+2792965006&4294967295,T=w+(m<<17&4294967295|m>>>15),m=v+(y^T&(w^y))+_[15]+1236535329&4294967295,v=T+(m<<22&4294967295|m>>>10),m=y+(T^w&(v^T))+_[1]+4129170786&4294967295,y=v+(m<<5&4294967295|m>>>27),m=w+(v^T&(y^v))+_[6]+3225465664&4294967295,w=y+(m<<9&4294967295|m>>>23),m=T+(y^v&(w^y))+_[11]+643717713&4294967295,T=w+(m<<14&4294967295|m>>>18),m=v+(w^y&(T^w))+_[0]+3921069994&4294967295,v=T+(m<<20&4294967295|m>>>12),m=y+(T^w&(v^T))+_[5]+3593408605&4294967295,y=v+(m<<5&4294967295|m>>>27),m=w+(v^T&(y^v))+_[10]+38016083&4294967295,w=y+(m<<9&4294967295|m>>>23),m=T+(y^v&(w^y))+_[15]+3634488961&4294967295,T=w+(m<<14&4294967295|m>>>18),m=v+(w^y&(T^w))+_[4]+3889429448&4294967295,v=T+(m<<20&4294967295|m>>>12),m=y+(T^w&(v^T))+_[9]+568446438&4294967295,y=v+(m<<5&4294967295|m>>>27),m=w+(v^T&(y^v))+_[14]+3275163606&4294967295,w=y+(m<<9&4294967295|m>>>23),m=T+(y^v&(w^y))+_[3]+4107603335&4294967295,T=w+(m<<14&4294967295|m>>>18),m=v+(w^y&(T^w))+_[8]+1163531501&4294967295,v=T+(m<<20&4294967295|m>>>12),m=y+(T^w&(v^T))+_[13]+2850285829&4294967295,y=v+(m<<5&4294967295|m>>>27),m=w+(v^T&(y^v))+_[2]+4243563512&4294967295,w=y+(m<<9&4294967295|m>>>23),m=T+(y^v&(w^y))+_[7]+1735328473&4294967295,T=w+(m<<14&4294967295|m>>>18),m=v+(w^y&(T^w))+_[12]+2368359562&4294967295,v=T+(m<<20&4294967295|m>>>12),m=y+(v^T^w)+_[5]+4294588738&4294967295,y=v+(m<<4&4294967295|m>>>28),m=w+(y^v^T)+_[8]+2272392833&4294967295,w=y+(m<<11&4294967295|m>>>21),m=T+(w^y^v)+_[11]+1839030562&4294967295,T=w+(m<<16&4294967295|m>>>16),m=v+(T^w^y)+_[14]+4259657740&4294967295,v=T+(m<<23&4294967295|m>>>9),m=y+(v^T^w)+_[1]+2763975236&4294967295,y=v+(m<<4&4294967295|m>>>28),m=w+(y^v^T)+_[4]+1272893353&4294967295,w=y+(m<<11&4294967295|m>>>21),m=T+(w^y^v)+_[7]+4139469664&4294967295,T=w+(m<<16&4294967295|m>>>16),m=v+(T^w^y)+_[10]+3200236656&4294967295,v=T+(m<<23&4294967295|m>>>9),m=y+(v^T^w)+_[13]+681279174&4294967295,y=v+(m<<4&4294967295|m>>>28),m=w+(y^v^T)+_[0]+3936430074&4294967295,w=y+(m<<11&4294967295|m>>>21),m=T+(w^y^v)+_[3]+3572445317&4294967295,T=w+(m<<16&4294967295|m>>>16),m=v+(T^w^y)+_[6]+76029189&4294967295,v=T+(m<<23&4294967295|m>>>9),m=y+(v^T^w)+_[9]+3654602809&4294967295,y=v+(m<<4&4294967295|m>>>28),m=w+(y^v^T)+_[12]+3873151461&4294967295,w=y+(m<<11&4294967295|m>>>21),m=T+(w^y^v)+_[15]+530742520&4294967295,T=w+(m<<16&4294967295|m>>>16),m=v+(T^w^y)+_[2]+3299628645&4294967295,v=T+(m<<23&4294967295|m>>>9),m=y+(T^(v|~w))+_[0]+4096336452&4294967295,y=v+(m<<6&4294967295|m>>>26),m=w+(v^(y|~T))+_[7]+1126891415&4294967295,w=y+(m<<10&4294967295|m>>>22),m=T+(y^(w|~v))+_[14]+2878612391&4294967295,T=w+(m<<15&4294967295|m>>>17),m=v+(w^(T|~y))+_[5]+4237533241&4294967295,v=T+(m<<21&4294967295|m>>>11),m=y+(T^(v|~w))+_[12]+1700485571&4294967295,y=v+(m<<6&4294967295|m>>>26),m=w+(v^(y|~T))+_[3]+2399980690&4294967295,w=y+(m<<10&4294967295|m>>>22),m=T+(y^(w|~v))+_[10]+4293915773&4294967295,T=w+(m<<15&4294967295|m>>>17),m=v+(w^(T|~y))+_[1]+2240044497&4294967295,v=T+(m<<21&4294967295|m>>>11),m=y+(T^(v|~w))+_[8]+1873313359&4294967295,y=v+(m<<6&4294967295|m>>>26),m=w+(v^(y|~T))+_[15]+4264355552&4294967295,w=y+(m<<10&4294967295|m>>>22),m=T+(y^(w|~v))+_[6]+2734768916&4294967295,T=w+(m<<15&4294967295|m>>>17),m=v+(w^(T|~y))+_[13]+1309151649&4294967295,v=T+(m<<21&4294967295|m>>>11),m=y+(T^(v|~w))+_[4]+4149444226&4294967295,y=v+(m<<6&4294967295|m>>>26),m=w+(v^(y|~T))+_[11]+3174756917&4294967295,w=y+(m<<10&4294967295|m>>>22),m=T+(y^(w|~v))+_[2]+718787259&4294967295,T=w+(m<<15&4294967295|m>>>17),m=v+(w^(T|~y))+_[9]+3951481745&4294967295,E.g[0]=E.g[0]+y&4294967295,E.g[1]=E.g[1]+(T+(m<<21&4294967295|m>>>11))&4294967295,E.g[2]=E.g[2]+T&4294967295,E.g[3]=E.g[3]+w&4294967295}s.prototype.v=function(E,y){y===void 0&&(y=E.length);const v=y-this.blockSize,_=this.C;let T=this.h,w=0;for(;w<y;){if(T==0)for(;w<=v;)r(this,E,w),w+=this.blockSize;if(typeof E=="string"){for(;w<y;)if(_[T++]=E.charCodeAt(w++),T==this.blockSize){r(this,_),T=0;break}}else for(;w<y;)if(_[T++]=E[w++],T==this.blockSize){r(this,_),T=0;break}}this.h=T,this.o+=y},s.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var y=1;y<E.length-8;++y)E[y]=0;y=this.o*8;for(var v=E.length-8;v<E.length;++v)E[v]=y&255,y/=256;for(this.v(E),E=Array(16),y=0,v=0;v<4;++v)for(let _=0;_<32;_+=8)E[y++]=this.g[v]>>>_&255;return E};function o(E,y){var v=u;return Object.prototype.hasOwnProperty.call(v,E)?v[E]:v[E]=y(E)}function a(E,y){this.h=y;const v=[];let _=!0;for(let T=E.length-1;T>=0;T--){const w=E[T]|0;_&&w==y||(v[T]=w,_=!1)}this.g=v}var u={};function d(E){return-128<=E&&E<128?o(E,function(y){return new a([y|0],y<0?-1:0)}):new a([E|0],E<0?-1:0)}function f(E){if(isNaN(E)||!isFinite(E))return b;if(E<0)return C(f(-E));const y=[];let v=1;for(let _=0;E>=v;_++)y[_]=E/v|0,v*=4294967296;return new a(y,0)}function g(E,y){if(E.length==0)throw Error("number format error: empty string");if(y=y||10,y<2||36<y)throw Error("radix out of range: "+y);if(E.charAt(0)=="-")return C(g(E.substring(1),y));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const v=f(Math.pow(y,8));let _=b;for(let w=0;w<E.length;w+=8){var T=Math.min(8,E.length-w);const m=parseInt(E.substring(w,w+T),y);T<8?(T=f(Math.pow(y,T)),_=_.j(T).add(f(m))):(_=_.j(v),_=_.add(f(m)))}return _}var b=d(0),I=d(1),x=d(16777216);n=a.prototype,n.m=function(){if(R(this))return-C(this).m();let E=0,y=1;for(let v=0;v<this.g.length;v++){const _=this.i(v);E+=(_>=0?_:4294967296+_)*y,y*=4294967296}return E},n.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(A(this))return"0";if(R(this))return"-"+C(this).toString(E);const y=f(Math.pow(E,6));var v=this;let _="";for(;;){const T=$(v,y).g;v=L(v,T.j(y));let w=((v.g.length>0?v.g[0]:v.h)>>>0).toString(E);if(v=T,A(v))return w+_;for(;w.length<6;)w="0"+w;_=w+_}},n.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function A(E){if(E.h!=0)return!1;for(let y=0;y<E.g.length;y++)if(E.g[y]!=0)return!1;return!0}function R(E){return E.h==-1}n.l=function(E){return E=L(this,E),R(E)?-1:A(E)?0:1};function C(E){const y=E.g.length,v=[];for(let _=0;_<y;_++)v[_]=~E.g[_];return new a(v,~E.h).add(I)}n.abs=function(){return R(this)?C(this):this},n.add=function(E){const y=Math.max(this.g.length,E.g.length),v=[];let _=0;for(let T=0;T<=y;T++){let w=_+(this.i(T)&65535)+(E.i(T)&65535),m=(w>>>16)+(this.i(T)>>>16)+(E.i(T)>>>16);_=m>>>16,w&=65535,m&=65535,v[T]=m<<16|w}return new a(v,v[v.length-1]&-2147483648?-1:0)};function L(E,y){return E.add(C(y))}n.j=function(E){if(A(this)||A(E))return b;if(R(this))return R(E)?C(this).j(C(E)):C(C(this).j(E));if(R(E))return C(this.j(C(E)));if(this.l(x)<0&&E.l(x)<0)return f(this.m()*E.m());const y=this.g.length+E.g.length,v=[];for(var _=0;_<2*y;_++)v[_]=0;for(_=0;_<this.g.length;_++)for(let T=0;T<E.g.length;T++){const w=this.i(_)>>>16,m=this.i(_)&65535,V=E.i(T)>>>16,F=E.i(T)&65535;v[2*_+2*T]+=m*F,P(v,2*_+2*T),v[2*_+2*T+1]+=w*F,P(v,2*_+2*T+1),v[2*_+2*T+1]+=m*V,P(v,2*_+2*T+1),v[2*_+2*T+2]+=w*V,P(v,2*_+2*T+2)}for(E=0;E<y;E++)v[E]=v[2*E+1]<<16|v[2*E];for(E=y;E<2*y;E++)v[E]=0;return new a(v,0)};function P(E,y){for(;(E[y]&65535)!=E[y];)E[y+1]+=E[y]>>>16,E[y]&=65535,y++}function O(E,y){this.g=E,this.h=y}function $(E,y){if(A(y))throw Error("division by zero");if(A(E))return new O(b,b);if(R(E))return y=$(C(E),y),new O(C(y.g),C(y.h));if(R(y))return y=$(E,C(y)),new O(C(y.g),y.h);if(E.g.length>30){if(R(E)||R(y))throw Error("slowDivide_ only works with positive integers.");for(var v=I,_=y;_.l(E)<=0;)v=H(v),_=H(_);var T=z(v,1),w=z(_,1);for(_=z(_,2),v=z(v,2);!A(_);){var m=w.add(_);m.l(E)<=0&&(T=T.add(v),w=m),_=z(_,1),v=z(v,1)}return y=L(E,T.j(y)),new O(T,y)}for(T=b;E.l(y)>=0;){for(v=Math.max(1,Math.floor(E.m()/y.m())),_=Math.ceil(Math.log(v)/Math.LN2),_=_<=48?1:Math.pow(2,_-48),w=f(v),m=w.j(y);R(m)||m.l(E)>0;)v-=_,w=f(v),m=w.j(y);A(w)&&(w=I),T=T.add(w),E=L(E,m)}return new O(T,E)}n.B=function(E){return $(this,E).h},n.and=function(E){const y=Math.max(this.g.length,E.g.length),v=[];for(let _=0;_<y;_++)v[_]=this.i(_)&E.i(_);return new a(v,this.h&E.h)},n.or=function(E){const y=Math.max(this.g.length,E.g.length),v=[];for(let _=0;_<y;_++)v[_]=this.i(_)|E.i(_);return new a(v,this.h|E.h)},n.xor=function(E){const y=Math.max(this.g.length,E.g.length),v=[];for(let _=0;_<y;_++)v[_]=this.i(_)^E.i(_);return new a(v,this.h^E.h)};function H(E){const y=E.g.length+1,v=[];for(let _=0;_<y;_++)v[_]=E.i(_)<<1|E.i(_-1)>>>31;return new a(v,E.h)}function z(E,y){const v=y>>5;y%=32;const _=E.g.length-v,T=[];for(let w=0;w<_;w++)T[w]=y>0?E.i(w+v)>>>y|E.i(w+v+1)<<32-y:E.i(w+v);return new a(T,E.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,Ul=s,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=f,a.fromString=g,Et=a}).apply(typeof Ia<"u"?Ia:typeof self<"u"?self:typeof window<"u"?window:{});var Ms=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ql,Xn,Hl,zs,_i,zl,Kl,Wl;(function(){var n,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ms=="object"&&Ms];for(var l=0;l<i.length;++l){var h=i[l];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var s=t(this);function r(i,l){if(l)e:{var h=s;i=i.split(".");for(var p=0;p<i.length-1;p++){var S=i[p];if(!(S in h))break e;h=h[S]}i=i[i.length-1],p=h[i],l=l(p),l!=p&&l!=null&&e(h,i,{configurable:!0,writable:!0,value:l})}}r("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(i){return i||function(l){var h=[],p;for(p in l)Object.prototype.hasOwnProperty.call(l,p)&&h.push([p,l[p]]);return h}});var o=o||{},a=this||self;function u(i){var l=typeof i;return l=="object"&&i!=null||l=="function"}function d(i,l,h){return i.call.apply(i.bind,arguments)}function f(i,l,h){return f=d,f.apply(null,arguments)}function g(i,l){var h=Array.prototype.slice.call(arguments,1);return function(){var p=h.slice();return p.push.apply(p,arguments),i.apply(this,p)}}function b(i,l){function h(){}h.prototype=l.prototype,i.Z=l.prototype,i.prototype=new h,i.prototype.constructor=i,i.Ob=function(p,S,N){for(var M=Array(arguments.length-2),X=2;X<arguments.length;X++)M[X-2]=arguments[X];return l.prototype[S].apply(p,M)}}var I=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function x(i){const l=i.length;if(l>0){const h=Array(l);for(let p=0;p<l;p++)h[p]=i[p];return h}return[]}function A(i,l){for(let p=1;p<arguments.length;p++){const S=arguments[p];var h=typeof S;if(h=h!="object"?h:S?Array.isArray(S)?"array":h:"null",h=="array"||h=="object"&&typeof S.length=="number"){h=i.length||0;const N=S.length||0;i.length=h+N;for(let M=0;M<N;M++)i[h+M]=S[M]}else i.push(S)}}class R{constructor(l,h){this.i=l,this.j=h,this.h=0,this.g=null}get(){let l;return this.h>0?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function C(i){a.setTimeout(()=>{throw i},0)}function L(){var i=E;let l=null;return i.g&&(l=i.g,i.g=i.g.next,i.g||(i.h=null),l.next=null),l}class P{constructor(){this.h=this.g=null}add(l,h){const p=O.get();p.set(l,h),this.h?this.h.next=p:this.g=p,this.h=p}}var O=new R(()=>new $,i=>i.reset());class ${constructor(){this.next=this.g=this.h=null}set(l,h){this.h=l,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let H,z=!1,E=new P,y=()=>{const i=Promise.resolve(void 0);H=()=>{i.then(v)}};function v(){for(var i;i=L();){try{i.h.call(i.g)}catch(h){C(h)}var l=O;l.j(i),l.h<100&&(l.h++,i.next=l.g,l.g=i)}z=!1}function _(){this.u=this.u,this.C=this.C}_.prototype.u=!1,_.prototype.dispose=function(){this.u||(this.u=!0,this.N())},_.prototype[Symbol.dispose]=function(){this.dispose()},_.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function T(i,l){this.type=i,this.g=this.target=l,this.defaultPrevented=!1}T.prototype.h=function(){this.defaultPrevented=!0};var w=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,l=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const h=()=>{};a.addEventListener("test",h,l),a.removeEventListener("test",h,l)}catch{}return i})();function m(i){return/^[\s\xa0]*$/.test(i)}function V(i,l){T.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,l)}b(V,T),V.prototype.init=function(i,l){const h=this.type=i.type,p=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=l,l=i.relatedTarget,l||(h=="mouseover"?l=i.fromElement:h=="mouseout"&&(l=i.toElement)),this.relatedTarget=l,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&V.Z.h.call(this)},V.prototype.h=function(){V.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var F="closure_listenable_"+(Math.random()*1e6|0),G=0;function ue(i,l,h,p,S){this.listener=i,this.proxy=null,this.src=l,this.type=h,this.capture=!!p,this.ha=S,this.key=++G,this.da=this.fa=!1}function fe(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function $e(i,l,h){for(const p in i)l.call(h,i[p],p,i)}function Rt(i,l){for(const h in i)l.call(void 0,i[h],h,i)}function Xt(i){const l={};for(const h in i)l[h]=i[h];return l}const it="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Zt(i,l){let h,p;for(let S=1;S<arguments.length;S++){p=arguments[S];for(h in p)i[h]=p[h];for(let N=0;N<it.length;N++)h=it[N],Object.prototype.hasOwnProperty.call(p,h)&&(i[h]=p[h])}}function ot(i){this.src=i,this.g={},this.h=0}ot.prototype.add=function(i,l,h,p,S){const N=i.toString();i=this.g[N],i||(i=this.g[N]=[],this.h++);const M=Oe(i,l,p,S);return M>-1?(l=i[M],h||(l.fa=!1)):(l=new ue(l,this.src,N,!!p,S),l.fa=h,i.push(l)),l};function en(i,l){const h=l.type;if(h in i.g){var p=i.g[h],S=Array.prototype.indexOf.call(p,l,void 0),N;(N=S>=0)&&Array.prototype.splice.call(p,S,1),N&&(fe(l),i.g[h].length==0&&(delete i.g[h],i.h--))}}function Oe(i,l,h,p){for(let S=0;S<i.length;++S){const N=i[S];if(!N.da&&N.listener==l&&N.capture==!!h&&N.ha==p)return S}return-1}var Pt="closure_lm_"+(Math.random()*1e6|0),tn={};function kn(i,l,h,p,S){if(Array.isArray(l)){for(let N=0;N<l.length;N++)kn(i,l[N],h,p,S);return null}return h=Vt(h),i&&i[F]?i.J(l,h,u(p)?!!p.capture:!1,S):ws(i,l,h,!1,p,S)}function ws(i,l,h,p,S,N){if(!l)throw Error("Invalid event type");const M=u(S)?!!S.capture:!!S;let X=He(i);if(X||(i[Pt]=X=new ot(i)),h=X.add(l,h,p,M,N),h.proxy)return h;if(p=at(),h.proxy=p,p.src=i,p.listener=h,i.addEventListener)w||(S=M),S===void 0&&(S=!1),i.addEventListener(l.toString(),p,S);else if(i.attachEvent)i.attachEvent(Vn(l.toString()),p);else if(i.addListener&&i.removeListener)i.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return h}function at(){function i(h){return l.call(i.src,i.listener,h)}const l=kt;return i}function Dn(i,l,h,p,S){if(Array.isArray(l))for(var N=0;N<l.length;N++)Dn(i,l[N],h,p,S);else p=u(p)?!!p.capture:!!p,h=Vt(h),i&&i[F]?(i=i.i,N=String(l).toString(),N in i.g&&(l=i.g[N],h=Oe(l,h,p,S),h>-1&&(fe(l[h]),Array.prototype.splice.call(l,h,1),l.length==0&&(delete i.g[N],i.h--)))):i&&(i=He(i))&&(l=i.g[l.toString()],i=-1,l&&(i=Oe(l,h,p,S)),(h=i>-1?l[i]:null)&&lt(h))}function lt(i){if(typeof i!="number"&&i&&!i.da){var l=i.src;if(l&&l[F])en(l.i,i);else{var h=i.type,p=i.proxy;l.removeEventListener?l.removeEventListener(h,p,i.capture):l.detachEvent?l.detachEvent(Vn(h),p):l.addListener&&l.removeListener&&l.removeListener(p),(h=He(l))?(en(h,i),h.h==0&&(h.src=null,l[Pt]=null)):fe(i)}}}function Vn(i){return i in tn?tn[i]:tn[i]="on"+i}function kt(i,l){if(i.da)i=!0;else{l=new V(l,this);const h=i.listener,p=i.ha||i.src;i.fa&&lt(i),i=h.call(p,l)}return i}function He(i){return i=i[Pt],i instanceof ot?i:null}var Dt="__closure_events_fn_"+(Math.random()*1e9>>>0);function Vt(i){return typeof i=="function"?i:(i[Dt]||(i[Dt]=function(l){return i.handleEvent(l)}),i[Dt])}function ye(){_.call(this),this.i=new ot(this),this.M=this,this.G=null}b(ye,_),ye.prototype[F]=!0,ye.prototype.removeEventListener=function(i,l,h,p){Dn(this,i,l,h,p)};function Te(i,l){var h,p=i.G;if(p)for(h=[];p;p=p.G)h.push(p);if(i=i.M,p=l.type||l,typeof l=="string")l=new T(l,i);else if(l instanceof T)l.target=l.target||i;else{var S=l;l=new T(p,i),Zt(l,S)}S=!0;let N,M;if(h)for(M=h.length-1;M>=0;M--)N=l.g=h[M],S=nn(N,p,!0,l)&&S;if(N=l.g=i,S=nn(N,p,!0,l)&&S,S=nn(N,p,!1,l)&&S,h)for(M=0;M<h.length;M++)N=l.g=h[M],S=nn(N,p,!1,l)&&S}ye.prototype.N=function(){if(ye.Z.N.call(this),this.i){var i=this.i;for(const l in i.g){const h=i.g[l];for(let p=0;p<h.length;p++)fe(h[p]);delete i.g[l],i.h--}}this.G=null},ye.prototype.J=function(i,l,h,p){return this.i.add(String(i),l,!1,h,p)},ye.prototype.K=function(i,l,h,p){return this.i.add(String(i),l,!0,h,p)};function nn(i,l,h,p){if(l=i.i.g[String(l)],!l)return!0;l=l.concat();let S=!0;for(let N=0;N<l.length;++N){const M=l[N];if(M&&!M.da&&M.capture==h){const X=M.listener,_e=M.ha||M.src;M.fa&&en(i.i,M),S=X.call(_e,p)!==!1&&S}}return S&&!p.defaultPrevented}function Or(i,l){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=f(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(l)>2147483647?-1:a.setTimeout(i,l||0)}function Is(i){i.g=Or(()=>{i.g=null,i.i&&(i.i=!1,Is(i))},i.l);const l=i.h;i.h=null,i.m.apply(null,l)}class Fr extends _{constructor(l,h){super(),this.m=l,this.l=h,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Is(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ct(i){_.call(this),this.h=i,this.g={}}b(ct,_);var As=[];function Ss(i){$e(i.g,function(l,h){this.g.hasOwnProperty(h)&&lt(l)},i),i.g={}}ct.prototype.N=function(){ct.Z.N.call(this),Ss(this)},ct.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var jn=a.JSON.stringify,D=a.JSON.parse,Y=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function se(){}function oe(){}var tt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function jt(){T.call(this,"d")}b(jt,T);function ut(){T.call(this,"c")}b(ut,T);var Ot={},Eo=null;function xs(){return Eo=Eo||new ye}Ot.Ia="serverreachability";function To(i){T.call(this,Ot.Ia,i)}b(To,T);function On(i){const l=xs();Te(l,new To(l))}Ot.STAT_EVENT="statevent";function wo(i,l){T.call(this,Ot.STAT_EVENT,i),this.stat=l}b(wo,T);function De(i){const l=xs();Te(l,new wo(l,i))}Ot.Ja="timingevent";function Io(i,l){T.call(this,Ot.Ja,i),this.size=l}b(Io,T);function Fn(i,l){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},l)}function Ln(){this.g=!0}Ln.prototype.ua=function(){this.g=!1};function xu(i,l,h,p,S,N){i.info(function(){if(i.g)if(N){var M="",X=N.split("&");for(let ie=0;ie<X.length;ie++){var _e=X[ie].split("=");if(_e.length>1){const we=_e[0];_e=_e[1];const Ke=we.split("_");M=Ke.length>=2&&Ke[1]=="type"?M+(we+"="+_e+"&"):M+(we+"=redacted&")}}}else M=null;else M=N;return"XMLHTTP REQ ("+p+") [attempt "+S+"]: "+l+`
`+h+`
`+M})}function Cu(i,l,h,p,S,N,M){i.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+S+"]: "+l+`
`+h+`
`+N+" "+M})}function sn(i,l,h,p){i.info(function(){return"XMLHTTP TEXT ("+l+"): "+Ru(i,h)+(p?" "+p:"")})}function Nu(i,l){i.info(function(){return"TIMEOUT: "+l})}Ln.prototype.info=function(){};function Ru(i,l){if(!i.g)return l;if(!l)return null;try{const N=JSON.parse(l);if(N){for(i=0;i<N.length;i++)if(Array.isArray(N[i])){var h=N[i];if(!(h.length<2)){var p=h[1];if(Array.isArray(p)&&!(p.length<1)){var S=p[0];if(S!="noop"&&S!="stop"&&S!="close")for(let M=1;M<p.length;M++)p[M]=""}}}}return jn(N)}catch{return l}}var Cs={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ao={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},So;function Lr(){}b(Lr,se),Lr.prototype.g=function(){return new XMLHttpRequest},So=new Lr;function Mn(i){return encodeURIComponent(String(i))}function Pu(i){var l=1;i=i.split(":");const h=[];for(;l>0&&i.length;)h.push(i.shift()),l--;return i.length&&h.push(i.join(":")),h}function ht(i,l,h,p){this.j=i,this.i=l,this.l=h,this.S=p||1,this.V=new ct(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new xo}function xo(){this.i=null,this.g="",this.h=!1}var Co={},Mr={};function Br(i,l,h){i.M=1,i.A=Rs(ze(l)),i.u=h,i.R=!0,No(i,null)}function No(i,l){i.F=Date.now(),Ns(i),i.B=ze(i.A);var h=i.B,p=i.S;Array.isArray(p)||(p=[String(p)]),Uo(h.i,"t",p),i.C=0,h=i.j.L,i.h=new xo,i.g=oa(i.j,h?l:null,!i.u),i.P>0&&(i.O=new Fr(f(i.Y,i,i.g),i.P)),l=i.V,h=i.g,p=i.ba;var S="readystatechange";Array.isArray(S)||(S&&(As[0]=S.toString()),S=As);for(let N=0;N<S.length;N++){const M=kn(h,S[N],p||l.handleEvent,!1,l.h||l);if(!M)break;l.g[M.key]=M}l=i.J?Xt(i.J):{},i.u?(i.v||(i.v="POST"),l["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,l)):(i.v="GET",i.g.ea(i.B,i.v,null,l)),On(),xu(i.i,i.v,i.B,i.l,i.S,i.u)}ht.prototype.ba=function(i){i=i.target;const l=this.O;l&&mt(i)==3?l.j():this.Y(i)},ht.prototype.Y=function(i){try{if(i==this.g)e:{const X=mt(this.g),_e=this.g.ya(),ie=this.g.ca();if(!(X<3)&&(X!=3||this.g&&(this.h.h||this.g.la()||Qo(this.g)))){this.K||X!=4||_e==7||(_e==8||ie<=0?On(3):On(2)),$r(this);var l=this.g.ca();this.X=l;var h=ku(this);if(this.o=l==200,Cu(this.i,this.v,this.B,this.l,this.S,X,l),this.o){if(this.U&&!this.L){t:{if(this.g){var p,S=this.g;if((p=S.g?S.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!m(p)){var N=p;break t}}N=null}if(i=N)sn(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ur(this,i);else{this.o=!1,this.m=3,De(12),Ft(this),Bn(this);break e}}if(this.R){i=!0;let we;for(;!this.K&&this.C<h.length;)if(we=Du(this,h),we==Mr){X==4&&(this.m=4,De(14),i=!1),sn(this.i,this.l,null,"[Incomplete Response]");break}else if(we==Co){this.m=4,De(15),sn(this.i,this.l,h,"[Invalid Chunk]"),i=!1;break}else sn(this.i,this.l,we,null),Ur(this,we);if(Ro(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),X!=4||h.length!=0||this.h.h||(this.m=1,De(16),i=!1),this.o=this.o&&i,!i)sn(this.i,this.l,h,"[Invalid Chunked Response]"),Ft(this),Bn(this);else if(h.length>0&&!this.W){this.W=!0;var M=this.j;M.g==this&&M.aa&&!M.P&&(M.j.info("Great, no buffering proxy detected. Bytes received: "+h.length),Jr(M),M.P=!0,De(11))}}else sn(this.i,this.l,h,null),Ur(this,h);X==4&&Ft(this),this.o&&!this.K&&(X==4?na(this.j,this):(this.o=!1,Ns(this)))}else Wu(this.g),l==400&&h.indexOf("Unknown SID")>0?(this.m=3,De(12)):(this.m=0,De(13)),Ft(this),Bn(this)}}}catch{}};function ku(i){if(!Ro(i))return i.g.la();const l=Qo(i.g);if(l==="")return"";let h="";const p=l.length,S=mt(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return Ft(i),Bn(i),"";i.h.i=new a.TextDecoder}for(let N=0;N<p;N++)i.h.h=!0,h+=i.h.i.decode(l[N],{stream:!(S&&N==p-1)});return l.length=0,i.h.g+=h,i.C=0,i.h.g}function Ro(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function Du(i,l){var h=i.C,p=l.indexOf(`
`,h);return p==-1?Mr:(h=Number(l.substring(h,p)),isNaN(h)?Co:(p+=1,p+h>l.length?Mr:(l=l.slice(p,p+h),i.C=p+h,l)))}ht.prototype.cancel=function(){this.K=!0,Ft(this)};function Ns(i){i.T=Date.now()+i.H,Po(i,i.H)}function Po(i,l){if(i.D!=null)throw Error("WatchDog timer not null");i.D=Fn(f(i.aa,i),l)}function $r(i){i.D&&(a.clearTimeout(i.D),i.D=null)}ht.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(Nu(this.i,this.B),this.M!=2&&(On(),De(17)),Ft(this),this.m=2,Bn(this)):Po(this,this.T-i)};function Bn(i){i.j.I==0||i.K||na(i.j,i)}function Ft(i){$r(i);var l=i.O;l&&typeof l.dispose=="function"&&l.dispose(),i.O=null,Ss(i.V),i.g&&(l=i.g,i.g=null,l.abort(),l.dispose())}function Ur(i,l){try{var h=i.j;if(h.I!=0&&(h.g==i||qr(h.h,i))){if(!i.L&&qr(h.h,i)&&h.I==3){try{var p=h.Ba.g.parse(l)}catch{p=null}if(Array.isArray(p)&&p.length==3){var S=p;if(S[0]==0){e:if(!h.v){if(h.g)if(h.g.F+3e3<i.F)js(h),Ds(h);else break e;Qr(h),De(18)}}else h.xa=S[1],0<h.xa-h.K&&S[2]<37500&&h.F&&h.A==0&&!h.C&&(h.C=Fn(f(h.Va,h),6e3));Vo(h.h)<=1&&h.ta&&(h.ta=void 0)}else Mt(h,11)}else if((i.L||h.g==i)&&js(h),!m(l))for(S=h.Ba.g.parse(l),l=0;l<S.length;l++){let ie=S[l];const we=ie[0];if(!(we<=h.K))if(h.K=we,ie=ie[1],h.I==2)if(ie[0]=="c"){h.M=ie[1],h.ba=ie[2];const Ke=ie[3];Ke!=null&&(h.ka=Ke,h.j.info("VER="+h.ka));const Bt=ie[4];Bt!=null&&(h.za=Bt,h.j.info("SVER="+h.za));const pt=ie[5];pt!=null&&typeof pt=="number"&&pt>0&&(p=1.5*pt,h.O=p,h.j.info("backChannelRequestTimeoutMs_="+p)),p=h;const gt=i.g;if(gt){const Fs=gt.g?gt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Fs){var N=p.h;N.g||Fs.indexOf("spdy")==-1&&Fs.indexOf("quic")==-1&&Fs.indexOf("h2")==-1||(N.j=N.l,N.g=new Set,N.h&&(Hr(N,N.h),N.h=null))}if(p.G){const Yr=gt.g?gt.g.getResponseHeader("X-HTTP-Session-Id"):null;Yr&&(p.wa=Yr,ae(p.J,p.G,Yr))}}h.I=3,h.l&&h.l.ra(),h.aa&&(h.T=Date.now()-i.F,h.j.info("Handshake RTT: "+h.T+"ms")),p=h;var M=i;if(p.na=ia(p,p.L?p.ba:null,p.W),M.L){jo(p.h,M);var X=M,_e=p.O;_e&&(X.H=_e),X.D&&($r(X),Ns(X)),p.g=M}else ea(p);h.i.length>0&&Vs(h)}else ie[0]!="stop"&&ie[0]!="close"||Mt(h,7);else h.I==3&&(ie[0]=="stop"||ie[0]=="close"?ie[0]=="stop"?Mt(h,7):Gr(h):ie[0]!="noop"&&h.l&&h.l.qa(ie),h.A=0)}}On(4)}catch{}}var Vu=class{constructor(i,l){this.g=i,this.map=l}};function ko(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Do(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function Vo(i){return i.h?1:i.g?i.g.size:0}function qr(i,l){return i.h?i.h==l:i.g?i.g.has(l):!1}function Hr(i,l){i.g?i.g.add(l):i.h=l}function jo(i,l){i.h&&i.h==l?i.h=null:i.g&&i.g.has(l)&&i.g.delete(l)}ko.prototype.cancel=function(){if(this.i=Oo(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function Oo(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let l=i.i;for(const h of i.g.values())l=l.concat(h.G);return l}return x(i.i)}var Fo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ju(i,l){if(i){i=i.split("&");for(let h=0;h<i.length;h++){const p=i[h].indexOf("=");let S,N=null;p>=0?(S=i[h].substring(0,p),N=i[h].substring(p+1)):S=i[h],l(S,N?decodeURIComponent(N.replace(/\+/g," ")):"")}}}function dt(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let l;i instanceof dt?(this.l=i.l,$n(this,i.j),this.o=i.o,this.g=i.g,Un(this,i.u),this.h=i.h,zr(this,qo(i.i)),this.m=i.m):i&&(l=String(i).match(Fo))?(this.l=!1,$n(this,l[1]||"",!0),this.o=qn(l[2]||""),this.g=qn(l[3]||"",!0),Un(this,l[4]),this.h=qn(l[5]||"",!0),zr(this,l[6]||"",!0),this.m=qn(l[7]||"")):(this.l=!1,this.i=new zn(null,this.l))}dt.prototype.toString=function(){const i=[];var l=this.j;l&&i.push(Hn(l,Lo,!0),":");var h=this.g;return(h||l=="file")&&(i.push("//"),(l=this.o)&&i.push(Hn(l,Lo,!0),"@"),i.push(Mn(h).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.u,h!=null&&i.push(":",String(h))),(h=this.h)&&(this.g&&h.charAt(0)!="/"&&i.push("/"),i.push(Hn(h,h.charAt(0)=="/"?Lu:Fu,!0))),(h=this.i.toString())&&i.push("?",h),(h=this.m)&&i.push("#",Hn(h,Bu)),i.join("")},dt.prototype.resolve=function(i){const l=ze(this);let h=!!i.j;h?$n(l,i.j):h=!!i.o,h?l.o=i.o:h=!!i.g,h?l.g=i.g:h=i.u!=null;var p=i.h;if(h)Un(l,i.u);else if(h=!!i.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var S=l.h.lastIndexOf("/");S!=-1&&(p=l.h.slice(0,S+1)+p)}if(S=p,S==".."||S==".")p="";else if(S.indexOf("./")!=-1||S.indexOf("/.")!=-1){p=S.lastIndexOf("/",0)==0,S=S.split("/");const N=[];for(let M=0;M<S.length;){const X=S[M++];X=="."?p&&M==S.length&&N.push(""):X==".."?((N.length>1||N.length==1&&N[0]!="")&&N.pop(),p&&M==S.length&&N.push("")):(N.push(X),p=!0)}p=N.join("/")}else p=S}return h?l.h=p:h=i.i.toString()!=="",h?zr(l,qo(i.i)):h=!!i.m,h&&(l.m=i.m),l};function ze(i){return new dt(i)}function $n(i,l,h){i.j=h?qn(l,!0):l,i.j&&(i.j=i.j.replace(/:$/,""))}function Un(i,l){if(l){if(l=Number(l),isNaN(l)||l<0)throw Error("Bad port number "+l);i.u=l}else i.u=null}function zr(i,l,h){l instanceof zn?(i.i=l,$u(i.i,i.l)):(h||(l=Hn(l,Mu)),i.i=new zn(l,i.l))}function ae(i,l,h){i.i.set(l,h)}function Rs(i){return ae(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function qn(i,l){return i?l?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function Hn(i,l,h){return typeof i=="string"?(i=encodeURI(i).replace(l,Ou),h&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Ou(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var Lo=/[#\/\?@]/g,Fu=/[#\?:]/g,Lu=/[#\?]/g,Mu=/[#\?@]/g,Bu=/#/g;function zn(i,l){this.h=this.g=null,this.i=i||null,this.j=!!l}function Lt(i){i.g||(i.g=new Map,i.h=0,i.i&&ju(i.i,function(l,h){i.add(decodeURIComponent(l.replace(/\+/g," ")),h)}))}n=zn.prototype,n.add=function(i,l){Lt(this),this.i=null,i=rn(this,i);let h=this.g.get(i);return h||this.g.set(i,h=[]),h.push(l),this.h+=1,this};function Mo(i,l){Lt(i),l=rn(i,l),i.g.has(l)&&(i.i=null,i.h-=i.g.get(l).length,i.g.delete(l))}function Bo(i,l){return Lt(i),l=rn(i,l),i.g.has(l)}n.forEach=function(i,l){Lt(this),this.g.forEach(function(h,p){h.forEach(function(S){i.call(l,S,p,this)},this)},this)};function $o(i,l){Lt(i);let h=[];if(typeof l=="string")Bo(i,l)&&(h=h.concat(i.g.get(rn(i,l))));else for(i=Array.from(i.g.values()),l=0;l<i.length;l++)h=h.concat(i[l]);return h}n.set=function(i,l){return Lt(this),this.i=null,i=rn(this,i),Bo(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[l]),this.h+=1,this},n.get=function(i,l){return i?(i=$o(this,i),i.length>0?String(i[0]):l):l};function Uo(i,l,h){Mo(i,l),h.length>0&&(i.i=null,i.g.set(rn(i,l),x(h)),i.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],l=Array.from(this.g.keys());for(let p=0;p<l.length;p++){var h=l[p];const S=Mn(h);h=$o(this,h);for(let N=0;N<h.length;N++){let M=S;h[N]!==""&&(M+="="+Mn(h[N])),i.push(M)}}return this.i=i.join("&")};function qo(i){const l=new zn;return l.i=i.i,i.g&&(l.g=new Map(i.g),l.h=i.h),l}function rn(i,l){return l=String(l),i.j&&(l=l.toLowerCase()),l}function $u(i,l){l&&!i.j&&(Lt(i),i.i=null,i.g.forEach(function(h,p){const S=p.toLowerCase();p!=S&&(Mo(this,p),Uo(this,S,h))},i)),i.j=l}function Uu(i,l){const h=new Ln;if(a.Image){const p=new Image;p.onload=g(ft,h,"TestLoadImage: loaded",!0,l,p),p.onerror=g(ft,h,"TestLoadImage: error",!1,l,p),p.onabort=g(ft,h,"TestLoadImage: abort",!1,l,p),p.ontimeout=g(ft,h,"TestLoadImage: timeout",!1,l,p),a.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=i}else l(!1)}function qu(i,l){const h=new Ln,p=new AbortController,S=setTimeout(()=>{p.abort(),ft(h,"TestPingServer: timeout",!1,l)},1e4);fetch(i,{signal:p.signal}).then(N=>{clearTimeout(S),N.ok?ft(h,"TestPingServer: ok",!0,l):ft(h,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(S),ft(h,"TestPingServer: error",!1,l)})}function ft(i,l,h,p,S){try{S&&(S.onload=null,S.onerror=null,S.onabort=null,S.ontimeout=null),p(h)}catch{}}function Hu(){this.g=new Y}function Kr(i){this.i=i.Sb||null,this.h=i.ab||!1}b(Kr,se),Kr.prototype.g=function(){return new Ps(this.i,this.h)};function Ps(i,l){ye.call(this),this.H=i,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}b(Ps,ye),n=Ps.prototype,n.open=function(i,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=l,this.readyState=1,Wn(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const l={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(l.body=i),(this.H||a).fetch(new Request(this.D,l)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Kn(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,Wn(this)),this.g&&(this.readyState=3,Wn(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ho(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function Ho(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var l=i.value?i.value:new Uint8Array(0);(l=this.B.decode(l,{stream:!i.done}))&&(this.response=this.responseText+=l)}i.done?Kn(this):Wn(this),this.readyState==3&&Ho(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,Kn(this))},n.Na=function(i){this.g&&(this.response=i,Kn(this))},n.ga=function(){this.g&&Kn(this)};function Kn(i){i.readyState=4,i.l=null,i.j=null,i.B=null,Wn(i)}n.setRequestHeader=function(i,l){this.A.append(i,l)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],l=this.h.entries();for(var h=l.next();!h.done;)h=h.value,i.push(h[0]+": "+h[1]),h=l.next();return i.join(`\r
`)};function Wn(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(Ps.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function zo(i){let l="";return $e(i,function(h,p){l+=p,l+=":",l+=h,l+=`\r
`}),l}function Wr(i,l,h){e:{for(p in h){var p=!1;break e}p=!0}p||(h=zo(h),typeof i=="string"?h!=null&&Mn(h):ae(i,l,h))}function de(i){ye.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}b(de,ye);var zu=/^https?$/i,Ku=["POST","PUT"];n=de.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,l,h,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);l=l?l.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():So.g(),this.g.onreadystatechange=I(f(this.Ca,this));try{this.B=!0,this.g.open(l,String(i),!0),this.B=!1}catch(N){Ko(this,N);return}if(i=h||"",h=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var S in p)h.set(S,p[S]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const N of p.keys())h.set(N,p.get(N));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(h.keys()).find(N=>N.toLowerCase()=="content-type"),S=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(Ku,l,void 0)>=0)||p||S||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[N,M]of h)this.g.setRequestHeader(N,M);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(N){Ko(this,N)}};function Ko(i,l){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=l,i.o=5,Wo(i),ks(i)}function Wo(i){i.A||(i.A=!0,Te(i,"complete"),Te(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,Te(this,"complete"),Te(this,"abort"),ks(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ks(this,!0)),de.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Go(this):this.Xa())},n.Xa=function(){Go(this)};function Go(i){if(i.h&&typeof o<"u"){if(i.v&&mt(i)==4)setTimeout(i.Ca.bind(i),0);else if(Te(i,"readystatechange"),mt(i)==4){i.h=!1;try{const N=i.ca();e:switch(N){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var h;if(!(h=l)){var p;if(p=N===0){let M=String(i.D).match(Fo)[1]||null;!M&&a.self&&a.self.location&&(M=a.self.location.protocol.slice(0,-1)),p=!zu.test(M?M.toLowerCase():"")}h=p}if(h)Te(i,"complete"),Te(i,"success");else{i.o=6;try{var S=mt(i)>2?i.g.statusText:""}catch{S=""}i.l=S+" ["+i.ca()+"]",Wo(i)}}finally{ks(i)}}}}function ks(i,l){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const h=i.g;i.g=null,l||Te(i,"ready");try{h.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function mt(i){return i.g?i.g.readyState:0}n.ca=function(){try{return mt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var l=this.g.responseText;return i&&l.indexOf(i)==0&&(l=l.substring(i.length)),D(l)}};function Qo(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function Wu(i){const l={};i=(i.g&&mt(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<i.length;p++){if(m(i[p]))continue;var h=Pu(i[p]);const S=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const N=l[S]||[];l[S]=N,N.push(h)}Rt(l,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Gn(i,l,h){return h&&h.internalChannelParams&&h.internalChannelParams[i]||l}function Jo(i){this.za=0,this.i=[],this.j=new Ln,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Gn("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Gn("baseRetryDelayMs",5e3,i),this.Za=Gn("retryDelaySeedMs",1e4,i),this.Ta=Gn("forwardChannelMaxRetries",2,i),this.va=Gn("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new ko(i&&i.concurrentRequestLimit),this.Ba=new Hu,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Jo.prototype,n.ka=8,n.I=1,n.connect=function(i,l,h,p){De(0),this.W=i,this.H=l||{},h&&p!==void 0&&(this.H.OSID=h,this.H.OAID=p),this.F=this.X,this.J=ia(this,null,this.W),Vs(this)};function Gr(i){if(Yo(i),i.I==3){var l=i.V++,h=ze(i.J);if(ae(h,"SID",i.M),ae(h,"RID",l),ae(h,"TYPE","terminate"),Qn(i,h),l=new ht(i,i.j,l),l.M=2,l.A=Rs(ze(h)),h=!1,a.navigator&&a.navigator.sendBeacon)try{h=a.navigator.sendBeacon(l.A.toString(),"")}catch{}!h&&a.Image&&(new Image().src=l.A,h=!0),h||(l.g=oa(l.j,null),l.g.ea(l.A)),l.F=Date.now(),Ns(l)}ra(i)}function Ds(i){i.g&&(Jr(i),i.g.cancel(),i.g=null)}function Yo(i){Ds(i),i.v&&(a.clearTimeout(i.v),i.v=null),js(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function Vs(i){if(!Do(i.h)&&!i.m){i.m=!0;var l=i.Ea;H||y(),z||(H(),z=!0),E.add(l,i),i.D=0}}function Gu(i,l){return Vo(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=l.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=Fn(f(i.Ea,i,l),sa(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const S=new ht(this,this.j,i);let N=this.o;if(this.U&&(N?(N=Xt(N),Zt(N,this.U)):N=this.U),this.u!==null||this.R||(S.J=N,N=null),this.S)e:{for(var l=0,h=0;h<this.i.length;h++){t:{var p=this.i[h];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(l+=p,l>4096){l=h;break e}if(l===4096||h===this.i.length-1){l=h+1;break e}}l=1e3}else l=1e3;l=Zo(this,S,l),h=ze(this.J),ae(h,"RID",i),ae(h,"CVER",22),this.G&&ae(h,"X-HTTP-Session-Id",this.G),Qn(this,h),N&&(this.R?l="headers="+Mn(zo(N))+"&"+l:this.u&&Wr(h,this.u,N)),Hr(this.h,S),this.Ra&&ae(h,"TYPE","init"),this.S?(ae(h,"$req",l),ae(h,"SID","null"),S.U=!0,Br(S,h,null)):Br(S,h,l),this.I=2}}else this.I==3&&(i?Xo(this,i):this.i.length==0||Do(this.h)||Xo(this))};function Xo(i,l){var h;l?h=l.l:h=i.V++;const p=ze(i.J);ae(p,"SID",i.M),ae(p,"RID",h),ae(p,"AID",i.K),Qn(i,p),i.u&&i.o&&Wr(p,i.u,i.o),h=new ht(i,i.j,h,i.D+1),i.u===null&&(h.J=i.o),l&&(i.i=l.G.concat(i.i)),l=Zo(i,h,1e3),h.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Hr(i.h,h),Br(h,p,l)}function Qn(i,l){i.H&&$e(i.H,function(h,p){ae(l,p,h)}),i.l&&$e({},function(h,p){ae(l,p,h)})}function Zo(i,l,h){h=Math.min(i.i.length,h);const p=i.l?f(i.l.Ka,i.l,i):null;e:{var S=i.i;let X=-1;for(;;){const _e=["count="+h];X==-1?h>0?(X=S[0].g,_e.push("ofs="+X)):X=0:_e.push("ofs="+X);let ie=!0;for(let we=0;we<h;we++){var N=S[we].g;const Ke=S[we].map;if(N-=X,N<0)X=Math.max(0,S[we].g-100),ie=!1;else try{N="req"+N+"_"||"";try{var M=Ke instanceof Map?Ke:Object.entries(Ke);for(const[Bt,pt]of M){let gt=pt;u(pt)&&(gt=jn(pt)),_e.push(N+Bt+"="+encodeURIComponent(gt))}}catch(Bt){throw _e.push(N+"type="+encodeURIComponent("_badmap")),Bt}}catch{p&&p(Ke)}}if(ie){M=_e.join("&");break e}}M=void 0}return i=i.i.splice(0,h),l.G=i,M}function ea(i){if(!i.g&&!i.v){i.Y=1;var l=i.Da;H||y(),z||(H(),z=!0),E.add(l,i),i.A=0}}function Qr(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=Fn(f(i.Da,i),sa(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,ta(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=Fn(f(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,De(10),Ds(this),ta(this))};function Jr(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function ta(i){i.g=new ht(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var l=ze(i.na);ae(l,"RID","rpc"),ae(l,"SID",i.M),ae(l,"AID",i.K),ae(l,"CI",i.F?"0":"1"),!i.F&&i.ia&&ae(l,"TO",i.ia),ae(l,"TYPE","xmlhttp"),Qn(i,l),i.u&&i.o&&Wr(l,i.u,i.o),i.O&&(i.g.H=i.O);var h=i.g;i=i.ba,h.M=1,h.A=Rs(ze(l)),h.u=null,h.R=!0,No(h,i)}n.Va=function(){this.C!=null&&(this.C=null,Ds(this),Qr(this),De(19))};function js(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function na(i,l){var h=null;if(i.g==l){js(i),Jr(i),i.g=null;var p=2}else if(qr(i.h,l))h=l.G,jo(i.h,l),p=1;else return;if(i.I!=0){if(l.o)if(p==1){h=l.u?l.u.length:0,l=Date.now()-l.F;var S=i.D;p=xs(),Te(p,new Io(p,h)),Vs(i)}else ea(i);else if(S=l.m,S==3||S==0&&l.X>0||!(p==1&&Gu(i,l)||p==2&&Qr(i)))switch(h&&h.length>0&&(l=i.h,l.i=l.i.concat(h)),S){case 1:Mt(i,5);break;case 4:Mt(i,10);break;case 3:Mt(i,6);break;default:Mt(i,2)}}}function sa(i,l){let h=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(h*=2),h*l}function Mt(i,l){if(i.j.info("Error code "+l),l==2){var h=f(i.bb,i),p=i.Ua;const S=!p;p=new dt(p||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||$n(p,"https"),Rs(p),S?Uu(p.toString(),h):qu(p.toString(),h)}else De(2);i.I=0,i.l&&i.l.pa(l),ra(i),Yo(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),De(2)):(this.j.info("Failed to ping google.com"),De(1))};function ra(i){if(i.I=0,i.ja=[],i.l){const l=Oo(i.h);(l.length!=0||i.i.length!=0)&&(A(i.ja,l),A(i.ja,i.i),i.h.i.length=0,x(i.i),i.i.length=0),i.l.oa()}}function ia(i,l,h){var p=h instanceof dt?ze(h):new dt(h);if(p.g!="")l&&(p.g=l+"."+p.g),Un(p,p.u);else{var S=a.location;p=S.protocol,l=l?l+"."+S.hostname:S.hostname,S=+S.port;const N=new dt(null);p&&$n(N,p),l&&(N.g=l),S&&Un(N,S),h&&(N.h=h),p=N}return h=i.G,l=i.wa,h&&l&&ae(p,h,l),ae(p,"VER",i.ka),Qn(i,p),p}function oa(i,l,h){if(l&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return l=i.Aa&&!i.ma?new de(new Kr({ab:h})):new de(i.ma),l.Fa(i.L),l}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function aa(){}n=aa.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Os(){}Os.prototype.g=function(i,l){return new Fe(i,l)};function Fe(i,l){ye.call(this),this.g=new Jo(l),this.l=i,this.h=l&&l.messageUrlParams||null,i=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(i?i["X-WebChannel-Content-Type"]=l.messageContentType:i={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.sa&&(i?i["X-WebChannel-Client-Profile"]=l.sa:i={"X-WebChannel-Client-Profile":l.sa}),this.g.U=i,(i=l&&l.Qb)&&!m(i)&&(this.g.u=i),this.A=l&&l.supportsCrossDomainXhr||!1,this.v=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!m(l)&&(this.g.G=l,i=this.h,i!==null&&l in i&&(i=this.h,l in i&&delete i[l])),this.j=new on(this)}b(Fe,ye),Fe.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Fe.prototype.close=function(){Gr(this.g)},Fe.prototype.o=function(i){var l=this.g;if(typeof i=="string"){var h={};h.__data__=i,i=h}else this.v&&(h={},h.__data__=jn(i),i=h);l.i.push(new Vu(l.Ya++,i)),l.I==3&&Vs(l)},Fe.prototype.N=function(){this.g.l=null,delete this.j,Gr(this.g),delete this.g,Fe.Z.N.call(this)};function la(i){jt.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var l=i.__sm__;if(l){e:{for(const h in l){i=h;break e}i=void 0}(this.i=i)&&(i=this.i,l=l!==null&&i in l?l[i]:void 0),this.data=l}else this.data=i}b(la,jt);function ca(){ut.call(this),this.status=1}b(ca,ut);function on(i){this.g=i}b(on,aa),on.prototype.ra=function(){Te(this.g,"a")},on.prototype.qa=function(i){Te(this.g,new la(i))},on.prototype.pa=function(i){Te(this.g,new ca)},on.prototype.oa=function(){Te(this.g,"b")},Os.prototype.createWebChannel=Os.prototype.g,Fe.prototype.send=Fe.prototype.o,Fe.prototype.open=Fe.prototype.m,Fe.prototype.close=Fe.prototype.close,Wl=function(){return new Os},Kl=function(){return xs()},zl=Ot,_i={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Cs.NO_ERROR=0,Cs.TIMEOUT=8,Cs.HTTP_ERROR=6,zs=Cs,Ao.COMPLETE="complete",Hl=Ao,oe.EventType=tt,tt.OPEN="a",tt.CLOSE="b",tt.ERROR="c",tt.MESSAGE="d",ye.prototype.listen=ye.prototype.J,Xn=oe,de.prototype.listenOnce=de.prototype.K,de.prototype.getLastError=de.prototype.Ha,de.prototype.getLastErrorCode=de.prototype.ya,de.prototype.getStatus=de.prototype.ca,de.prototype.getResponseJson=de.prototype.La,de.prototype.getResponseText=de.prototype.la,de.prototype.send=de.prototype.ea,de.prototype.setWithCredentials=de.prototype.Fa,ql=de}).apply(typeof Ms<"u"?Ms:typeof self<"u"?self:typeof window<"u"?window:{});class Pe{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Pe.UNAUTHENTICATED=new Pe(null),Pe.GOOGLE_CREDENTIALS=new Pe("google-credentials-uid"),Pe.FIRST_PARTY=new Pe("first-party-uid"),Pe.MOCK_USER=new Pe("mock-user");let Sn="12.9.0";function $d(n){Sn=n}const Ht=new Ol("@firebase/firestore");function an(){return Ht.logLevel}function U(n,...e){if(Ht.logLevel<=ne.DEBUG){const t=e.map(Mi);Ht.debug(`Firestore (${Sn}): ${n}`,...t)}}function st(n,...e){if(Ht.logLevel<=ne.ERROR){const t=e.map(Mi);Ht.error(`Firestore (${Sn}): ${n}`,...t)}}function zt(n,...e){if(Ht.logLevel<=ne.WARN){const t=e.map(Mi);Ht.warn(`Firestore (${Sn}): ${n}`,...t)}}function Mi(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function W(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,Gl(n,s,t)}function Gl(n,e,t){let s=`FIRESTORE (${Sn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw st(s),new Error(s)}function re(n,e,t,s){let r="Unexpected state";typeof t=="string"?r=t:s=t,n||Gl(e,r,s)}function J(n,e){return n}const j={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class q extends An{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Tt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Ql{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ud{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Pe.UNAUTHENTICATED)))}shutdown(){}}class qd{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Hd{constructor(e){this.t=e,this.currentUser=Pe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){re(this.o===void 0,42304);let s=this.i;const r=d=>this.i!==s?(s=this.i,t(d)):Promise.resolve();let o=new Tt;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Tt,e.enqueueRetryable((()=>r(this.currentUser)))};const a=()=>{const d=o;e.enqueueRetryable((async()=>{await d.promise,await r(this.currentUser)}))},u=d=>{U("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((d=>u(d))),setTimeout((()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?u(d):(U("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Tt)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((s=>this.i!==e?(U("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(re(typeof s.accessToken=="string",31837,{l:s}),new Ql(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return re(e===null||typeof e=="string",2055,{h:e}),new Pe(e)}}class zd{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=Pe.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class Kd{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new zd(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Pe.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Aa{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Wd{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Id(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){re(this.o===void 0,3512);const s=o=>{o.error!=null&&U("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,U("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>s(o)))};const r=o=>{U("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>r(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?r(o):U("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Aa(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(re(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Aa(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Gd(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}class Bi{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const r=Gd(40);for(let o=0;o<r.length;++o)s.length<20&&r[o]<t&&(s+=e.charAt(r[o]%62))}return s}}function Z(n,e){return n<e?-1:n>e?1:0}function vi(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const r=n.charAt(s),o=e.charAt(s);if(r!==o)return si(r)===si(o)?Z(r,o):si(r)?1:-1}return Z(n.length,e.length)}const Qd=55296,Jd=57343;function si(n){const e=n.charCodeAt(0);return e>=Qd&&e<=Jd}function yn(n,e,t){return n.length===e.length&&n.every(((s,r)=>t(s,e[r])))}const Sa="__name__";class We{constructor(e,t,s){t===void 0?t=0:t>e.length&&W(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&W(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return We.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof We?e.forEach((s=>{t.push(s)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const o=We.compareSegments(e.get(r),t.get(r));if(o!==0)return o}return Z(e.length,t.length)}static compareSegments(e,t){const s=We.isNumericId(e),r=We.isNumericId(t);return s&&!r?-1:!s&&r?1:s&&r?We.extractNumericId(e).compare(We.extractNumericId(t)):vi(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Et.fromString(e.substring(4,e.length-2))}}class le extends We{construct(e,t,s){return new le(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new q(j.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter((r=>r.length>0)))}return new le(t)}static emptyPath(){return new le([])}}const Yd=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ce extends We{construct(e,t,s){return new Ce(e,t,s)}static isValidIdentifier(e){return Yd.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ce.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Sa}static keyField(){return new Ce([Sa])}static fromServerFormat(e){const t=[];let s="",r=0;const o=()=>{if(s.length===0)throw new q(j.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let a=!1;for(;r<e.length;){const u=e[r];if(u==="\\"){if(r+1===e.length)throw new q(j.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[r+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new q(j.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=d,r+=2}else u==="`"?(a=!a,r++):u!=="."||a?(s+=u,r++):(o(),r++)}if(o(),a)throw new q(j.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ce(t)}static emptyPath(){return new Ce([])}}class K{constructor(e){this.path=e}static fromPath(e){return new K(le.fromString(e))}static fromName(e){return new K(le.fromString(e).popFirst(5))}static empty(){return new K(le.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&le.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return le.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new K(new le(e.slice()))}}function Jl(n,e,t){if(!t)throw new q(j.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Xd(n,e,t,s){if(e===!0&&s===!0)throw new q(j.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function xa(n){if(!K.isDocumentKey(n))throw new q(j.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Ca(n){if(K.isDocumentKey(n))throw new q(j.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Yl(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function $i(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(s){return s.constructor?s.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":W(12329,{type:typeof n})}function _n(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new q(j.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=$i(n);throw new q(j.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ge(n,e){const t={typeString:n};return e&&(t.value=e),t}function ys(n,e){if(!Yl(n))throw new q(j.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const r=e[s].typeString,o="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const a=n[s];if(r&&typeof a!==r){t=`JSON field '${s}' must be a ${r}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${s}' field to equal '${o.value}'`;break}}if(t)throw new q(j.INVALID_ARGUMENT,t);return!0}const Na=-62135596800,Ra=1e6;class ce{static now(){return ce.fromMillis(Date.now())}static fromDate(e){return ce.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*Ra);return new ce(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new q(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new q(j.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Na)throw new q(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new q(j.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Ra}_compareTo(e){return this.seconds===e.seconds?Z(this.nanoseconds,e.nanoseconds):Z(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ce._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ys(e,ce._jsonSchema))return new ce(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Na;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ce._jsonSchemaVersion="firestore/timestamp/1.0",ce._jsonSchema={type:ge("string",ce._jsonSchemaVersion),seconds:ge("number"),nanoseconds:ge("number")};class Q{static fromTimestamp(e){return new Q(e)}static min(){return new Q(new ce(0,0))}static max(){return new Q(new ce(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const hs=-1;function Zd(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=Q.fromTimestamp(s===1e9?new ce(t+1,0):new ce(t,s));return new It(r,K.empty(),e)}function ef(n){return new It(n.readTime,n.key,hs)}class It{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new It(Q.min(),K.empty(),hs)}static max(){return new It(Q.max(),K.empty(),hs)}}function tf(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=K.comparator(n.documentKey,e.documentKey),t!==0?t:Z(n.largestBatchId,e.largestBatchId))}const nf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class sf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function xn(n){if(n.code!==j.FAILED_PRECONDITION||n.message!==nf)throw n;U("LocalStore","Unexpectedly lost primary lease")}class k{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&W(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new k(((s,r)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(s,r)},this.catchCallback=o=>{this.wrapFailure(t,o).next(s,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof k?t:k.resolve(t)}catch(t){return k.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):k.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):k.reject(t)}static resolve(e){return new k(((t,s)=>{t(e)}))}static reject(e){return new k(((t,s)=>{s(e)}))}static waitFor(e){return new k(((t,s)=>{let r=0,o=0,a=!1;e.forEach((u=>{++r,u.next((()=>{++o,a&&o===r&&t()}),(d=>s(d)))})),a=!0,o===r&&t()}))}static or(e){let t=k.resolve(!1);for(const s of e)t=t.next((r=>r?k.resolve(r):s()));return t}static forEach(e,t){const s=[];return e.forEach(((r,o)=>{s.push(t.call(this,r,o))})),this.waitFor(s)}static mapArray(e,t){return new k(((s,r)=>{const o=e.length,a=new Array(o);let u=0;for(let d=0;d<o;d++){const f=d;t(e[f]).next((g=>{a[f]=g,++u,u===o&&s(a)}),(g=>r(g)))}}))}static doWhile(e,t){return new k(((s,r)=>{const o=()=>{e()===!0?t().next((()=>{o()}),r):s()};o()}))}}function rf(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Cn(n){return n.name==="IndexedDbTransactionError"}class mr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}mr.ce=-1;const Ui=-1;function pr(n){return n==null}function tr(n){return n===0&&1/n==-1/0}function of(n){return typeof n=="number"&&Number.isInteger(n)&&!tr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const Xl="";function af(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Pa(e)),e=lf(n.get(t),e);return Pa(e)}function lf(n,e){let t=e;const s=n.length;for(let r=0;r<s;r++){const o=n.charAt(r);switch(o){case"\0":t+="";break;case Xl:t+="";break;default:t+=o}}return t}function Pa(n){return n+Xl+""}function ka(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Wt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Zl(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class he{constructor(e,t){this.comparator=e,this.root=t||xe.EMPTY}insert(e,t){return new he(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,xe.BLACK,null,null))}remove(e){return new he(this.comparator,this.root.remove(e,this.comparator).copy(null,null,xe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,s)=>(e(t,s),!1)))}toString(){const e=[];return this.inorderTraversal(((t,s)=>(e.push(`${t}:${s}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Bs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Bs(this.root,e,this.comparator,!1)}getReverseIterator(){return new Bs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Bs(this.root,e,this.comparator,!0)}}class Bs{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?s(e.key,t):1,t&&r&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class xe{constructor(e,t,s,r,o){this.key=e,this.value=t,this.color=s??xe.RED,this.left=r??xe.EMPTY,this.right=o??xe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,o){return new xe(e??this.key,t??this.value,s??this.color,r??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const o=s(e,r.key);return r=o<0?r.copy(null,null,null,r.left.insert(e,t,s),null):o===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return xe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return xe.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,xe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,xe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw W(43730,{key:this.key,value:this.value});if(this.right.isRed())throw W(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw W(27949);return e+(this.isRed()?0:1)}}xe.EMPTY=null,xe.RED=!0,xe.BLACK=!1;xe.EMPTY=new class{constructor(){this.size=0}get key(){throw W(57766)}get value(){throw W(16141)}get color(){throw W(16727)}get left(){throw W(29726)}get right(){throw W(36894)}copy(e,t,s,r,o){return this}insert(e,t,s){return new xe(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ee{constructor(e){this.comparator=e,this.data=new he(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,s)=>(e(t),!1)))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Da(this.data.getIterator())}getIteratorFrom(e){return new Da(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((s=>{t=t.add(s)})),t}isEqual(e){if(!(e instanceof Ee)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,o=s.getNext().key;if(this.comparator(r,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Ee(this.comparator);return t.data=e,t}}class Da{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ue{constructor(e){this.fields=e,e.sort(Ce.comparator)}static empty(){return new Ue([])}unionWith(e){let t=new Ee(Ce.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new Ue(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return yn(this.fields,e.fields,((t,s)=>t.isEqual(s)))}}class ec extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ne{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(r){try{return atob(r)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new ec("Invalid base64 string: "+o):o}})(e);return new Ne(t)}static fromUint8Array(e){const t=(function(r){let o="";for(let a=0;a<r.length;++a)o+=String.fromCharCode(r[a]);return o})(e);return new Ne(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Z(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ne.EMPTY_BYTE_STRING=new Ne("");const cf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function At(n){if(re(!!n,39018),typeof n=="string"){let e=0;const t=cf.exec(n);if(re(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:me(n.seconds),nanos:me(n.nanos)}}function me(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function St(n){return typeof n=="string"?Ne.fromBase64String(n):Ne.fromUint8Array(n)}const tc="server_timestamp",nc="__type__",sc="__previous_value__",rc="__local_write_time__";function qi(n){return(n?.mapValue?.fields||{})[nc]?.stringValue===tc}function gr(n){const e=n.mapValue.fields[sc];return qi(e)?gr(e):e}function ds(n){const e=At(n.mapValue.fields[rc].timestampValue);return new ce(e.seconds,e.nanos)}class uf{constructor(e,t,s,r,o,a,u,d,f,g,b){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=d,this.useFetchStreams=f,this.isUsingEmulator=g,this.apiKey=b}}const nr="(default)";class fs{constructor(e,t){this.projectId=e,this.database=t||nr}static empty(){return new fs("","")}get isDefaultDatabase(){return this.database===nr}isEqual(e){return e instanceof fs&&e.projectId===this.projectId&&e.database===this.database}}function hf(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new q(j.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new fs(n.options.projectId,e)}const ic="__type__",df="__max__",$s={mapValue:{}},oc="__vector__",sr="value";function xt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?qi(n)?4:mf(n)?9007199254740991:ff(n)?10:11:W(28295,{value:n})}function Xe(n,e){if(n===e)return!0;const t=xt(n);if(t!==xt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ds(n).isEqual(ds(e));case 3:return(function(r,o){if(typeof r.timestampValue=="string"&&typeof o.timestampValue=="string"&&r.timestampValue.length===o.timestampValue.length)return r.timestampValue===o.timestampValue;const a=At(r.timestampValue),u=At(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(r,o){return St(r.bytesValue).isEqual(St(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(r,o){return me(r.geoPointValue.latitude)===me(o.geoPointValue.latitude)&&me(r.geoPointValue.longitude)===me(o.geoPointValue.longitude)})(n,e);case 2:return(function(r,o){if("integerValue"in r&&"integerValue"in o)return me(r.integerValue)===me(o.integerValue);if("doubleValue"in r&&"doubleValue"in o){const a=me(r.doubleValue),u=me(o.doubleValue);return a===u?tr(a)===tr(u):isNaN(a)&&isNaN(u)}return!1})(n,e);case 9:return yn(n.arrayValue.values||[],e.arrayValue.values||[],Xe);case 10:case 11:return(function(r,o){const a=r.mapValue.fields||{},u=o.mapValue.fields||{};if(ka(a)!==ka(u))return!1;for(const d in a)if(a.hasOwnProperty(d)&&(u[d]===void 0||!Xe(a[d],u[d])))return!1;return!0})(n,e);default:return W(52216,{left:n})}}function ms(n,e){return(n.values||[]).find((t=>Xe(t,e)))!==void 0}function vn(n,e){if(n===e)return 0;const t=xt(n),s=xt(e);if(t!==s)return Z(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return Z(n.booleanValue,e.booleanValue);case 2:return(function(o,a){const u=me(o.integerValue||o.doubleValue),d=me(a.integerValue||a.doubleValue);return u<d?-1:u>d?1:u===d?0:isNaN(u)?isNaN(d)?0:-1:1})(n,e);case 3:return Va(n.timestampValue,e.timestampValue);case 4:return Va(ds(n),ds(e));case 5:return vi(n.stringValue,e.stringValue);case 6:return(function(o,a){const u=St(o),d=St(a);return u.compareTo(d)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){const u=o.split("/"),d=a.split("/");for(let f=0;f<u.length&&f<d.length;f++){const g=Z(u[f],d[f]);if(g!==0)return g}return Z(u.length,d.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){const u=Z(me(o.latitude),me(a.latitude));return u!==0?u:Z(me(o.longitude),me(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return ja(n.arrayValue,e.arrayValue);case 10:return(function(o,a){const u=o.fields||{},d=a.fields||{},f=u[sr]?.arrayValue,g=d[sr]?.arrayValue,b=Z(f?.values?.length||0,g?.values?.length||0);return b!==0?b:ja(f,g)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===$s.mapValue&&a===$s.mapValue)return 0;if(o===$s.mapValue)return 1;if(a===$s.mapValue)return-1;const u=o.fields||{},d=Object.keys(u),f=a.fields||{},g=Object.keys(f);d.sort(),g.sort();for(let b=0;b<d.length&&b<g.length;++b){const I=vi(d[b],g[b]);if(I!==0)return I;const x=vn(u[d[b]],f[g[b]]);if(x!==0)return x}return Z(d.length,g.length)})(n.mapValue,e.mapValue);default:throw W(23264,{he:t})}}function Va(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Z(n,e);const t=At(n),s=At(e),r=Z(t.seconds,s.seconds);return r!==0?r:Z(t.nanos,s.nanos)}function ja(n,e){const t=n.values||[],s=e.values||[];for(let r=0;r<t.length&&r<s.length;++r){const o=vn(t[r],s[r]);if(o)return o}return Z(t.length,s.length)}function bn(n){return bi(n)}function bi(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const s=At(t);return`time(${s.seconds},${s.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return St(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return K.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let s="[",r=!0;for(const o of t.values||[])r?r=!1:s+=",",s+=bi(o);return s+"]"})(n.arrayValue):"mapValue"in n?(function(t){const s=Object.keys(t.fields||{}).sort();let r="{",o=!0;for(const a of s)o?o=!1:r+=",",r+=`${a}:${bi(t.fields[a])}`;return r+"}"})(n.mapValue):W(61005,{value:n})}function Ks(n){switch(xt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=gr(n);return e?16+Ks(e):16;case 5:return 2*n.stringValue.length;case 6:return St(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((r,o)=>r+Ks(o)),0)})(n.arrayValue);case 10:case 11:return(function(s){let r=0;return Wt(s.fields,((o,a)=>{r+=o.length+Ks(a)})),r})(n.mapValue);default:throw W(13486,{value:n})}}function Ei(n){return!!n&&"integerValue"in n}function Hi(n){return!!n&&"arrayValue"in n}function Oa(n){return!!n&&"nullValue"in n}function Fa(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ws(n){return!!n&&"mapValue"in n}function ff(n){return(n?.mapValue?.fields||{})[ic]?.stringValue===oc}function ss(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Wt(n.mapValue.fields,((t,s)=>e.mapValue.fields[t]=ss(s))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ss(n.arrayValue.values[t]);return e}return{...n}}function mf(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===df}class Le{constructor(e){this.value=e}static empty(){return new Le({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!Ws(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ss(t)}setAll(e){let t=Ce.emptyPath(),s={},r=[];e.forEach(((a,u)=>{if(!t.isImmediateParentOf(u)){const d=this.getFieldsMap(t);this.applyChanges(d,s,r),s={},r=[],t=u.popLast()}a?s[u.lastSegment()]=ss(a):r.push(u.lastSegment())}));const o=this.getFieldsMap(t);this.applyChanges(o,s,r)}delete(e){const t=this.field(e.popLast());Ws(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Xe(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];Ws(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){Wt(t,((r,o)=>e[r]=o));for(const r of s)delete e[r]}clone(){return new Le(ss(this.value))}}function ac(n){const e=[];return Wt(n.fields,((t,s)=>{const r=new Ce([t]);if(Ws(s)){const o=ac(s.mapValue).fields;if(o.length===0)e.push(r);else for(const a of o)e.push(r.child(a))}else e.push(r)})),new Ue(e)}class ke{constructor(e,t,s,r,o,a,u){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new ke(e,0,Q.min(),Q.min(),Q.min(),Le.empty(),0)}static newFoundDocument(e,t,s,r){return new ke(e,1,t,Q.min(),s,r,0)}static newNoDocument(e,t){return new ke(e,2,t,Q.min(),Q.min(),Le.empty(),0)}static newUnknownDocument(e,t){return new ke(e,3,t,Q.min(),Q.min(),Le.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Q.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Le.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Le.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ke&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ke(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class rr{constructor(e,t){this.position=e,this.inclusive=t}}function La(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const o=e[r],a=n.position[r];if(o.field.isKeyField()?s=K.comparator(K.fromName(a.referenceValue),t.key):s=vn(a,t.data.field(o.field)),o.dir==="desc"&&(s*=-1),s!==0)break}return s}function Ma(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Xe(n.position[t],e.position[t]))return!1;return!0}class ir{constructor(e,t="asc"){this.field=e,this.dir=t}}function pf(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class lc{}class be extends lc{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new yf(e,t,s):t==="array-contains"?new bf(e,s):t==="in"?new Ef(e,s):t==="not-in"?new Tf(e,s):t==="array-contains-any"?new wf(e,s):new be(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new _f(e,s):new vf(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(vn(t,this.value)):t!==null&&xt(this.value)===xt(t)&&this.matchesComparison(vn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return W(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ze extends lc{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ze(e,t)}matches(e){return cc(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function cc(n){return n.op==="and"}function uc(n){return gf(n)&&cc(n)}function gf(n){for(const e of n.filters)if(e instanceof Ze)return!1;return!0}function Ti(n){if(n instanceof be)return n.field.canonicalString()+n.op.toString()+bn(n.value);if(uc(n))return n.filters.map((e=>Ti(e))).join(",");{const e=n.filters.map((t=>Ti(t))).join(",");return`${n.op}(${e})`}}function hc(n,e){return n instanceof be?(function(s,r){return r instanceof be&&s.op===r.op&&s.field.isEqual(r.field)&&Xe(s.value,r.value)})(n,e):n instanceof Ze?(function(s,r){return r instanceof Ze&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce(((o,a,u)=>o&&hc(a,r.filters[u])),!0):!1})(n,e):void W(19439)}function dc(n){return n instanceof be?(function(t){return`${t.field.canonicalString()} ${t.op} ${bn(t.value)}`})(n):n instanceof Ze?(function(t){return t.op.toString()+" {"+t.getFilters().map(dc).join(" ,")+"}"})(n):"Filter"}class yf extends be{constructor(e,t,s){super(e,t,s),this.key=K.fromName(s.referenceValue)}matches(e){const t=K.comparator(e.key,this.key);return this.matchesComparison(t)}}class _f extends be{constructor(e,t){super(e,"in",t),this.keys=fc("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class vf extends be{constructor(e,t){super(e,"not-in",t),this.keys=fc("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function fc(n,e){return(e.arrayValue?.values||[]).map((t=>K.fromName(t.referenceValue)))}class bf extends be{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Hi(t)&&ms(t.arrayValue,this.value)}}class Ef extends be{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&ms(this.value.arrayValue,t)}}class Tf extends be{constructor(e,t){super(e,"not-in",t)}matches(e){if(ms(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!ms(this.value.arrayValue,t)}}class wf extends be{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Hi(t)||!t.arrayValue.values)&&t.arrayValue.values.some((s=>ms(this.value.arrayValue,s)))}}class If{constructor(e,t=null,s=[],r=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}}function Ba(n,e=null,t=[],s=[],r=null,o=null,a=null){return new If(n,e,t,s,r,o,a)}function zi(n){const e=J(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((s=>Ti(s))).join(","),t+="|ob:",t+=e.orderBy.map((s=>(function(o){return o.field.canonicalString()+o.dir})(s))).join(","),pr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((s=>bn(s))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((s=>bn(s))).join(",")),e.Te=t}return e.Te}function Ki(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!pf(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!hc(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ma(n.startAt,e.startAt)&&Ma(n.endAt,e.endAt)}function wi(n){return K.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class yr{constructor(e,t=null,s=[],r=[],o=null,a="F",u=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=d,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function Af(n,e,t,s,r,o,a,u){return new yr(n,e,t,s,r,o,a,u)}function mc(n){return new yr(n)}function $a(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Sf(n){return K.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function xf(n){return n.collectionGroup!==null}function rs(n){const e=J(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new Ee(Ce.comparator);return a.filters.forEach((d=>{d.getFlattenedFilters().forEach((f=>{f.isInequality()&&(u=u.add(f.field))}))})),u})(e).forEach((o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new ir(o,s))})),t.has(Ce.keyField().canonicalString())||e.Ie.push(new ir(Ce.keyField(),s))}return e.Ie}function Ge(n){const e=J(n);return e.Ee||(e.Ee=Cf(e,rs(n))),e.Ee}function Cf(n,e){if(n.limitType==="F")return Ba(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((r=>{const o=r.dir==="desc"?"asc":"desc";return new ir(r.field,o)}));const t=n.endAt?new rr(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new rr(n.startAt.position,n.startAt.inclusive):null;return Ba(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function Ii(n,e,t){return new yr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function _r(n,e){return Ki(Ge(n),Ge(e))&&n.limitType===e.limitType}function pc(n){return`${zi(Ge(n))}|lt:${n.limitType}`}function ln(n){return`Query(target=${(function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map((r=>dc(r))).join(", ")}]`),pr(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map((r=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(r))).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map((r=>bn(r))).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map((r=>bn(r))).join(",")),`Target(${s})`})(Ge(n))}; limitType=${n.limitType})`}function vr(n,e){return e.isFoundDocument()&&(function(s,r){const o=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(o):K.isDocumentKey(s.path)?s.path.isEqual(o):s.path.isImmediateParentOf(o)})(n,e)&&(function(s,r){for(const o of rs(s))if(!o.field.isKeyField()&&r.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(s,r){for(const o of s.filters)if(!o.matches(r))return!1;return!0})(n,e)&&(function(s,r){return!(s.startAt&&!(function(a,u,d){const f=La(a,u,d);return a.inclusive?f<=0:f<0})(s.startAt,rs(s),r)||s.endAt&&!(function(a,u,d){const f=La(a,u,d);return a.inclusive?f>=0:f>0})(s.endAt,rs(s),r))})(n,e)}function Nf(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function gc(n){return(e,t)=>{let s=!1;for(const r of rs(n)){const o=Rf(r,e,t);if(o!==0)return o;s=s||r.field.isKeyField()}return 0}}function Rf(n,e,t){const s=n.field.isKeyField()?K.comparator(e.key,t.key):(function(o,a,u){const d=a.data.field(o),f=u.data.field(o);return d!==null&&f!==null?vn(d,f):W(42886)})(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return W(19790,{direction:n.dir})}}class Gt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[r,o]of s)if(this.equalsFn(r,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let o=0;o<r.length;o++)if(this.equalsFn(r[o][0],e))return void(r[o]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Wt(this.inner,((t,s)=>{for(const[r,o]of s)e(r,o)}))}isEmpty(){return Zl(this.inner)}size(){return this.innerSize}}const Pf=new he(K.comparator);function rt(){return Pf}const yc=new he(K.comparator);function Zn(...n){let e=yc;for(const t of n)e=e.insert(t.key,t);return e}function _c(n){let e=yc;return n.forEach(((t,s)=>e=e.insert(t,s.overlayedDocument))),e}function qt(){return is()}function vc(){return is()}function is(){return new Gt((n=>n.toString()),((n,e)=>n.isEqual(e)))}const kf=new he(K.comparator),Df=new Ee(K.comparator);function ee(...n){let e=Df;for(const t of n)e=e.add(t);return e}const Vf=new Ee(Z);function jf(){return Vf}function Wi(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:tr(e)?"-0":e}}function bc(n){return{integerValue:""+n}}function Of(n,e){return of(e)?bc(e):Wi(n,e)}class br{constructor(){this._=void 0}}function Ff(n,e,t){return n instanceof or?(function(r,o){const a={fields:{[nc]:{stringValue:tc},[rc]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return o&&qi(o)&&(o=gr(o)),o&&(a.fields[sc]=o),{mapValue:a}})(t,e):n instanceof ps?Tc(n,e):n instanceof gs?wc(n,e):(function(r,o){const a=Ec(r,o),u=Ua(a)+Ua(r.Ae);return Ei(a)&&Ei(r.Ae)?bc(u):Wi(r.serializer,u)})(n,e)}function Lf(n,e,t){return n instanceof ps?Tc(n,e):n instanceof gs?wc(n,e):t}function Ec(n,e){return n instanceof ar?(function(s){return Ei(s)||(function(o){return!!o&&"doubleValue"in o})(s)})(e)?e:{integerValue:0}:null}class or extends br{}class ps extends br{constructor(e){super(),this.elements=e}}function Tc(n,e){const t=Ic(e);for(const s of n.elements)t.some((r=>Xe(r,s)))||t.push(s);return{arrayValue:{values:t}}}class gs extends br{constructor(e){super(),this.elements=e}}function wc(n,e){let t=Ic(e);for(const s of n.elements)t=t.filter((r=>!Xe(r,s)));return{arrayValue:{values:t}}}class ar extends br{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Ua(n){return me(n.integerValue||n.doubleValue)}function Ic(n){return Hi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Mf(n,e){return n.field.isEqual(e.field)&&(function(s,r){return s instanceof ps&&r instanceof ps||s instanceof gs&&r instanceof gs?yn(s.elements,r.elements,Xe):s instanceof ar&&r instanceof ar?Xe(s.Ae,r.Ae):s instanceof or&&r instanceof or})(n.transform,e.transform)}class Bf{constructor(e,t){this.version=e,this.transformResults=t}}class Qe{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Qe}static exists(e){return new Qe(void 0,e)}static updateTime(e){return new Qe(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Gs(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class Er{}function Ac(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Gi(n.key,Qe.none()):new _s(n.key,n.data,Qe.none());{const t=n.data,s=Le.empty();let r=new Ee(Ce.comparator);for(let o of e.fields)if(!r.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?s.delete(o):s.set(o,a),r=r.add(o)}return new Qt(n.key,s,new Ue(r.toArray()),Qe.none())}}function $f(n,e,t){n instanceof _s?(function(r,o,a){const u=r.value.clone(),d=Ha(r.fieldTransforms,o,a.transformResults);u.setAll(d),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):n instanceof Qt?(function(r,o,a){if(!Gs(r.precondition,o))return void o.convertToUnknownDocument(a.version);const u=Ha(r.fieldTransforms,o,a.transformResults),d=o.data;d.setAll(Sc(r)),d.setAll(u),o.convertToFoundDocument(a.version,d).setHasCommittedMutations()})(n,e,t):(function(r,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function os(n,e,t,s){return n instanceof _s?(function(o,a,u,d){if(!Gs(o.precondition,a))return u;const f=o.value.clone(),g=za(o.fieldTransforms,d,a);return f.setAll(g),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null})(n,e,t,s):n instanceof Qt?(function(o,a,u,d){if(!Gs(o.precondition,a))return u;const f=za(o.fieldTransforms,d,a),g=a.data;return g.setAll(Sc(o)),g.setAll(f),a.convertToFoundDocument(a.version,g).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((b=>b.field)))})(n,e,t,s):(function(o,a,u){return Gs(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,e,t)}function Uf(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),o=Ec(s.transform,r||null);o!=null&&(t===null&&(t=Le.empty()),t.set(s.field,o))}return t||null}function qa(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&yn(s,r,((o,a)=>Mf(o,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class _s extends Er{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Qt extends Er{constructor(e,t,s,r,o=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function Sc(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}})),e}function Ha(n,e,t){const s=new Map;re(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let r=0;r<t.length;r++){const o=n[r],a=o.transform,u=e.data.field(o.field);s.set(o.field,Lf(a,u,t[r]))}return s}function za(n,e,t){const s=new Map;for(const r of n){const o=r.transform,a=t.data.field(r.field);s.set(r.field,Ff(o,a,e))}return s}class Gi extends Er{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class qf extends Er{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Hf{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const o=this.mutations[r];o.key.isEqual(e.key)&&$f(o,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=os(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=os(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=vc();return this.mutations.forEach((r=>{const o=e.get(r.key),a=o.overlayedDocument;let u=this.applyToLocalView(a,o.mutatedFields);u=t.has(r.key)?null:u;const d=Ac(a,u);d!==null&&s.set(r.key,d),a.isValidDocument()||a.convertToNoDocument(Q.min())})),s}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),ee())}isEqual(e){return this.batchId===e.batchId&&yn(this.mutations,e.mutations,((t,s)=>qa(t,s)))&&yn(this.baseMutations,e.baseMutations,((t,s)=>qa(t,s)))}}class Qi{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){re(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let r=(function(){return kf})();const o=e.mutations;for(let a=0;a<o.length;a++)r=r.insert(o[a].key,s[a].version);return new Qi(e,t,s,r)}}class zf{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Kf{constructor(e,t){this.count=e,this.unchangedNames=t}}var pe,te;function Wf(n){switch(n){case j.OK:return W(64938);case j.CANCELLED:case j.UNKNOWN:case j.DEADLINE_EXCEEDED:case j.RESOURCE_EXHAUSTED:case j.INTERNAL:case j.UNAVAILABLE:case j.UNAUTHENTICATED:return!1;case j.INVALID_ARGUMENT:case j.NOT_FOUND:case j.ALREADY_EXISTS:case j.PERMISSION_DENIED:case j.FAILED_PRECONDITION:case j.ABORTED:case j.OUT_OF_RANGE:case j.UNIMPLEMENTED:case j.DATA_LOSS:return!0;default:return W(15467,{code:n})}}function xc(n){if(n===void 0)return st("GRPC error has no .code"),j.UNKNOWN;switch(n){case pe.OK:return j.OK;case pe.CANCELLED:return j.CANCELLED;case pe.UNKNOWN:return j.UNKNOWN;case pe.DEADLINE_EXCEEDED:return j.DEADLINE_EXCEEDED;case pe.RESOURCE_EXHAUSTED:return j.RESOURCE_EXHAUSTED;case pe.INTERNAL:return j.INTERNAL;case pe.UNAVAILABLE:return j.UNAVAILABLE;case pe.UNAUTHENTICATED:return j.UNAUTHENTICATED;case pe.INVALID_ARGUMENT:return j.INVALID_ARGUMENT;case pe.NOT_FOUND:return j.NOT_FOUND;case pe.ALREADY_EXISTS:return j.ALREADY_EXISTS;case pe.PERMISSION_DENIED:return j.PERMISSION_DENIED;case pe.FAILED_PRECONDITION:return j.FAILED_PRECONDITION;case pe.ABORTED:return j.ABORTED;case pe.OUT_OF_RANGE:return j.OUT_OF_RANGE;case pe.UNIMPLEMENTED:return j.UNIMPLEMENTED;case pe.DATA_LOSS:return j.DATA_LOSS;default:return W(39323,{code:n})}}(te=pe||(pe={}))[te.OK=0]="OK",te[te.CANCELLED=1]="CANCELLED",te[te.UNKNOWN=2]="UNKNOWN",te[te.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",te[te.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",te[te.NOT_FOUND=5]="NOT_FOUND",te[te.ALREADY_EXISTS=6]="ALREADY_EXISTS",te[te.PERMISSION_DENIED=7]="PERMISSION_DENIED",te[te.UNAUTHENTICATED=16]="UNAUTHENTICATED",te[te.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",te[te.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",te[te.ABORTED=10]="ABORTED",te[te.OUT_OF_RANGE=11]="OUT_OF_RANGE",te[te.UNIMPLEMENTED=12]="UNIMPLEMENTED",te[te.INTERNAL=13]="INTERNAL",te[te.UNAVAILABLE=14]="UNAVAILABLE",te[te.DATA_LOSS=15]="DATA_LOSS";function Gf(){return new TextEncoder}const Qf=new Et([4294967295,4294967295],0);function Ka(n){const e=Gf().encode(n),t=new Ul;return t.update(e),new Uint8Array(t.digest())}function Wa(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new Et([t,s],0),new Et([r,o],0)]}class Ji{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new es(`Invalid padding: ${t}`);if(s<0)throw new es(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new es(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new es(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Et.fromNumber(this.ge)}ye(e,t,s){let r=e.add(t.multiply(Et.fromNumber(s)));return r.compare(Qf)===1&&(r=new Et([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Ka(e),[s,r]=Wa(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(s,r,o);if(!this.we(a))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new Ji(o,r,t);return s.forEach((u=>a.insert(u))),a}insert(e){if(this.ge===0)return;const t=Ka(e),[s,r]=Wa(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(s,r,o);this.be(a)}}be(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class es extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Tr{constructor(e,t,s,r,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,vs.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new Tr(Q.min(),r,new he(Z),rt(),ee())}}class vs{constructor(e,t,s,r,o){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new vs(s,t,ee(),ee(),ee())}}class Qs{constructor(e,t,s,r){this.Se=e,this.removedTargetIds=t,this.key=s,this.De=r}}class Cc{constructor(e,t){this.targetId=e,this.Ce=t}}class Nc{constructor(e,t,s=Ne.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class Ga{constructor(){this.ve=0,this.Fe=Qa(),this.Me=Ne.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=ee(),t=ee(),s=ee();return this.Fe.forEach(((r,o)=>{switch(o){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:W(38017,{changeType:o})}})),new vs(this.Me,this.xe,e,t,s)}Ke(){this.Oe=!1,this.Fe=Qa()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,re(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class Jf{constructor(e){this.Ge=e,this.ze=new Map,this.je=rt(),this.He=Us(),this.Je=Us(),this.Ze=new he(Z)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.We(),s.Ne||s.Ke(),s.Le(e.resumeToken);break;case 2:s.We(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.Qe(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:W(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((s,r)=>{this.rt(r)&&t(r)}))}st(e){const t=e.targetId,s=e.Ce.count,r=this.ot(t);if(r){const o=r.target;if(wi(o))if(s===0){const a=new K(o.path);this.et(t,a,ke.newNoDocument(a,Q.min()))}else re(s===1,20013,{expectedCount:s});else{const a=this._t(t);if(a!==s){const u=this.ut(e),d=u?this.ct(u,e,a):1;if(d!==0){this.it(t);const f=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,f)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:o=0}=t;let a,u;try{a=St(s).toUint8Array()}catch(d){if(d instanceof ec)return zt("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{u=new Ji(a,r,o)}catch(d){return zt(d instanceof es?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return u.ge===0?null:u}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let r=0;return s.forEach((o=>{const a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(t,o,null),r++)})),r}Tt(e){const t=new Map;this.ze.forEach(((o,a)=>{const u=this.ot(a);if(u){if(o.current&&wi(u.target)){const d=new K(u.target.path);this.It(d).has(a)||this.Et(a,d)||this.et(a,d,ke.newNoDocument(d,e))}o.Be&&(t.set(a,o.ke()),o.Ke())}}));let s=ee();this.Je.forEach(((o,a)=>{let u=!0;a.forEachWhile((d=>{const f=this.ot(d);return!f||f.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(s=s.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(e)));const r=new Tr(e,t,this.Ze,this.je,s);return this.je=rt(),this.He=Us(),this.Je=Us(),this.Ze=new he(Z),r}Ye(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,s),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.qe(t,1):r.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new Ga,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new Ee(Z),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new Ee(Z),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||U("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Ga),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Us(){return new he(K.comparator)}function Qa(){return new he(K.comparator)}const Yf={asc:"ASCENDING",desc:"DESCENDING"},Xf={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Zf={and:"AND",or:"OR"};class em{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ai(n,e){return n.useProto3Json||pr(e)?e:{value:e}}function lr(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Rc(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function tm(n,e){return lr(n,e.toTimestamp())}function Je(n){return re(!!n,49232),Q.fromTimestamp((function(t){const s=At(t);return new ce(s.seconds,s.nanos)})(n))}function Yi(n,e){return Si(n,e).canonicalString()}function Si(n,e){const t=(function(r){return new le(["projects",r.projectId,"databases",r.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Pc(n){const e=le.fromString(n);return re(Oc(e),10190,{key:e.toString()}),e}function xi(n,e){return Yi(n.databaseId,e.path)}function ri(n,e){const t=Pc(e);if(t.get(1)!==n.databaseId.projectId)throw new q(j.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new q(j.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new K(Dc(t))}function kc(n,e){return Yi(n.databaseId,e)}function nm(n){const e=Pc(n);return e.length===4?le.emptyPath():Dc(e)}function Ci(n){return new le(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Dc(n){return re(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Ja(n,e,t){return{name:xi(n,e),fields:t.value.mapValue.fields}}function sm(n,e){let t;if("targetChange"in e){e.targetChange;const s=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:W(39313,{state:f})})(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],o=(function(f,g){return f.useProto3Json?(re(g===void 0||typeof g=="string",58123),Ne.fromBase64String(g||"")):(re(g===void 0||g instanceof Buffer||g instanceof Uint8Array,16193),Ne.fromUint8Array(g||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&(function(f){const g=f.code===void 0?j.UNKNOWN:xc(f.code);return new q(g,f.message||"")})(a);t=new Nc(s,r,o,u||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=ri(n,s.document.name),o=Je(s.document.updateTime),a=s.document.createTime?Je(s.document.createTime):Q.min(),u=new Le({mapValue:{fields:s.document.fields}}),d=ke.newFoundDocument(r,o,a,u),f=s.targetIds||[],g=s.removedTargetIds||[];t=new Qs(f,g,d.key,d)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=ri(n,s.document),o=s.readTime?Je(s.readTime):Q.min(),a=ke.newNoDocument(r,o),u=s.removedTargetIds||[];t=new Qs([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=ri(n,s.document),o=s.removedTargetIds||[];t=new Qs([],o,r,null)}else{if(!("filter"in e))return W(11601,{Vt:e});{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:o}=s,a=new Kf(r,o),u=s.targetId;t=new Cc(u,a)}}return t}function rm(n,e){let t;if(e instanceof _s)t={update:Ja(n,e.key,e.value)};else if(e instanceof Gi)t={delete:xi(n,e.key)};else if(e instanceof Qt)t={update:Ja(n,e.key,e.data),updateMask:fm(e.fieldMask)};else{if(!(e instanceof qf))return W(16599,{dt:e.type});t={verify:xi(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((s=>(function(o,a){const u=a.transform;if(u instanceof or)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ps)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof gs)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof ar)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw W(20930,{transform:a.transform})})(0,s)))),e.precondition.isNone||(t.currentDocument=(function(r,o){return o.updateTime!==void 0?{updateTime:tm(r,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:W(27497)})(n,e.precondition)),t}function im(n,e){return n&&n.length>0?(re(e!==void 0,14353),n.map((t=>(function(r,o){let a=r.updateTime?Je(r.updateTime):Je(o);return a.isEqual(Q.min())&&(a=Je(o)),new Bf(a,r.transformResults||[])})(t,e)))):[]}function om(n,e){return{documents:[kc(n,e.path)]}}function am(n,e){const t={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=kc(n,r);const o=(function(f){if(f.length!==0)return jc(Ze.create(f,"and"))})(e.filters);o&&(t.structuredQuery.where=o);const a=(function(f){if(f.length!==0)return f.map((g=>(function(I){return{field:cn(I.field),direction:um(I.dir)}})(g)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=Ai(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(e.endAt)),{ft:t,parent:r}}function lm(n){let e=nm(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){re(s===1,65062);const g=t.from[0];g.allDescendants?r=g.collectionId:e=e.child(g.collectionId)}let o=[];t.where&&(o=(function(b){const I=Vc(b);return I instanceof Ze&&uc(I)?I.getFilters():[I]})(t.where));let a=[];t.orderBy&&(a=(function(b){return b.map((I=>(function(A){return new ir(un(A.field),(function(C){switch(C){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(A.direction))})(I)))})(t.orderBy));let u=null;t.limit&&(u=(function(b){let I;return I=typeof b=="object"?b.value:b,pr(I)?null:I})(t.limit));let d=null;t.startAt&&(d=(function(b){const I=!!b.before,x=b.values||[];return new rr(x,I)})(t.startAt));let f=null;return t.endAt&&(f=(function(b){const I=!b.before,x=b.values||[];return new rr(x,I)})(t.endAt)),Af(e,r,a,o,u,"F",d,f)}function cm(n,e){const t=(function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return W(28987,{purpose:r})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Vc(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=un(t.unaryFilter.field);return be.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=un(t.unaryFilter.field);return be.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=un(t.unaryFilter.field);return be.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=un(t.unaryFilter.field);return be.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return W(61313);default:return W(60726)}})(n):n.fieldFilter!==void 0?(function(t){return be.create(un(t.fieldFilter.field),(function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return W(58110);default:return W(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Ze.create(t.compositeFilter.filters.map((s=>Vc(s))),(function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return W(1026)}})(t.compositeFilter.op))})(n):W(30097,{filter:n})}function um(n){return Yf[n]}function hm(n){return Xf[n]}function dm(n){return Zf[n]}function cn(n){return{fieldPath:n.canonicalString()}}function un(n){return Ce.fromServerFormat(n.fieldPath)}function jc(n){return n instanceof be?(function(t){if(t.op==="=="){if(Fa(t.value))return{unaryFilter:{field:cn(t.field),op:"IS_NAN"}};if(Oa(t.value))return{unaryFilter:{field:cn(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Fa(t.value))return{unaryFilter:{field:cn(t.field),op:"IS_NOT_NAN"}};if(Oa(t.value))return{unaryFilter:{field:cn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:cn(t.field),op:hm(t.op),value:t.value}}})(n):n instanceof Ze?(function(t){const s=t.getFilters().map((r=>jc(r)));return s.length===1?s[0]:{compositeFilter:{op:dm(t.op),filters:s}}})(n):W(54877,{filter:n})}function fm(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Oc(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function Fc(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}class yt{constructor(e,t,s,r,o=Q.min(),a=Q.min(),u=Ne.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=d}withSequenceNumber(e){return new yt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new yt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new yt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new yt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class mm{constructor(e){this.yt=e}}function pm(n){const e=lm({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ii(e,e.limit,"L"):e}class gm{constructor(){this.Sn=new ym}addToCollectionParentIndex(e,t){return this.Sn.add(t),k.resolve()}getCollectionParents(e,t){return k.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return k.resolve()}deleteFieldIndex(e,t){return k.resolve()}deleteAllFieldIndexes(e){return k.resolve()}createTargetIndexes(e,t){return k.resolve()}getDocumentsMatchingTarget(e,t){return k.resolve(null)}getIndexType(e,t){return k.resolve(0)}getFieldIndexes(e,t){return k.resolve([])}getNextCollectionGroupToUpdate(e){return k.resolve(null)}getMinOffset(e,t){return k.resolve(It.min())}getMinOffsetFromCollectionGroup(e,t){return k.resolve(It.min())}updateCollectionGroup(e,t,s){return k.resolve()}updateIndexEntries(e,t){return k.resolve()}}class ym{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new Ee(le.comparator),o=!r.has(s);return this.index[t]=r.add(s),o}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new Ee(le.comparator)).toArray()}}const Ya={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Lc=41943040;class Ve{static withCacheSize(e){return new Ve(e,Ve.DEFAULT_COLLECTION_PERCENTILE,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}Ve.DEFAULT_COLLECTION_PERCENTILE=10,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ve.DEFAULT=new Ve(Lc,Ve.DEFAULT_COLLECTION_PERCENTILE,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ve.DISABLED=new Ve(-1,0,0);class En{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new En(0)}static ar(){return new En(-1)}}const Xa="LruGarbageCollector",_m=1048576;function Za([n,e],[t,s]){const r=Z(n,t);return r===0?Z(e,s):r}class vm{constructor(e){this.Pr=e,this.buffer=new Ee(Za),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();Za(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class bm{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){U(Xa,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Cn(t)?U(Xa,"Ignoring IndexedDB error during garbage collection: ",t):await xn(t)}await this.Ar(3e5)}))}}class Em{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next((s=>Math.floor(t/100*s)))}nthSequenceNumber(e,t){if(t===0)return k.resolve(mr.ce);const s=new vm(t);return this.Vr.forEachTarget(e,(r=>s.Er(r.sequenceNumber))).next((()=>this.Vr.mr(e,(r=>s.Er(r))))).next((()=>s.maxValue))}removeTargets(e,t,s){return this.Vr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(U("LruGarbageCollector","Garbage collection skipped; disabled"),k.resolve(Ya)):this.getCacheSize(e).next((s=>s<this.params.cacheSizeCollectionThreshold?(U("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ya):this.gr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let s,r,o,a,u,d,f;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((b=>(b>this.params.maximumSequenceNumbersToCollect?(U("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${b}`),r=this.params.maximumSequenceNumbersToCollect):r=b,a=Date.now(),this.nthSequenceNumber(e,r)))).next((b=>(s=b,u=Date.now(),this.removeTargets(e,s,t)))).next((b=>(o=b,d=Date.now(),this.removeOrphanedDocuments(e,s)))).next((b=>(f=Date.now(),an()<=ne.DEBUG&&U("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-g}ms
	Determined least recently used ${r} in `+(u-a)+`ms
	Removed ${o} targets in `+(d-u)+`ms
	Removed ${b} documents in `+(f-d)+`ms
Total Duration: ${f-g}ms`),k.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:o,documentsRemoved:b}))))}}function Tm(n,e){return new Em(n,e)}class wm{constructor(){this.changes=new Gt((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ke.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?k.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Im{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Am{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(s=r,this.remoteDocumentCache.getEntry(e,t)))).next((r=>(s!==null&&os(s.mutation,r,Ue.empty(),ce.now()),r)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.getLocalViewOfDocuments(e,s,ee()).next((()=>s))))}getLocalViewOfDocuments(e,t,s=ee()){const r=qt();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,s).next((o=>{let a=Zn();return o.forEach(((u,d)=>{a=a.insert(u,d.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const s=qt();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,ee())))}populateOverlays(e,t,s){const r=[];return s.forEach((o=>{t.has(o)||r.push(o)})),this.documentOverlayCache.getOverlays(e,r).next((o=>{o.forEach(((a,u)=>{t.set(a,u)}))}))}computeViews(e,t,s,r){let o=rt();const a=is(),u=(function(){return is()})();return t.forEach(((d,f)=>{const g=s.get(f.key);r.has(f.key)&&(g===void 0||g.mutation instanceof Qt)?o=o.insert(f.key,f):g!==void 0?(a.set(f.key,g.mutation.getFieldMask()),os(g.mutation,f,g.mutation.getFieldMask(),ce.now())):a.set(f.key,Ue.empty())})),this.recalculateAndSaveOverlays(e,o).next((d=>(d.forEach(((f,g)=>a.set(f,g))),t.forEach(((f,g)=>u.set(f,new Im(g,a.get(f)??null)))),u)))}recalculateAndSaveOverlays(e,t){const s=is();let r=new he(((a,u)=>a-u)),o=ee();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const u of a)u.keys().forEach((d=>{const f=t.get(d);if(f===null)return;let g=s.get(d)||Ue.empty();g=u.applyToLocalView(f,g),s.set(d,g);const b=(r.get(u.batchId)||ee()).add(d);r=r.insert(u.batchId,b)}))})).next((()=>{const a=[],u=r.getReverseIterator();for(;u.hasNext();){const d=u.getNext(),f=d.key,g=d.value,b=vc();g.forEach((I=>{if(!o.has(I)){const x=Ac(t.get(I),s.get(I));x!==null&&b.set(I,x),o=o.add(I)}})),a.push(this.documentOverlayCache.saveOverlays(e,f,b))}return k.waitFor(a)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.recalculateAndSaveOverlays(e,s)))}getDocumentsMatchingQuery(e,t,s,r){return Sf(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):xf(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r)}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next((o=>{const a=r-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-o.size):k.resolve(qt());let u=hs,d=o;return a.next((f=>k.forEach(f,((g,b)=>(u<b.largestBatchId&&(u=b.largestBatchId),o.get(g)?k.resolve():this.remoteDocumentCache.getEntry(e,g).next((I=>{d=d.insert(g,I)}))))).next((()=>this.populateOverlays(e,f,o))).next((()=>this.computeViews(e,d,f,ee()))).next((g=>({batchId:u,changes:_c(g)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new K(t)).next((s=>{let r=Zn();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r}))}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const o=t.collectionGroup;let a=Zn();return this.indexManager.getCollectionParents(e,o).next((u=>k.forEach(u,(d=>{const f=(function(b,I){return new yr(I,null,b.explicitOrderBy.slice(),b.filters.slice(),b.limit,b.limitType,b.startAt,b.endAt)})(t,d.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,s,r).next((g=>{g.forEach(((b,I)=>{a=a.insert(b,I)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,s,r){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,o,r)))).next((a=>{o.forEach(((d,f)=>{const g=f.getKey();a.get(g)===null&&(a=a.insert(g,ke.newInvalidDocument(g)))}));let u=Zn();return a.forEach(((d,f)=>{const g=o.get(d);g!==void 0&&os(g.mutation,f,Ue.empty(),ce.now()),vr(t,f)&&(u=u.insert(d,f))})),u}))}}class Sm{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return k.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,(function(r){return{id:r.id,version:r.version,createTime:Je(r.createTime)}})(t)),k.resolve()}getNamedQuery(e,t){return k.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,(function(r){return{name:r.name,query:pm(r.bundledQuery),readTime:Je(r.readTime)}})(t)),k.resolve()}}class xm{constructor(){this.overlays=new he(K.comparator),this.Lr=new Map}getOverlay(e,t){return k.resolve(this.overlays.get(t))}getOverlays(e,t){const s=qt();return k.forEach(t,(r=>this.getOverlay(e,r).next((o=>{o!==null&&s.set(r,o)})))).next((()=>s))}saveOverlays(e,t,s){return s.forEach(((r,o)=>{this.bt(e,t,o)})),k.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.Lr.get(s);return r!==void 0&&(r.forEach((o=>this.overlays=this.overlays.remove(o))),this.Lr.delete(s)),k.resolve()}getOverlaysForCollection(e,t,s){const r=qt(),o=t.length+1,a=new K(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const d=u.getNext().value,f=d.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===o&&d.largestBatchId>s&&r.set(d.getKey(),d)}return k.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let o=new he(((f,g)=>f-g));const a=this.overlays.getIterator();for(;a.hasNext();){const f=a.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>s){let g=o.get(f.largestBatchId);g===null&&(g=qt(),o=o.insert(f.largestBatchId,g)),g.set(f.getKey(),f)}}const u=qt(),d=o.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach(((f,g)=>u.set(f,g))),!(u.size()>=r)););return k.resolve(u)}bt(e,t,s){const r=this.overlays.get(s.key);if(r!==null){const a=this.Lr.get(r.largestBatchId).delete(s.key);this.Lr.set(r.largestBatchId,a)}this.overlays=this.overlays.insert(s.key,new zf(t,s));let o=this.Lr.get(t);o===void 0&&(o=ee(),this.Lr.set(t,o)),this.Lr.set(t,o.add(s.key))}}class Cm{constructor(){this.sessionToken=Ne.EMPTY_BYTE_STRING}getSessionToken(e){return k.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,k.resolve()}}class Xi{constructor(){this.kr=new Ee(Ae.Kr),this.qr=new Ee(Ae.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const s=new Ae(e,t);this.kr=this.kr.add(s),this.qr=this.qr.add(s)}$r(e,t){e.forEach((s=>this.addReference(s,t)))}removeReference(e,t){this.Wr(new Ae(e,t))}Qr(e,t){e.forEach((s=>this.removeReference(s,t)))}Gr(e){const t=new K(new le([])),s=new Ae(t,e),r=new Ae(t,e+1),o=[];return this.qr.forEachInRange([s,r],(a=>{this.Wr(a),o.push(a.key)})),o}zr(){this.kr.forEach((e=>this.Wr(e)))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new K(new le([])),s=new Ae(t,e),r=new Ae(t,e+1);let o=ee();return this.qr.forEachInRange([s,r],(a=>{o=o.add(a.key)})),o}containsKey(e){const t=new Ae(e,0),s=this.kr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class Ae{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return K.comparator(e.key,t.key)||Z(e.Hr,t.Hr)}static Ur(e,t){return Z(e.Hr,t.Hr)||K.comparator(e.key,t.key)}}class Nm{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new Ee(Ae.Kr)}checkEmpty(e){return k.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,r){const o=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Hf(o,t,s,r);this.mutationQueue.push(a);for(const u of r)this.Jr=this.Jr.add(new Ae(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return k.resolve(a)}lookupMutationBatch(e,t){return k.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.Xr(s),o=r<0?0:r;return k.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return k.resolve(this.mutationQueue.length===0?Ui:this.Yn-1)}getAllMutationBatches(e){return k.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new Ae(t,0),r=new Ae(t,Number.POSITIVE_INFINITY),o=[];return this.Jr.forEachInRange([s,r],(a=>{const u=this.Zr(a.Hr);o.push(u)})),k.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Ee(Z);return t.forEach((r=>{const o=new Ae(r,0),a=new Ae(r,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([o,a],(u=>{s=s.add(u.Hr)}))})),k.resolve(this.Yr(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let o=s;K.isDocumentKey(o)||(o=o.child(""));const a=new Ae(new K(o),0);let u=new Ee(Z);return this.Jr.forEachWhile((d=>{const f=d.key.path;return!!s.isPrefixOf(f)&&(f.length===r&&(u=u.add(d.Hr)),!0)}),a),k.resolve(this.Yr(u))}Yr(e){const t=[];return e.forEach((s=>{const r=this.Zr(s);r!==null&&t.push(r)})),t}removeMutationBatch(e,t){re(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Jr;return k.forEach(t.mutations,(r=>{const o=new Ae(r.key,t.batchId);return s=s.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Jr=s}))}nr(e){}containsKey(e,t){const s=new Ae(t,0),r=this.Jr.firstAfterOrEqual(s);return k.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,k.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Rm{constructor(e){this.ti=e,this.docs=(function(){return new he(K.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),o=r?r.size:0,a=this.ti(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return k.resolve(s?s.document.mutableCopy():ke.newInvalidDocument(t))}getEntries(e,t){let s=rt();return t.forEach((r=>{const o=this.docs.get(r);s=s.insert(r,o?o.document.mutableCopy():ke.newInvalidDocument(r))})),k.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let o=rt();const a=t.path,u=new K(a.child("__id-9223372036854775808__")),d=this.docs.getIteratorFrom(u);for(;d.hasNext();){const{key:f,value:{document:g}}=d.getNext();if(!a.isPrefixOf(f.path))break;f.path.length>a.length+1||tf(ef(g),s)<=0||(r.has(g.key)||vr(t,g))&&(o=o.insert(g.key,g.mutableCopy()))}return k.resolve(o)}getAllFromCollectionGroup(e,t,s,r){W(9500)}ni(e,t){return k.forEach(this.docs,(s=>t(s)))}newChangeBuffer(e){return new Pm(this)}getSize(e){return k.resolve(this.size)}}class Pm extends wm{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach(((s,r)=>{r.isValidDocument()?t.push(this.Mr.addEntry(e,r)):this.Mr.removeEntry(s)})),k.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class km{constructor(e){this.persistence=e,this.ri=new Gt((t=>zi(t)),Ki),this.lastRemoteSnapshotVersion=Q.min(),this.highestTargetId=0,this.ii=0,this.si=new Xi,this.targetCount=0,this.oi=En._r()}forEachTarget(e,t){return this.ri.forEach(((s,r)=>t(r))),k.resolve()}getLastRemoteSnapshotVersion(e){return k.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return k.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),k.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.ii&&(this.ii=t),k.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new En(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,k.resolve()}updateTargetData(e,t){return this.lr(t),k.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,k.resolve()}removeTargets(e,t,s){let r=0;const o=[];return this.ri.forEach(((a,u)=>{u.sequenceNumber<=t&&s.get(u.targetId)===null&&(this.ri.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),r++)})),k.waitFor(o).next((()=>r))}getTargetCount(e){return k.resolve(this.targetCount)}getTargetData(e,t){const s=this.ri.get(t)||null;return k.resolve(s)}addMatchingKeys(e,t,s){return this.si.$r(t,s),k.resolve()}removeMatchingKeys(e,t,s){this.si.Qr(t,s);const r=this.persistence.referenceDelegate,o=[];return r&&t.forEach((a=>{o.push(r.markPotentiallyOrphaned(e,a))})),k.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),k.resolve()}getMatchingKeysForTargetId(e,t){const s=this.si.jr(t);return k.resolve(s)}containsKey(e,t){return k.resolve(this.si.containsKey(t))}}class Mc{constructor(e,t){this._i={},this.overlays={},this.ai=new mr(0),this.ui=!1,this.ui=!0,this.ci=new Cm,this.referenceDelegate=e(this),this.li=new km(this),this.indexManager=new gm,this.remoteDocumentCache=(function(r){return new Rm(r)})((s=>this.referenceDelegate.hi(s))),this.serializer=new mm(t),this.Pi=new Sm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new xm,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this._i[e.toKey()];return s||(s=new Nm(t,this.referenceDelegate),this._i[e.toKey()]=s),s}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,s){U("MemoryPersistence","Starting transaction:",e);const r=new Dm(this.ai.next());return this.referenceDelegate.Ti(),s(r).next((o=>this.referenceDelegate.Ii(r).next((()=>o)))).toPromise().then((o=>(r.raiseOnCommittedEvent(),o)))}Ei(e,t){return k.or(Object.values(this._i).map((s=>()=>s.containsKey(e,t))))}}class Dm extends sf{constructor(e){super(),this.currentSequenceNumber=e}}class Zi{constructor(e){this.persistence=e,this.Ri=new Xi,this.Ai=null}static Vi(e){return new Zi(e)}get di(){if(this.Ai)return this.Ai;throw W(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.di.delete(s.toString()),k.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.di.add(s.toString()),k.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),k.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach((r=>this.di.add(r.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next((r=>{r.forEach((o=>this.di.add(o.toString())))})).next((()=>s.removeTargetData(e,t)))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return k.forEach(this.di,(s=>{const r=K.fromPath(s);return this.mi(e,r).next((o=>{o||t.removeEntry(r,Q.min())}))})).next((()=>(this.Ai=null,t.apply(e))))}updateLimboDocument(e,t){return this.mi(e,t).next((s=>{s?this.di.delete(t.toString()):this.di.add(t.toString())}))}hi(e){return 0}mi(e,t){return k.or([()=>k.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class cr{constructor(e,t){this.persistence=e,this.fi=new Gt((s=>af(s.path)),((s,r)=>s.isEqual(r))),this.garbageCollector=Tm(this,t)}static Vi(e,t){return new cr(e,t)}Ti(){}Ii(e){return k.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next((s=>t.next((r=>s+r))))}pr(e){let t=0;return this.mr(e,(s=>{t++})).next((()=>t))}mr(e,t){return k.forEach(this.fi,((s,r)=>this.wr(e,s,r).next((o=>o?k.resolve():t(r)))))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const r=this.persistence.getRemoteDocumentCache(),o=r.newChangeBuffer();return r.ni(e,(a=>this.wr(e,a,t).next((u=>{u||(s++,o.removeEntry(a,Q.min()))})))).next((()=>o.apply(e))).next((()=>s))}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),k.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.fi.set(s,e.currentSequenceNumber),k.resolve()}removeReference(e,t,s){return this.fi.set(s,e.currentSequenceNumber),k.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),k.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ks(e.data.value)),t}wr(e,t,s){return k.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.fi.get(t);return k.resolve(r!==void 0&&r>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class eo{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Ts=s,this.Is=r}static Es(e,t){let s=ee(),r=ee();for(const o of t.docChanges)switch(o.type){case 0:s=s.add(o.doc.key);break;case 1:r=r.add(o.doc.key)}return new eo(e,t.fromCache,s,r)}}class Vm{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class jm{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return Eh()?8:rf(vh())>0?6:4})()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,r){const o={result:null};return this.gs(e,t).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ps(e,t,r,s).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new Vm;return this.ys(e,t,a).next((u=>{if(o.result=u,this.As)return this.ws(e,t,a,u.size)}))})).next((()=>o.result))}ws(e,t,s,r){return s.documentReadCount<this.Vs?(an()<=ne.DEBUG&&U("QueryEngine","SDK will not create cache indexes for query:",ln(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),k.resolve()):(an()<=ne.DEBUG&&U("QueryEngine","Query:",ln(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.ds*r?(an()<=ne.DEBUG&&U("QueryEngine","The SDK decides to create cache indexes for query:",ln(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ge(t))):k.resolve())}gs(e,t){if($a(t))return k.resolve(null);let s=Ge(t);return this.indexManager.getIndexType(e,s).next((r=>r===0?null:(t.limit!==null&&r===1&&(t=Ii(t,null,"F"),s=Ge(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next((o=>{const a=ee(...o);return this.fs.getDocuments(e,a).next((u=>this.indexManager.getMinOffset(e,s).next((d=>{const f=this.bs(t,u);return this.Ss(t,f,a,d.readTime)?this.gs(e,Ii(t,null,"F")):this.Ds(e,f,t,d)}))))})))))}ps(e,t,s,r){return $a(t)||r.isEqual(Q.min())?k.resolve(null):this.fs.getDocuments(e,s).next((o=>{const a=this.bs(t,o);return this.Ss(t,a,s,r)?k.resolve(null):(an()<=ne.DEBUG&&U("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ln(t)),this.Ds(e,a,t,Zd(r,hs)).next((u=>u)))}))}bs(e,t){let s=new Ee(gc(e));return t.forEach(((r,o)=>{vr(e,o)&&(s=s.add(o))})),s}Ss(e,t,s,r){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(r)>0)}ys(e,t,s){return an()<=ne.DEBUG&&U("QueryEngine","Using full collection scan to execute query:",ln(t)),this.fs.getDocumentsMatchingQuery(e,t,It.min(),s)}Ds(e,t,s,r){return this.fs.getDocumentsMatchingQuery(e,s,r).next((o=>(t.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const to="LocalStore",Om=3e8;class Fm{constructor(e,t,s,r){this.persistence=e,this.Cs=t,this.serializer=r,this.vs=new he(Z),this.Fs=new Gt((o=>zi(o)),Ki),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(s)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Am(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.vs)))}}function Lm(n,e,t,s){return new Fm(n,e,t,s)}async function Bc(n,e){const t=J(n);return await t.persistence.runTransaction("Handle user change","readonly",(s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next((o=>(r=o,t.Os(e),t.mutationQueue.getAllMutationBatches(s)))).next((o=>{const a=[],u=[];let d=ee();for(const f of r){a.push(f.batchId);for(const g of f.mutations)d=d.add(g.key)}for(const f of o){u.push(f.batchId);for(const g of f.mutations)d=d.add(g.key)}return t.localDocuments.getDocuments(s,d).next((f=>({Ns:f,removedBatchIds:a,addedBatchIds:u})))}))}))}function Mm(n,e){const t=J(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(s=>{const r=e.batch.keys(),o=t.xs.newChangeBuffer({trackRemovals:!0});return(function(u,d,f,g){const b=f.batch,I=b.keys();let x=k.resolve();return I.forEach((A=>{x=x.next((()=>g.getEntry(d,A))).next((R=>{const C=f.docVersions.get(A);re(C!==null,48541),R.version.compareTo(C)<0&&(b.applyToRemoteDocument(R,f),R.isValidDocument()&&(R.setReadTime(f.commitVersion),g.addEntry(R)))}))})),x.next((()=>u.mutationQueue.removeMutationBatch(d,b)))})(t,s,e,o).next((()=>o.apply(s))).next((()=>t.mutationQueue.performConsistencyCheck(s))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,(function(u){let d=ee();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(d=d.add(u.batch.mutations[f].key));return d})(e)))).next((()=>t.localDocuments.getDocuments(s,r)))}))}function $c(n){const e=J(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.li.getLastRemoteSnapshotVersion(t)))}function Bm(n,e){const t=J(n),s=e.snapshotVersion;let r=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=t.xs.newChangeBuffer({trackRemovals:!0});r=t.vs;const u=[];e.targetChanges.forEach(((g,b)=>{const I=r.get(b);if(!I)return;u.push(t.li.removeMatchingKeys(o,g.removedDocuments,b).next((()=>t.li.addMatchingKeys(o,g.addedDocuments,b))));let x=I.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(b)!==null?x=x.withResumeToken(Ne.EMPTY_BYTE_STRING,Q.min()).withLastLimboFreeSnapshotVersion(Q.min()):g.resumeToken.approximateByteSize()>0&&(x=x.withResumeToken(g.resumeToken,s)),r=r.insert(b,x),(function(R,C,L){return R.resumeToken.approximateByteSize()===0||C.snapshotVersion.toMicroseconds()-R.snapshotVersion.toMicroseconds()>=Om?!0:L.addedDocuments.size+L.modifiedDocuments.size+L.removedDocuments.size>0})(I,x,g)&&u.push(t.li.updateTargetData(o,x))}));let d=rt(),f=ee();if(e.documentUpdates.forEach((g=>{e.resolvedLimboDocuments.has(g)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,g))})),u.push($m(o,a,e.documentUpdates).next((g=>{d=g.Bs,f=g.Ls}))),!s.isEqual(Q.min())){const g=t.li.getLastRemoteSnapshotVersion(o).next((b=>t.li.setTargetsMetadata(o,o.currentSequenceNumber,s)));u.push(g)}return k.waitFor(u).next((()=>a.apply(o))).next((()=>t.localDocuments.getLocalViewOfDocuments(o,d,f))).next((()=>d))})).then((o=>(t.vs=r,o)))}function $m(n,e,t){let s=ee(),r=ee();return t.forEach((o=>s=s.add(o))),e.getEntries(n,s).next((o=>{let a=rt();return t.forEach(((u,d)=>{const f=o.get(u);d.isFoundDocument()!==f.isFoundDocument()&&(r=r.add(u)),d.isNoDocument()&&d.version.isEqual(Q.min())?(e.removeEntry(u,d.readTime),a=a.insert(u,d)):!f.isValidDocument()||d.version.compareTo(f.version)>0||d.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(d),a=a.insert(u,d)):U(to,"Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",d.version)})),{Bs:a,Ls:r}}))}function Um(n,e){const t=J(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(s=>(e===void 0&&(e=Ui),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e))))}function qm(n,e){const t=J(n);return t.persistence.runTransaction("Allocate target","readwrite",(s=>{let r;return t.li.getTargetData(s,e).next((o=>o?(r=o,k.resolve(r)):t.li.allocateTargetId(s).next((a=>(r=new yt(e,a,"TargetPurposeListen",s.currentSequenceNumber),t.li.addTargetData(s,r).next((()=>r)))))))})).then((s=>{const r=t.vs.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.vs=t.vs.insert(s.targetId,s),t.Fs.set(e,s.targetId)),s}))}async function Ni(n,e,t){const s=J(n),r=s.vs.get(e),o=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",o,(a=>s.persistence.referenceDelegate.removeTarget(a,r)))}catch(a){if(!Cn(a))throw a;U(to,`Failed to update sequence numbers for target ${e}: ${a}`)}s.vs=s.vs.remove(e),s.Fs.delete(r.target)}function el(n,e,t){const s=J(n);let r=Q.min(),o=ee();return s.persistence.runTransaction("Execute query","readwrite",(a=>(function(d,f,g){const b=J(d),I=b.Fs.get(g);return I!==void 0?k.resolve(b.vs.get(I)):b.li.getTargetData(f,g)})(s,a,Ge(e)).next((u=>{if(u)return r=u.lastLimboFreeSnapshotVersion,s.li.getMatchingKeysForTargetId(a,u.targetId).next((d=>{o=d}))})).next((()=>s.Cs.getDocumentsMatchingQuery(a,e,t?r:Q.min(),t?o:ee()))).next((u=>(Hm(s,Nf(e),u),{documents:u,ks:o})))))}function Hm(n,e,t){let s=n.Ms.get(e)||Q.min();t.forEach(((r,o)=>{o.readTime.compareTo(s)>0&&(s=o.readTime)})),n.Ms.set(e,s)}class tl{constructor(){this.activeTargetIds=jf()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class zm{constructor(){this.vo=new tl,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,s){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new tl,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Km{Mo(e){}shutdown(){}}const nl="ConnectivityMonitor";class sl{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){U(nl,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){U(nl,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let qs=null;function Ri(){return qs===null?qs=(function(){return 268435456+Math.round(2147483648*Math.random())})():qs++,"0x"+qs.toString(16)}const ii="RestConnection",Wm={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class Gm{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${s}/databases/${r}`,this.$o=this.databaseId.database===nr?`project_id=${s}`:`project_id=${s}&database_id=${r}`}Wo(e,t,s,r,o){const a=Ri(),u=this.Qo(e,t.toUriEncodedString());U(ii,`Sending RPC '${e}' ${a}:`,u,s);const d={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(d,r,o);const{host:f}=new URL(u),g=Fi(f);return this.zo(e,u,d,s,g).then((b=>(U(ii,`Received RPC '${e}' ${a}: `,b),b)),(b=>{throw zt(ii,`RPC '${e}' ${a} failed with error: `,b,"url: ",u,"request:",s),b}))}jo(e,t,s,r,o,a){return this.Wo(e,t,s,r,o)}Go(e,t,s){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Sn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((r,o)=>e[o]=r)),s&&s.headers.forEach(((r,o)=>e[o]=r))}Qo(e,t){const s=Wm[e];let r=`${this.qo}/v1/${t}:${s}`;return this.databaseInfo.apiKey&&(r=`${r}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),r}terminate(){}}class Qm{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}const Re="WebChannelConnection",Yn=(n,e,t)=>{n.listen(e,(s=>{try{t(s)}catch(r){setTimeout((()=>{throw r}),0)}}))};class dn extends Gm{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!dn.c_){const e=Kl();Yn(e,zl.STAT_EVENT,(t=>{t.stat===_i.PROXY?U(Re,"STAT_EVENT: detected buffering proxy"):t.stat===_i.NOPROXY&&U(Re,"STAT_EVENT: detected no buffering proxy")})),dn.c_=!0}}zo(e,t,s,r,o){const a=Ri();return new Promise(((u,d)=>{const f=new ql;f.setWithCredentials(!0),f.listenOnce(Hl.COMPLETE,(()=>{try{switch(f.getLastErrorCode()){case zs.NO_ERROR:const b=f.getResponseJson();U(Re,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(b)),u(b);break;case zs.TIMEOUT:U(Re,`RPC '${e}' ${a} timed out`),d(new q(j.DEADLINE_EXCEEDED,"Request time out"));break;case zs.HTTP_ERROR:const I=f.getStatus();if(U(Re,`RPC '${e}' ${a} failed with status:`,I,"response text:",f.getResponseText()),I>0){let x=f.getResponseJson();Array.isArray(x)&&(x=x[0]);const A=x?.error;if(A&&A.status&&A.message){const R=(function(L){const P=L.toLowerCase().replace(/_/g,"-");return Object.values(j).indexOf(P)>=0?P:j.UNKNOWN})(A.status);d(new q(R,A.message))}else d(new q(j.UNKNOWN,"Server responded with status "+f.getStatus()))}else d(new q(j.UNAVAILABLE,"Connection failed."));break;default:W(9055,{l_:e,streamId:a,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{U(Re,`RPC '${e}' ${a} completed.`)}}));const g=JSON.stringify(r);U(Re,`RPC '${e}' ${a} sending request:`,r),f.send(t,"POST",g,s,15)}))}T_(e,t,s){const r=Ri(),o=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Go(u.initMessageHeaders,t,s),u.encodeInitMessageHeaders=!0;const f=o.join("");U(Re,`Creating RPC '${e}' stream ${r}: ${f}`,u);const g=a.createWebChannel(f,u);this.I_(g);let b=!1,I=!1;const x=new Qm({Ho:A=>{I?U(Re,`Not sending because RPC '${e}' stream ${r} is closed:`,A):(b||(U(Re,`Opening RPC '${e}' stream ${r} transport.`),g.open(),b=!0),U(Re,`RPC '${e}' stream ${r} sending:`,A),g.send(A))},Jo:()=>g.close()});return Yn(g,Xn.EventType.OPEN,(()=>{I||(U(Re,`RPC '${e}' stream ${r} transport opened.`),x.i_())})),Yn(g,Xn.EventType.CLOSE,(()=>{I||(I=!0,U(Re,`RPC '${e}' stream ${r} transport closed`),x.o_(),this.E_(g))})),Yn(g,Xn.EventType.ERROR,(A=>{I||(I=!0,zt(Re,`RPC '${e}' stream ${r} transport errored. Name:`,A.name,"Message:",A.message),x.o_(new q(j.UNAVAILABLE,"The operation could not be completed")))})),Yn(g,Xn.EventType.MESSAGE,(A=>{if(!I){const R=A.data[0];re(!!R,16349);const C=R,L=C?.error||C[0]?.error;if(L){U(Re,`RPC '${e}' stream ${r} received error:`,L);const P=L.status;let O=(function(z){const E=pe[z];if(E!==void 0)return xc(E)})(P),$=L.message;P==="NOT_FOUND"&&$.includes("database")&&$.includes("does not exist")&&$.includes(this.databaseId.database)&&zt(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),O===void 0&&(O=j.INTERNAL,$="Unknown error status: "+P+" with message "+L.message),I=!0,x.o_(new q(O,$)),g.close()}else U(Re,`RPC '${e}' stream ${r} received:`,R),x.__(R)}})),dn.u_(),setTimeout((()=>{x.s_()}),0),x}terminate(){this.a_.forEach((e=>e.close())),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter((t=>t===e))}Go(e,t,s){super.Go(e,t,s),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Wl()}}function Jm(n){return new dn(n)}function oi(){return typeof document<"u"?document:null}function wr(n){return new em(n,!0)}dn.c_=!1;class Uc{constructor(e,t,s=1e3,r=1.5,o=6e4){this.Ci=e,this.timerId=t,this.R_=s,this.A_=r,this.V_=o,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),s=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-s);r>0&&U("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const rl="PersistentStream";class qc{constructor(e,t,s,r,o,a,u,d){this.Ci=e,this.b_=s,this.S_=r,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=d,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Uc(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===j.RESOURCE_EXHAUSTED?(st(t.toString()),st("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===j.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,r])=>{this.D_===t&&this.G_(s,r)}),(s=>{e((()=>{const r=new q(j.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(r)}))}))}G_(e,t){const s=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo((()=>{s((()=>this.listener.Zo()))})),this.stream.Yo((()=>{s((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((r=>{s((()=>this.z_(r)))})),this.stream.onMessage((r=>{s((()=>++this.F_==1?this.H_(r):this.onNext(r)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return U(rl,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget((()=>this.D_===e?t():(U(rl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ym extends qc{constructor(e,t,s,r,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=sm(this.serializer,e),s=(function(o){if(!("targetChange"in o))return Q.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?Q.min():a.readTime?Je(a.readTime):Q.min()})(e);return this.listener.J_(t,s)}Z_(e){const t={};t.database=Ci(this.serializer),t.addTarget=(function(o,a){let u;const d=a.target;if(u=wi(d)?{documents:om(o,d)}:{query:am(o,d).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Rc(o,a.resumeToken);const f=Ai(o,a.expectedCount);f!==null&&(u.expectedCount=f)}else if(a.snapshotVersion.compareTo(Q.min())>0){u.readTime=lr(o,a.snapshotVersion.toTimestamp());const f=Ai(o,a.expectedCount);f!==null&&(u.expectedCount=f)}return u})(this.serializer,e);const s=cm(this.serializer,e);s&&(t.labels=s),this.K_(t)}X_(e){const t={};t.database=Ci(this.serializer),t.removeTarget=e,this.K_(t)}}class Xm extends qc{constructor(e,t,s,r,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,a),this.serializer=o}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return re(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,re(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){re(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=im(e.writeResults,e.commitTime),s=Je(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=Ci(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((s=>rm(this.serializer,s)))};this.K_(t)}}class Zm{}class ep extends Zm{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new q(j.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Wo(e,Si(t,s),r,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new q(j.UNKNOWN,o.toString())}))}jo(e,t,s,r,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,u])=>this.connection.jo(e,Si(t,s),r,a,u,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===j.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new q(j.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function tp(n,e,t,s){return new ep(n,e,t,s)}class np{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(st(t),this.aa=!1):U("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Kt="RemoteStore";class sp{constructor(e,t,s,r,o){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=o,this.Aa.Mo((a=>{s.enqueueAndForget((async()=>{Jt(this)&&(U(Kt,"Restarting streams for network reachability change."),await(async function(d){const f=J(d);f.Ea.add(4),await bs(f),f.Va.set("Unknown"),f.Ea.delete(4),await Ir(f)})(this))}))})),this.Va=new np(s,r)}}async function Ir(n){if(Jt(n))for(const e of n.Ra)await e(!0)}async function bs(n){for(const e of n.Ra)await e(!1)}function Hc(n,e){const t=J(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),io(t)?ro(t):Nn(t).O_()&&so(t,e))}function no(n,e){const t=J(n),s=Nn(t);t.Ia.delete(e),s.O_()&&zc(t,e),t.Ia.size===0&&(s.O_()?s.L_():Jt(t)&&t.Va.set("Unknown"))}function so(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Q.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Nn(n).Z_(e)}function zc(n,e){n.da.$e(e),Nn(n).X_(e)}function ro(n){n.da=new Jf({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Nn(n).start(),n.Va.ua()}function io(n){return Jt(n)&&!Nn(n).x_()&&n.Ia.size>0}function Jt(n){return J(n).Ea.size===0}function Kc(n){n.da=void 0}async function rp(n){n.Va.set("Online")}async function ip(n){n.Ia.forEach(((e,t)=>{so(n,e)}))}async function op(n,e){Kc(n),io(n)?(n.Va.ha(e),ro(n)):n.Va.set("Unknown")}async function ap(n,e,t){if(n.Va.set("Online"),e instanceof Nc&&e.state===2&&e.cause)try{await(async function(r,o){const a=o.cause;for(const u of o.targetIds)r.Ia.has(u)&&(await r.remoteSyncer.rejectListen(u,a),r.Ia.delete(u),r.da.removeTarget(u))})(n,e)}catch(s){U(Kt,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await ur(n,s)}else if(e instanceof Qs?n.da.Xe(e):e instanceof Cc?n.da.st(e):n.da.tt(e),!t.isEqual(Q.min()))try{const s=await $c(n.localStore);t.compareTo(s)>=0&&await(function(o,a){const u=o.da.Tt(a);return u.targetChanges.forEach(((d,f)=>{if(d.resumeToken.approximateByteSize()>0){const g=o.Ia.get(f);g&&o.Ia.set(f,g.withResumeToken(d.resumeToken,a))}})),u.targetMismatches.forEach(((d,f)=>{const g=o.Ia.get(d);if(!g)return;o.Ia.set(d,g.withResumeToken(Ne.EMPTY_BYTE_STRING,g.snapshotVersion)),zc(o,d);const b=new yt(g.target,d,f,g.sequenceNumber);so(o,b)})),o.remoteSyncer.applyRemoteEvent(u)})(n,t)}catch(s){U(Kt,"Failed to raise snapshot:",s),await ur(n,s)}}async function ur(n,e,t){if(!Cn(e))throw e;n.Ea.add(1),await bs(n),n.Va.set("Offline"),t||(t=()=>$c(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{U(Kt,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await Ir(n)}))}function Wc(n,e){return e().catch((t=>ur(n,t,e)))}async function Ar(n){const e=J(n),t=Ct(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Ui;for(;lp(e);)try{const r=await Um(e.localStore,s);if(r===null){e.Ta.length===0&&t.L_();break}s=r.batchId,cp(e,r)}catch(r){await ur(e,r)}Gc(e)&&Qc(e)}function lp(n){return Jt(n)&&n.Ta.length<10}function cp(n,e){n.Ta.push(e);const t=Ct(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function Gc(n){return Jt(n)&&!Ct(n).x_()&&n.Ta.length>0}function Qc(n){Ct(n).start()}async function up(n){Ct(n).ra()}async function hp(n){const e=Ct(n);for(const t of n.Ta)e.ea(t.mutations)}async function dp(n,e,t){const s=n.Ta.shift(),r=Qi.from(s,e,t);await Wc(n,(()=>n.remoteSyncer.applySuccessfulWrite(r))),await Ar(n)}async function fp(n,e){e&&Ct(n).Y_&&await(async function(s,r){if((function(a){return Wf(a)&&a!==j.ABORTED})(r.code)){const o=s.Ta.shift();Ct(s).B_(),await Wc(s,(()=>s.remoteSyncer.rejectFailedWrite(o.batchId,r))),await Ar(s)}})(n,e),Gc(n)&&Qc(n)}async function il(n,e){const t=J(n);t.asyncQueue.verifyOperationInProgress(),U(Kt,"RemoteStore received new credentials");const s=Jt(t);t.Ea.add(3),await bs(t),s&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Ir(t)}async function mp(n,e){const t=J(n);e?(t.Ea.delete(2),await Ir(t)):e||(t.Ea.add(2),await bs(t),t.Va.set("Unknown"))}function Nn(n){return n.ma||(n.ma=(function(t,s,r){const o=J(t);return o.sa(),new Ym(s,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,r)})(n.datastore,n.asyncQueue,{Zo:rp.bind(null,n),Yo:ip.bind(null,n),t_:op.bind(null,n),J_:ap.bind(null,n)}),n.Ra.push((async e=>{e?(n.ma.B_(),io(n)?ro(n):n.Va.set("Unknown")):(await n.ma.stop(),Kc(n))}))),n.ma}function Ct(n){return n.fa||(n.fa=(function(t,s,r){const o=J(t);return o.sa(),new Xm(s,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,r)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:up.bind(null,n),t_:fp.bind(null,n),ta:hp.bind(null,n),na:dp.bind(null,n)}),n.Ra.push((async e=>{e?(n.fa.B_(),await Ar(n)):(await n.fa.stop(),n.Ta.length>0&&(U(Kt,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class oo{constructor(e,t,s,r,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=o,this.deferred=new Tt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,o){const a=Date.now()+s,u=new oo(e,t,a,r,o);return u.start(s),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new q(j.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ao(n,e){if(st("AsyncQueue",`${e}: ${n}`),Cn(n))return new q(j.UNAVAILABLE,`${e}: ${n}`);throw n}class fn{static emptySet(e){return new fn(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||K.comparator(t.key,s.key):(t,s)=>K.comparator(t.key,s.key),this.keyedMap=Zn(),this.sortedSet=new he(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,s)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof fn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,o=s.getNext().key;if(!r.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new fn;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}class ol{constructor(){this.ga=new he(K.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):W(63341,{Vt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,s)=>{e.push(s)})),e}}class Tn{constructor(e,t,s,r,o,a,u,d,f){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=d,this.hasCachedResults=f}static fromInitialDocuments(e,t,s,r,o){const a=[];return t.forEach((u=>{a.push({type:0,doc:u})})),new Tn(e,t,fn.emptySet(t),a,s,r,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&_r(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}class pp{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((e=>e.Da()))}}class gp{constructor(){this.queries=al(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const r=J(t),o=r.queries;r.queries=al(),o.forEach(((a,u)=>{for(const d of u.ba)d.onError(s)}))})(this,new q(j.ABORTED,"Firestore shutting down"))}}function al(){return new Gt((n=>pc(n)),_r)}async function yp(n,e){const t=J(n);let s=3;const r=e.query;let o=t.queries.get(r);o?!o.Sa()&&e.Da()&&(s=2):(o=new pp,s=e.Da()?0:1);try{switch(s){case 0:o.wa=await t.onListen(r,!0);break;case 1:o.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(a){const u=ao(a,`Initialization of query '${ln(e.query)}' failed`);return void e.onError(u)}t.queries.set(r,o),o.ba.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&lo(t)}async function _p(n,e){const t=J(n),s=e.query;let r=3;const o=t.queries.get(s);if(o){const a=o.ba.indexOf(e);a>=0&&(o.ba.splice(a,1),o.ba.length===0?r=e.Da()?0:1:!o.Sa()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function vp(n,e){const t=J(n);let s=!1;for(const r of e){const o=r.query,a=t.queries.get(o);if(a){for(const u of a.ba)u.Fa(r)&&(s=!0);a.wa=r}}s&&lo(t)}function bp(n,e,t){const s=J(n),r=s.queries.get(e);if(r)for(const o of r.ba)o.onError(t);s.queries.delete(e)}function lo(n){n.Ca.forEach((e=>{e.next()}))}var Pi,ll;(ll=Pi||(Pi={})).Ma="default",ll.Cache="cache";class Ep{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new Tn(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.Ka||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=Tn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Pi.Cache}}class Jc{constructor(e){this.key=e}}class Yc{constructor(e){this.key=e}}class Tp{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=ee(),this.mutatedKeys=ee(),this.eu=gc(e),this.tu=new fn(this.eu)}get nu(){return this.Za}ru(e,t){const s=t?t.iu:new ol,r=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,a=r,u=!1;const d=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,f=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((g,b)=>{const I=r.get(g),x=vr(this.query,b)?b:null,A=!!I&&this.mutatedKeys.has(I.key),R=!!x&&(x.hasLocalMutations||this.mutatedKeys.has(x.key)&&x.hasCommittedMutations);let C=!1;I&&x?I.data.isEqual(x.data)?A!==R&&(s.track({type:3,doc:x}),C=!0):this.su(I,x)||(s.track({type:2,doc:x}),C=!0,(d&&this.eu(x,d)>0||f&&this.eu(x,f)<0)&&(u=!0)):!I&&x?(s.track({type:0,doc:x}),C=!0):I&&!x&&(s.track({type:1,doc:I}),C=!0,(d||f)&&(u=!0)),C&&(x?(a=a.add(x),o=R?o.add(g):o.delete(g)):(a=a.delete(g),o=o.delete(g)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const g=this.query.limitType==="F"?a.last():a.first();a=a.delete(g.key),o=o.delete(g.key),s.track({type:1,doc:g})}return{tu:a,iu:s,Ss:u,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((g,b)=>(function(x,A){const R=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return W(20277,{Vt:C})}};return R(x)-R(A)})(g.type,b.type)||this.eu(g.doc,b.doc))),this.ou(s),r=r??!1;const u=t&&!r?this._u():[],d=this.Ya.size===0&&this.current&&!r?1:0,f=d!==this.Xa;return this.Xa=d,a.length!==0||f?{snapshot:new Tn(this.query,e.tu,o,a,e.mutatedKeys,d===0,f,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new ol,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Za=this.Za.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Za=this.Za.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=ee(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Ya=this.Ya.add(s.key))}));const t=[];return e.forEach((s=>{this.Ya.has(s)||t.push(new Yc(s))})),this.Ya.forEach((s=>{e.has(s)||t.push(new Jc(s))})),t}cu(e){this.Za=e.ks,this.Ya=ee();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Tn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const co="SyncEngine";class wp{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class Ip{constructor(e){this.key=e,this.hu=!1}}class Ap{constructor(e,t,s,r,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Gt((u=>pc(u)),_r),this.Iu=new Map,this.Eu=new Set,this.Ru=new he(K.comparator),this.Au=new Map,this.Vu=new Xi,this.du={},this.mu=new Map,this.fu=En.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Sp(n,e,t=!0){const s=su(n);let r;const o=s.Tu.get(e);return o?(s.sharedClientState.addLocalQueryTarget(o.targetId),r=o.view.lu()):r=await Xc(s,e,t,!0),r}async function xp(n,e){const t=su(n);await Xc(t,e,!0,!1)}async function Xc(n,e,t,s){const r=await qm(n.localStore,Ge(e)),o=r.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t);let u;return s&&(u=await Cp(n,e,o,a==="current",r.resumeToken)),n.isPrimaryClient&&t&&Hc(n.remoteStore,r),u}async function Cp(n,e,t,s,r){n.pu=(b,I,x)=>(async function(R,C,L,P){let O=C.view.ru(L);O.Ss&&(O=await el(R.localStore,C.query,!1).then((({documents:E})=>C.view.ru(E,O))));const $=P&&P.targetChanges.get(C.targetId),H=P&&P.targetMismatches.get(C.targetId)!=null,z=C.view.applyChanges(O,R.isPrimaryClient,$,H);return ul(R,C.targetId,z.au),z.snapshot})(n,b,I,x);const o=await el(n.localStore,e,!0),a=new Tp(e,o.ks),u=a.ru(o.documents),d=vs.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",r),f=a.applyChanges(u,n.isPrimaryClient,d);ul(n,t,f.au);const g=new wp(e,t,a);return n.Tu.set(e,g),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),f.snapshot}async function Np(n,e,t){const s=J(n),r=s.Tu.get(e),o=s.Iu.get(r.targetId);if(o.length>1)return s.Iu.set(r.targetId,o.filter((a=>!_r(a,e)))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await Ni(s.localStore,r.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(r.targetId),t&&no(s.remoteStore,r.targetId),ki(s,r.targetId)})).catch(xn)):(ki(s,r.targetId),await Ni(s.localStore,r.targetId,!0))}async function Rp(n,e){const t=J(n),s=t.Tu.get(e),r=t.Iu.get(s.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),no(t.remoteStore,s.targetId))}async function Pp(n,e,t){const s=Lp(n);try{const r=await(function(a,u){const d=J(a),f=ce.now(),g=u.reduce(((x,A)=>x.add(A.key)),ee());let b,I;return d.persistence.runTransaction("Locally write mutations","readwrite",(x=>{let A=rt(),R=ee();return d.xs.getEntries(x,g).next((C=>{A=C,A.forEach(((L,P)=>{P.isValidDocument()||(R=R.add(L))}))})).next((()=>d.localDocuments.getOverlayedDocuments(x,A))).next((C=>{b=C;const L=[];for(const P of u){const O=Uf(P,b.get(P.key).overlayedDocument);O!=null&&L.push(new Qt(P.key,O,ac(O.value.mapValue),Qe.exists(!0)))}return d.mutationQueue.addMutationBatch(x,f,L,u)})).next((C=>{I=C;const L=C.applyToLocalDocumentSet(b,R);return d.documentOverlayCache.saveOverlays(x,C.batchId,L)}))})).then((()=>({batchId:I.batchId,changes:_c(b)})))})(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),(function(a,u,d){let f=a.du[a.currentUser.toKey()];f||(f=new he(Z)),f=f.insert(u,d),a.du[a.currentUser.toKey()]=f})(s,r.batchId,t),await Es(s,r.changes),await Ar(s.remoteStore)}catch(r){const o=ao(r,"Failed to persist write");t.reject(o)}}async function Zc(n,e){const t=J(n);try{const s=await Bm(t.localStore,e);e.targetChanges.forEach(((r,o)=>{const a=t.Au.get(o);a&&(re(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?a.hu=!0:r.modifiedDocuments.size>0?re(a.hu,14607):r.removedDocuments.size>0&&(re(a.hu,42227),a.hu=!1))})),await Es(t,s,e)}catch(s){await xn(s)}}function cl(n,e,t){const s=J(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const r=[];s.Tu.forEach(((o,a)=>{const u=a.view.va(e);u.snapshot&&r.push(u.snapshot)})),(function(a,u){const d=J(a);d.onlineState=u;let f=!1;d.queries.forEach(((g,b)=>{for(const I of b.ba)I.va(u)&&(f=!0)})),f&&lo(d)})(s.eventManager,e),r.length&&s.Pu.J_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function kp(n,e,t){const s=J(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.Au.get(e),o=r&&r.key;if(o){let a=new he(K.comparator);a=a.insert(o,ke.newNoDocument(o,Q.min()));const u=ee().add(o),d=new Tr(Q.min(),new Map,new he(Z),a,u);await Zc(s,d),s.Ru=s.Ru.remove(o),s.Au.delete(e),uo(s)}else await Ni(s.localStore,e,!1).then((()=>ki(s,e,t))).catch(xn)}async function Dp(n,e){const t=J(n),s=e.batch.batchId;try{const r=await Mm(t.localStore,e);tu(t,s,null),eu(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await Es(t,r)}catch(r){await xn(r)}}async function Vp(n,e,t){const s=J(n);try{const r=await(function(a,u){const d=J(a);return d.persistence.runTransaction("Reject batch","readwrite-primary",(f=>{let g;return d.mutationQueue.lookupMutationBatch(f,u).next((b=>(re(b!==null,37113),g=b.keys(),d.mutationQueue.removeMutationBatch(f,b)))).next((()=>d.mutationQueue.performConsistencyCheck(f))).next((()=>d.documentOverlayCache.removeOverlaysForBatchId(f,g,u))).next((()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,g))).next((()=>d.localDocuments.getDocuments(f,g)))}))})(s.localStore,e);tu(s,e,t),eu(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await Es(s,r)}catch(r){await xn(r)}}function eu(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function tu(n,e,t){const s=J(n);let r=s.du[s.currentUser.toKey()];if(r){const o=r.get(e);o&&(t?o.reject(t):o.resolve(),r=r.remove(e)),s.du[s.currentUser.toKey()]=r}}function ki(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach((s=>{n.Vu.containsKey(s)||nu(n,s)}))}function nu(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(no(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),uo(n))}function ul(n,e,t){for(const s of t)s instanceof Jc?(n.Vu.addReference(s.key,e),jp(n,s)):s instanceof Yc?(U(co,"Document no longer in limbo: "+s.key),n.Vu.removeReference(s.key,e),n.Vu.containsKey(s.key)||nu(n,s.key)):W(19791,{wu:s})}function jp(n,e){const t=e.key,s=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(s)||(U(co,"New document in limbo: "+t),n.Eu.add(s),uo(n))}function uo(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new K(le.fromString(e)),s=n.fu.next();n.Au.set(s,new Ip(t)),n.Ru=n.Ru.insert(t,s),Hc(n.remoteStore,new yt(Ge(mc(t.path)),s,"TargetPurposeLimboResolution",mr.ce))}}async function Es(n,e,t){const s=J(n),r=[],o=[],a=[];s.Tu.isEmpty()||(s.Tu.forEach(((u,d)=>{a.push(s.pu(d,e,t).then((f=>{if((f||t)&&s.isPrimaryClient){const g=f?!f.fromCache:t?.targetChanges.get(d.targetId)?.current;s.sharedClientState.updateQueryState(d.targetId,g?"current":"not-current")}if(f){r.push(f);const g=eo.Es(d.targetId,f);o.push(g)}})))})),await Promise.all(a),s.Pu.J_(r),await(async function(d,f){const g=J(d);try{await g.persistence.runTransaction("notifyLocalViewChanges","readwrite",(b=>k.forEach(f,(I=>k.forEach(I.Ts,(x=>g.persistence.referenceDelegate.addReference(b,I.targetId,x))).next((()=>k.forEach(I.Is,(x=>g.persistence.referenceDelegate.removeReference(b,I.targetId,x)))))))))}catch(b){if(!Cn(b))throw b;U(to,"Failed to update sequence numbers: "+b)}for(const b of f){const I=b.targetId;if(!b.fromCache){const x=g.vs.get(I),A=x.snapshotVersion,R=x.withLastLimboFreeSnapshotVersion(A);g.vs=g.vs.insert(I,R)}}})(s.localStore,o))}async function Op(n,e){const t=J(n);if(!t.currentUser.isEqual(e)){U(co,"User change. New user:",e.toKey());const s=await Bc(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach((u=>{u.forEach((d=>{d.reject(new q(j.CANCELLED,a))}))})),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await Es(t,s.Ns)}}function Fp(n,e){const t=J(n),s=t.Au.get(e);if(s&&s.hu)return ee().add(s.key);{let r=ee();const o=t.Iu.get(e);if(!o)return r;for(const a of o){const u=t.Tu.get(a);r=r.unionWith(u.view.nu)}return r}}function su(n){const e=J(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Zc.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Fp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=kp.bind(null,e),e.Pu.J_=vp.bind(null,e.eventManager),e.Pu.yu=bp.bind(null,e.eventManager),e}function Lp(n){const e=J(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Dp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Vp.bind(null,e),e}class hr{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=wr(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Lm(this.persistence,new jm,e.initialUser,this.serializer)}Cu(e){return new Mc(Zi.Vi,this.serializer)}Du(e){return new zm}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}hr.provider={build:()=>new hr};class Mp extends hr{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){re(this.persistence.referenceDelegate instanceof cr,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new bm(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Ve.withCacheSize(this.cacheSizeBytes):Ve.DEFAULT;return new Mc((s=>cr.Vi(s,t)),this.serializer)}}class Di{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>cl(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Op.bind(null,this.syncEngine),await mp(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new gp})()}createDatastore(e){const t=wr(e.databaseInfo.databaseId),s=Jm(e.databaseInfo);return tp(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return(function(s,r,o,a,u){return new sp(s,r,o,a,u)})(this.localStore,this.datastore,e.asyncQueue,(t=>cl(this.syncEngine,t,0)),(function(){return sl.v()?new sl:new Km})())}createSyncEngine(e,t){return(function(r,o,a,u,d,f,g){const b=new Ap(r,o,a,u,d,f);return g&&(b.gu=!0),b})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const s=J(t);U(Kt,"RemoteStore shutting down."),s.Ea.add(5),await bs(s),s.Aa.shutdown(),s.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Di.provider={build:()=>new Di};class Bp{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):st("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const Nt="FirestoreClient";class $p{constructor(e,t,s,r,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this._databaseInfo=r,this.user=Pe.UNAUTHENTICATED,this.clientId=Bi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(s,(async a=>{U(Nt,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(s,(a=>(U(Nt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Tt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=ao(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}async function ai(n,e){n.asyncQueue.verifyOperationInProgress(),U(Nt,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener((async r=>{s.isEqual(r)||(await Bc(e.localStore,r),s=r)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function hl(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Up(n);U(Nt,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((s=>il(e.remoteStore,s))),n.setAppCheckTokenChangeListener(((s,r)=>il(e.remoteStore,r))),n._onlineComponents=e}async function Up(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){U(Nt,"Using user provided OfflineComponentProvider");try{await ai(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(r){return r.name==="FirebaseError"?r.code===j.FAILED_PRECONDITION||r.code===j.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11})(t))throw t;zt("Error using user provided cache. Falling back to memory cache: "+t),await ai(n,new hr)}}else U(Nt,"Using default OfflineComponentProvider"),await ai(n,new Mp(void 0));return n._offlineComponents}async function ru(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(U(Nt,"Using user provided OnlineComponentProvider"),await hl(n,n._uninitializedComponentsProvider._online)):(U(Nt,"Using default OnlineComponentProvider"),await hl(n,new Di))),n._onlineComponents}function qp(n){return ru(n).then((e=>e.syncEngine))}async function Hp(n){const e=await ru(n),t=e.eventManager;return t.onListen=Sp.bind(null,e.syncEngine),t.onUnlisten=Np.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=xp.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Rp.bind(null,e.syncEngine),t}function zp(n,e,t={}){const s=new Tt;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,u,d,f){const g=new Bp({next:I=>{g.Nu(),a.enqueueAndForget((()=>_p(o,b))),I.fromCache&&d.source==="server"?f.reject(new q(j.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(I)},error:I=>f.reject(I)}),b=new Ep(u,g,{includeMetadataChanges:!0,Ka:!0});return yp(o,b)})(await Hp(n),n.asyncQueue,e,t,s))),s.promise}function Kp(n,e){const t=new Tt;return n.asyncQueue.enqueueAndForget((async()=>Pp(await qp(n),e,t))),t.promise}function iu(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const Wp="ComponentProvider",dl=new Map;function Gp(n,e,t,s,r){return new uf(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,iu(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator,s)}const ou="firestore.googleapis.com",fl=!0;class ml{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new q(j.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ou,this.ssl=fl}else this.host=e.host,this.ssl=e.ssl??fl;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Lc;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<_m)throw new q(j.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Xd("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=iu(e.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new q(j.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new q(j.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new q(j.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(s,r){return s.timeoutSeconds===r.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Sr{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ml({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new q(j.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new q(j.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ml(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new Ud;switch(s.type){case"firstParty":return new Kd(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new q(j.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const s=dl.get(t);s&&(U(Wp,"Removing Datastore"),dl.delete(t),s.terminate())})(this),Promise.resolve()}}function Qp(n,e,t,s={}){n=_n(n,Sr);const r=Fi(e),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},u=`${e}:${t}`;r&&(mh(`https://${u}`),_h("Firestore",!0)),o.host!==ou&&o.host!==u&&zt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const d={...o,host:u,ssl:r,emulatorOptions:s};if(!Xs(d,a)&&(n._setSettings(d),s.mockUserToken)){let f,g;if(typeof s.mockUserToken=="string")f=s.mockUserToken,g=Pe.MOCK_USER;else{f=ph(s.mockUserToken,n._app?.options.projectId);const b=s.mockUserToken.sub||s.mockUserToken.user_id;if(!b)throw new q(j.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new Pe(b)}n._authCredentials=new qd(new Ql(f,g))}}class xr{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new xr(this.firestore,e,this._query)}}class Se{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new wt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Se(this.firestore,e,this._key)}toJSON(){return{type:Se._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(ys(t,Se._jsonSchema))return new Se(e,s||null,new K(le.fromString(t.referencePath)))}}Se._jsonSchemaVersion="firestore/documentReference/1.0",Se._jsonSchema={type:ge("string",Se._jsonSchemaVersion),referencePath:ge("string")};class wt extends xr{constructor(e,t,s){super(e,t,mc(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Se(this.firestore,null,new K(e))}withConverter(e){return new wt(this.firestore,e,this._path)}}function ho(n,e,...t){if(n=ls(n),Jl("collection","path",e),n instanceof Sr){const s=le.fromString(e,...t);return Ca(s),new wt(n,null,s)}{if(!(n instanceof Se||n instanceof wt))throw new q(j.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(le.fromString(e,...t));return Ca(s),new wt(n.firestore,null,s)}}function Rn(n,e,...t){if(n=ls(n),arguments.length===1&&(e=Bi.newId()),Jl("doc","path",e),n instanceof Sr){const s=le.fromString(e,...t);return xa(s),new Se(n,null,new K(s))}{if(!(n instanceof Se||n instanceof wt))throw new q(j.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(le.fromString(e,...t));return xa(s),new Se(n.firestore,n instanceof wt?n.converter:null,new K(s))}}const pl="AsyncQueue";class gl{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Uc(this,"async_queue_retry"),this._c=()=>{const s=oi();s&&U(pl,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=oi();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=oi();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Tt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Yu.push(e),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!Cn(e))throw e;U(pl,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((s=>{throw this.nc=s,this.rc=!1,st("INTERNAL UNHANDLED ERROR: ",yl(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=oo.createAndSchedule(this,e,t,s,(o=>this.hc(o)));return this.tc.push(r),r}uc(){this.nc&&W(47125,{Pc:yl(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,s)=>t.targetTimeMs-s.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function yl(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Cr extends Sr{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new gl,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new gl(e),this._firestoreClient=void 0,await e}}}function Jp(n,e){const t=typeof n=="object"?n:Cd(),s=typeof n=="string"?n:nr,r=wd(t,"firestore").getImmediate({identifier:s});if(!r._initialized){const o=dh("firestore");o&&Qp(r,...o)}return r}function au(n){if(n._terminated)throw new q(j.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Yp(n),n._firestoreClient}function Yp(n){const e=n._freezeSettings(),t=Gp(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new $p(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(r){const o=r?._online.build();return{_offline:r?._offline.build(o),_online:o}})(n._componentsProvider))}class Me{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Me(Ne.fromBase64String(e))}catch(t){throw new q(j.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Me(Ne.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Me._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ys(e,Me._jsonSchema))return Me.fromBase64String(e.bytes)}}Me._jsonSchemaVersion="firestore/bytes/1.0",Me._jsonSchema={type:ge("string",Me._jsonSchemaVersion),bytes:ge("string")};class lu{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new q(j.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ce(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class cu{constructor(e){this._methodName=e}}class Ye{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new q(j.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new q(j.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Z(this._lat,e._lat)||Z(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ye._jsonSchemaVersion}}static fromJSON(e){if(ys(e,Ye._jsonSchema))return new Ye(e.latitude,e.longitude)}}Ye._jsonSchemaVersion="firestore/geoPoint/1.0",Ye._jsonSchema={type:ge("string",Ye._jsonSchemaVersion),latitude:ge("number"),longitude:ge("number")};class qe{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(s,r){if(s.length!==r.length)return!1;for(let o=0;o<s.length;++o)if(s[o]!==r[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:qe._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ys(e,qe._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new qe(e.vectorValues);throw new q(j.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}qe._jsonSchemaVersion="firestore/vectorValue/1.0",qe._jsonSchema={type:ge("string",qe._jsonSchemaVersion),vectorValues:ge("object")};const Xp=/^__.*__$/;class Zp{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new Qt(e,this.data,this.fieldMask,t,this.fieldTransforms):new _s(e,this.data,t,this.fieldTransforms)}}function uu(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw W(40011,{dataSource:n})}}class fo{constructor(e,t,s,r,o,a){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,o===void 0&&this.validatePath(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new fo({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){const t=this.path?.child(e),s=this.contextWith({path:t,arrayElement:!1});return s.validatePathSegment(e),s}childContextForFieldPath(e){const t=this.path?.child(e),s=this.contextWith({path:t,arrayElement:!1});return s.validatePath(),s}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return dr(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(uu(this.dataSource)&&Xp.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class eg{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||wr(e)}createContext(e,t,s,r=!1){return new fo({dataSource:e,methodName:t,targetDoc:s,path:Ce.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function tg(n){const e=n._freezeSettings(),t=wr(n._databaseId);return new eg(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ng(n,e,t,s,r,o={}){const a=n.createContext(o.merge||o.mergeFields?2:0,e,t,r);mu("Data must be an object, but it was:",a,s);const u=du(s,a);let d,f;if(o.merge)d=new Ue(a.fieldMask),f=a.fieldTransforms;else if(o.mergeFields){const g=[];for(const b of o.mergeFields){const I=mo(e,b,t);if(!a.contains(I))throw new q(j.INVALID_ARGUMENT,`Field '${I}' is specified in your field mask but missing from your input data.`);ig(g,I)||g.push(I)}d=new Ue(g),f=a.fieldTransforms.filter((b=>d.covers(b.field)))}else d=null,f=a.fieldTransforms;return new Zp(new Le(u),d,f)}function hu(n,e){if(fu(n=ls(n)))return mu("Unsupported field value:",e,n),du(n,e);if(n instanceof cu)return(function(s,r){if(!uu(r.dataSource))throw r.createError(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.createError(`${s._methodName}() is not currently supported inside arrays`);const o=s._toFieldTransform(r);o&&r.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return(function(s,r){const o=[];let a=0;for(const u of s){let d=hu(u,r.childContextForArray(a));d==null&&(d={nullValue:"NULL_VALUE"}),o.push(d),a++}return{arrayValue:{values:o}}})(n,e)}return(function(s,r){if((s=ls(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return Of(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const o=ce.fromDate(s);return{timestampValue:lr(r.serializer,o)}}if(s instanceof ce){const o=new ce(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:lr(r.serializer,o)}}if(s instanceof Ye)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Me)return{bytesValue:Rc(r.serializer,s._byteString)};if(s instanceof Se){const o=r.databaseId,a=s.firestore._databaseId;if(!a.isEqual(o))throw r.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Yi(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof qe)return(function(a,u){const d=a instanceof qe?a.toArray():a;return{mapValue:{fields:{[ic]:{stringValue:oc},[sr]:{arrayValue:{values:d.map((g=>{if(typeof g!="number")throw u.createError("VectorValues must only contain numeric values.");return Wi(u.serializer,g)}))}}}}}})(s,r);if(Fc(s))return s._toProto(r.serializer);throw r.createError(`Unsupported field value: ${$i(s)}`)})(n,e)}function du(n,e){const t={};return Zl(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Wt(n,((s,r)=>{const o=hu(r,e.childContextForField(s));o!=null&&(t[s]=o)})),{mapValue:{fields:t}}}function fu(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ce||n instanceof Ye||n instanceof Me||n instanceof Se||n instanceof cu||n instanceof qe||Fc(n))}function mu(n,e,t){if(!fu(t)||!Yl(t)){const s=$i(t);throw s==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+s)}}function mo(n,e,t){if((e=ls(e))instanceof lu)return e._internalPath;if(typeof e=="string")return rg(n,e);throw dr("Field path arguments must be of type string or ",n,!1,void 0,t)}const sg=new RegExp("[~\\*/\\[\\]]");function rg(n,e,t){if(e.search(sg)>=0)throw dr(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new lu(...e.split("."))._internalPath}catch{throw dr(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function dr(n,e,t,s,r){const o=s&&!s.isEmpty(),a=r!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let d="";return(o||a)&&(d+=" (found",o&&(d+=` in field ${s}`),a&&(d+=` in document ${r}`),d+=")"),new q(j.INVALID_ARGUMENT,u+n+d)}function ig(n,e){return n.some((t=>t.isEqual(e)))}class og{convertValue(e,t="none"){switch(xt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return me(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(St(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw W(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return Wt(e,((r,o)=>{s[r]=this.convertValue(o,t)})),s}convertVectorValue(e){const t=e.fields?.[sr].arrayValue?.values?.map((s=>me(s.doubleValue)));return new qe(t)}convertGeoPoint(e){return new Ye(me(e.latitude),me(e.longitude))}convertArray(e,t){return(e.values||[]).map((s=>this.convertValue(s,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const s=gr(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(ds(e));default:return null}}convertTimestamp(e){const t=At(e);return new ce(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=le.fromString(e);re(Oc(s),9688,{name:e});const r=new fs(s.get(1),s.get(3)),o=new K(s.popFirst(5));return r.isEqual(t)||st(`Document ${o} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}class ag extends og{constructor(e){super(),this.firestore=e}convertBytes(e){return new Me(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Se(this.firestore,null,t)}}const _l="@firebase/firestore",vl="4.11.0";class pu{constructor(e,t,s,r,o){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Se(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new lg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){const t=this._document.data.field(mo("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class lg extends pu{data(){return super.data()}}function cg(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new q(j.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function ug(n,e,t){let s;return s=n?n.toFirestore(e):e,s}class Hs{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class mn extends pu{constructor(e,t,s,r,o,a){super(e,t,s,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Js(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(mo("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new q(j.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=mn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}mn._jsonSchemaVersion="firestore/documentSnapshot/1.0",mn._jsonSchema={type:ge("string",mn._jsonSchemaVersion),bundleSource:ge("string","DocumentSnapshot"),bundleName:ge("string"),bundle:ge("string")};class Js extends mn{data(e={}){return super.data(e)}}class pn{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Hs(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((s=>{e.call(t,new Js(this._firestore,this._userDataWriter,s.key,s,new Hs(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new q(j.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(r,o){if(r._snapshot.oldDocs.isEmpty()){let a=0;return r._snapshot.docChanges.map((u=>{const d=new Js(r._firestore,r._userDataWriter,u.doc.key,u.doc,new Hs(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter);return u.doc,{type:"added",doc:d,oldIndex:-1,newIndex:a++}}))}{let a=r._snapshot.oldDocs;return r._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const d=new Js(r._firestore,r._userDataWriter,u.doc.key,u.doc,new Hs(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter);let f=-1,g=-1;return u.type!==0&&(f=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),g=a.indexOf(u.doc.key)),{type:hg(u.type),doc:d,oldIndex:f,newIndex:g}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new q(j.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=pn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Bi.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],r=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),s.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),r.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function hg(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return W(61501,{type:n})}}pn._jsonSchemaVersion="firestore/querySnapshot/1.0",pn._jsonSchema={type:ge("string",pn._jsonSchemaVersion),bundleSource:ge("string","QuerySnapshot"),bundleName:ge("string"),bundle:ge("string")};function po(n){n=_n(n,xr);const e=_n(n.firestore,Cr),t=au(e),s=new ag(e);return cg(n._query),zp(t,n._query).then((r=>new pn(e,s,n,r)))}function Nr(n,e,t){n=_n(n,Se);const s=_n(n.firestore,Cr),r=ug(n.converter,e),o=tg(s);return gu(s,[ng(o,"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,Qe.none())])}function go(n){return gu(_n(n.firestore,Cr),[new Gi(n._key,Qe.none())])}function gu(n,e){const t=au(n);return Kp(t,e)}(function(e,t=!0){$d(xd),er(new cs("firestore",((s,{instanceIdentifier:r,options:o})=>{const a=s.getProvider("app").getImmediate(),u=new Cr(new Hd(s.getProvider("auth-internal")),new Wd(a,s.getProvider("app-check-internal")),hf(a,r),a);return o={useFetchStreams:t,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),hn(_l,vl,e),hn(_l,vl,"esm2020")})();const Vi={apiKey:"",authDomain:"",projectId:"",storageBucket:"",messagingSenderId:"",appId:""},je=!!(Vi.apiKey&&Vi.projectId);let bl=null,et=null;je&&(bl=Ml(Vi),et=Jp(bl));const yu="/Claude/",wn=`${yu}sodexo-live-logo.svg`,_u=`${yu}sodexo-dark.svg`,El="sdx_salt",Rr="sdx_users",vu="sdx_inspection_vault",Tl="sdx_device_secret",dg=600*1e3,bu="sdx_autofill_memory";function ts(){try{return JSON.parse(localStorage.getItem(bu))||{}}catch{return{}}}function fg(n){const e=ts(),t=["siteName","siteNumber","supervisorName","sitePhone","locationType"];for(const s of t)n[s]&&(e[s]||(e[s]=[]),e[s].includes(n[s])||(e[s].unshift(n[s]),e[s]=e[s].slice(0,10)));n.siteName&&n.siteNumber&&(e.siteMap||(e.siteMap={}),e.siteMap[n.siteName]={siteNumber:n.siteNumber,sitePhone:n.sitePhone||"",supervisorName:n.supervisorName||"",locationType:n.locationType||"",floor:n.floor||""}),localStorage.setItem(bu,JSON.stringify(e))}const li={name:"Joxel Da Silva",badge:"365582",department:"Safety Inspector"};async function Eu(){let n=localStorage.getItem(El);if(n)return new Uint8Array(JSON.parse(n));const e=crypto.getRandomValues(new Uint8Array(16));return localStorage.setItem(El,JSON.stringify(Array.from(e))),e}async function mg(n){const e=new TextEncoder,t=await Eu(),s=await crypto.subtle.importKey("raw",e.encode(n),"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},s,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function Pr(n){const e=new TextEncoder,t=await Eu(),s=new Uint8Array([...t,...e.encode(n)]),r=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(r)).map(o=>o.toString(16).padStart(2,"0")).join("")}async function pg(n,e){const t=crypto.getRandomValues(new Uint8Array(12)),s=new TextEncoder,r=await crypto.subtle.encrypt({name:"AES-GCM",iv:t},e,s.encode(JSON.stringify(n)));return JSON.stringify({iv:Array.from(t),ct:Array.from(new Uint8Array(r))})}async function gg(n,e){if(!n)return[];try{const{iv:t,ct:s}=JSON.parse(n),r=await crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(t)},e,new Uint8Array(s));return JSON.parse(new TextDecoder().decode(r))}catch{return[]}}async function yg(){let n=localStorage.getItem(Tl);if(!n){const e=crypto.getRandomValues(new Uint8Array(32));n=Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join(""),localStorage.setItem(Tl,n)}return mg("sdx_master_"+n)}async function Be(){if(je)try{return(await po(ho(et,"users"))).docs.map(e=>e.data())}catch{return[]}try{return JSON.parse(localStorage.getItem(Rr)||"[]")}catch{return[]}}async function Ts(n){if(je){try{await Nr(Rn(et,"users",n.badgeHash),n)}catch{}return}const e=await Be(),t=e.findIndex(s=>s.badgeHash===n.badgeHash);t>=0?e[t]=n:e.push(n),localStorage.setItem(Rr,JSON.stringify(e))}async function _g(n){if(je){try{await go(Rn(et,"users",n))}catch{}return}const e=await Be();localStorage.setItem(Rr,JSON.stringify(e.filter(t=>t.badgeHash!==n)))}async function Tu(){if((await Be()).length>0)return;const e=await Pr(li.badge),t={badgeHash:e,name:li.name,department:li.department,role:"admin",approved:!0,registeredAt:new Date().toISOString()};je?await Nr(Rn(et,"users",e),t):localStorage.setItem(Rr,JSON.stringify([t]))}let In=null,ji=null;async function yo(){if(je)try{const t=(await po(ho(et,"inspections"))).docs.map(s=>s.data());return t.sort((s,r)=>(r.savedAt||"").localeCompare(s.savedAt||"")),t}catch{return[]}if(!In)return[];const n=localStorage.getItem(vu);return gg(n,In)}async function _o(n){if(je){try{for(const t of n)await Nr(Rn(et,"inspections",t.id),t)}catch(t){console.error("Firestore saveHistory error:",t)}return}if(!In)return;const e=await pg(n,In);localStorage.setItem(vu,e)}async function vg(n){if(je){try{await Nr(Rn(et,"inspections",n.id),n)}catch{}return}const e=await yo();e.unshift(n),await _o(e)}async function bg(n){if(je){try{await go(Rn(et,"inspections",n))}catch{}return}const e=await yo();await _o(e.filter(t=>t.id!==n))}async function Eg(){if(je){try{const n=await po(ho(et,"inspections"));for(const e of n.docs)await go(e.ref)}catch{}return}await _o([])}async function Tg(n){await Tu();const e=await Pr(n),s=(await Be()).find(r=>r.badgeHash===e);return s?s.approved?(je||(In=await yg()),ji={...s},{ok:!0,user:ji}):{ok:!1,reason:"pending"}:{ok:!1,reason:"not_found"}}async function wg(n,e,t){const s=await Pr(n);if((await Be()).find(a=>a.badgeHash===s))return{ok:!1,reason:"exists"};const o={badgeHash:s,name:e,department:t,role:"inspector",approved:!1,registeredAt:new Date().toISOString()};return await Ts(o),{ok:!0}}function wl(){In=null,ji=null}async function Ig(n,e,t,s){const r=await Pr(n);if((await Be()).find(u=>u.badgeHash===r))return{ok:!1,reason:"exists"};const a={badgeHash:r,name:e,department:t,role:s||"inspector",approved:!0,registeredAt:new Date().toISOString()};return await Ts(a),{ok:!0}}async function Ag(n){const t=(await Be()).find(s=>s.badgeHash===n);t&&(t.approved=!0,await Ts(t))}async function Il(n){await _g(n)}async function Sg(n){const t=(await Be()).find(s=>s.badgeHash===n);t&&(t.role="admin",await Ts(t))}async function xg(n){const t=(await Be()).find(s=>s.badgeHash===n);t&&(t.role="inspector",await Ts(t))}function Cg({onUnlock:n}){const[e,t]=B.useState(""),[s,r]=B.useState("signin"),[o,a]=B.useState(""),[u,d]=B.useState(""),[f,g]=B.useState(""),[b,I]=B.useState(!1),[x,A]=B.useState(""),R=B.useRef(null);B.useEffect(()=>{Tu()},[]),B.useEffect(()=>{R.current?.focus()},[s]);async function C(P){P.preventDefault(),g(""),I(!0);try{const O=await Tg(e.trim());if(O.ok){n(O.user);return}O.reason==="pending"?r("pending"):g("Badge not recognized. Request access below if youre new.")}catch{g("Something went wrong. Try again.")}finally{I(!1)}}async function L(P){P.preventDefault(),g(""),I(!0);try{const O=await wg(e.trim(),o.trim(),u.trim());O.ok?(A("Registration submitted! Ask an administrator to approve your badge."),r("pending")):O.reason==="exists"&&g("This badge is already registered. Try signing in.")}catch{g("Registration failed. Try again.")}finally{I(!1)}}return c.jsx("div",{className:"pinOverlay",children:c.jsxs("div",{className:"pinCard",children:[c.jsx("img",{src:_u,alt:"Sodexo",className:"pinLogo"}),s==="signin"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"pinTitle",children:"Badge Sign-In"}),c.jsx("div",{className:"pinSub",children:"Enter your work badge number to access inspections"}),c.jsxs("form",{onSubmit:C,className:"pinForm",children:[c.jsx("input",{ref:R,className:"pinInput badgeInput",type:"password",maxLength:20,value:e,onChange:P=>t(P.target.value),placeholder:"Badge #",autoComplete:"off"}),f&&c.jsx("div",{className:"pinError",children:f}),c.jsx("button",{className:"btn btnPrimary pinBtn",type:"submit",disabled:b||e.trim().length<3,children:b?"Verifying...":"Sign In"})]}),c.jsx("button",{className:"btnLink",type:"button",onClick:()=>{r("register"),g(""),t("")},children:"New here? Request access"})]}),s==="register"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"pinTitle",children:"Request Access"}),c.jsx("div",{className:"pinSub",children:"Fill in your details. An administrator will review your request."}),c.jsxs("form",{onSubmit:L,className:"pinForm",children:[c.jsx("input",{ref:R,className:"pinInput badgeInput",type:"password",maxLength:20,value:e,onChange:P=>t(P.target.value),placeholder:"Badge #",autoComplete:"off"}),c.jsx("input",{className:"input regInput",value:o,onChange:P=>a(P.target.value),placeholder:"Full name",autoComplete:"name"}),c.jsx("input",{className:"input regInput",value:u,onChange:P=>d(P.target.value),placeholder:"Department"}),f&&c.jsx("div",{className:"pinError",children:f}),c.jsx("button",{className:"btn btnPrimary pinBtn",type:"submit",disabled:b||e.trim().length<3||!o.trim()||!u.trim(),children:b?"Submitting...":"Request Access"})]}),c.jsx("button",{className:"btnLink",type:"button",onClick:()=>{r("signin"),g(""),t("")},children:"Already registered? Sign in"})]}),s==="pending"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"pinTitle",children:"Pending Approval"}),c.jsx("div",{className:"pinSub",children:x||"Your access request is awaiting administrator approval."}),c.jsx("div",{className:"pendingIcon",children:""}),c.jsx("button",{className:"btnLink",type:"button",onClick:()=>{r("signin"),g(""),A(""),t("")},children:"Back to sign in"})]}),c.jsxs("div",{className:"pinFooter",children:[c.jsx("span",{className:"pinLock",children:""})," AES-256 encrypted  stored only on this device"]})]})})}function vo(n,e){const t=URL.createObjectURL(n),s=document.createElement("a");s.href=t,s.download=e,document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),URL.revokeObjectURL(t)},100)}const gn={inspection:{label:"Kitchen Inspection",contextFields:[{key:"kitchen",label:"Kitchen / Location"},{key:"participants",label:"Participants"},{key:"date",label:"Date"}],useCases:["Email Summary","Google Doc","Slack Update","Evaluation Scorecard"],sample:{meta:{inspectionType:"Event Day",inspectionDate:"2026-02-09",inspectorName:"J. Da Silva"},context:{kitchen:"Concourse Kitchen  North Stand",participants:"Chef Lead, Sanitation Lead, Ops Manager",date:"2026-02-09"},inspection:{facility:{ceiling:{status:"OK",notes:"",photos:[]},walls:{status:"OK",notes:"",photos:[]},floors:{status:"Needs Attention",notes:"Slip hazard near mop sink.",photos:[]},lighting:{status:"Needs Attention",notes:"Bulb out over dish station.",photos:[]}},operations:{employeePractices:{status:"Needs Attention",notes:"Coaching on hot holding.",photos:[]},handwashing:{status:"OK",notes:"Soap low at one hand sink.",photos:[]},labelingDating:{status:"Needs Attention",notes:"A few unlabeled containers.",photos:[]},logs:{status:"Needs Attention",notes:"Chemical logs missing 2/7.",photos:[]}},temps:{handSinkTempF:96,threeCompSinkTempF:110},equipment:{doubleDoorCooler:{status:"OK",notes:"38F",photos:[]},doubleDoorFreezer:{status:"OK",notes:"",photos:[]},walkInCooler:{status:"OK",notes:"",photos:[]},warmers:{status:"Needs Attention",notes:"Hot hold 142F (borderline).",photos:[]},ovens:{status:"OK",notes:"",photos:[]},threeCompSink:{status:"OK",notes:"",photos:[]},ecolab:{status:"OK",notes:"Sanitizer 150 ppm",photos:[]}}},rawNotes:"sitdown after svc. recap insp: cooler 38F ok. hot hold 142F (border). q: when calibrate therms? last wk. found: 3 cutting boards scored. chem logs missing 2/7. pest trap behind dry storage shifted. action: replace boards, backfill logs, reset trap + pic, coach hot holding. owner: chef lead. due: Fri."}}},Ng=["OK","Not Clean","Needs Attention","N/A"],ci=6,Al=8,Rg=["Event Day","Post Event","Regular Inspection"],Pg=["Concession","Subcontractor","Portable"],kg=["Floor 1","Floor 2","Floor 3"],fr={"Event Day":{headline:"Event Day Readiness",opening:"This is an Event Day inspection focused on pre-service readiness and risk control before peak volume."},"Post Event":{headline:"Post-Event Close-Out",opening:"This is a Post Event inspection focused on close-out conditions, cleanup effectiveness, and immediate corrective actions after service."},"Regular Inspection":{headline:"Routine Compliance Review",opening:"This is a Regular Inspection focused on routine compliance, sanitation standards, and repeat-risk prevention."}},Dg=[[/\bw\//gi,"with"],[/\bKM\b/g,"Kitchen Manager"],[/\bq\b/gi,"question"],[/\btemp(s?)\b/gi,"temperature$1"],[/\bok\b/gi,"OK"],[/\bchk\b/gi,"check"],[/\bwk\b/gi,"week"],[/\b(\d+)x\b/gi,"$1"],[/\binsp\b/gi,"inspection"],[/\bsvc\b/gi,"service"],[/\btherm(s?)\b/gi,"thermometer$1"],[/\bchem\b/gi,"chemical"],[/\bdocs?\b/gi,"document(s)"],[/\bpic\b/gi,"photo"],[/\bborder\b/gi,"borderline"]];function kr(n){let e=n;for(const[t,s]of Dg)e=e.replace(t,s);return e}const Vg=[[/\bi\b/g,"I"],[/\bdoesnt\b/gi,"doesn't"],[/\bdidnt\b/gi,"didn't"],[/\bwasnt\b/gi,"wasn't"],[/\bwerent\b/gi,"weren't"],[/\bcant\b/gi,"can't"],[/\bwont\b/gi,"won't"],[/\bcouldnt\b/gi,"couldn't"],[/\bshouldnt\b/gi,"shouldn't"],[/\bwouldnt\b/gi,"wouldn't"],[/\bisnt\b/gi,"isn't"],[/\barent\b/gi,"aren't"],[/\bhasnt\b/gi,"hasn't"],[/\bhavent\b/gi,"haven't"],[/\btheyre\b/gi,"they're"],[/\btheres\b/gi,"there's"],[/\bwere\b(?!\s)/gi,"we're"],[/\bits\b(?=\s+[a-z])/gi,"it's"],[/\brecieved?\b/gi,"received"],[/\bseperately?\b/gi,"separately"],[/\boccured\b/gi,"occurred"],[/\buntill?\b/gi,"until"],[/\balot\b/gi,"a lot"],[/\bteh\b/gi,"the"],[/\bwich\b/gi,"which"],[/\bthere\s+is\b/gi,"there is"],[/\bthru\b/gi,"through"],[/\bppl\b/gi,"people"],[/\bmgr\b/gi,"manager"],[/\bmgmt\b/gi,"management"],[/\bequip\b/gi,"equipment"],[/\bmaint\b/gi,"maintenance"],[/\brefrig\b/gi,"refrigerator"],[/\binfo\b/gi,"information"],[/\bamt\b/gi,"amount"],[/\bapprox\b/gi,"approximately"],[/\bmin\b(?=\s|\.|\,|$)/gi,"minimum"],[/\bmax\b(?=\s|\.|\,|$)/gi,"maximum"],[/\bF\b(?=\s*[\.\,\)]|$)/g,"F"]],jg=[{key:"action",patterns:[/\baction\b/i,/\breplace\b/i,/\bfix\b/i,/\brepair\b/i,/\bschedule\b/i,/\bcoach\b/i,/\bfollow\s*up\b/i,/\bbackfill\b/i,/\breset\b/i]},{key:"finding",patterns:[/\bfound\b/i,/\bnoted\b/i,/\bobserved\b/i,/\bscored\b/i,/\bmissing\b/i,/\bshifted\b/i,/\blow\b/i,/\bbroken\b/i,/\bdamaged\b/i,/\bflagged\b/i]},{key:"temp",patterns:[/\d+\s*?F/i,/\btemperature\b/i,/\bcooler\b/i,/\bfreezer\b/i,/\bhot\s*hold/i,/\bwarm/i]},{key:"question",patterns:[/\bquestion\b/i,/\basked\b/i,/\bwhen\b/i,/\?$/]},{key:"owner",patterns:[/\bowner\b/i,/\bdue\b/i,/\bassign/i,/\bchef\s*lead\b/i]},{key:"context",patterns:[/\bsitdown\b/i,/\bsit-down\b/i,/\brecap\b/i,/\bafter\b/i,/\bbefore\b/i,/\bduring\b/i]}];function Og(n){for(const e of jg)for(const t of e.patterns)if(t.test(n))return e.key;return"general"}const Dr={context:"Context",finding:"Findings",temp:"Temperatures",question:"Questions",action:"Action Items",owner:"Ownership & Deadlines",general:"Notes"},Vr=["context","temp","finding","question","action","owner","general"];function Fg(n){let e=n;for(const[t,s]of Vg)e=e.replace(t,s);return e=e.replace(/^\s*([a-z])/,(t,s)=>s.toUpperCase()),e=e.replace(/\s{2,}/g," "),e=e.trim(),e&&!/[.!?]$/.test(e)&&(e+="."),e}function jr(n){if(!n||!n.trim())return{bullets:[],grouped:{}};const s=kr(n).split(/(?<=\.)\s+|;\s*|\n+/).map(o=>o.trim()).filter(o=>o.length>2).map(o=>Fg(o)),r={};for(const o of s){const a=Og(o);r[a]||(r[a]=[]),r[a].push(o)}return{bullets:s,grouped:r}}function as(n){const{grouped:e}=jr(n),t=[];for(const s of Vr)if(!(!e[s]||!e[s].length)){t.push(`${Dr[s]}:`);for(const r of e[s])t.push(`   ${r}`);t.push("")}return t.join(`
`).trim()||n||""}function ve(...n){return n.filter(Boolean).join(" ")}function Sl(n){const e=gn[n],t={};for(const s of e.contextFields)t[s.key]="";return t.date!==void 0&&(t.date=new Date().toISOString().slice(0,10)),t}function Ie(n){return{...n,photos:[]}}function ui(){return{facility:{ceiling:Ie({status:"OK",notes:""}),walls:Ie({status:"OK",notes:""}),floors:Ie({status:"OK",notes:""}),lighting:Ie({status:"OK",notes:""})},operations:{employeePractices:Ie({status:"OK",notes:""}),handwashing:Ie({status:"OK",notes:""}),labelingDating:Ie({status:"OK",notes:""}),logs:Ie({status:"OK",notes:""})},temps:{handSinkTempF:"",threeCompSinkTempF:""},equipment:{doubleDoorCooler:Ie({status:"OK",notes:""}),doubleDoorFreezer:Ie({status:"OK",notes:""}),walkInCooler:Ie({status:"OK",notes:""}),warmers:Ie({status:"OK",notes:""}),ovens:Ie({status:"OK",notes:""}),threeCompSink:Ie({status:"OK",notes:""}),ecolab:Ie({status:"OK",notes:""})}}}function Lg(n,e){return`${gn[n].label}  ${e}`}function hi(n,e){return e.reduce((t,s)=>t?t[s]:void 0,n)}function Ut(n,e,t){const[s,...r]=e;return s?{...n,[s]:r.length?Ut(n?.[s]??{},r,t):t}:t}function xl(n){return Math.round(n/(1024*1024)*10)/10}function Mg(n,e=800,t=.6){return new Promise(s=>{const r=new Image;r.onload=()=>{let{width:o,height:a}=r;if(o>e||a>e){const f=Math.min(e/o,e/a);o=Math.round(o*f),a=Math.round(a*f)}const u=document.createElement("canvas");u.width=o,u.height=a,u.getContext("2d").drawImage(r,0,0,o,a),s(u.toDataURL("image/jpeg",t))},r.onerror=()=>s(null),r.src=URL.createObjectURL(n)})}function Bg(n){let e=0;const t=s=>{if(!(!s||typeof s!="object")){if(Array.isArray(s)){s.forEach(t);return}s.photos?.length&&(e+=s.photos.length);for(const r of Object.values(s))t(r)}};return t(n),e}function _t(n){return String(n||"").trim()}function wu(n){const t=String(n||"").match(/action\s*:\s*([\s\S]+)/i);return t?t[1].split(/next\s*chk|next\s*check|follow\s*up|owner\s*:/i)[0].trim().split(",").map(r=>_t(r)).filter(Boolean).map(r=>({issue:r})):[]}function Yt(n){const e=[],t=o=>{if(!(!o||typeof o!="object")){o.status&&(o.status==="Needs Attention"||o.status==="Not Clean")&&e.push(!0);for(const a of Object.keys(o))t(o[a])}};t(n?.facility),t(n?.operations),t(n?.equipment);const s=Number(n?.temps?.handSinkTempF),r=Number(n?.temps?.threeCompSinkTempF);return!Number.isNaN(s)&&s&&s<95&&e.push(!0),!Number.isNaN(r)&&r&&r<110&&e.push(!0),e.length?"Needs Attention":"Pass"}function $g({inspectionDate:n,inspectorName:e,context:t,noteType:s,inspection:r}){const o=[];n||o.push({text:"Inspection Date is missing",fieldId:"field-inspectionDate"}),e||o.push({text:"Inspector Name is missing",fieldId:"field-inspectorName"});const a=gn[s].contextFields;for(const u of a)t[u.key]?.trim()||o.push({text:`${u.label} is missing`,fieldId:`field-ctx-${u.key}`});return r.temps.handSinkTempF||o.push({text:"Hand sink temperature not recorded",fieldId:"field-handSinkTempF"}),r.temps.threeCompSinkTempF||o.push({text:"3-comp sink temperature not recorded",fieldId:"field-threeCompSinkTempF"}),o}function Ug({noteType:n,context:e,inspection:t,inspectionType:s,inspectionDate:r,siteName:o,siteNumber:a}){const u=Yt(t),d=o||e?.kitchen||"Kitchen",f=a?` (#${a})`:"",g=r||e?.date||"Date",b=s?`  ${s}`:"";return`Subject: ${d}${f} Kitchen Inspection${b}  ${g}  ${u}`}function bo(n){const e=[["facility","ceiling","Facility > Ceiling"],["facility","walls","Facility > Walls"],["facility","floors","Facility > Floors"],["facility","lighting","Facility > Lighting"],["operations","employeePractices","Operations > Employee practices"],["operations","handwashing","Operations > Handwashing / supplies"],["operations","labelingDating","Operations > Labeling / dating"],["operations","logs","Operations > Logs / documentation"],["equipment","doubleDoorCooler","Equipment > Double-door cooler"],["equipment","doubleDoorFreezer","Equipment > Double-door freezer"],["equipment","walkInCooler","Equipment > Walk-in cooler"],["equipment","warmers","Equipment > Warmers / hot holding"],["equipment","ovens","Equipment > Ovens"],["equipment","threeCompSink","Equipment > 3-compartment sink"],["equipment","ecolab","Equipment > Ecolab / chemicals"]];for(const o of["facility","operations","equipment"]){const a=n?.[o]||{};for(const u of Object.keys(a))if(u.startsWith("custom_")){const d=o.charAt(0).toUpperCase()+o.slice(1);e.push([o,u,`${d} > ${a[u]?.label||"Custom"}`])}}let t=0;const s=[],r={};for(const[o,a,u]of e){const d=n?.[o]?.[a],f=d?.photos||[];if(!f.length)continue;const g=`${o}.${a}`;r[g]=[];for(const b of f){t+=1,r[g].push(t);const I=_t(d?.notes)||_t(b?.name)||"";s.push({num:t,label:u,caption:I,previewUrl:b.previewUrl||null})}}return{index:s,mapByPath:r}}function Pn({inspection:n,rawNotes:e}){const t=[],{mapByPath:s}=bo(n),r=(d,f,g)=>{g?.status&&(g.status==="Needs Attention"||g.status==="Not Clean")&&t.push({issue:`${f}: ${_t(g.notes)||"Issue noted"}`,owner:"",due:"",priority:g.status==="Not Clean"?"High":"Med",photos:s[d]||[]})};r("facility.ceiling","Ceiling",n?.facility?.ceiling),r("facility.walls","Walls",n?.facility?.walls),r("facility.floors","Floors",n?.facility?.floors),r("facility.lighting","Lighting",n?.facility?.lighting),r("operations.employeePractices","Employee practices",n?.operations?.employeePractices),r("operations.handwashing","Handwashing / supplies",n?.operations?.handwashing),r("operations.labelingDating","Labeling / dating",n?.operations?.labelingDating),r("operations.logs","Logs / documentation",n?.operations?.logs),r("equipment.doubleDoorCooler","Double-door cooler",n?.equipment?.doubleDoorCooler),r("equipment.doubleDoorFreezer","Double-door freezer",n?.equipment?.doubleDoorFreezer),r("equipment.walkInCooler","Walk-in cooler",n?.equipment?.walkInCooler),r("equipment.warmers","Warmers / hot holding",n?.equipment?.warmers),r("equipment.ovens","Ovens",n?.equipment?.ovens),r("equipment.threeCompSink","3-compartment sink",n?.equipment?.threeCompSink),r("equipment.ecolab","Ecolab / chemicals",n?.equipment?.ecolab);const o=Number(n?.temps?.handSinkTempF);!Number.isNaN(o)&&o&&o<95&&t.push({issue:`Hand sink temperature below minimum: ${o}F (min 95F)`,owner:"",due:"",priority:"High",photos:[]});const a=Number(n?.temps?.threeCompSinkTempF);!Number.isNaN(a)&&a&&a<110&&t.push({issue:`3-compartment sink wash temperature below minimum: ${a}F (min 110F)`,owner:"",due:"",priority:"High",photos:[]});for(const d of wu(e))t.push({issue:d.issue,owner:"",due:"",priority:"Med",photos:[]});const u=new Set;return t.filter(d=>{const f=d.issue.toLowerCase();return u.has(f)?!1:(u.add(f),!0)})}function Iu(n){const e=`| Issue | Owner | Due | Priority | Photo # |
|---|---|---|---|---|`,t=n.map(s=>{const r=(s.photos||[]).length?s.photos.join(", "):"";return`| ${_t(s.issue)} | ${_t(s.owner)} | ${_t(s.due)} | ${_t(s.priority)} | ${r} |`}).join(`
`);return`${e}
${t||"|  |  |  |  |  |"}`}function Cl({noteType:n,context:e,inspection:t,rawNotes:s,inspectionType:r,inspectionDate:o,inspectorName:a,siteName:u,siteNumber:d,sitePhone:f,supervisorName:g,floor:b}){const I=fr[r]||fr["Regular Inspection"],x=Ug({noteType:n,context:e,inspection:t,inspectionType:r,inspectionDate:o,siteName:u,siteNumber:d}),A=Yt(t),R=Pn({inspection:t,rawNotes:s}),{index:C}=bo(t),L=u||e?.kitchen||"Kitchen",P=d?` (#${d})`:"",O=o||e?.date||"",$=[`- Inspection Type: ${r||""}`,`- Site: ${L}${P}`,b?`- Floor: ${b}`:null,`- Date: ${O}`,`- Inspector: ${a||""}`,`- Supervisor: ${g||""}`,f?`- Site Phone: ${f}`:null,`- Overall Status: ${A}`].filter(Boolean).join(`
`),H=[`- siteName: ${u||""}`,`- siteNumber: ${d||""}`,`- supervisorName: ${g||""}`,f?`- sitePhone: ${f}`:null,...Object.entries(e||{}).map(([V,F])=>`- ${V}: ${F||""}`)].filter(Boolean).join(`
`),z=C.length?C.map(V=>`Photo ${V.num}  ${V.label}${V.caption?`  ${V.caption}`:""}`).join(`
`):"No photos attached.",E=[],y=(V,F)=>{F&&F.status&&F.status!=="OK"&&F.status!=="N/A"&&E.push(`- ${V}: ${F.status}${F.notes?`  ${F.notes}`:""}`)};y("Facility > Ceiling",t?.facility?.ceiling),y("Facility > Walls",t?.facility?.walls),y("Facility > Floors",t?.facility?.floors),y("Facility > Lighting",t?.facility?.lighting),y("Operations > Employee practices",t?.operations?.employeePractices),y("Operations > Handwashing / supplies",t?.operations?.handwashing),y("Operations > Labeling / dating",t?.operations?.labelingDating),y("Operations > Logs / documentation",t?.operations?.logs),y("Equipment > Double-door cooler",t?.equipment?.doubleDoorCooler),y("Equipment > Double-door freezer",t?.equipment?.doubleDoorFreezer),y("Equipment > Walk-in cooler",t?.equipment?.walkInCooler),y("Equipment > Warmers / hot holding",t?.equipment?.warmers),y("Equipment > Ovens",t?.equipment?.ovens),y("Equipment > 3-compartment sink",t?.equipment?.threeCompSink),y("Equipment > Ecolab / chemicals",t?.equipment?.ecolab);const v=Number(t?.temps?.handSinkTempF),_=Number(t?.temps?.threeCompSinkTempF);!Number.isNaN(v)&&v&&v<95&&E.push(`- Temps > Hand sink: ${v}F (below 95F minimum)`),!Number.isNaN(_)&&_&&_<110&&E.push(`- Temps > 3-comp wash: ${_}F (below 110F minimum)`);const T=E.length?E.join(`
`):"- No exceptions noted from checklist/temps.",m=R.filter(V=>V.priority==="High").map(V=>`- ${V.issue}${V.photos?.length?` (Photo ${V.photos.join(", ")})`:""}`).join(`
`)||(r==="Event Day"?"- No critical blockers identified for service.":"- No critical issues flagged.");return[x,"","Hi team,","",I.opening,"",`## ${I.headline}  Snapshot`,$,"","## Context (from sit-down notes)",H||"- ","","## Critical Risks",m,"","## Findings by Area",T,"","## Corrective Actions (please assign Owner + Due)",Iu(R),"","## Photo Index",z,"","## Inspector Notes (organized)",as(s)||""].join(`
`)}function qg({noteType:n,useCase:e,context:t,inspection:s,rawNotes:r,inspectionType:o,inspectionDate:a,inspectorName:u,siteName:d,siteNumber:f,sitePhone:g,supervisorName:b,floor:I}){const x=Yt(s),A=Pn({inspection:s,rawNotes:r});kr(r);const R=d||t?.kitchen||"Kitchen",C=a||t?.date||"";if(e==="Email Summary")return Cl({noteType:n,context:t,inspection:s,rawNotes:r,inspectionType:o,inspectionDate:a,inspectorName:u,siteName:d,siteNumber:f,sitePhone:g,supervisorName:b,floor:I});if(e==="Slack Update"){const L=[`*${o||"Inspection"}  ${R}  ${C}*`,`Inspector: ${u||""} | Status: *${x}*`,"","*Summary:*",as(r),""];if(A.length){L.push(`*Action Items (${A.length}):*`);for(const P of A)L.push(`   [${P.priority}] ${P.issue}`)}else L.push("No corrective actions needed.");return L.join(`
`)}if(e==="Google Doc"){const L=[`# ${o||"Inspection"}  ${R}`,`Date: ${C} | Inspector: ${u||""} | Supervisor: ${b||""}`,`Overall Status: ${x}`,"","## Inspector Notes",as(r),"","## Findings"],P=(O,$)=>{$?.status&&$.status!=="OK"&&$.status!=="N/A"&&L.push(`- **${O}**: ${$.status}${$.notes?`  ${$.notes}`:""}`)};return P("Ceiling",s?.facility?.ceiling),P("Walls",s?.facility?.walls),P("Floors",s?.facility?.floors),P("Lighting",s?.facility?.lighting),P("Employee practices",s?.operations?.employeePractices),P("Handwashing",s?.operations?.handwashing),P("Labeling / dating",s?.operations?.labelingDating),P("Logs",s?.operations?.logs),P("Double-door cooler",s?.equipment?.doubleDoorCooler),P("Double-door freezer",s?.equipment?.doubleDoorFreezer),P("Walk-in cooler",s?.equipment?.walkInCooler),P("Warmers",s?.equipment?.warmers),P("Ovens",s?.equipment?.ovens),P("3-compartment sink",s?.equipment?.threeCompSink),P("Ecolab / chemicals",s?.equipment?.ecolab),L[L.length-1]==="## Findings"&&L.push("- All areas OK."),L.push("","## Action Items"),A.length?L.push(Iu(A)):L.push("No corrective actions needed."),L.join(`
`)}if(e==="Evaluation Scorecard"){const L=[{title:"Facility",items:[["Ceiling",s?.facility?.ceiling],["Walls",s?.facility?.walls],["Floors",s?.facility?.floors],["Lighting",s?.facility?.lighting]]},{title:"Operations",items:[["Employee practices",s?.operations?.employeePractices],["Handwashing",s?.operations?.handwashing],["Labeling / dating",s?.operations?.labelingDating],["Logs",s?.operations?.logs]]},{title:"Equipment",items:[["Double-door cooler",s?.equipment?.doubleDoorCooler],["Double-door freezer",s?.equipment?.doubleDoorFreezer],["Walk-in cooler",s?.equipment?.walkInCooler],["Warmers",s?.equipment?.warmers],["Ovens",s?.equipment?.ovens],["3-comp sink",s?.equipment?.threeCompSink],["Ecolab",s?.equipment?.ecolab]]}],P=["EVALUATION SCORECARD",`${"=".repeat(50)}`,`${o||"Inspection"}  ${R}  ${C}`,`Inspector: ${u||""}`,`Overall: ${x}`,""];for(const H of L){P.push(`--- ${H.title.toUpperCase()} ---`);for(const[z,E]of H.items){const y=E?.status||"N/A",v=y==="OK"?"[PASS]":y==="N/A"?"[ -- ]":"[FAIL]";P.push(`  ${v} ${z}${E?.notes?`  ${E.notes}`:""}`)}P.push("")}P.push("--- TEMPERATURES ---");const O=s?.temps?.handSinkTempF,$=s?.temps?.threeCompSinkTempF;P.push(`  Hand sink: ${O||""}F ${Number(O)>=95?"[PASS]":O?"[FAIL]":""}`),P.push(`  3-comp wash: ${$||""}F ${Number($)>=110?"[PASS]":$?"[FAIL]":""}`),P.push("",`--- ACTION ITEMS (${A.length}) ---`);for(const H of A)P.push(`  [${H.priority}] ${H.issue}`);return A.length||P.push("  None."),P.push("","--- INSPECTOR NOTES ---",as(r)),P.join(`
`)}return Cl({noteType:n,context:t,inspection:s,rawNotes:r,inspectionType:o,inspectionDate:a,inspectorName:u,siteName:d,siteNumber:f,sitePhone:g,supervisorName:b,floor:I})}function Nl({inspection:n,rawNotes:e,context:t,noteType:s}){const r=[],o=(e||"").toLowerCase(),a=(g,b)=>{b?.status==="Needs Attention"&&!b?.notes?.trim()&&r.push(`"${g}" is flagged Needs Attention but has no notes  add details so corrective actions are clear.`),b?.status==="Not Clean"&&!b?.notes?.trim()&&r.push(`"${g}" is flagged Not Clean but has no notes  describe the issue for the report.`)};a("Ceiling",n?.facility?.ceiling),a("Walls",n?.facility?.walls),a("Floors",n?.facility?.floors),a("Lighting",n?.facility?.lighting),a("Employee practices",n?.operations?.employeePractices),a("Handwashing",n?.operations?.handwashing),a("Labeling / dating",n?.operations?.labelingDating),a("Logs",n?.operations?.logs),a("Double-door cooler",n?.equipment?.doubleDoorCooler),a("Double-door freezer",n?.equipment?.doubleDoorFreezer),a("Walk-in cooler",n?.equipment?.walkInCooler),a("Warmers",n?.equipment?.warmers),a("Ovens",n?.equipment?.ovens),a("3-compartment sink",n?.equipment?.threeCompSink),a("Ecolab / chemicals",n?.equipment?.ecolab);const u=Number(n?.temps?.handSinkTempF),d=Number(n?.temps?.threeCompSinkTempF);u&&u<95&&r.push(`Hand sink temp is ${u}F (below 95F min). Flag for immediate maintenance.`),d&&d<110&&r.push(`3-comp sink wash temp is ${d}F (below 110F min). Check water heater.`),u&&u>=95&&u<100&&r.push(`Hand sink temp is ${u}F  passes but is close to the 95F minimum. Monitor.`),d&&d>=110&&d<115&&r.push(`3-comp wash temp is ${d}F  passes but is close to the 110F minimum. Monitor.`),o.includes("allergen")&&r.push("Allergen concerns detected in notes  ensure allergen training is scheduled and documented."),o.includes("haccp")&&r.push("HACCP mentioned  verify all HACCP logs are complete and signed before next inspection."),(o.includes("pest")||o.includes("trap"))&&r.push("Pest control mentioned  document trap locations and schedule pest vendor follow-up."),(o.includes("cutting board")||o.includes("scored"))&&r.push("Scored cutting boards noted  replace immediately per food safety protocol."),o.includes("calibrat")&&r.push("Thermometer calibration mentioned  document last calibration date and schedule next.");const f=wu(e);return f.length>3&&r.push(`${f.length} action items found in notes  consider prioritizing the top 3 for immediate follow-up.`),r.length||r.push("No issues detected. Inspection looks clean!"),r}function Hg({noteType:n,useCase:e,context:t,inspection:s,rawNotes:r,inspectionType:o,inspectionDate:a,inspectorName:u,siteName:d,siteNumber:f,sitePhone:g,supervisorName:b,locationType:I,floor:x}){const A=Yt(s),R=Pn({inspection:s,rawNotes:r});kr(r);const C=d||t?.kitchen||"Kitchen",L=a||t?.date||new Date().toLocaleDateString(),P=fr[o]||fr["Regular Inspection"],{index:O}=bo(s),$=Number(s?.temps?.handSinkTempF),H=Number(s?.temps?.threeCompSinkTempF);function z(_,T){const w=s?.[_]||{};return Object.keys(w).filter(m=>m.startsWith("custom_")).map(m=>({section:T,label:w[m]?.label||"Custom",node:w[m]}))}const E=[{section:"Facility",label:"Ceiling",node:s?.facility?.ceiling},{section:"Facility",label:"Walls",node:s?.facility?.walls},{section:"Facility",label:"Floors",node:s?.facility?.floors},{section:"Facility",label:"Lighting",node:s?.facility?.lighting},...z("facility","Facility"),{section:"Operations",label:"Employee Practices",node:s?.operations?.employeePractices},{section:"Operations",label:"Handwashing / Supplies",node:s?.operations?.handwashing},{section:"Operations",label:"Labeling / Dating",node:s?.operations?.labelingDating},{section:"Operations",label:"Logs / Documentation",node:s?.operations?.logs},...z("operations","Operations"),{section:"Equipment",label:"Double-Door Cooler",node:s?.equipment?.doubleDoorCooler},{section:"Equipment",label:"Double-Door Freezer",node:s?.equipment?.doubleDoorFreezer},{section:"Equipment",label:"Walk-In Cooler",node:s?.equipment?.walkInCooler},{section:"Equipment",label:"Warmers / Hot Holding",node:s?.equipment?.warmers},{section:"Equipment",label:"Ovens",node:s?.equipment?.ovens},{section:"Equipment",label:"3-Compartment Sink",node:s?.equipment?.threeCompSink},{section:"Equipment",label:"Ecolab / Chemicals",node:s?.equipment?.ecolab},...z("equipment","Equipment")],y=E.filter(_=>_.node?.status&&_.node.status!=="OK"&&_.node.status!=="N/A");$&&$<95&&y.push({section:"Temperature",label:"Hand Sink",node:{status:"Not Clean",notes:`${$}F (below 95F minimum)`}}),H&&H<110&&y.push({section:"Temperature",label:"3-Comp Wash",node:{status:"Not Clean",notes:`${H}F (below 110F minimum)`}});const v=["Facility","Operations","Equipment"];return c.jsxs("div",{className:"rpt",children:[c.jsxs("div",{className:"rptHeader",children:[c.jsx("img",{src:_u,alt:"Sodexo",className:"rptLogo"}),c.jsxs("div",{className:"rptHeaderRight",children:[c.jsx("div",{className:"rptDocType",children:o||"Kitchen Inspection"}),c.jsxs("div",{className:"rptDocId",children:["Report #",Date.now().toString(36).toUpperCase()]})]})]}),c.jsxs("div",{className:"rptTitleBar",children:[c.jsxs("div",{children:[c.jsx("div",{className:"rptTitle",children:C}),c.jsx("div",{className:"rptDate",children:L})]}),c.jsx("div",{className:ve("rptStatus",A==="Pass"?"rptStatusPass":"rptStatusFail"),children:A==="Pass"?"PASSED":"NEEDS ATTENTION"})]}),c.jsxs("div",{className:"rptInfoGrid",children:[c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Inspector"}),c.jsx("div",{className:"rptInfoValue",children:u||""})]}),c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Supervisor"}),c.jsx("div",{className:"rptInfoValue",children:b||""})]}),c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Unit / Location"}),c.jsx("div",{className:"rptInfoValue",children:f||""})]}),I&&c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Type"}),c.jsx("div",{className:"rptInfoValue",children:I})]}),x&&c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Floor"}),c.jsx("div",{className:"rptInfoValue",children:x})]}),g&&c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Phone"}),c.jsx("div",{className:"rptInfoValue",children:g})]}),c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Hand Sink Temp"}),c.jsxs("div",{className:"rptInfoValue",children:[s?.temps?.handSinkTempF?`${s.temps.handSinkTempF}F`:"",$>=95&&c.jsx("span",{className:"rptCheck",children:" "}),$>0&&$<95&&c.jsx("span",{className:"rptWarn",children:"  Below 95F"})]})]}),c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"3-Comp Wash Temp"}),c.jsxs("div",{className:"rptInfoValue",children:[s?.temps?.threeCompSinkTempF?`${s.temps.threeCompSinkTempF}F`:"",H>=110&&c.jsx("span",{className:"rptCheck",children:" "}),H>0&&H<110&&c.jsx("span",{className:"rptWarn",children:"  Below 110F"})]})]})]}),(e==="Email Summary"||e==="Google Doc")&&P.opening&&c.jsx("div",{className:"rptBlock",children:c.jsx("p",{className:"rptParagraph",children:P.opening})}),c.jsxs("div",{className:"rptBlock",children:[c.jsx("div",{className:"rptBlockTitle",children:"Inspection Scorecard"}),c.jsxs("table",{className:"rptTable",children:[c.jsx("thead",{children:c.jsxs("tr",{children:[c.jsx("th",{children:"Section"}),c.jsx("th",{children:"Item"}),c.jsx("th",{children:"Status"}),c.jsx("th",{children:"Notes"})]})}),c.jsxs("tbody",{children:[v.map(_=>{const T=E.filter(w=>w.section===_);return T.map((w,m)=>c.jsxs("tr",{className:w.node?.status==="Not Clean"?"rptRowFail":w.node?.status==="Needs Attention"?"rptRowWarn":"",children:[m===0&&c.jsx("td",{rowSpan:T.length,className:"rptSectionCell",children:_}),c.jsx("td",{children:w.label}),c.jsx("td",{children:c.jsx("span",{className:ve("rptStatusPill",w.node?.status==="OK"?"rptPillPass":w.node?.status==="Not Clean"?"rptPillFail":w.node?.status==="Needs Attention"?"rptPillWarn":"rptPillNa"),children:w.node?.status||"N/A"})}),c.jsx("td",{className:"rptNoteCell",children:w.node?.notes||""})]},w.label))}),c.jsxs("tr",{className:$>0&&$<95?"rptRowFail":"",children:[c.jsx("td",{rowSpan:2,className:"rptSectionCell",children:"Temps"}),c.jsx("td",{children:"Hand Sink"}),c.jsx("td",{children:c.jsx("span",{className:ve("rptStatusPill",$>=95?"rptPillPass":$?"rptPillFail":"rptPillNa"),children:s?.temps?.handSinkTempF?`${s.temps.handSinkTempF}F`:"N/A"})}),c.jsx("td",{className:"rptNoteCell",children:$>=95?"Meets minimum":$?"Below 95F minimum":""})]}),c.jsxs("tr",{className:H>0&&H<110?"rptRowFail":"",children:[c.jsx("td",{children:"3-Comp Wash"}),c.jsx("td",{children:c.jsx("span",{className:ve("rptStatusPill",H>=110?"rptPillPass":H?"rptPillFail":"rptPillNa"),children:s?.temps?.threeCompSinkTempF?`${s.temps.threeCompSinkTempF}F`:"N/A"})}),c.jsx("td",{className:"rptNoteCell",children:H>=110?"Meets minimum":H?"Below 110F minimum":""})]})]})]})]}),y.length>0&&c.jsxs("div",{className:"rptBlock rptBlockAlert",children:[c.jsxs("div",{className:"rptBlockTitle rptBlockTitleAlert",children:["Issues Found (",y.length,")"]}),y.map((_,T)=>c.jsxs("div",{className:"rptIssueRow",children:[c.jsx("span",{className:"rptIssueNum",children:T+1}),c.jsxs("div",{className:"rptIssueContent",children:[c.jsxs("div",{className:"rptIssueName",children:[_.label," ",c.jsxs("span",{className:"rptIssueSection",children:["(",_.section,")"]})]}),_.node?.notes&&c.jsx("div",{className:"rptIssueDetail",children:_.node.notes})]}),c.jsx("span",{className:ve("rptStatusPill",_.node?.status==="Not Clean"?"rptPillFail":"rptPillWarn"),children:_.node?.status})]},T))]}),R.length>0&&c.jsxs("div",{className:"rptBlock",children:[c.jsx("div",{className:"rptBlockTitle",children:"Corrective Actions Required"}),R.map((_,T)=>c.jsxs("div",{className:"rptActionRow",children:[c.jsx("span",{className:ve("rptPriorityDot",_.priority==="High"?"rptDotHigh":"rptDotMed")}),c.jsxs("div",{className:"rptActionContent",children:[c.jsx("span",{className:"rptActionText",children:_.issue}),c.jsxs("span",{className:ve("rptPriorityLabel",_.priority==="High"?"rptLabelHigh":"rptLabelMed"),children:[_.priority," Priority"]})]})]},T))]}),O.length>0&&c.jsxs("div",{className:"rptBlock",children:[c.jsxs("div",{className:"rptBlockTitle",children:["Photo Evidence (",O.length,")"]}),c.jsx("div",{className:"rptPhotoGallery",children:O.map(_=>c.jsxs("div",{className:"rptPhotoCard",children:[_.previewUrl?c.jsx("img",{src:_.previewUrl,alt:`Photo #${_.num}`,className:"rptPhotoImg"}):c.jsx("div",{className:"rptPhotoPlaceholder",children:"No preview"}),c.jsxs("div",{className:"rptPhotoCaption",children:[c.jsxs("span",{className:"rptPhotoNum",children:["#",_.num]}),c.jsxs("span",{children:[_.label,_.caption?`  ${_.caption}`:""]})]})]},_.num))})]}),r&&(()=>{const{grouped:_}=jr(r);return Object.values(_).some(w=>w.length>0)?c.jsxs("div",{className:"rptBlock",children:[c.jsx("div",{className:"rptBlockTitle",children:"Inspector Notes"}),c.jsx("div",{className:"rptNotesOrganized",children:Vr.map(w=>!_[w]||!_[w].length?null:c.jsxs("div",{className:"rptNoteCategory",children:[c.jsx("div",{className:ve("rptNoteCatLabel",`rptNoteCat--${w}`),children:Dr[w]}),c.jsx("ul",{className:"rptNoteBullets",children:_[w].map((m,V)=>c.jsx("li",{children:m},V))})]},w))})]}):null})(),c.jsxs("div",{className:"rptFooter",children:[c.jsxs("div",{children:["Generated ",new Date().toLocaleDateString()," ",new Date().toLocaleTimeString(),"  Sodexo Kitchen Inspection System"]}),c.jsx("div",{children:"This report is confidential and intended for internal use only."})]})]})}function zg({inspection:n,rawNotes:e,inspectionType:t,inspectionDate:s,inspectorName:r,siteName:o,siteNumber:a,supervisorName:u}){const d=[["Section","Item","Status","Notes","Priority"]],f=(g,b,I)=>{if(!I)return;const x=I.status==="Not Clean"?"High":I.status==="Needs Attention"?"Med":"";d.push([g,b,I.status||"",(I.notes||"").replace(/"/g,'""'),x])};return f("Facility","Ceiling",n?.facility?.ceiling),f("Facility","Walls",n?.facility?.walls),f("Facility","Floors",n?.facility?.floors),f("Facility","Lighting",n?.facility?.lighting),f("Operations","Employee practices",n?.operations?.employeePractices),f("Operations","Handwashing / supplies",n?.operations?.handwashing),f("Operations","Labeling / dating",n?.operations?.labelingDating),f("Operations","Logs / documentation",n?.operations?.logs),f("Equipment","Double-door cooler",n?.equipment?.doubleDoorCooler),f("Equipment","Double-door freezer",n?.equipment?.doubleDoorFreezer),f("Equipment","Walk-in cooler",n?.equipment?.walkInCooler),f("Equipment","Warmers / hot holding",n?.equipment?.warmers),f("Equipment","Ovens",n?.equipment?.ovens),f("Equipment","3-compartment sink",n?.equipment?.threeCompSink),f("Equipment","Ecolab / chemicals",n?.equipment?.ecolab),d.push(["Temps","Hand sink (F)",n?.temps?.handSinkTempF||"",Number(n?.temps?.handSinkTempF)>=95?"Pass":"Below min",""]),d.push(["Temps","3-comp wash (F)",n?.temps?.threeCompSinkTempF||"",Number(n?.temps?.threeCompSinkTempF)>=110?"Pass":"Below min",""]),d}function Kg({inspection:n,rawNotes:e,inspectionType:t,inspectionDate:s,inspectorName:r,siteName:o,siteNumber:a,supervisorName:u,floor:d}){const f=zg({inspection:n,rawNotes:e,inspectionType:t,inspectionDate:s,inspectorName:r,siteName:o,siteNumber:a,supervisorName:u}),g=Yt(n),b=Pn({inspection:n,rawNotes:e}),I=`<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
<head><meta charset="utf-8">
<!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>
<x:Name>Inspection</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions>
</x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]-->
<style>
  td, th { mso-number-format:"\\@"; padding: 6px 10px; border: 1px solid #ccc; font-family: Calibri, Arial; font-size: 11pt; }
  th { background: #2A295C; color: white; font-weight: bold; }
  .section-header { background: #F0F1F5; font-weight: bold; color: #2A295C; font-size: 12pt; }
  .pass { background: #ECFDF5; color: #15803D; font-weight: bold; }
  .fail { background: #FEF2F2; color: #DC2626; font-weight: bold; }
  .warn { background: #FFFBEB; color: #D97706; }
  .meta-label { font-weight: bold; color: #2A295C; background: #F7F8FA; }
  .title { font-size: 16pt; font-weight: bold; color: #2A295C; }
</style></head><body>
<table>
  <tr><td class="title" colspan="5">SODEXO KITCHEN INSPECTION REPORT</td></tr>
  <tr><td colspan="5" style="border-bottom: 3px solid #EE0000; padding: 0;"></td></tr>
  <tr><td class="meta-label">Inspection Type</td><td colspan="4">${t||""}</td></tr>
  <tr><td class="meta-label">Date</td><td colspan="4">${s||""}</td></tr>
  <tr><td class="meta-label">Inspector</td><td colspan="4">${r||""}</td></tr>
  <tr><td class="meta-label">Site / Location</td><td colspan="4">${o||""}</td></tr>
  <tr><td class="meta-label">Unit #</td><td colspan="4">${a||""}</td></tr>
  <tr><td class="meta-label">Floor</td><td colspan="4">${d||""}</td></tr>
  <tr><td class="meta-label">Supervisor</td><td colspan="4">${u||""}</td></tr>
  <tr><td class="meta-label">Overall Status</td><td colspan="4" class="${g==="Pass"?"pass":"fail"}">${g}</td></tr>
  <tr><td colspan="5"></td></tr>
  <tr><td class="section-header" colspan="5">INSPECTION SCORECARD</td></tr>
  <tr><th>Section</th><th>Item</th><th>Status</th><th>Notes</th><th>Priority</th></tr>
  ${f.slice(1).map(R=>{const C=R[2]==="OK"?"pass":R[2]==="Not Clean"?"fail":R[2]==="Needs Attention"?"warn":"";return`<tr><td>${R[0]}</td><td>${R[1]}</td><td class="${C}">${R[2]}</td><td>${R[3]}</td><td>${R[4]}</td></tr>`}).join(`
  `)}
  <tr><td colspan="5"></td></tr>
  ${b.length>0?`
  <tr><td class="section-header" colspan="5">CORRECTIVE ACTIONS</td></tr>
  <tr><th>#</th><th colspan="3">Issue</th><th>Priority</th></tr>
  ${b.map((R,C)=>`<tr><td>${C+1}</td><td colspan="3">${R.issue}</td><td class="${R.priority==="High"?"fail":"warn"}">${R.priority}</td></tr>`).join(`
  `)}
  <tr><td colspan="5"></td></tr>`:""}
  <tr><td class="section-header" colspan="5">INSPECTOR NOTES</td></tr>
  <tr><td colspan="5" style="white-space:pre-wrap;font-size:10pt;">${as(e).replace(/</g,"&lt;")}</td></tr>
</table></body></html>`,x=new Blob([I],{type:"application/vnd.ms-excel"}),A=`inspection_${s||"undated"}_${(o||"site").replace(/\s+/g,"_")}.xls`;vo(x,A)}function Au({output:n,inspection:e,rawNotes:t,inspectionType:s,inspectionDate:r,siteName:o,siteNumber:a,sitePhone:u,inspectorName:d,supervisorName:f}){const g=Yt(e),b=Pn({inspection:e,rawNotes:t});kr(t);const I=[["Facility","Ceiling",e?.facility?.ceiling],["Facility","Walls",e?.facility?.walls],["Facility","Floors",e?.facility?.floors],["Facility","Lighting",e?.facility?.lighting],["Operations","Employee Practices",e?.operations?.employeePractices],["Operations","Handwashing / Supplies",e?.operations?.handwashing],["Operations","Labeling / Dating",e?.operations?.labelingDating],["Operations","Logs / Documentation",e?.operations?.logs],["Equipment","Double-Door Cooler",e?.equipment?.doubleDoorCooler],["Equipment","Double-Door Freezer",e?.equipment?.doubleDoorFreezer],["Equipment","Walk-In Cooler",e?.equipment?.walkInCooler],["Equipment","Warmers / Hot Holding",e?.equipment?.warmers],["Equipment","Ovens",e?.equipment?.ovens],["Equipment","3-Compartment Sink",e?.equipment?.threeCompSink],["Equipment","Ecolab / Chemicals",e?.equipment?.ecolab]],x=I.filter(([,,O])=>O?.status&&O.status!=="OK"&&O.status!=="N/A"),A=Number(e?.temps?.handSinkTempF),R=Number(e?.temps?.threeCompSinkTempF),C=`<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">
<head><meta charset="utf-8">
<!--[if gte mso 9]><xml><w:WordDocument><w:View>Print</w:View><w:Zoom>100</w:Zoom></w:WordDocument></xml><![endif]-->
<style>
  @page { size: letter; margin: 1in; }
  body { font-family: Calibri, Arial, sans-serif; font-size: 11pt; color: #1F2937; line-height: 1.5; }
  h1 { color: #2A295C; font-size: 22pt; margin-bottom: 4px; }
  h2 { color: #2A295C; font-size: 14pt; border-bottom: 2px solid #2A295C; padding-bottom: 4px; margin-top: 24px; }
  .red-line { border-bottom: 3px solid #EE0000; margin-bottom: 20px; }
  .info-table { width: 100%; border-collapse: collapse; margin: 16px 0; }
  .info-table td { padding: 8px 12px; border: 1px solid #E5E7EB; font-size: 10pt; }
  .info-label { background: #F7F8FA; font-weight: bold; color: #2A295C; width: 30%; }
  .status-pass { background: #ECFDF5; color: #15803D; font-weight: bold; font-size: 12pt; text-align: center; padding: 10px; }
  .status-fail { background: #FEF2F2; color: #DC2626; font-weight: bold; font-size: 12pt; text-align: center; padding: 10px; }
  table.scorecard { width: 100%; border-collapse: collapse; margin: 12px 0; }
  table.scorecard th { background: #2A295C; color: white; padding: 8px 12px; text-align: left; font-size: 10pt; }
  table.scorecard td { padding: 7px 12px; border: 1px solid #E5E7EB; font-size: 10pt; }
  .sc-section { background: #F0F1F5; font-weight: bold; color: #2A295C; }
  .pill-pass { background: #ECFDF5; color: #15803D; font-weight: bold; padding: 2px 8px; }
  .pill-fail { background: #FEF2F2; color: #DC2626; font-weight: bold; padding: 2px 8px; }
  .pill-warn { background: #FFFBEB; color: #D97706; font-weight: bold; padding: 2px 8px; }
  .pill-na { background: #F3F4F6; color: #9CA3AF; padding: 2px 8px; }
  .issue-num { background: #DC2626; color: white; font-weight: bold; padding: 2px 8px; text-align: center; width: 30px; }
  .notes-box { background: #F7F8FA; padding: 16px; border-left: 3px solid #2A295C; white-space: pre-wrap; font-size: 10pt; line-height: 1.7; }
  .footer { margin-top: 32px; padding-top: 12px; border-top: 1px solid #E5E7EB; font-size: 8pt; color: #9CA3AF; text-align: center; }
</style></head><body>

<h1>Sodexo Kitchen Inspection Report</h1>
<div class="red-line"></div>

<table class="info-table">
  <tr><td class="info-label">Inspection Type</td><td>${s||""}</td><td class="info-label">Date</td><td>${r||""}</td></tr>
  <tr><td class="info-label">Inspector</td><td>${d||""}</td><td class="info-label">Supervisor</td><td>${f||""}</td></tr>
  <tr><td class="info-label">Site / Location</td><td>${o||""}</td><td class="info-label">Unit #</td><td>${a||""}</td></tr>
  ${u?`<tr><td class="info-label">Phone</td><td>${u}</td><td></td><td></td></tr>`:""}
  <tr><td class="info-label">Hand Sink Temp</td><td>${e?.temps?.handSinkTempF?e.temps.handSinkTempF+"F":""} ${A>=95?"":A?" Below 95F":""}</td>
      <td class="info-label">3-Comp Wash Temp</td><td>${e?.temps?.threeCompSinkTempF?e.temps.threeCompSinkTempF+"F":""} ${R>=110?"":R?" Below 110F":""}</td></tr>
  <tr><td class="info-label">Overall Status</td><td colspan="3" class="${g==="Pass"?"status-pass":"status-fail"}">${g==="Pass"?"PASSED":"NEEDS ATTENTION"}</td></tr>
</table>

<h2>Inspection Scorecard</h2>
<table class="scorecard">
  <tr><th>Section</th><th>Item</th><th>Status</th><th>Notes</th></tr>
  ${I.map(([O,$,H])=>{const z=H?.status||"N/A";return`<tr><td>${O}</td><td>${$}</td><td><span class="${z==="OK"?"pill-pass":z==="Not Clean"?"pill-fail":z==="Needs Attention"?"pill-warn":"pill-na"}">${z}</span></td><td>${H?.notes||""}</td></tr>`}).join(`
  `)}
  <tr><td>Temps</td><td>Hand Sink</td><td><span class="${A>=95?"pill-pass":A?"pill-fail":"pill-na"}">${e?.temps?.handSinkTempF?e.temps.handSinkTempF+"F":"N/A"}</span></td><td>${A>=95?"Meets minimum":A?"Below 95F minimum":""}</td></tr>
  <tr><td>Temps</td><td>3-Comp Wash</td><td><span class="${R>=110?"pill-pass":R?"pill-fail":"pill-na"}">${e?.temps?.threeCompSinkTempF?e.temps.threeCompSinkTempF+"F":"N/A"}</span></td><td>${R>=110?"Meets minimum":R?"Below 110F minimum":""}</td></tr>
</table>

${x.length>0?`
<h2>Issues Found (${x.length})</h2>
<table class="scorecard">
  <tr><th>#</th><th>Area</th><th>Item</th><th>Status</th><th>Notes</th></tr>
  ${x.map(([O,$,H],z)=>`<tr><td class="issue-num">${z+1}</td><td>${O}</td><td>${$}</td><td><span class="pill-fail">${H.status}</span></td><td>${H.notes||""}</td></tr>`).join(`
  `)}
</table>`:'<h2>Issues</h2><p style="background:#ECFDF5;padding:12px;color:#15803D;font-weight:bold;text-align:center;">All areas passed inspection</p>'}

${b.length>0?`
<h2>Corrective Actions Required</h2>
<table class="scorecard">
  <tr><th>#</th><th>Issue</th><th>Priority</th></tr>
  ${b.map((O,$)=>`<tr><td style="text-align:center">${$+1}</td><td>${O.issue}</td><td><span class="${O.priority==="High"?"pill-fail":"pill-warn"}">${O.priority}</span></td></tr>`).join(`
  `)}
</table>`:""}

<h2>Inspector Notes</h2>
${(()=>{const{grouped:O}=jr(t),$=Vr.filter(H=>O[H]?.length);return $.length?$.map(H=>`<div style="margin-bottom:12px;"><p style="font-weight:bold;color:#2A295C;font-size:10pt;margin:0 0 4px 0;">${Dr[H]}</p><ul style="margin:0;padding-left:20px;">${O[H].map(z=>`<li style="margin-bottom:4px;font-size:10pt;line-height:1.5;">${z.replace(/</g,"&lt;")}</li>`).join("")}</ul></div>`).join(""):'<div class="notes-box"></div>'})()}

<div class="footer">
  <p>Generated ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}  Sodexo Kitchen Inspection System</p>
  <p>This report is confidential and intended for internal use only.</p>
</div>
</body></html>`,L=new Blob([C],{type:"application/msword"}),P=`inspection_${r||"undated"}_${(o||"site").replace(/\s+/g,"_")}.doc`;vo(L,P)}function Su({output:n,inspectionDate:e,siteName:t}){const s=new Blob([n||""],{type:"text/plain;charset=utf-8;"}),r=`inspection_${e||"undated"}_${(t||"site").replace(/\s+/g,"_")}.txt`;vo(s,r)}function Wg({history:n}){const[e,t]=B.useState(null),[s,r]=B.useState(null),o=B.useMemo(()=>{const x={};for(const A of n){const R=`${A.siteName||A.location||"Unknown"}${A.floor?` - ${A.floor}`:""}`,C=A.siteNumber||"";x[R]||(x[R]={points:[],unitNum:C});const L=Number(A.temps?.handSinkTempF),P=Number(A.temps?.threeCompSinkTempF);(L||P)&&x[R].points.push({date:A.inspectionDate||A.savedAt?.slice(0,10)||"",handSink:L||null,threeComp:P||null,floor:A.floor||"",status:A.overallStatus||""})}for(const A of Object.keys(x))x[A].points.sort((R,C)=>R.date.localeCompare(C.date));return x},[n]),a=Object.keys(o);if(a.length===0)return null;const u=500,d=220,f=45,g=20,b=20,I=50;return c.jsxs("div",{className:"card",style:{marginBottom:24},children:[c.jsxs("div",{className:"cardHeader",children:[c.jsx("div",{className:"cardTitle",children:"Temperature Trends by Location"}),c.jsxs("div",{className:"cardSub",style:{fontSize:"0.72rem",color:"#6b7280"},children:[a.length," location",a.length!==1?"s":""," tracked"]})]}),c.jsx("div",{className:"cardBody",children:c.jsx("div",{className:"tempChartsGrid",children:a.map(x=>{const{points:A,unitNum:R}=o[x],C=A.flatMap(F=>[F.handSink,F.threeComp]).filter(Boolean);if(C.length===0)return null;const L=Math.min(...C,90)-5,P=Math.max(...C,115)+5,O=P-L||1,$=A.length>1?(u-f-g)/(A.length-1):(u-f-g)/2,H=A.length===1?(u-f-g)/2:0,z=F=>f+H+F*$,E=F=>b+(d-b-I)*(1-(F-L)/O),y=A.map((F,G)=>F.handSink?[z(G),E(F.handSink)]:null).filter(Boolean),v=A.map((F,G)=>F.threeComp?[z(G),E(F.threeComp)]:null).filter(Boolean),_=F=>F.map((G,ue)=>`${ue===0?"M":"L"}${G[0]},${G[1]}`).join(" "),T=F=>{if(F.length<2)return"";const G=d-I;return`${_(F)} L${F[F.length-1][0]},${G} L${F[0][0]},${G} Z`},w=[];for(let F=Math.ceil(L/10)*10;F<=P;F+=10)w.push(F);const m=y.length>0?Math.round(A.reduce((F,G)=>F+(G.handSink||0),0)/A.filter(F=>F.handSink).length):null,V=v.length>0?Math.round(A.reduce((F,G)=>F+(G.threeComp||0),0)/A.filter(F=>F.threeComp).length):null;return c.jsxs("div",{className:"tempChartItem",children:[c.jsxs("div",{className:"tempChartHeader",children:[c.jsx("div",{className:"tempChartLabel",children:x}),R&&c.jsxs("span",{className:"tempChartUnit",children:["#",R]})]}),c.jsxs("div",{className:"tempChartAvgs",children:[m!==null&&c.jsxs("span",{className:ve("tempAvgPill","tempAvgPillClickable",s==="hand"&&"tempAvgPillActive"),style:{background:s==="hand"?"#3b82f6":m>=95?"#dbeafe":"#fee2e2",color:s==="hand"?"#fff":m>=95?"#1d4ed8":"#dc2626"},onClick:()=>r(s==="hand"?null:"hand"),children:["Avg Hand: ",m,"F"]}),V!==null&&c.jsxs("span",{className:ve("tempAvgPill","tempAvgPillClickable",s==="three"&&"tempAvgPillActive"),style:{background:s==="three"?"#8b5cf6":V>=110?"#ede9fe":"#fee2e2",color:s==="three"?"#fff":V>=110?"#7c3aed":"#dc2626"},onClick:()=>r(s==="three"?null:"three"),children:["Avg 3-Comp: ",V,"F"]}),c.jsxs("span",{className:"tempAvgPill",style:{background:"#f0fdf4",color:"#15803d"},children:[A.length," reading",A.length!==1?"s":""]})]}),c.jsxs("svg",{viewBox:`0 0 ${u} ${d}`,className:"tempChartSvg",onMouseLeave:()=>t(null),children:[c.jsxs("defs",{children:[c.jsxs("linearGradient",{id:`handGrad-${x.replace(/\W/g,"")}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[c.jsx("stop",{offset:"0%",stopColor:"#3b82f6",stopOpacity:"0.25"}),c.jsx("stop",{offset:"100%",stopColor:"#3b82f6",stopOpacity:"0.02"})]}),c.jsxs("linearGradient",{id:`threeGrad-${x.replace(/\W/g,"")}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[c.jsx("stop",{offset:"0%",stopColor:"#8b5cf6",stopOpacity:"0.25"}),c.jsx("stop",{offset:"100%",stopColor:"#8b5cf6",stopOpacity:"0.02"})]})]}),w.map(F=>c.jsxs("g",{children:[c.jsx("line",{x1:f,y1:E(F),x2:u-g,y2:E(F),stroke:"#e5e7eb",strokeWidth:"1"}),c.jsxs("text",{x:f-6,y:E(F)+4,textAnchor:"end",fontSize:"9",fill:"#9ca3af",children:[F,""]})]},F)),[95,110].map(F=>{if(F<L||F>P)return null;const G=E(F),ue=F===95,fe=s&&s!==(ue?"hand":"three");return c.jsxs("g",{opacity:fe?.15:1,style:{transition:"opacity 0.3s"},children:[c.jsx("line",{x1:f,y1:G,x2:u-g,y2:G,stroke:ue?"#3b82f6":"#8b5cf6",strokeDasharray:"6,4",strokeWidth:"1.5",opacity:"0.6"}),c.jsx("rect",{x:u-g+2,y:G-8,width:"36",height:"16",rx:"3",fill:ue?"#3b82f6":"#8b5cf6",opacity:"0.9"}),c.jsxs("text",{x:u-g+20,y:G+4,textAnchor:"middle",fontSize:"8",fill:"white",fontWeight:"bold",children:[F,"F"]})]},F)}),y.length>=2&&c.jsx("path",{d:T(y),fill:`url(#handGrad-${x.replace(/\W/g,"")})`,opacity:s&&s!=="hand"?.1:1,style:{transition:"opacity 0.3s"}}),v.length>=2&&c.jsx("path",{d:T(v),fill:`url(#threeGrad-${x.replace(/\W/g,"")})`,opacity:s&&s!=="three"?.1:1,style:{transition:"opacity 0.3s"}}),y.length>1&&c.jsx("path",{d:_(y),fill:"none",stroke:"#3b82f6",strokeWidth:s==="hand"?"3.5":"2.5",strokeLinecap:"round",strokeLinejoin:"round",opacity:s&&s!=="hand"?.15:1,style:{transition:"opacity 0.3s, stroke-width 0.3s"}}),v.length>1&&c.jsx("path",{d:_(v),fill:"none",stroke:"#8b5cf6",strokeWidth:s==="three"?"3.5":"2.5",strokeLinecap:"round",strokeLinejoin:"round",opacity:s&&s!=="three"?.15:1,style:{transition:"opacity 0.3s, stroke-width 0.3s"}}),A.map((F,G)=>{const ue=`${x}-${G}`;return c.jsxs("g",{onMouseEnter:()=>t(ue),onTouchStart:()=>t(ue),children:[F.handSink&&c.jsxs("g",{opacity:s&&s!=="hand"?.15:1,style:{transition:"opacity 0.3s"},children:[c.jsx("circle",{cx:z(G),cy:E(F.handSink),r:s==="hand"?6:5,fill:"white",stroke:F.handSink>=95?"#3b82f6":"#ef4444",strokeWidth:"2.5",style:{transition:"r 0.3s"}}),(e===ue||s==="hand")&&c.jsxs("g",{children:[c.jsx("rect",{x:z(G)-30,y:E(F.handSink)-26,width:"60",height:"20",rx:"4",fill:"#1e293b",opacity:"0.9"}),c.jsxs("text",{x:z(G),y:E(F.handSink)-12,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:[F.handSink,"F"]})]})]}),F.threeComp&&c.jsxs("g",{opacity:s&&s!=="three"?.15:1,style:{transition:"opacity 0.3s"},children:[c.jsx("circle",{cx:z(G),cy:E(F.threeComp),r:s==="three"?6:5,fill:"white",stroke:F.threeComp>=110?"#8b5cf6":"#ef4444",strokeWidth:"2.5",style:{transition:"r 0.3s"}}),(e===ue||s==="three")&&c.jsxs("g",{children:[c.jsx("rect",{x:z(G)-30,y:E(F.threeComp)-26,width:"60",height:"20",rx:"4",fill:"#1e293b",opacity:"0.9"}),c.jsxs("text",{x:z(G),y:E(F.threeComp)-12,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:[F.threeComp,"F"]})]})]}),c.jsx("rect",{x:z(G)-15,y:b,width:"30",height:d-b-I,fill:"transparent"})]},G)}),A.map((F,G)=>c.jsx("text",{x:z(G),y:d-10,textAnchor:"middle",fontSize:"9",fill:"#6b7280",fontWeight:"500",children:F.date.slice(5)},G))]}),c.jsxs("div",{className:"tempChartLegend",children:[c.jsxs("span",{className:"tempLegendItem",children:[c.jsx("span",{className:"tempLegendDot",style:{background:"#3b82f6"}})," Hand Sink (min 95F)"]}),c.jsxs("span",{className:"tempLegendItem",children:[c.jsx("span",{className:"tempLegendDot",style:{background:"#8b5cf6"}})," 3-Comp (min 110F)"]}),c.jsxs("span",{className:"tempLegendItem",children:[c.jsx("span",{className:"tempLegendDot",style:{background:"#ef4444"}})," Below min"]})]})]},x)})})})]})}function Gg({history:n,onLocationClick:e}){const t=B.useMemo(()=>{if(n.length<2)return null;const s={},r={},o={},a={};for(const A of n){const R=`${A.siteName||A.location||"Unknown"}${A.floor?` (${A.floor})`:""}`,C=A.siteNumber||"";a[R]=(a[R]||0)+1;const L=new Set;for(const P of A.actionItems||[]){const O=P.issue?.split(":")[0]?.trim()||"Other";L.has(O)||(L.add(O),s[O]=(s[O]||0)+1,r[O]||(r[O]=[]),r[O].push({name:A.siteName||A.location||"Unknown",unit:C,floor:A.floor||"",date:A.inspectionDate||""}),o[R]||(o[R]={}),o[R][O]=(o[R][O]||0)+1)}}const u=Object.entries(s).filter(([,A])=>A>=2).sort((A,R)=>R[1]-A[1]).map(([A,R])=>{const C={};for(const P of r[A]){const O=`${P.name}${P.unit?` #${P.unit}`:""}${P.floor?` (${P.floor})`:""}`;C[O]||(C[O]={label:O,count:0,dates:[]}),C[O].count++,P.date&&C[O].dates.push(P.date)}const L=Object.values(C).sort((P,O)=>O.count-P.count);return{category:A,count:R,kitchens:L}}),d={};for(const[A,R]of Object.entries(o)){const C=a[A]||1,L=Object.entries(R).filter(([,P])=>P>=2).map(([P,O])=>({category:P,count:O,rate:Math.round(O/C*100)})).sort((P,O)=>O.rate-P.rate);L.length>0&&(d[A]=L)}let f=0,g=0;for(const A of n){const R=Number(A.temps?.handSinkTempF),C=Number(A.temps?.threeCompSinkTempF);R&&(f++,R<95&&g++),C&&(f++,C<110&&g++)}const b=f>0?Math.round((f-g)/f*100):null,I={};for(const A of n){const R=`${A.siteName||A.location||"Unknown"}${A.siteNumber?` #${A.siteNumber}`:""}${A.floor?` (${A.floor})`:""}`;I[R]=(I[R]||0)+(A.actionItems||[]).length}const x=Object.entries(I).filter(([,A])=>A>=2).sort((A,R)=>R[1]-A[1]).slice(0,5);return{recurring:u,locationRecurring:d,tempComplianceRate:b,tempChecks:f,tempFails:g,totalInspections:n.length,worstLocations:x}},[n]);return!t||t.recurring.length===0&&Object.keys(t.locationRecurring).length===0&&t.worstLocations.length===0?null:c.jsxs("div",{className:"card",style:{marginBottom:24},children:[c.jsx("div",{className:"cardHeader",children:c.jsx("div",{className:"cardTitle",children:"Recurring Issues Tracker"})}),c.jsxs("div",{className:"cardBody",children:[c.jsxs("div",{className:"analysisStatsRow",children:[c.jsxs("div",{className:"analysisStat",children:[c.jsx("div",{className:"analysisStatNum",children:t.totalInspections}),c.jsx("div",{className:"analysisStatLabel",children:"Total Inspections"})]}),t.tempComplianceRate!==null&&c.jsxs("div",{className:"analysisStat",children:[c.jsxs("div",{className:"analysisStatNum",style:{color:t.tempComplianceRate>=90?"#15803D":"#EE0000"},children:[t.tempComplianceRate,"%"]}),c.jsx("div",{className:"analysisStatLabel",children:"Temp Compliance"})]}),c.jsxs("div",{className:"analysisStat",children:[c.jsx("div",{className:"analysisStatNum",style:{color:t.recurring.length>0?"#EE0000":"#15803D"},children:t.recurring.length}),c.jsx("div",{className:"analysisStatLabel",children:"Repeat Issues"})]})]}),t.recurring.length>0&&c.jsxs("div",{style:{marginTop:16},children:[c.jsx("div",{className:"guideSectionTitle",children:"Issues That Keep Coming Back"}),c.jsx("div",{className:"recurringList",children:t.recurring.map(({category:s,count:r,kitchens:o})=>c.jsxs("div",{className:"recurringItem recurringItemExpanded",children:[c.jsx("span",{className:"recurringBar",style:{width:`${Math.min(100,r/t.totalInspections*100)}%`}}),c.jsxs("div",{className:"recurringTop",children:[c.jsx("span",{className:"recurringLabel",children:s}),c.jsxs("span",{className:"recurringBadge",children:[r,"/",t.totalInspections," (",Math.round(r/t.totalInspections*100),"%)"]})]}),c.jsx("div",{className:"recurringKitchens",children:o.map((a,u)=>c.jsxs("span",{className:"recurringKitchenTag recurringKitchenClickable",onClick:()=>e?.(a.label.split(" #")[0].split(" (")[0]),children:[a.label," ",c.jsxs("span",{className:"recurringKitchenCount",children:["",a.count]})]},u))})]},s))})]}),t.worstLocations.length>0&&c.jsxs("div",{style:{marginTop:20},children:[c.jsx("div",{className:"guideSectionTitle",children:"Locations With Most Issues"}),c.jsx("div",{className:"worstLocationsList",children:t.worstLocations.map(([s,r],o)=>c.jsxs("div",{className:"worstLocation worstLocationClickable",onClick:()=>e?.(s.split(" #")[0].split(" (")[0]),children:[c.jsxs("span",{className:"worstRank",style:{background:o===0?"#EE0000":o===1?"#f97316":"#eab308"},children:["#",o+1]}),c.jsx("span",{className:"worstName",children:s}),c.jsxs("span",{className:"worstCount",children:[r," issue",r!==1?"s":""]}),c.jsx("span",{className:"worstArrow",children:""})]},s))})]}),Object.keys(t.locationRecurring).length>0&&c.jsxs("div",{style:{marginTop:20},children:[c.jsx("div",{className:"guideSectionTitle",children:"Flagged Locations  Repeat Problems"}),Object.entries(t.locationRecurring).map(([s,r])=>c.jsxs("div",{className:"flaggedLocation",children:[c.jsx("div",{className:"flaggedLocationName",children:s}),c.jsx("div",{className:"flaggedIssuesList",children:r.map((o,a)=>c.jsxs("div",{className:"flaggedIssue",children:[c.jsx("span",{className:"flaggedIssueCat",children:o.category}),c.jsxs("span",{className:"flaggedIssueRate",style:{color:o.rate>=50?"#EE0000":"#b45309"},children:[o.count,"x (",o.rate,"% of inspections)"]})]},a))})]},s))]})]})]})}function Qg({onBack:n}){const[e,t]=B.useState([]),[s,r]=B.useState(""),[o,a]=B.useState(""),[u,d]=B.useState(""),[f,g]=B.useState(""),[b,I]=B.useState(""),[x,A]=B.useState(""),[R,C]=B.useState(null),[L,P]=B.useState(!1),[O,$]=B.useState("reports");B.useEffect(()=>{yo().then(m=>{t(m),P(!0)})},[]),B.useMemo(()=>{const m=new Set;for(const V of e)for(const F of V.actionItems||[])m.add(F.issue?.split(":")[0]?.trim()||"Other");return Array.from(m).sort()},[e]);const H=B.useMemo(()=>e.filter(m=>!(s&&m.inspectionDate!==s||o&&m.inspectionType!==o||u&&m.floor!==u||x&&m.locationType!==x||b&&!`${m.siteName||m.location||""}${m.siteNumber?` #${m.siteNumber}`:""}`.toLowerCase().includes(b.toLowerCase())||f&&!(m.actionItems||[]).some(F=>F.issue?.toLowerCase().includes(f.toLowerCase())))),[e,s,o,u,b,f]);function z(m){I(m),r(""),a(""),d(""),g(""),$("reports"),setTimeout(()=>{const V=document.getElementById("history-results");V&&V.scrollIntoView({behavior:"smooth",block:"start"})},100)}function E(m){const V=e.filter(F=>F.id!==m);t(V),bg(m).catch(()=>{})}function y(){confirm("Delete all inspection history? This cannot be undone.")&&(t([]),Eg().catch(()=>{}))}const v=[...new Set(e.map(m=>m.inspectionDate).filter(Boolean))].sort().reverse(),_=[...new Set(e.map(m=>m.inspectionType).filter(Boolean))].sort(),T=[...new Set(e.map(m=>m.floor).filter(Boolean))].sort(),w=[...new Set(e.map(m=>m.locationType).filter(Boolean))].sort();return c.jsxs("div",{className:"appShell",children:[c.jsxs("header",{className:"topBar",children:[c.jsxs("div",{className:"brandLeft brandClickable",onClick:n,title:"Back to Inspector",children:[c.jsx("img",{src:wn,alt:"Sodexo",className:"brandLogo"}),c.jsxs("div",{children:[c.jsx("div",{className:"brandTitle",children:"Inspection History"}),c.jsxs("div",{className:"brandSub",children:[e.length," saved inspection",e.length!==1?"s":""]})]})]}),c.jsxs("div",{className:"topActions",children:[c.jsx("button",{className:"btn btnGhost",onClick:n,type:"button",children:"Back to Inspector"}),e.length>0&&c.jsx("button",{className:"btn btnGhost",onClick:y,type:"button",style:{color:"#EE0000",borderColor:"#EE0000"},children:"Clear All"})]})]}),c.jsx("div",{className:"topBarSpacer"}),c.jsxs("main",{className:"pageMain pageMainWide",children:[c.jsxs("div",{className:"card",style:{marginBottom:24},children:[c.jsxs("div",{className:"cardHeader",children:[c.jsx("div",{className:"cardTitle",children:"Filters"}),(s||o||u||b||f)&&c.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{r(""),a(""),d(""),I(""),g("")},children:"Clear filters"})]}),c.jsx("div",{className:"cardBody",children:c.jsxs("div",{className:"fieldGrid filterGrid",children:[c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Date"}),c.jsxs("select",{className:"select",value:s,onChange:m=>r(m.target.value),children:[c.jsx("option",{value:"",children:"All dates"}),v.map(m=>c.jsx("option",{value:m,children:m},m))]})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Inspection Type"}),c.jsxs("select",{className:"select",value:o,onChange:m=>a(m.target.value),children:[c.jsx("option",{value:"",children:"All types"}),_.map(m=>c.jsx("option",{value:m,children:m},m))]})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Floor"}),c.jsxs("select",{className:"select",value:u,onChange:m=>d(m.target.value),children:[c.jsx("option",{value:"",children:"All floors"}),T.map(m=>c.jsx("option",{value:m,children:m},m))]})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Location Type"}),c.jsxs("select",{className:"select",value:x,onChange:m=>A(m.target.value),children:[c.jsx("option",{value:"",children:"All types"}),w.map(m=>c.jsx("option",{value:m,children:m},m))]})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Location"}),c.jsx("input",{className:"input",value:b,onChange:m=>I(m.target.value),placeholder:"e.g., North Kitchen #204"})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Search Issues"}),c.jsx("input",{className:"input",value:f,onChange:m=>g(m.target.value),placeholder:"e.g., ceiling, temp, allergen..."})]})]})})]}),e.length>=2&&c.jsxs("div",{className:"historyTabs",children:[c.jsxs("button",{className:ve("historyTab",O==="reports"&&"historyTabActive"),onClick:()=>$("reports"),type:"button",children:["Reports (",H.length,")"]}),c.jsx("button",{className:ve("historyTab",O==="analytics"&&"historyTabActive"),onClick:()=>$("analytics"),type:"button",children:"Analytics"})]}),O==="analytics"&&e.length>=2&&c.jsxs(c.Fragment,{children:[c.jsx(Wg,{history:H.length>0?H:e}),c.jsx(Gg,{history:H.length>0?H:e,onLocationClick:z})]}),O==="reports"&&(H.length===0?c.jsx("div",{className:"card",children:c.jsx("div",{className:"cardBody",children:c.jsxs("div",{className:"emptyState",children:[c.jsx("div",{className:"emptyTitle",children:e.length===0?"No inspections saved yet":"No matches"}),c.jsx("div",{className:"emptySub",children:e.length===0?"Complete an inspection and click Save to build your history.":"Try adjusting your filters."})]})})}):c.jsx("div",{className:"historyList",id:"history-results",children:H.map(m=>{const V=R===m.id,F=m.actionItems||[],G=m.overallStatus==="Pass"?"#15803D":"#EE0000";return c.jsxs("div",{className:"card historyCard",style:{marginBottom:16},children:[c.jsxs("div",{className:"cardHeader",style:{cursor:"pointer"},onClick:()=>C(V?null:m.id),children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,flex:1},children:[c.jsx("span",{className:"historyStatus",style:{background:G},children:m.overallStatus}),c.jsxs("div",{children:[c.jsx("div",{className:"cardTitle",children:m.siteName||m.location||"Inspection"}),c.jsxs("div",{className:"cardSub",children:[m.inspectionDate," "," ",c.jsx("span",{className:ve("typeBadge",m.inspectionType==="Event Day"?"typeBadgeEvent":m.inspectionType==="Post Event"?"typeBadgePost":"typeBadgeRegular"),children:m.inspectionType}),m.locationType&&c.jsxs(c.Fragment,{children:[" "," ",c.jsx("span",{className:"typeBadge typeBadgeLocType",children:m.locationType})]}),m.floor&&c.jsxs(c.Fragment,{children:[" "," ",c.jsx("span",{className:"typeBadge typeBadgeFloor",children:m.floor})]})," "," ",m.inspectorName||""]})]})]}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[F.length>0&&c.jsxs("span",{className:"pill",children:[F.length," issue",F.length!==1?"s":""]}),c.jsx("span",{style:{fontSize:"1.2rem",color:"var(--sdx-gray-400)"},children:V?"":""})]})]}),V&&c.jsxs("div",{className:"cardBody",children:[c.jsxs("div",{className:"historyMeta",children:[c.jsxs("div",{children:[c.jsx("strong",{children:"Inspector:"})," ",m.inspectorName||""]}),c.jsxs("div",{children:[c.jsx("strong",{children:"Supervisor:"})," ",m.supervisorName||""]}),c.jsxs("div",{children:[c.jsx("strong",{children:"Unit #:"})," ",m.siteNumber||""]}),c.jsxs("div",{children:[c.jsx("strong",{children:"Floor:"})," ",m.floor||""]}),c.jsxs("div",{children:[c.jsx("strong",{children:"Hand sink:"})," ",m.temps?.handSinkTempF||"","F"]}),c.jsxs("div",{children:[c.jsx("strong",{children:"3-comp wash:"})," ",m.temps?.threeCompSinkTempF||"","F"]})]}),F.length>0&&c.jsxs("div",{style:{marginTop:16},children:[c.jsx("div",{className:"guideSectionTitle",children:"Action Items"}),c.jsxs("table",{className:"historyTable",children:[c.jsx("thead",{children:c.jsxs("tr",{children:[c.jsx("th",{children:"Issue"}),c.jsx("th",{children:"Priority"})]})}),c.jsx("tbody",{children:F.map((ue,fe)=>c.jsxs("tr",{children:[c.jsx("td",{children:ue.issue}),c.jsx("td",{children:c.jsx("span",{className:ve("priorityBadge",ue.priority==="High"?"priorityHigh":"priorityMed"),children:ue.priority})})]},fe))})]})]}),m.rawNotes&&c.jsxs("div",{style:{marginTop:16},children:[c.jsx("div",{className:"guideSectionTitle",children:"Inspector Notes"}),c.jsx("div",{className:"historyNotesFormatted",style:{maxHeight:250,overflowY:"auto"},children:(()=>{const{grouped:ue}=jr(m.rawNotes);return Vr.map(fe=>ue[fe]?.length?c.jsxs("div",{style:{marginBottom:10},children:[c.jsx("div",{className:ve("rptNoteCatLabel",`rptNoteCat--${fe}`),children:Dr[fe]}),c.jsx("ul",{className:"rptNoteBullets",children:ue[fe].map(($e,Rt)=>c.jsx("li",{children:$e},Rt))})]},fe):null)})()})]}),c.jsxs("div",{style:{marginTop:16,display:"flex",gap:8},children:[c.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{Su({output:m.output||m.rawNotes||"",inspectionDate:m.inspectionDate,siteName:m.siteName})},children:"Download TXT"}),c.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{Au({output:m.output||m.rawNotes||"",inspectionType:m.inspectionType,inspectionDate:m.inspectionDate,siteName:m.siteName,inspectorName:m.inspectorName})},children:"Download HTML"}),c.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>E(m.id),style:{color:"#EE0000",borderColor:"rgba(238,0,0,.3)",marginLeft:"auto"},children:"Delete"})]})]})]},m.id)})}))]}),c.jsxs("footer",{className:"footer",children:[c.jsx("img",{src:wn,alt:"Sodexo",className:"footerLogo"}),c.jsx("span",{children:je?" Inspection history synced to cloud database.":"Inspection history is stored locally in your browser."})]})]})}function Jg({currentUser:n,onBack:e}){const[t,s]=B.useState([]),[r,o]=B.useState(!1),[a,u]=B.useState(""),[d,f]=B.useState(""),[g,b]=B.useState(""),[I,x]=B.useState("inspector"),[A,R]=B.useState(""),[C,L]=B.useState(""),[P,O]=B.useState(!1);B.useEffect(()=>{Be().then(s)},[]);async function $(){s(await Be())}async function H(V){await Ag(V),await $()}async function z(V){confirm("Remove this access request?")&&(await Il(V),await $())}async function E(V){await Sg(V),await $()}async function y(V){await xg(V),await $()}async function v(V){confirm("Remove this user? They will need to request access again.")&&(await Il(V),await $())}async function _(V){V.preventDefault(),R(""),L(""),O(!0);try{if(a.trim().length<3){R("Badge number must be at least 3 characters.");return}const F=await Ig(a.trim(),d.trim(),g.trim(),I);F.ok?(L(`${d.trim()} added as ${I==="admin"?"Admin":"Inspector"}.`),u(""),f(""),b(""),x("inspector"),await $(),setTimeout(()=>L(""),3e3)):F.reason==="exists"&&R("This badge number is already registered.")}catch{R("Failed to add user. Try again.")}finally{O(!1)}}const T=t.filter(V=>!V.approved),w=t.filter(V=>V.approved),m=t.filter(V=>V.role==="admin"&&V.approved).length;return c.jsxs("div",{className:"appShell",children:[c.jsxs("header",{className:"topBar",children:[c.jsxs("div",{className:"brandLeft brandClickable",onClick:e,title:"Back to Inspector",children:[c.jsx("img",{src:wn,alt:"Sodexo",className:"brandLogo"}),c.jsxs("div",{children:[c.jsx("div",{className:"brandTitle",children:"Admin Panel"}),c.jsx("div",{className:"brandSub",children:"Manage user access & permissions"})]})]}),c.jsx("div",{className:"topActions",children:c.jsx("button",{className:"btn btnGhost",onClick:e,type:"button",children:"Back to Inspector"})})]}),c.jsx("div",{className:"topBarSpacer"}),c.jsxs("main",{className:"pageMain pageMainNarrow",children:[c.jsxs("div",{className:"card adminCard",style:{marginBottom:24},children:[c.jsxs("div",{className:"cardHeader",children:[c.jsx("div",{className:"cardTitle",children:"Add New User"}),c.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{o(!r),R(""),L("")},children:r?"Cancel":"+ Add User"})]}),r&&c.jsx("div",{className:"cardBody",children:c.jsxs("form",{onSubmit:_,className:"addUserForm",children:[c.jsxs("div",{className:"fieldGrid",children:[c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Badge Number"}),c.jsx("input",{className:"input",type:"password",value:a,onChange:V=>u(V.target.value),placeholder:"Enter badge #",autoComplete:"off"})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Full Name"}),c.jsx("input",{className:"input",value:d,onChange:V=>f(V.target.value),placeholder:"e.g., Jane Smith"})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Department"}),c.jsx("input",{className:"input",value:g,onChange:V=>b(V.target.value),placeholder:"e.g., Safety Inspector"})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Role"}),c.jsxs("select",{className:"select",value:I,onChange:V=>x(V.target.value),children:[c.jsx("option",{value:"inspector",children:"Inspector"}),c.jsx("option",{value:"admin",children:"Admin"})]})]})]}),A&&c.jsx("div",{className:"pinError",style:{marginTop:8},children:A}),C&&c.jsx("div",{className:"addUserSuccess",children:C}),c.jsx("button",{className:"btn btnPrimary",type:"submit",style:{marginTop:12},disabled:P||a.trim().length<3||!d.trim()||!g.trim(),children:P?"Adding...":`Add as ${I==="admin"?"Admin":"Inspector"}`})]})})]}),T.length>0&&c.jsxs("div",{className:"card adminCard",style:{marginBottom:24},children:[c.jsx("div",{className:"cardHeader",children:c.jsxs("div",{className:"cardTitle",children:["Pending Approvals",c.jsx("span",{className:"adminCount",children:T.length})]})}),c.jsx("div",{className:"cardBody",children:T.map(V=>c.jsxs("div",{className:"adminUserRow",children:[c.jsxs("div",{className:"adminUserInfo",children:[c.jsx("div",{className:"adminUserName",children:V.name}),c.jsxs("div",{className:"adminUserMeta",children:[V.department,"  Requested ",new Date(V.registeredAt).toLocaleDateString()]})]}),c.jsxs("div",{className:"adminUserActions",children:[c.jsx("button",{className:"btn btnPrimary btnSmall",onClick:()=>H(V.badgeHash),children:"Approve"}),c.jsx("button",{className:"btn btnGhost btnSmall adminDenyBtn",onClick:()=>z(V.badgeHash),children:"Deny"})]})]},V.badgeHash))})]}),c.jsxs("div",{className:"card adminCard",children:[c.jsx("div",{className:"cardHeader",children:c.jsxs("div",{className:"cardTitle",children:["Team Members",c.jsx("span",{className:"adminCount",children:w.length})]})}),c.jsx("div",{className:"cardBody",children:w.length===0?c.jsx("div",{className:"emptyState",children:c.jsx("div",{className:"emptyTitle",children:"No approved users"})}):w.map(V=>{const F=V.badgeHash===n?.badgeHash,G=V.role==="admin"&&m<=1;return c.jsxs("div",{className:"adminUserRow",children:[c.jsxs("div",{className:"adminUserInfo",children:[c.jsxs("div",{className:"adminUserName",children:[V.name,V.role==="admin"&&c.jsx("span",{className:"roleBadge adminRoleBadge",children:"Admin"}),V.role==="inspector"&&c.jsx("span",{className:"roleBadge inspectorRoleBadge",children:"Inspector"}),F&&c.jsx("span",{className:"roleBadge youRoleBadge",children:"You"})]}),c.jsxs("div",{className:"adminUserMeta",children:[V.department,"  Since ",new Date(V.registeredAt).toLocaleDateString()]})]}),c.jsxs("div",{className:"adminUserActions",children:[V.role==="inspector"&&c.jsx("button",{className:"btn btnGhost btnSmall",onClick:()=>E(V.badgeHash),children:"Make Admin"}),V.role==="admin"&&!G&&!F&&c.jsx("button",{className:"btn btnGhost btnSmall",onClick:()=>y(V.badgeHash),children:"Remove Admin"}),!F&&c.jsx("button",{className:"btn btnGhost btnSmall adminDenyBtn",onClick:()=>v(V.badgeHash),children:"Remove"})]})]},V.badgeHash)})})]})]}),c.jsxs("footer",{className:"footer",children:[c.jsx("img",{src:wn,alt:"Sodexo",className:"footerLogo"}),c.jsx("span",{children:je?" User accounts synced to cloud database.":"User accounts are stored locally on this device."})]})]})}function Yg({photos:n,onRemove:e}){return n?.length?c.jsx("div",{className:"photoStrip",children:n.map(t=>c.jsxs("div",{className:"photoThumb",children:[c.jsx("img",{src:t.previewUrl,alt:t.name}),c.jsx("button",{className:"thumbX",type:"button",onClick:()=>e(t.id),"aria-label":"Remove photo",children:""})]},t.id))}):null}function di({title:n,items:e,inspection:t,setInspection:s,allowCustom:r,sectionKey:o}){const a=B.useRef({}),[u,d]=B.useState("");async function f(x,A){const R=Array.from(A||[]).slice(0,ci),C=[];for(const L of R){if(!L.type.startsWith("image/")||xl(L.size)>Al)continue;const P=await Mg(L);P&&C.push({id:`${Date.now()}_${Math.random().toString(16).slice(2)}`,name:L.name,sizeMb:xl(L.size),type:"image/jpeg",previewUrl:P})}C.length!==0&&s(L=>{const P=x.split("."),O=hi(L,P)||Ie({status:"OK",notes:""}),$={...O,photos:[...O.photos||[],...C].slice(0,ci)};return Ut(L,P,$)})}function g(x,A){s(R=>{const C=x.split("."),L=hi(R,C)||Ie({status:"OK",notes:""}),P={...L,photos:(L.photos||[]).filter(O=>O.id!==A)};return Ut(R,C,P)})}const b=B.useMemo(()=>{if(!r||!o)return[];const x=t?.[o]||{};return Object.keys(x).filter(A=>A.startsWith("custom_")).map(A=>({path:[o,A],label:x[A]?.label||"Custom item",isCustom:!0,customKey:A}))},[r,o,t]),I=[...e,...b];return c.jsxs("div",{className:"guideSection",children:[c.jsx("div",{className:"guideSectionTitle",children:n}),c.jsx("div",{className:"guideItems",children:I.map(x=>{const A=x.path.join("."),R=hi(t,x.path)||Ie({status:"OK",notes:""});return c.jsxs("div",{className:"guideItem",children:[c.jsxs("div",{className:"guideItemHead",children:[c.jsx("div",{className:"guideLabel",children:x.label}),c.jsx("select",{className:"select selectSmall",value:R.status,onChange:C=>s(L=>Ut(L,x.path,{...R,status:C.target.value})),children:Ng.map(C=>c.jsx("option",{value:C,children:C},C))})]}),c.jsx("input",{className:"input inputSmall",value:R.notes,onChange:C=>s(L=>Ut(L,x.path,{...R,notes:C.target.value})),placeholder:"Issue / observation (optional)"}),c.jsxs("div",{className:"photoRow",children:[c.jsx("input",{ref:C=>a.current[A]=C,className:"fileInput",type:"file",accept:"image/*",multiple:!0,onChange:C=>{f(A,C.target.files),C.target.value=""}}),c.jsx("button",{className:"btn btnGhost btnSmall photoBtn",type:"button",onClick:()=>a.current[A]?.click(),children:" Add photos"}),c.jsxs("span",{className:"hint",children:["Up to ",ci," (",Al,"MB each)"]})]}),c.jsx(Yg,{photos:R.photos,onRemove:C=>g(A,C)})]},A)})}),r&&c.jsxs("div",{className:"guideAddItem",children:[c.jsx("input",{className:"input inputSmall",value:u,onChange:x=>d(x.target.value),placeholder:"Add new item (e.g., Walk-in freezer)",onKeyDown:x=>{if(x.key==="Enter"&&u.trim()){const A=`custom_${Date.now()}`;s(R=>Ut(R,[o,A],{status:"OK",notes:"",photos:[],label:u.trim()})),d("")}}}),c.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{if(!u.trim())return;const x=`custom_${Date.now()}`;s(A=>Ut(A,[o,x],{status:"OK",notes:"",photos:[],label:u.trim()})),d("")},children:"+ Add"})]})]})}function Xg(){const[n,e]=B.useState(!0),[t,s]=B.useState(null),[r,o]=B.useState("inspector"),[a,u]=B.useState(0),[d,f]=B.useState(64),g=B.useRef(null),b=B.useRef(Date.now());B.useEffect(()=>{const D=document.getElementById("splash");D&&(D.classList.add("hide"),setTimeout(()=>D.remove(),350))},[]),B.useEffect(()=>{if(!g.current)return;const D=new ResizeObserver(([Y])=>f(Y.contentRect.height));return D.observe(g.current),f(g.current.offsetHeight),()=>D.disconnect()},[n,r]),B.useEffect(()=>{if(!t||t.role!=="admin"||n){u(0);return}async function D(){try{const se=await Be();u(se.filter(oe=>!oe.approved).length)}catch{}}D();const Y=setInterval(D,3e4);return()=>clearInterval(Y)},[t,n,r]),B.useEffect(()=>{const D="sdx_last_cache_clean";function Y(){const oe=new Date().toISOString().slice(0,10);localStorage.getItem(D)!==oe&&(localStorage.setItem(D,oe),navigator.serviceWorker?.controller&&navigator.serviceWorker.controller.postMessage("CLEAN_CACHE"))}Y();const se=setInterval(Y,3600*1e3);return()=>clearInterval(se)},[]);const[I,x]=B.useState("inspection"),[A,R]=B.useState(()=>Sl("inspection")),[C,L]=B.useState(()=>ui()),[P,O]=B.useState(""),[$,H]=B.useState(gn.inspection.useCases[0]),[z,E]=B.useState("Regular Inspection"),[y,v]=B.useState(()=>new Date().toISOString().slice(0,10)),[_,T]=B.useState(""),[w,m]=B.useState(""),[V,F]=B.useState(""),[G,ue]=B.useState(""),[fe,$e]=B.useState(""),[Rt,Xt]=B.useState("Concession"),[it,Zt]=B.useState("Floor 1"),[ot,en]=B.useState(!1),[Oe,Pt]=B.useState(""),[tn,kn]=B.useState(!1),[ws,at]=B.useState(""),[Dn,lt]=B.useState([]),[Vn,kt]=B.useState([]),[He,Dt]=B.useState(!1),Vt=B.useCallback(()=>{b.current=Date.now()},[]);if(B.useEffect(()=>{if(n)return;const D=["mousedown","keydown","touchstart","scroll"];D.forEach(se=>window.addEventListener(se,Vt,{passive:!0}));const Y=setInterval(()=>{Date.now()-b.current>dg&&(wl(),e(!0))},3e4);return()=>{D.forEach(se=>window.removeEventListener(se,Vt)),clearInterval(Y)}},[n,Vt]),B.useEffect(()=>{function D(Y){P.trim()&&!He&&(Y.preventDefault(),Y.returnValue="")}return window.addEventListener("beforeunload",D),()=>window.removeEventListener("beforeunload",D)},[P,He]),n)return c.jsx(Cg,{onUnlock:D=>{s(D),e(!1),Vt(),D?.name&&!_&&T(D.name)}});if(r==="history")return c.jsx(Qg,{onBack:()=>o("inspector")});if(r==="admin")return c.jsx(Jg,{currentUser:t,onBack:()=>o("inspector")});const ye=gn[I];function Te(){R(Sl(I)),L(ui()),O(""),Pt(""),at(""),lt([]),kt([]),Dt(!1),E("Regular Inspection"),v(new Date().toISOString().slice(0,10)),T(t?.name||""),m(""),F(""),ue(""),$e(""),Xt("Concession"),Zt("Floor 1"),window.scrollTo({top:0,behavior:"smooth"})}function nn(){const D=gn[I].sample;R({...D.context}),L(D.inspection?{...D.inspection}:ui()),O(D.rawNotes||""),E(D.meta?.inspectionType||"Regular Inspection"),v(D.meta?.inspectionDate||D.context?.date||""),T(D.meta?.inspectorName||""),m(""),F(""),ue(""),$e(""),Pt(""),at(""),lt([]),kt([])}function Or(){at(""),lt([]),kt([]);const D=$g({inspectionDate:y,inspectorName:_,context:A,noteType:I,inspection:C});if(D.length&&lt(D),!P.trim()){at("Please enter raw notes before transforming.");return}kn(!0);try{const Y=qg({noteType:I,useCase:$,context:A,inspection:C,rawNotes:P,inspectionType:z,inspectionDate:y,inspectorName:_,siteName:w,siteNumber:V,sitePhone:fe,supervisorName:G,floor:it});Pt(Y);const se=Nl({inspection:C,rawNotes:P,context:A,noteType:I});kt(se)}catch(Y){at(Y?.message||"Something went wrong")}finally{kn(!1)}}async function Is(){Oe&&await navigator.clipboard.writeText(Oe)}function Fr(){const D=Nl({inspection:C,rawNotes:P,context:A,noteType:I});kt(D)}async function ct(){function D(se){if(!se||typeof se!="object")return se;if(Array.isArray(se))return se.map(D);const oe={};for(const[tt,jt]of Object.entries(se))tt==="photos"&&Array.isArray(jt)?oe.photos=jt.map(ut=>({id:ut.id,name:ut.name,sizeMb:ut.sizeMb,type:ut.type})):oe[tt]=D(jt);return oe}const Y={id:`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,savedAt:new Date().toISOString(),noteType:I,inspectionType:z,inspectionDate:y,inspectorName:_,siteName:w,siteNumber:V,supervisorName:G,sitePhone:fe,locationType:Rt,floor:it,location:w||A?.kitchen||"Kitchen",context:{...A},temps:{...C.temps},overallStatus:Yt(C),actionItems:Pn({inspection:C,rawNotes:P}),rawNotes:P,output:Oe,inspection:D(C),photoCount:Bg(C)};try{await vg(Y),fg(Y),Dt(!0),setTimeout(()=>Dt(!1),2500)}catch(se){console.error("Save failed:",se),at("Save failed  record may be too large. Try removing some photos.")}}function As(){Kg({inspection:C,rawNotes:P,inspectionType:z,inspectionDate:y,inspectorName:_,siteName:w,siteNumber:V,supervisorName:G,floor:it})}function Ss(){Au({output:Oe,inspection:C,rawNotes:P,inspectionType:z,inspectionDate:y,siteName:w,siteNumber:V,sitePhone:fe,inspectorName:_,supervisorName:G})}function jn(){Su({output:Oe,inspectionDate:y,siteName:w})}return c.jsxs("div",{className:"appShell",children:[c.jsxs("header",{className:"topBar",ref:g,children:[c.jsxs("div",{className:"brandLeft brandClickable",onClick:()=>{o("inspector"),window.scrollTo({top:0,behavior:"smooth"})},title:"Home",children:[c.jsx("img",{src:wn,alt:"Sodexo",className:"brandLogo"}),c.jsxs("div",{children:[c.jsx("div",{className:"brandTitle",children:"Kitchen Inspection"}),c.jsx("div",{className:"brandSub",children:"Turn sit-down inspection notes into organized documents"})]})]}),c.jsxs("div",{className:"topActionsHamburger",children:[c.jsx("button",{className:ve("btn","btnPrimary","btnGenHeader"),onClick:Or,type:"button",disabled:tn,children:tn?"Generating...":"Generate Report"}),c.jsxs("button",{className:"hamburgerBtn",onClick:()=>en(!ot),type:"button","aria-label":"Menu",children:[c.jsxs("span",{className:ve("hamburgerIcon",ot&&"hamburgerOpen"),children:[c.jsx("span",{}),c.jsx("span",{}),c.jsx("span",{})]}),a>0&&c.jsx("span",{className:"hamburgerBadge",children:a})]})]}),ot&&c.jsxs("div",{className:"dropdownMenu",onClick:()=>en(!1),children:[t&&c.jsxs("div",{className:"dropdownMenuUser",children:[t.name,t.role==="admin"?" (Admin)":""]}),c.jsx("button",{className:"dropdownMenuItem",onClick:Te,type:"button",children:"+ New Inspection"}),c.jsx("button",{className:"dropdownMenuItem",onClick:()=>o("history"),type:"button",children:"Past Reports"}),t?.role==="admin"&&c.jsxs("button",{className:"dropdownMenuItem",onClick:()=>o("admin"),type:"button",children:["Admin Panel",a>0&&c.jsxs("span",{className:"menuBadge",children:[a," pending"]})]}),c.jsx("button",{className:"dropdownMenuItem dropdownMenuDanger",onClick:()=>{wl(),s(null),e(!0)},type:"button",children:"Lock App"})]})]}),c.jsx("div",{style:{height:d,flexShrink:0}}),c.jsxs("main",{className:"grid",children:[c.jsxs("section",{className:"card",children:[c.jsx("div",{className:"cardHeader",children:c.jsx("div",{className:"cardTitle",children:"Inspection Details"})}),c.jsxs("div",{className:"cardBody",children:[c.jsxs("div",{className:"fieldGrid",children:[c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Type"}),c.jsx("select",{className:"select",value:z,onChange:D=>E(D.target.value),children:Rg.map(D=>c.jsx("option",{value:D,children:D},D))})]}),c.jsxs("label",{className:"field",id:"field-inspectionDate",children:[c.jsx("span",{className:"fieldLabel",children:"Date"}),c.jsx("input",{className:"input",type:"date",value:y,onChange:D=>v(D.target.value)})]}),c.jsxs("label",{className:"field",id:"field-inspectorName",children:[c.jsx("span",{className:"fieldLabel",children:"Inspector"}),c.jsx("input",{className:"input",value:_,onChange:D=>T(D.target.value),placeholder:"e.g., J. Da Silva"})]}),c.jsxs("label",{className:"field",id:"field-supervisorName",children:[c.jsx("span",{className:"fieldLabel",children:"Supervisor"}),c.jsx("input",{className:"input",list:"supervisorSuggestions",value:G,onChange:D=>ue(D.target.value),placeholder:"e.g., GM / Chef Lead"}),c.jsx("datalist",{id:"supervisorSuggestions",children:(ts().supervisorName||[]).map((D,Y)=>c.jsx("option",{value:D},Y))})]}),c.jsxs("label",{className:"field",id:"field-siteName",children:[c.jsx("span",{className:"fieldLabel",children:"Restaurant / Location"}),c.jsx("input",{className:"input",list:"siteNameSuggestions",value:w,onChange:D=>{const Y=D.target.value;m(Y);const oe=ts().siteMap?.[Y];oe&&(oe.siteNumber&&!V&&F(oe.siteNumber),oe.sitePhone&&!fe&&$e(oe.sitePhone),oe.supervisorName&&!G&&ue(oe.supervisorName),oe.locationType&&Xt(oe.locationType),oe.floor&&Zt(oe.floor))},placeholder:"e.g., North Stand Kitchen"}),c.jsx("datalist",{id:"siteNameSuggestions",children:(ts().siteName||[]).map((D,Y)=>c.jsx("option",{value:D},Y))})]}),c.jsxs("label",{className:"field",id:"field-siteNumber",children:[c.jsx("span",{className:"fieldLabel",children:"Unit Number"}),c.jsx("input",{className:"input",list:"siteNumberSuggestions",value:V,onChange:D=>F(D.target.value),placeholder:"e.g., Unit 12 / Loc-204"}),c.jsx("datalist",{id:"siteNumberSuggestions",children:(ts().siteNumber||[]).map((D,Y)=>c.jsx("option",{value:D},Y))})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Location Type"}),c.jsx("select",{className:"select",value:Rt,onChange:D=>Xt(D.target.value),children:Pg.map(D=>c.jsx("option",{value:D,children:D},D))})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Phone (optional)"}),c.jsx("input",{className:"input",value:fe,onChange:D=>$e(D.target.value),placeholder:"e.g., (305) 555-0123"})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Floor"}),c.jsx("select",{className:"select",value:it,onChange:D=>Zt(D.target.value),children:kg.map(D=>c.jsx("option",{value:D,children:D},D))})]})]}),c.jsx("div",{className:"fieldGrid",children:ye.contextFields.map(D=>c.jsxs("label",{className:"field",id:`field-ctx-${D.key}`,children:[c.jsx("span",{className:"fieldLabel",children:D.label}),D.key==="date"?c.jsx("input",{className:"input",type:"date",value:A[D.key]??"",onChange:Y=>R(se=>({...se,[D.key]:Y.target.value}))}):c.jsx("input",{className:"input",value:A[D.key]??"",onChange:Y=>R(se=>({...se,[D.key]:Y.target.value})),placeholder:D.label})]},D.key))}),c.jsxs("div",{className:"field",children:[c.jsxs("div",{className:"fieldLabelRow",children:[c.jsx("span",{className:"fieldLabel",children:"Final output format"}),c.jsx("span",{className:"hint",children:"Adapts to the selected note type"})]}),c.jsx("select",{className:"select",value:$,onChange:D=>H(D.target.value),children:ye.useCases.map(D=>c.jsx("option",{value:D,children:D},D))})]}),c.jsxs("div",{className:"guide",children:[c.jsxs("div",{className:"guideHeader",children:[c.jsxs("div",{children:[c.jsx("div",{className:"guideTitle",children:"Inspector guide"}),c.jsx("div",{className:"guideSub",children:"Fast checklist for sit-down kitchen inspections"})]}),c.jsxs("div",{className:"pillRow",children:[c.jsxs("span",{className:"pill",children:["Hand sink ",""," 95 F"]}),c.jsxs("span",{className:"pill",children:["3-comp wash ",""," 110 F"]})]})]}),c.jsx(di,{title:"Facility: ceiling, walls, floors, lighting",items:[{path:["facility","ceiling"],label:"Ceiling"},{path:["facility","walls"],label:"Walls"},{path:["facility","floors"],label:"Floors"},{path:["facility","lighting"],label:"Lighting"}],inspection:C,setInspection:L,allowCustom:!0,sectionKey:"facility"}),c.jsx(di,{title:"Operations: employees + process controls",items:[{path:["operations","employeePractices"],label:"Employee practices"},{path:["operations","handwashing"],label:"Handwashing / supplies"},{path:["operations","labelingDating"],label:"Labeling / dating"},{path:["operations","logs"],label:"Logs / documentation"}],inspection:C,setInspection:L,allowCustom:!0,sectionKey:"operations"}),c.jsxs("div",{className:"tempsRow",children:[c.jsx("div",{className:"tempsTitle",children:"Key temperatures"}),c.jsxs("div",{className:"tempsGrid",children:[c.jsxs("label",{className:"field",id:"field-handSinkTempF",style:{marginTop:0},children:[c.jsx("span",{className:"fieldLabel",children:"Hand sink temp (F)"}),c.jsx("input",{className:"input",inputMode:"numeric",value:C.temps.handSinkTempF,onChange:D=>L(Y=>({...Y,temps:{...Y.temps,handSinkTempF:D.target.value}})),placeholder:"e.g., 97"}),c.jsx("span",{className:"hint",children:Number(C.temps.handSinkTempF)>=95?"Meets >=95 F":C.temps.handSinkTempF?"Below 95 F - flag":""})]}),c.jsxs("label",{className:"field",id:"field-threeCompSinkTempF",style:{marginTop:0},children:[c.jsx("span",{className:"fieldLabel",children:"3-comp wash temp (F)"}),c.jsx("input",{className:"input",inputMode:"numeric",value:C.temps.threeCompSinkTempF,onChange:D=>L(Y=>({...Y,temps:{...Y.temps,threeCompSinkTempF:D.target.value}})),placeholder:"e.g., 112"}),c.jsx("span",{className:"hint",children:Number(C.temps.threeCompSinkTempF)>=110?"Meets >=110 F":C.temps.threeCompSinkTempF?"Below 110 F - flag":""})]})]})]}),c.jsx(di,{title:"Equipment check",items:[{path:["equipment","doubleDoorCooler"],label:"Double-door cooler"},{path:["equipment","doubleDoorFreezer"],label:"Double-door freezer"},{path:["equipment","walkInCooler"],label:"Walk-in cooler"},{path:["equipment","warmers"],label:"Warmers / hot holding"},{path:["equipment","ovens"],label:"Ovens"},{path:["equipment","threeCompSink"],label:"3-compartment sink"},{path:["equipment","ecolab"],label:"Ecolab / chemicals"}],inspection:C,setInspection:L,allowCustom:!0,sectionKey:"equipment"})]}),c.jsxs("div",{className:"field",children:[c.jsxs("div",{className:"fieldLabelRow",children:[c.jsx("span",{className:"fieldLabel",children:"Raw notes"}),c.jsx("span",{className:"hint",children:"Abbreviations are expanded while preserving meaning"})]}),c.jsx("textarea",{className:"textarea",value:P,onChange:D=>O(D.target.value),placeholder:"Paste quick inspection notes here...",rows:10})]}),Dn.length>0&&c.jsxs("div",{className:"warningBox",children:[c.jsx("strong",{children:"Missing information:"}),c.jsx("ul",{children:Dn.map((D,Y)=>c.jsx("li",{className:"warningLink",onClick:()=>{const se=document.getElementById(D.fieldId);if(se){se.scrollIntoView({behavior:"smooth",block:"center"});const oe=se.querySelector("input, select, textarea");oe&&setTimeout(()=>oe.focus(),400),se.classList.add("fieldHighlight"),setTimeout(()=>se.classList.remove("fieldHighlight"),2e3)}},children:D.text},Y))})]}),ws?c.jsx("div",{className:"errorBox",children:ws}):null]})]}),c.jsxs("section",{className:"card",id:"report-output",children:[c.jsxs("div",{className:"cardHeader",children:[c.jsxs("div",{children:[c.jsx("div",{className:"cardTitle",children:"Output"}),c.jsx("div",{className:"cardSub",children:Lg(I,$)})]}),c.jsxs("div",{className:"outputActions",children:[c.jsx("button",{className:"btn btnGhost",type:"button",onClick:Is,disabled:!Oe,children:"Copy"}),c.jsx("button",{className:ve("btn",He?"btnSaved":"btnSave"),type:"button",onClick:ct,disabled:!Oe,children:He?"Saved!":"Save"})]})]}),c.jsxs("div",{className:"cardBody",children:[Vn.length>0&&c.jsxs("div",{className:"aiBox",children:[c.jsx("div",{className:"aiBoxTitle",children:"AI Assistant"}),c.jsx("ul",{children:Vn.map((D,Y)=>c.jsx("li",{children:D},Y))})]}),Oe?c.jsxs(c.Fragment,{children:[c.jsx(Hg,{noteType:I,useCase:$,context:A,inspection:C,rawNotes:P,inspectionType:z,inspectionDate:y,inspectorName:_,siteName:w,siteNumber:V,sitePhone:fe,supervisorName:G,locationType:Rt,floor:it}),c.jsxs("div",{className:"downloadBar",children:[c.jsx("span",{className:"downloadLabel",children:"Download:"}),c.jsx("button",{className:"btn btnDownload",type:"button",onClick:As,children:"Excel (.xls)"}),c.jsx("button",{className:"btn btnDownload",type:"button",onClick:Ss,children:"Word (.doc)"}),c.jsx("button",{className:"btn btnDownload",type:"button",onClick:jn,children:"Text (.txt)"})]})]}):c.jsxs("div",{className:"emptyState",children:[c.jsx("div",{className:"emptyIcon",children:""}),c.jsx("div",{className:"emptyTitle",children:"Ready to generate your report"}),c.jsxs("div",{className:"emptySub",children:["Fill in the inspection details on the left, then click ",c.jsx("strong",{children:"Generate Report"}),"."]})]})]})]})]}),c.jsx("button",{className:"fab fabLeft",onClick:nn,type:"button",title:"Try Example",children:" Try Example"}),c.jsx("button",{className:"fab fabRight",onClick:Fr,type:"button",title:"AI Tips",children:" AI Tips"}),Oe&&c.jsxs("div",{className:"stickyActionBar",children:[c.jsx("button",{className:"btn stickyBtn stickyBtnView",type:"button",onClick:()=>{const D=document.getElementById("report-output");D&&D.scrollIntoView({behavior:"smooth",block:"start"})},children:" View Report"}),c.jsx("button",{className:ve("btn stickyBtn",He?"stickyBtnSaved":"stickyBtnSave"),type:"button",onClick:ct,children:He?" Saved!":"&#128190; Save Report"}),c.jsx("button",{className:"btn stickyBtn stickyBtnNew",type:"button",onClick:Te,children:"+ New"})]}),c.jsxs("footer",{className:"footer",children:[c.jsx("img",{src:wn,alt:"Sodexo",className:"footerLogo"}),c.jsx("span",{children:je?" Cloud database connected  data syncs across all devices.":"U0001F512 Data stored locally on this device."})]})]})}th.createRoot(document.getElementById("root")).render(c.jsx(Xu.StrictMode,{children:c.jsx(Xg,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/Claude/sw.js").catch(()=>{})});
