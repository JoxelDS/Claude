import{r as Dl,g as Vl,a as Zu}from"./react-N--QU9DW.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();var ni={exports:{}},Yn={};var pa;function eh(){if(pa)return Yn;pa=1;var s=Dl(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,r=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function a(u,d,m){var f,E={},w=null,C=null;m!==void 0&&(w=""+m),d.key!==void 0&&(w=""+d.key),d.ref!==void 0&&(C=d.ref);for(f in d)n.call(d,f)&&!o.hasOwnProperty(f)&&(E[f]=d[f]);if(u&&u.defaultProps)for(f in d=u.defaultProps,d)E[f]===void 0&&(E[f]=d[f]);return{$$typeof:e,type:u,key:w,ref:C,props:E,_owner:r.current}}return Yn.Fragment=t,Yn.jsx=a,Yn.jsxs=a,Yn}var fa;function th(){return fa||(fa=1,ni.exports=eh()),ni.exports}var l=th(),q=Dl();const nh=Vl(q);var Us={},ga;function sh(){if(ga)return Us;ga=1;var s=Zu();return Us.createRoot=s.createRoot,Us.hydrateRoot=s.hydrateRoot,Us}var rh=sh();const ih=Vl(rh),oh=()=>{};var ya={};const jl=function(s){const e=[];let t=0;for(let n=0;n<s.length;n++){let r=s.charCodeAt(n);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&n+1<s.length&&(s.charCodeAt(n+1)&64512)===56320?(r=65536+((r&1023)<<10)+(s.charCodeAt(++n)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},ah=function(s){const e=[];let t=0,n=0;for(;t<s.length;){const r=s[t++];if(r<128)e[n++]=String.fromCharCode(r);else if(r>191&&r<224){const o=s[t++];e[n++]=String.fromCharCode((r&31)<<6|o&63)}else if(r>239&&r<365){const o=s[t++],a=s[t++],u=s[t++],d=((r&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[n++]=String.fromCharCode(55296+(d>>10)),e[n++]=String.fromCharCode(56320+(d&1023))}else{const o=s[t++],a=s[t++];e[n++]=String.fromCharCode((r&15)<<12|(o&63)<<6|a&63)}}return e.join("")},Fl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,e){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let r=0;r<s.length;r+=3){const o=s[r],a=r+1<s.length,u=a?s[r+1]:0,d=r+2<s.length,m=d?s[r+2]:0,f=o>>2,E=(o&3)<<4|u>>4;let w=(u&15)<<2|m>>6,C=m&63;d||(C=64,a||(w=64)),n.push(t[f],t[E],t[w],t[C])}return n.join("")},encodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(s):this.encodeByteArray(jl(s),e)},decodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(s):ah(this.decodeStringToByteArray(s,e))},decodeStringToByteArray(s,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let r=0;r<s.length;){const o=t[s.charAt(r++)],u=r<s.length?t[s.charAt(r)]:0;++r;const m=r<s.length?t[s.charAt(r)]:64;++r;const E=r<s.length?t[s.charAt(r)]:64;if(++r,o==null||u==null||m==null||E==null)throw new lh;const w=o<<2|u>>4;if(n.push(w),m!==64){const C=u<<4&240|m>>2;if(n.push(C),E!==64){const I=m<<6&192|E;n.push(I)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}};class lh extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ch=function(s){const e=jl(s);return Fl.encodeByteArray(e,!0)},tr=function(s){return ch(s).replace(/\./g,"")},uh=function(s){try{return Fl.decodeString(s,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function hh(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const dh=()=>hh().__FIREBASE_DEFAULTS__,mh=()=>{if(typeof process>"u"||typeof ya>"u")return;const s=ya.__FIREBASE_DEFAULTS__;if(s)return JSON.parse(s)},ph=()=>{if(typeof document>"u")return;let s;try{s=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=s&&uh(s[1]);return e&&JSON.parse(e)},Bi=()=>{try{return oh()||dh()||mh()||ph()}catch(s){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${s}`);return}},fh=s=>Bi()?.emulatorHosts?.[s],gh=s=>{const e=fh(s);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),n]:[e.substring(0,t),n]},Ol=()=>Bi()?.config;class yh{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}function Ui(s){try{return(s.startsWith("http://")||s.startsWith("https://")?new URL(s).hostname:s).endsWith(".cloudworkstations.dev")}catch{return!1}}async function _h(s){return(await fetch(s,{credentials:"include"})).ok}function vh(s,e){if(s.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},n=e||"demo-project",r=s.iat||0,o=s.sub||s.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...s};return[tr(JSON.stringify(t)),tr(JSON.stringify(a)),""].join(".")}const ss={};function bh(){const s={prod:[],emulator:[]};for(const e of Object.keys(ss))ss[e]?s.emulator.push(e):s.prod.push(e);return s}function Eh(s){let e=document.getElementById(s),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",s),t=!0),{created:t,element:e}}let _a=!1;function Th(s,e){if(typeof window>"u"||typeof document>"u"||!Ui(window.location.host)||ss[s]===e||ss[s]||_a)return;ss[s]=e;function t(w){return`__firebase__banner__${w}`}const n="__firebase__banner",o=bh().prod.length>0;function a(){const w=document.getElementById(n);w&&w.remove()}function u(w){w.style.display="flex",w.style.background="#7faaf0",w.style.position="fixed",w.style.bottom="5px",w.style.left="5px",w.style.padding=".5em",w.style.borderRadius="5px",w.style.alignItems="center"}function d(w,C){w.setAttribute("width","24"),w.setAttribute("id",C),w.setAttribute("height","24"),w.setAttribute("viewBox","0 0 24 24"),w.setAttribute("fill","none"),w.style.marginLeft="-6px"}function m(){const w=document.createElement("span");return w.style.cursor="pointer",w.style.marginLeft="16px",w.style.fontSize="24px",w.innerHTML=" &times;",w.onclick=()=>{_a=!0,a()},w}function f(w,C){w.setAttribute("id",C),w.innerText="Learn more",w.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",w.setAttribute("target","__blank"),w.style.paddingLeft="5px",w.style.textDecoration="underline"}function E(){const w=Eh(n),C=t("text"),I=document.getElementById(C)||document.createElement("span"),R=t("learnmore"),N=document.getElementById(R)||document.createElement("a"),k=t("preprendIcon"),S=document.getElementById(k)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(w.created){const F=w.element;u(F),f(N,R);const B=m();d(S,k),F.append(S,I,N,B),document.body.appendChild(F)}o?(I.innerText="Preview backend disconnected.",S.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(S.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,I.innerText="Preview backend running in this workspace."),I.setAttribute("id",C)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",E):E()}function wh(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ih(){const s=Bi()?.forceEnvironment;if(s==="node")return!0;if(s==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Ah(){return!Ih()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function xh(){try{return typeof indexedDB=="object"}catch{return!1}}function Sh(){return new Promise((s,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(n);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(n),s(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(t){e(t)}})}const Ch="FirebaseError";class xn extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=Ch,Object.setPrototypeOf(this,xn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ll.prototype.create)}}class Ll{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,o=this.errors[e],a=o?Nh(o,n):"Error",u=`${this.serviceName}: ${a} (${r}).`;return new xn(r,u,n)}}function Nh(s,e){return s.replace(Rh,(t,n)=>{const r=e[n];return r!=null?String(r):`<${n}?>`})}const Rh=/\{\$([^}]+)}/g;function nr(s,e){if(s===e)return!0;const t=Object.keys(s),n=Object.keys(e);for(const r of t){if(!n.includes(r))return!1;const o=s[r],a=e[r];if(va(o)&&va(a)){if(!nr(o,a))return!1}else if(o!==a)return!1}for(const r of n)if(!t.includes(r))return!1;return!0}function va(s){return s!==null&&typeof s=="object"}function us(s){return s&&s._delegate?s._delegate:s}class hs{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Ht="[DEFAULT]";class Ph{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new yh;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(n)return null;throw r}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Dh(e))try{this.getOrInitializeService({instanceIdentifier:Ht})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:r});n.resolve(o)}catch{}}}}clearInstance(e=Ht){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ht){return this.instances.has(e)}getOptions(e=Ht){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[o,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);n===u&&a.resolve(r)}return r}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);const o=this.instances.get(n);return o&&e(o,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:kh(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Ht){return this.component?this.component.multipleInstances?e:Ht:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function kh(s){return s===Ht?void 0:s}function Dh(s){return s.instantiationMode==="EAGER"}class Vh{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Ph(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var se;(function(s){s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT"})(se||(se={}));const jh={debug:se.DEBUG,verbose:se.VERBOSE,info:se.INFO,warn:se.WARN,error:se.ERROR,silent:se.SILENT},Fh=se.INFO,Oh={[se.DEBUG]:"log",[se.VERBOSE]:"log",[se.INFO]:"info",[se.WARN]:"warn",[se.ERROR]:"error"},Lh=(s,e,...t)=>{if(e<s.logLevel)return;const n=new Date().toISOString(),r=Oh[e];if(r)console[r](`[${n}]  ${s.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Ml{constructor(e){this.name=e,this._logLevel=Fh,this._logHandler=Lh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in se))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?jh[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,se.DEBUG,...e),this._logHandler(this,se.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,se.VERBOSE,...e),this._logHandler(this,se.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,se.INFO,...e),this._logHandler(this,se.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,se.WARN,...e),this._logHandler(this,se.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,se.ERROR,...e),this._logHandler(this,se.ERROR,...e)}}const Mh=(s,e)=>e.some(t=>s instanceof t);let ba,Ea;function $h(){return ba||(ba=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Bh(){return Ea||(Ea=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const $l=new WeakMap,yi=new WeakMap,Bl=new WeakMap,si=new WeakMap,qi=new WeakMap;function Uh(s){const e=new Promise((t,n)=>{const r=()=>{s.removeEventListener("success",o),s.removeEventListener("error",a)},o=()=>{t(At(s.result)),r()},a=()=>{n(s.error),r()};s.addEventListener("success",o),s.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&$l.set(t,s)}).catch(()=>{}),qi.set(e,s),e}function qh(s){if(yi.has(s))return;const e=new Promise((t,n)=>{const r=()=>{s.removeEventListener("complete",o),s.removeEventListener("error",a),s.removeEventListener("abort",a)},o=()=>{t(),r()},a=()=>{n(s.error||new DOMException("AbortError","AbortError")),r()};s.addEventListener("complete",o),s.addEventListener("error",a),s.addEventListener("abort",a)});yi.set(s,e)}let _i={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return yi.get(s);if(e==="objectStoreNames")return s.objectStoreNames||Bl.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return At(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function zh(s){_i=s(_i)}function Hh(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=s.call(ri(this),e,...t);return Bl.set(n,e.sort?e.sort():[e]),At(n)}:Bh().includes(s)?function(...e){return s.apply(ri(this),e),At($l.get(this))}:function(...e){return At(s.apply(ri(this),e))}}function Wh(s){return typeof s=="function"?Hh(s):(s instanceof IDBTransaction&&qh(s),Mh(s,$h())?new Proxy(s,_i):s)}function At(s){if(s instanceof IDBRequest)return Uh(s);if(si.has(s))return si.get(s);const e=Wh(s);return e!==s&&(si.set(s,e),qi.set(e,s)),e}const ri=s=>qi.get(s);function Kh(s,e,{blocked:t,upgrade:n,blocking:r,terminated:o}={}){const a=indexedDB.open(s,e),u=At(a);return n&&a.addEventListener("upgradeneeded",d=>{n(At(a.result),d.oldVersion,d.newVersion,At(a.transaction),d)}),t&&a.addEventListener("blocked",d=>t(d.oldVersion,d.newVersion,d)),u.then(d=>{o&&d.addEventListener("close",()=>o()),r&&d.addEventListener("versionchange",m=>r(m.oldVersion,m.newVersion,m))}).catch(()=>{}),u}const Gh=["get","getKey","getAll","getAllKeys","count"],Qh=["put","add","delete","clear"],ii=new Map;function Ta(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(ii.get(e))return ii.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,r=Qh.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(r||Gh.includes(t)))return;const o=async function(a,...u){const d=this.transaction(a,r?"readwrite":"readonly");let m=d.store;return n&&(m=m.index(u.shift())),(await Promise.all([m[t](...u),r&&d.done]))[0]};return ii.set(e,o),o}zh(s=>({...s,get:(e,t,n)=>Ta(e,t)||s.get(e,t,n),has:(e,t)=>!!Ta(e,t)||s.has(e,t)}));class Jh{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Yh(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function Yh(s){return s.getComponent()?.type==="VERSION"}const vi="@firebase/app",wa="0.14.8";const lt=new Ml("@firebase/app"),Xh="@firebase/app-compat",Zh="@firebase/analytics-compat",ed="@firebase/analytics",td="@firebase/app-check-compat",nd="@firebase/app-check",sd="@firebase/auth",rd="@firebase/auth-compat",id="@firebase/database",od="@firebase/data-connect",ad="@firebase/database-compat",ld="@firebase/functions",cd="@firebase/functions-compat",ud="@firebase/installations",hd="@firebase/installations-compat",dd="@firebase/messaging",md="@firebase/messaging-compat",pd="@firebase/performance",fd="@firebase/performance-compat",gd="@firebase/remote-config",yd="@firebase/remote-config-compat",_d="@firebase/storage",vd="@firebase/storage-compat",bd="@firebase/firestore",Ed="@firebase/ai",Td="@firebase/firestore-compat",wd="firebase",Id="12.9.0";const bi="[DEFAULT]",Ad={[vi]:"fire-core",[Xh]:"fire-core-compat",[ed]:"fire-analytics",[Zh]:"fire-analytics-compat",[nd]:"fire-app-check",[td]:"fire-app-check-compat",[sd]:"fire-auth",[rd]:"fire-auth-compat",[id]:"fire-rtdb",[od]:"fire-data-connect",[ad]:"fire-rtdb-compat",[ld]:"fire-fn",[cd]:"fire-fn-compat",[ud]:"fire-iid",[hd]:"fire-iid-compat",[dd]:"fire-fcm",[md]:"fire-fcm-compat",[pd]:"fire-perf",[fd]:"fire-perf-compat",[gd]:"fire-rc",[yd]:"fire-rc-compat",[_d]:"fire-gcs",[vd]:"fire-gcs-compat",[bd]:"fire-fst",[Td]:"fire-fst-compat",[Ed]:"fire-vertex","fire-js":"fire-js",[wd]:"fire-js-all"};const sr=new Map,xd=new Map,Ei=new Map;function Ia(s,e){try{s.container.addComponent(e)}catch(t){lt.debug(`Component ${e.name} failed to register with FirebaseApp ${s.name}`,t)}}function rr(s){const e=s.name;if(Ei.has(e))return lt.debug(`There were multiple attempts to register component ${e}.`),!1;Ei.set(e,s);for(const t of sr.values())Ia(t,s);for(const t of xd.values())Ia(t,s);return!0}function Sd(s,e){const t=s.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),s.container.getProvider(e)}function Cd(s){return s==null?!1:s.settings!==void 0}const Nd={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},xt=new Ll("app","Firebase",Nd);class Rd{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new hs("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw xt.create("app-deleted",{appName:this._name})}}const Pd=Id;function Ul(s,e={}){let t=s;typeof e!="object"&&(e={name:e});const n={name:bi,automaticDataCollectionEnabled:!0,...e},r=n.name;if(typeof r!="string"||!r)throw xt.create("bad-app-name",{appName:String(r)});if(t||(t=Ol()),!t)throw xt.create("no-options");const o=sr.get(r);if(o){if(nr(t,o.options)&&nr(n,o.config))return o;throw xt.create("duplicate-app",{appName:r})}const a=new Vh(r);for(const d of Ei.values())a.addComponent(d);const u=new Rd(t,n,a);return sr.set(r,u),u}function kd(s=bi){const e=sr.get(s);if(!e&&s===bi&&Ol())return Ul();if(!e)throw xt.create("no-app",{appName:s});return e}function dn(s,e,t){let n=Ad[s]??s;t&&(n+=`-${t}`);const r=n.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const a=[`Unable to register library "${n}" with version "${e}":`];r&&a.push(`library name "${n}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),lt.warn(a.join(" "));return}rr(new hs(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}const Dd="firebase-heartbeat-database",Vd=1,ds="firebase-heartbeat-store";let oi=null;function ql(){return oi||(oi=Kh(Dd,Vd,{upgrade:(s,e)=>{switch(e){case 0:try{s.createObjectStore(ds)}catch(t){console.warn(t)}}}}).catch(s=>{throw xt.create("idb-open",{originalErrorMessage:s.message})})),oi}async function jd(s){try{const t=(await ql()).transaction(ds),n=await t.objectStore(ds).get(zl(s));return await t.done,n}catch(e){if(e instanceof xn)lt.warn(e.message);else{const t=xt.create("idb-get",{originalErrorMessage:e?.message});lt.warn(t.message)}}}async function Aa(s,e){try{const n=(await ql()).transaction(ds,"readwrite");await n.objectStore(ds).put(e,zl(s)),await n.done}catch(t){if(t instanceof xn)lt.warn(t.message);else{const n=xt.create("idb-set",{originalErrorMessage:t?.message});lt.warn(n.message)}}}function zl(s){return`${s.name}!${s.options.appId}`}const Fd=1024,Od=30;class Ld{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new $d(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=xa();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(r=>r.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats.length>Od){const r=Bd(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){lt.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=xa(),{heartbeatsToSend:t,unsentEntries:n}=Md(this._heartbeatsCache.heartbeats),r=tr(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return lt.warn(e),""}}}function xa(){return new Date().toISOString().substring(0,10)}function Md(s,e=Fd){const t=[];let n=s.slice();for(const r of s){const o=t.find(a=>a.agent===r.agent);if(o){if(o.dates.push(r.date),Sa(t)>e){o.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),Sa(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class $d{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return xh()?Sh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await jd(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return Aa(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const n=await this.read();return Aa(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}}function Sa(s){return tr(JSON.stringify({version:2,heartbeats:s})).length}function Bd(s){if(s.length===0)return-1;let e=0,t=s[0].date;for(let n=1;n<s.length;n++)s[n].date<t&&(t=s[n].date,e=n);return e}function Ud(s){rr(new hs("platform-logger",e=>new Jh(e),"PRIVATE")),rr(new hs("heartbeat",e=>new Ld(e),"PRIVATE")),dn(vi,wa,s),dn(vi,wa,"esm2020"),dn("fire-js","")}Ud("");var qd="firebase",zd="12.9.0";dn(qd,zd,"app");var Ca=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var St,Hl;(function(){var s;function e(b,y){function _(){}_.prototype=y.prototype,b.F=y.prototype,b.prototype=new _,b.prototype.constructor=b,b.D=function(T,v,A){for(var p=Array(arguments.length-2),D=2;D<arguments.length;D++)p[D-2]=arguments[D];return y.prototype[v].apply(T,p)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(n,t),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(b,y,_){_||(_=0);const T=Array(16);if(typeof y=="string")for(var v=0;v<16;++v)T[v]=y.charCodeAt(_++)|y.charCodeAt(_++)<<8|y.charCodeAt(_++)<<16|y.charCodeAt(_++)<<24;else for(v=0;v<16;++v)T[v]=y[_++]|y[_++]<<8|y[_++]<<16|y[_++]<<24;y=b.g[0],_=b.g[1],v=b.g[2];let A=b.g[3],p;p=y+(A^_&(v^A))+T[0]+3614090360&4294967295,y=_+(p<<7&4294967295|p>>>25),p=A+(v^y&(_^v))+T[1]+3905402710&4294967295,A=y+(p<<12&4294967295|p>>>20),p=v+(_^A&(y^_))+T[2]+606105819&4294967295,v=A+(p<<17&4294967295|p>>>15),p=_+(y^v&(A^y))+T[3]+3250441966&4294967295,_=v+(p<<22&4294967295|p>>>10),p=y+(A^_&(v^A))+T[4]+4118548399&4294967295,y=_+(p<<7&4294967295|p>>>25),p=A+(v^y&(_^v))+T[5]+1200080426&4294967295,A=y+(p<<12&4294967295|p>>>20),p=v+(_^A&(y^_))+T[6]+2821735955&4294967295,v=A+(p<<17&4294967295|p>>>15),p=_+(y^v&(A^y))+T[7]+4249261313&4294967295,_=v+(p<<22&4294967295|p>>>10),p=y+(A^_&(v^A))+T[8]+1770035416&4294967295,y=_+(p<<7&4294967295|p>>>25),p=A+(v^y&(_^v))+T[9]+2336552879&4294967295,A=y+(p<<12&4294967295|p>>>20),p=v+(_^A&(y^_))+T[10]+4294925233&4294967295,v=A+(p<<17&4294967295|p>>>15),p=_+(y^v&(A^y))+T[11]+2304563134&4294967295,_=v+(p<<22&4294967295|p>>>10),p=y+(A^_&(v^A))+T[12]+1804603682&4294967295,y=_+(p<<7&4294967295|p>>>25),p=A+(v^y&(_^v))+T[13]+4254626195&4294967295,A=y+(p<<12&4294967295|p>>>20),p=v+(_^A&(y^_))+T[14]+2792965006&4294967295,v=A+(p<<17&4294967295|p>>>15),p=_+(y^v&(A^y))+T[15]+1236535329&4294967295,_=v+(p<<22&4294967295|p>>>10),p=y+(v^A&(_^v))+T[1]+4129170786&4294967295,y=_+(p<<5&4294967295|p>>>27),p=A+(_^v&(y^_))+T[6]+3225465664&4294967295,A=y+(p<<9&4294967295|p>>>23),p=v+(y^_&(A^y))+T[11]+643717713&4294967295,v=A+(p<<14&4294967295|p>>>18),p=_+(A^y&(v^A))+T[0]+3921069994&4294967295,_=v+(p<<20&4294967295|p>>>12),p=y+(v^A&(_^v))+T[5]+3593408605&4294967295,y=_+(p<<5&4294967295|p>>>27),p=A+(_^v&(y^_))+T[10]+38016083&4294967295,A=y+(p<<9&4294967295|p>>>23),p=v+(y^_&(A^y))+T[15]+3634488961&4294967295,v=A+(p<<14&4294967295|p>>>18),p=_+(A^y&(v^A))+T[4]+3889429448&4294967295,_=v+(p<<20&4294967295|p>>>12),p=y+(v^A&(_^v))+T[9]+568446438&4294967295,y=_+(p<<5&4294967295|p>>>27),p=A+(_^v&(y^_))+T[14]+3275163606&4294967295,A=y+(p<<9&4294967295|p>>>23),p=v+(y^_&(A^y))+T[3]+4107603335&4294967295,v=A+(p<<14&4294967295|p>>>18),p=_+(A^y&(v^A))+T[8]+1163531501&4294967295,_=v+(p<<20&4294967295|p>>>12),p=y+(v^A&(_^v))+T[13]+2850285829&4294967295,y=_+(p<<5&4294967295|p>>>27),p=A+(_^v&(y^_))+T[2]+4243563512&4294967295,A=y+(p<<9&4294967295|p>>>23),p=v+(y^_&(A^y))+T[7]+1735328473&4294967295,v=A+(p<<14&4294967295|p>>>18),p=_+(A^y&(v^A))+T[12]+2368359562&4294967295,_=v+(p<<20&4294967295|p>>>12),p=y+(_^v^A)+T[5]+4294588738&4294967295,y=_+(p<<4&4294967295|p>>>28),p=A+(y^_^v)+T[8]+2272392833&4294967295,A=y+(p<<11&4294967295|p>>>21),p=v+(A^y^_)+T[11]+1839030562&4294967295,v=A+(p<<16&4294967295|p>>>16),p=_+(v^A^y)+T[14]+4259657740&4294967295,_=v+(p<<23&4294967295|p>>>9),p=y+(_^v^A)+T[1]+2763975236&4294967295,y=_+(p<<4&4294967295|p>>>28),p=A+(y^_^v)+T[4]+1272893353&4294967295,A=y+(p<<11&4294967295|p>>>21),p=v+(A^y^_)+T[7]+4139469664&4294967295,v=A+(p<<16&4294967295|p>>>16),p=_+(v^A^y)+T[10]+3200236656&4294967295,_=v+(p<<23&4294967295|p>>>9),p=y+(_^v^A)+T[13]+681279174&4294967295,y=_+(p<<4&4294967295|p>>>28),p=A+(y^_^v)+T[0]+3936430074&4294967295,A=y+(p<<11&4294967295|p>>>21),p=v+(A^y^_)+T[3]+3572445317&4294967295,v=A+(p<<16&4294967295|p>>>16),p=_+(v^A^y)+T[6]+76029189&4294967295,_=v+(p<<23&4294967295|p>>>9),p=y+(_^v^A)+T[9]+3654602809&4294967295,y=_+(p<<4&4294967295|p>>>28),p=A+(y^_^v)+T[12]+3873151461&4294967295,A=y+(p<<11&4294967295|p>>>21),p=v+(A^y^_)+T[15]+530742520&4294967295,v=A+(p<<16&4294967295|p>>>16),p=_+(v^A^y)+T[2]+3299628645&4294967295,_=v+(p<<23&4294967295|p>>>9),p=y+(v^(_|~A))+T[0]+4096336452&4294967295,y=_+(p<<6&4294967295|p>>>26),p=A+(_^(y|~v))+T[7]+1126891415&4294967295,A=y+(p<<10&4294967295|p>>>22),p=v+(y^(A|~_))+T[14]+2878612391&4294967295,v=A+(p<<15&4294967295|p>>>17),p=_+(A^(v|~y))+T[5]+4237533241&4294967295,_=v+(p<<21&4294967295|p>>>11),p=y+(v^(_|~A))+T[12]+1700485571&4294967295,y=_+(p<<6&4294967295|p>>>26),p=A+(_^(y|~v))+T[3]+2399980690&4294967295,A=y+(p<<10&4294967295|p>>>22),p=v+(y^(A|~_))+T[10]+4293915773&4294967295,v=A+(p<<15&4294967295|p>>>17),p=_+(A^(v|~y))+T[1]+2240044497&4294967295,_=v+(p<<21&4294967295|p>>>11),p=y+(v^(_|~A))+T[8]+1873313359&4294967295,y=_+(p<<6&4294967295|p>>>26),p=A+(_^(y|~v))+T[15]+4264355552&4294967295,A=y+(p<<10&4294967295|p>>>22),p=v+(y^(A|~_))+T[6]+2734768916&4294967295,v=A+(p<<15&4294967295|p>>>17),p=_+(A^(v|~y))+T[13]+1309151649&4294967295,_=v+(p<<21&4294967295|p>>>11),p=y+(v^(_|~A))+T[4]+4149444226&4294967295,y=_+(p<<6&4294967295|p>>>26),p=A+(_^(y|~v))+T[11]+3174756917&4294967295,A=y+(p<<10&4294967295|p>>>22),p=v+(y^(A|~_))+T[2]+718787259&4294967295,v=A+(p<<15&4294967295|p>>>17),p=_+(A^(v|~y))+T[9]+3951481745&4294967295,b.g[0]=b.g[0]+y&4294967295,b.g[1]=b.g[1]+(v+(p<<21&4294967295|p>>>11))&4294967295,b.g[2]=b.g[2]+v&4294967295,b.g[3]=b.g[3]+A&4294967295}n.prototype.v=function(b,y){y===void 0&&(y=b.length);const _=y-this.blockSize,T=this.C;let v=this.h,A=0;for(;A<y;){if(v==0)for(;A<=_;)r(this,b,A),A+=this.blockSize;if(typeof b=="string"){for(;A<y;)if(T[v++]=b.charCodeAt(A++),v==this.blockSize){r(this,T),v=0;break}}else for(;A<y;)if(T[v++]=b[A++],v==this.blockSize){r(this,T),v=0;break}}this.h=v,this.o+=y},n.prototype.A=function(){var b=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);b[0]=128;for(var y=1;y<b.length-8;++y)b[y]=0;y=this.o*8;for(var _=b.length-8;_<b.length;++_)b[_]=y&255,y/=256;for(this.v(b),b=Array(16),y=0,_=0;_<4;++_)for(let T=0;T<32;T+=8)b[y++]=this.g[_]>>>T&255;return b};function o(b,y){var _=u;return Object.prototype.hasOwnProperty.call(_,b)?_[b]:_[b]=y(b)}function a(b,y){this.h=y;const _=[];let T=!0;for(let v=b.length-1;v>=0;v--){const A=b[v]|0;T&&A==y||(_[v]=A,T=!1)}this.g=_}var u={};function d(b){return-128<=b&&b<128?o(b,function(y){return new a([y|0],y<0?-1:0)}):new a([b|0],b<0?-1:0)}function m(b){if(isNaN(b)||!isFinite(b))return E;if(b<0)return N(m(-b));const y=[];let _=1;for(let T=0;b>=_;T++)y[T]=b/_|0,_*=4294967296;return new a(y,0)}function f(b,y){if(b.length==0)throw Error("number format error: empty string");if(y=y||10,y<2||36<y)throw Error("radix out of range: "+y);if(b.charAt(0)=="-")return N(f(b.substring(1),y));if(b.indexOf("-")>=0)throw Error('number format error: interior "-" character');const _=m(Math.pow(y,8));let T=E;for(let A=0;A<b.length;A+=8){var v=Math.min(8,b.length-A);const p=parseInt(b.substring(A,A+v),y);v<8?(v=m(Math.pow(y,v)),T=T.j(v).add(m(p))):(T=T.j(_),T=T.add(m(p)))}return T}var E=d(0),w=d(1),C=d(16777216);s=a.prototype,s.m=function(){if(R(this))return-N(this).m();let b=0,y=1;for(let _=0;_<this.g.length;_++){const T=this.i(_);b+=(T>=0?T:4294967296+T)*y,y*=4294967296}return b},s.toString=function(b){if(b=b||10,b<2||36<b)throw Error("radix out of range: "+b);if(I(this))return"0";if(R(this))return"-"+N(this).toString(b);const y=m(Math.pow(b,6));var _=this;let T="";for(;;){const v=B(_,y).g;_=k(_,v.j(y));let A=((_.g.length>0?_.g[0]:_.h)>>>0).toString(b);if(_=v,I(_))return A+T;for(;A.length<6;)A="0"+A;T=A+T}},s.i=function(b){return b<0?0:b<this.g.length?this.g[b]:this.h};function I(b){if(b.h!=0)return!1;for(let y=0;y<b.g.length;y++)if(b.g[y]!=0)return!1;return!0}function R(b){return b.h==-1}s.l=function(b){return b=k(this,b),R(b)?-1:I(b)?0:1};function N(b){const y=b.g.length,_=[];for(let T=0;T<y;T++)_[T]=~b.g[T];return new a(_,~b.h).add(w)}s.abs=function(){return R(this)?N(this):this},s.add=function(b){const y=Math.max(this.g.length,b.g.length),_=[];let T=0;for(let v=0;v<=y;v++){let A=T+(this.i(v)&65535)+(b.i(v)&65535),p=(A>>>16)+(this.i(v)>>>16)+(b.i(v)>>>16);T=p>>>16,A&=65535,p&=65535,_[v]=p<<16|A}return new a(_,_[_.length-1]&-2147483648?-1:0)};function k(b,y){return b.add(N(y))}s.j=function(b){if(I(this)||I(b))return E;if(R(this))return R(b)?N(this).j(N(b)):N(N(this).j(b));if(R(b))return N(this.j(N(b)));if(this.l(C)<0&&b.l(C)<0)return m(this.m()*b.m());const y=this.g.length+b.g.length,_=[];for(var T=0;T<2*y;T++)_[T]=0;for(T=0;T<this.g.length;T++)for(let v=0;v<b.g.length;v++){const A=this.i(T)>>>16,p=this.i(T)&65535,D=b.i(v)>>>16,J=b.i(v)&65535;_[2*T+2*v]+=p*J,S(_,2*T+2*v),_[2*T+2*v+1]+=A*J,S(_,2*T+2*v+1),_[2*T+2*v+1]+=p*D,S(_,2*T+2*v+1),_[2*T+2*v+2]+=A*D,S(_,2*T+2*v+2)}for(b=0;b<y;b++)_[b]=_[2*b+1]<<16|_[2*b];for(b=y;b<2*y;b++)_[b]=0;return new a(_,0)};function S(b,y){for(;(b[y]&65535)!=b[y];)b[y+1]+=b[y]>>>16,b[y]&=65535,y++}function F(b,y){this.g=b,this.h=y}function B(b,y){if(I(y))throw Error("division by zero");if(I(b))return new F(E,E);if(R(b))return y=B(N(b),y),new F(N(y.g),N(y.h));if(R(y))return y=B(b,N(y)),new F(N(y.g),y.h);if(b.g.length>30){if(R(b)||R(y))throw Error("slowDivide_ only works with positive integers.");for(var _=w,T=y;T.l(b)<=0;)_=$(_),T=$(T);var v=O(_,1),A=O(T,1);for(T=O(T,2),_=O(_,2);!I(T);){var p=A.add(T);p.l(b)<=0&&(v=v.add(_),A=p),T=O(T,1),_=O(_,1)}return y=k(b,v.j(y)),new F(v,y)}for(v=E;b.l(y)>=0;){for(_=Math.max(1,Math.floor(b.m()/y.m())),T=Math.ceil(Math.log(_)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),A=m(_),p=A.j(y);R(p)||p.l(b)>0;)_-=T,A=m(_),p=A.j(y);I(A)&&(A=w),v=v.add(A),b=k(b,p)}return new F(v,b)}s.B=function(b){return B(this,b).h},s.and=function(b){const y=Math.max(this.g.length,b.g.length),_=[];for(let T=0;T<y;T++)_[T]=this.i(T)&b.i(T);return new a(_,this.h&b.h)},s.or=function(b){const y=Math.max(this.g.length,b.g.length),_=[];for(let T=0;T<y;T++)_[T]=this.i(T)|b.i(T);return new a(_,this.h|b.h)},s.xor=function(b){const y=Math.max(this.g.length,b.g.length),_=[];for(let T=0;T<y;T++)_[T]=this.i(T)^b.i(T);return new a(_,this.h^b.h)};function $(b){const y=b.g.length+1,_=[];for(let T=0;T<y;T++)_[T]=b.i(T)<<1|b.i(T-1)>>>31;return new a(_,b.h)}function O(b,y){const _=y>>5;y%=32;const T=b.g.length-_,v=[];for(let A=0;A<T;A++)v[A]=y>0?b.i(A+_)>>>y|b.i(A+_+1)<<32-y:b.i(A+_);return new a(v,b.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,Hl=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=m,a.fromString=f,St=a}).apply(typeof Ca<"u"?Ca:typeof self<"u"?self:typeof window<"u"?window:{});var qs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Wl,Zn,Kl,Qs,Ti,Gl,Ql,Jl;(function(){var s,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof qs=="object"&&qs];for(var c=0;c<i.length;++c){var h=i[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=t(this);function r(i,c){if(c)e:{var h=n;i=i.split(".");for(var g=0;g<i.length-1;g++){var x=i[g];if(!(x in h))break e;h=h[x]}i=i[i.length-1],g=h[i],c=c(g),c!=g&&c!=null&&e(h,i,{configurable:!0,writable:!0,value:c})}}r("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(i){return i||function(c){var h=[],g;for(g in c)Object.prototype.hasOwnProperty.call(c,g)&&h.push([g,c[g]]);return h}});var o=o||{},a=this||self;function u(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function d(i,c,h){return i.call.apply(i.bind,arguments)}function m(i,c,h){return m=d,m.apply(null,arguments)}function f(i,c){var h=Array.prototype.slice.call(arguments,1);return function(){var g=h.slice();return g.push.apply(g,arguments),i.apply(this,g)}}function E(i,c){function h(){}h.prototype=c.prototype,i.Z=c.prototype,i.prototype=new h,i.prototype.constructor=i,i.Ob=function(g,x,P){for(var U=Array(arguments.length-2),Z=2;Z<arguments.length;Z++)U[Z-2]=arguments[Z];return c.prototype[x].apply(g,U)}}var w=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function C(i){const c=i.length;if(c>0){const h=Array(c);for(let g=0;g<c;g++)h[g]=i[g];return h}return[]}function I(i,c){for(let g=1;g<arguments.length;g++){const x=arguments[g];var h=typeof x;if(h=h!="object"?h:x?Array.isArray(x)?"array":h:"null",h=="array"||h=="object"&&typeof x.length=="number"){h=i.length||0;const P=x.length||0;i.length=h+P;for(let U=0;U<P;U++)i[h+U]=x[U]}else i.push(x)}}class R{constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function N(i){a.setTimeout(()=>{throw i},0)}function k(){var i=b;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class S{constructor(){this.h=this.g=null}add(c,h){const g=F.get();g.set(c,h),this.h?this.h.next=g:this.g=g,this.h=g}}var F=new R(()=>new B,i=>i.reset());class B{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let $,O=!1,b=new S,y=()=>{const i=Promise.resolve(void 0);$=()=>{i.then(_)}};function _(){for(var i;i=k();){try{i.h.call(i.g)}catch(h){N(h)}var c=F;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}O=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function v(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}v.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const h=()=>{};a.addEventListener("test",h,c),a.removeEventListener("test",h,c)}catch{}return i})();function p(i){return/^[\s\xa0]*$/.test(i)}function D(i,c){v.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}E(D,v),D.prototype.init=function(i,c){const h=this.type=i.type,g=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(h=="mouseover"?c=i.fromElement:h=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&D.Z.h.call(this)},D.prototype.h=function(){D.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var J="closure_listenable_"+(Math.random()*1e6|0),we=0;function Ie(i,c,h,g,x){this.listener=i,this.proxy=null,this.src=c,this.type=h,this.capture=!!g,this.ha=x,this.key=++we,this.da=this.fa=!1}function he(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function M(i,c,h){for(const g in i)c.call(h,i[g],g,i)}function K(i,c){for(const h in i)c.call(void 0,i[h],h,i)}function Ae(i){const c={};for(const h in i)c[h]=i[h];return c}const Me="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ht(i,c){let h,g;for(let x=1;x<arguments.length;x++){g=arguments[x];for(h in g)i[h]=g[h];for(let P=0;P<Me.length;P++)h=Me[P],Object.prototype.hasOwnProperty.call(g,h)&&(i[h]=g[h])}}function dt(i){this.src=i,this.g={},this.h=0}dt.prototype.add=function(i,c,h,g,x){const P=i.toString();i=this.g[P],i||(i=this.g[P]=[],this.h++);const U=$e(i,c,g,x);return U>-1?(c=i[U],h||(c.fa=!1)):(c=new Ie(c,this.src,P,!!g,x),c.fa=h,i.push(c)),c};function tn(i,c){const h=c.type;if(h in i.g){var g=i.g[h],x=Array.prototype.indexOf.call(g,c,void 0),P;(P=x>=0)&&Array.prototype.splice.call(g,x,1),P&&(he(c),i.g[h].length==0&&(delete i.g[h],i.h--))}}function $e(i,c,h,g){for(let x=0;x<i.length;++x){const P=i[x];if(!P.da&&P.listener==c&&P.capture==!!h&&P.ha==g)return x}return-1}var Ot="closure_lm_"+(Math.random()*1e6|0),nn={};function Dn(i,c,h,g,x){if(Array.isArray(c)){for(let P=0;P<c.length;P++)Dn(i,c[P],h,g,x);return null}return h=$t(h),i&&i[J]?i.J(c,h,u(g)?!!g.capture:!1,x):Ss(i,c,h,!1,g,x)}function Ss(i,c,h,g,x,P){if(!c)throw Error("Invalid event type");const U=u(x)?!!x.capture:!!x;let Z=Qe(i);if(Z||(i[Ot]=Z=new dt(i)),h=Z.add(c,h,g,U,P),h.proxy)return h;if(g=mt(),h.proxy=g,g.src=i,g.listener=h,i.addEventListener)A||(x=U),x===void 0&&(x=!1),i.addEventListener(c.toString(),g,x);else if(i.attachEvent)i.attachEvent(jn(c.toString()),g);else if(i.addListener&&i.removeListener)i.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return h}function mt(){function i(h){return c.call(i.src,i.listener,h)}const c=Lt;return i}function Vn(i,c,h,g,x){if(Array.isArray(c))for(var P=0;P<c.length;P++)Vn(i,c[P],h,g,x);else g=u(g)?!!g.capture:!!g,h=$t(h),i&&i[J]?(i=i.i,P=String(c).toString(),P in i.g&&(c=i.g[P],h=$e(c,h,g,x),h>-1&&(he(c[h]),Array.prototype.splice.call(c,h,1),c.length==0&&(delete i.g[P],i.h--)))):i&&(i=Qe(i))&&(c=i.g[c.toString()],i=-1,c&&(i=$e(c,h,g,x)),(h=i>-1?c[i]:null)&&pt(h))}function pt(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[J])tn(c.i,i);else{var h=i.type,g=i.proxy;c.removeEventListener?c.removeEventListener(h,g,i.capture):c.detachEvent?c.detachEvent(jn(h),g):c.addListener&&c.removeListener&&c.removeListener(g),(h=Qe(c))?(tn(h,i),h.h==0&&(h.src=null,c[Ot]=null)):he(i)}}}function jn(i){return i in nn?nn[i]:nn[i]="on"+i}function Lt(i,c){if(i.da)i=!0;else{c=new D(c,this);const h=i.listener,g=i.ha||i.src;i.fa&&pt(i),i=h.call(g,c)}return i}function Qe(i){return i=i[Ot],i instanceof dt?i:null}var Mt="__closure_events_fn_"+(Math.random()*1e9>>>0);function $t(i){return typeof i=="function"?i:(i[Mt]||(i[Mt]=function(c){return i.handleEvent(c)}),i[Mt])}function ve(){T.call(this),this.i=new dt(this),this.M=this,this.G=null}E(ve,T),ve.prototype[J]=!0,ve.prototype.removeEventListener=function(i,c,h,g){Vn(this,i,c,h,g)};function xe(i,c){var h,g=i.G;if(g)for(h=[];g;g=g.G)h.push(g);if(i=i.M,g=c.type||c,typeof c=="string")c=new v(c,i);else if(c instanceof v)c.target=c.target||i;else{var x=c;c=new v(g,i),ht(c,x)}x=!0;let P,U;if(h)for(U=h.length-1;U>=0;U--)P=c.g=h[U],x=sn(P,g,!0,c)&&x;if(P=c.g=i,x=sn(P,g,!0,c)&&x,x=sn(P,g,!1,c)&&x,h)for(U=0;U<h.length;U++)P=c.g=h[U],x=sn(P,g,!1,c)&&x}ve.prototype.N=function(){if(ve.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const h=i.g[c];for(let g=0;g<h.length;g++)he(h[g]);delete i.g[c],i.h--}}this.G=null},ve.prototype.J=function(i,c,h,g){return this.i.add(String(i),c,!1,h,g)},ve.prototype.K=function(i,c,h,g){return this.i.add(String(i),c,!0,h,g)};function sn(i,c,h,g){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let x=!0;for(let P=0;P<c.length;++P){const U=c[P];if(U&&!U.da&&U.capture==h){const Z=U.listener,be=U.ha||U.src;U.fa&&tn(i.i,U),x=Z.call(be,g)!==!1&&x}}return x&&!g.defaultPrevented}function $r(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=m(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function Cs(i){i.g=$r(()=>{i.g=null,i.i&&(i.i=!1,Cs(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class Br extends T{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Cs(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ft(i){T.call(this),this.h=i,this.g={}}E(ft,T);var Ns=[];function Rs(i){M(i.g,function(c,h){this.g.hasOwnProperty(h)&&pt(c)},i),i.g={}}ft.prototype.N=function(){ft.Z.N.call(this),Rs(this)},ft.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Fn=a.JSON.stringify,V=a.JSON.parse,G=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function re(){}function ie(){}var We={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ot(){v.call(this,"d")}E(ot,v);function qe(){v.call(this,"c")}E(qe,v);var at={},Ao=null;function Ps(){return Ao=Ao||new ve}at.Ia="serverreachability";function xo(i){v.call(this,at.Ia,i)}E(xo,v);function On(i){const c=Ps();xe(c,new xo(c))}at.STAT_EVENT="statevent";function So(i,c){v.call(this,at.STAT_EVENT,i),this.stat=c}E(So,v);function Fe(i){const c=Ps();xe(c,new So(c,i))}at.Ja="timingevent";function Co(i,c){v.call(this,at.Ja,i),this.size=c}E(Co,v);function Ln(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function Mn(){this.g=!0}Mn.prototype.ua=function(){this.g=!1};function Pu(i,c,h,g,x,P){i.info(function(){if(i.g)if(P){var U="",Z=P.split("&");for(let ae=0;ae<Z.length;ae++){var be=Z[ae].split("=");if(be.length>1){const Se=be[0];be=be[1];const Ye=Se.split("_");U=Ye.length>=2&&Ye[1]=="type"?U+(Se+"="+be+"&"):U+(Se+"=redacted&")}}}else U=null;else U=P;return"XMLHTTP REQ ("+g+") [attempt "+x+"]: "+c+`
`+h+`
`+U})}function ku(i,c,h,g,x,P,U){i.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+x+"]: "+c+`
`+h+`
`+P+" "+U})}function rn(i,c,h,g){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+Vu(i,h)+(g?" "+g:"")})}function Du(i,c){i.info(function(){return"TIMEOUT: "+c})}Mn.prototype.info=function(){};function Vu(i,c){if(!i.g)return c;if(!c)return null;try{const P=JSON.parse(c);if(P){for(i=0;i<P.length;i++)if(Array.isArray(P[i])){var h=P[i];if(!(h.length<2)){var g=h[1];if(Array.isArray(g)&&!(g.length<1)){var x=g[0];if(x!="noop"&&x!="stop"&&x!="close")for(let U=1;U<g.length;U++)g[U]=""}}}}return Fn(P)}catch{return c}}var ks={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},No={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Ro;function Ur(){}E(Ur,re),Ur.prototype.g=function(){return new XMLHttpRequest},Ro=new Ur;function $n(i){return encodeURIComponent(String(i))}function ju(i){var c=1;i=i.split(":");const h=[];for(;c>0&&i.length;)h.push(i.shift()),c--;return i.length&&h.push(i.join(":")),h}function gt(i,c,h,g){this.j=i,this.i=c,this.l=h,this.S=g||1,this.V=new ft(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Po}function Po(){this.i=null,this.g="",this.h=!1}var ko={},qr={};function zr(i,c,h){i.M=1,i.A=Vs(Je(c)),i.u=h,i.R=!0,Do(i,null)}function Do(i,c){i.F=Date.now(),Ds(i),i.B=Je(i.A);var h=i.B,g=i.S;Array.isArray(g)||(g=[String(g)]),Wo(h.i,"t",g),i.C=0,h=i.j.L,i.h=new Po,i.g=ua(i.j,h?c:null,!i.u),i.P>0&&(i.O=new Br(m(i.Y,i,i.g),i.P)),c=i.V,h=i.g,g=i.ba;var x="readystatechange";Array.isArray(x)||(x&&(Ns[0]=x.toString()),x=Ns);for(let P=0;P<x.length;P++){const U=Dn(h,x[P],g||c.handleEvent,!1,c.h||c);if(!U)break;c.g[U.key]=U}c=i.J?Ae(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),On(),Pu(i.i,i.v,i.B,i.l,i.S,i.u)}gt.prototype.ba=function(i){i=i.target;const c=this.O;c&&vt(i)==3?c.j():this.Y(i)},gt.prototype.Y=function(i){try{if(i==this.g)e:{const Z=vt(this.g),be=this.g.ya(),ae=this.g.ca();if(!(Z<3)&&(Z!=3||this.g&&(this.h.h||this.g.la()||Zo(this.g)))){this.K||Z!=4||be==7||(be==8||ae<=0?On(3):On(2)),Hr(this);var c=this.g.ca();this.X=c;var h=Fu(this);if(this.o=c==200,ku(this.i,this.v,this.B,this.l,this.S,Z,c),this.o){if(this.U&&!this.L){t:{if(this.g){var g,x=this.g;if((g=x.g?x.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(g)){var P=g;break t}}P=null}if(i=P)rn(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Wr(this,i);else{this.o=!1,this.m=3,Fe(12),Bt(this),Bn(this);break e}}if(this.R){i=!0;let Se;for(;!this.K&&this.C<h.length;)if(Se=Ou(this,h),Se==qr){Z==4&&(this.m=4,Fe(14),i=!1),rn(this.i,this.l,null,"[Incomplete Response]");break}else if(Se==ko){this.m=4,Fe(15),rn(this.i,this.l,h,"[Invalid Chunk]"),i=!1;break}else rn(this.i,this.l,Se,null),Wr(this,Se);if(Vo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Z!=4||h.length!=0||this.h.h||(this.m=1,Fe(16),i=!1),this.o=this.o&&i,!i)rn(this.i,this.l,h,"[Invalid Chunked Response]"),Bt(this),Bn(this);else if(h.length>0&&!this.W){this.W=!0;var U=this.j;U.g==this&&U.aa&&!U.P&&(U.j.info("Great, no buffering proxy detected. Bytes received: "+h.length),ei(U),U.P=!0,Fe(11))}}else rn(this.i,this.l,h,null),Wr(this,h);Z==4&&Bt(this),this.o&&!this.K&&(Z==4?oa(this.j,this):(this.o=!1,Ds(this)))}else Yu(this.g),c==400&&h.indexOf("Unknown SID")>0?(this.m=3,Fe(12)):(this.m=0,Fe(13)),Bt(this),Bn(this)}}}catch{}};function Fu(i){if(!Vo(i))return i.g.la();const c=Zo(i.g);if(c==="")return"";let h="";const g=c.length,x=vt(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return Bt(i),Bn(i),"";i.h.i=new a.TextDecoder}for(let P=0;P<g;P++)i.h.h=!0,h+=i.h.i.decode(c[P],{stream:!(x&&P==g-1)});return c.length=0,i.h.g+=h,i.C=0,i.h.g}function Vo(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function Ou(i,c){var h=i.C,g=c.indexOf(`
`,h);return g==-1?qr:(h=Number(c.substring(h,g)),isNaN(h)?ko:(g+=1,g+h>c.length?qr:(c=c.slice(g,g+h),i.C=g+h,c)))}gt.prototype.cancel=function(){this.K=!0,Bt(this)};function Ds(i){i.T=Date.now()+i.H,jo(i,i.H)}function jo(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=Ln(m(i.aa,i),c)}function Hr(i){i.D&&(a.clearTimeout(i.D),i.D=null)}gt.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(Du(this.i,this.B),this.M!=2&&(On(),Fe(17)),Bt(this),this.m=2,Bn(this)):jo(this,this.T-i)};function Bn(i){i.j.I==0||i.K||oa(i.j,i)}function Bt(i){Hr(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,Rs(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function Wr(i,c){try{var h=i.j;if(h.I!=0&&(h.g==i||Kr(h.h,i))){if(!i.L&&Kr(h.h,i)&&h.I==3){try{var g=h.Ba.g.parse(c)}catch{g=null}if(Array.isArray(g)&&g.length==3){var x=g;if(x[0]==0){e:if(!h.v){if(h.g)if(h.g.F+3e3<i.F)Ms(h),Os(h);else break e;Zr(h),Fe(18)}}else h.xa=x[1],0<h.xa-h.K&&x[2]<37500&&h.F&&h.A==0&&!h.C&&(h.C=Ln(m(h.Va,h),6e3));Lo(h.h)<=1&&h.ta&&(h.ta=void 0)}else qt(h,11)}else if((i.L||h.g==i)&&Ms(h),!p(c))for(x=h.Ba.g.parse(c),c=0;c<x.length;c++){let ae=x[c];const Se=ae[0];if(!(Se<=h.K))if(h.K=Se,ae=ae[1],h.I==2)if(ae[0]=="c"){h.M=ae[1],h.ba=ae[2];const Ye=ae[3];Ye!=null&&(h.ka=Ye,h.j.info("VER="+h.ka));const zt=ae[4];zt!=null&&(h.za=zt,h.j.info("SVER="+h.za));const bt=ae[5];bt!=null&&typeof bt=="number"&&bt>0&&(g=1.5*bt,h.O=g,h.j.info("backChannelRequestTimeoutMs_="+g)),g=h;const Et=i.g;if(Et){const Bs=Et.g?Et.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Bs){var P=g.h;P.g||Bs.indexOf("spdy")==-1&&Bs.indexOf("quic")==-1&&Bs.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(Gr(P,P.h),P.h=null))}if(g.G){const ti=Et.g?Et.g.getResponseHeader("X-HTTP-Session-Id"):null;ti&&(g.wa=ti,le(g.J,g.G,ti))}}h.I=3,h.l&&h.l.ra(),h.aa&&(h.T=Date.now()-i.F,h.j.info("Handshake RTT: "+h.T+"ms")),g=h;var U=i;if(g.na=ca(g,g.L?g.ba:null,g.W),U.L){Mo(g.h,U);var Z=U,be=g.O;be&&(Z.H=be),Z.D&&(Hr(Z),Ds(Z)),g.g=U}else ra(g);h.i.length>0&&Ls(h)}else ae[0]!="stop"&&ae[0]!="close"||qt(h,7);else h.I==3&&(ae[0]=="stop"||ae[0]=="close"?ae[0]=="stop"?qt(h,7):Xr(h):ae[0]!="noop"&&h.l&&h.l.qa(ae),h.A=0)}}On(4)}catch{}}var Lu=class{constructor(i,c){this.g=i,this.map=c}};function Fo(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Oo(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function Lo(i){return i.h?1:i.g?i.g.size:0}function Kr(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function Gr(i,c){i.g?i.g.add(c):i.h=c}function Mo(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}Fo.prototype.cancel=function(){if(this.i=$o(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function $o(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const h of i.g.values())c=c.concat(h.G);return c}return C(i.i)}var Bo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Mu(i,c){if(i){i=i.split("&");for(let h=0;h<i.length;h++){const g=i[h].indexOf("=");let x,P=null;g>=0?(x=i[h].substring(0,g),P=i[h].substring(g+1)):x=i[h],c(x,P?decodeURIComponent(P.replace(/\+/g," ")):"")}}}function yt(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof yt?(this.l=i.l,Un(this,i.j),this.o=i.o,this.g=i.g,qn(this,i.u),this.h=i.h,Qr(this,Ko(i.i)),this.m=i.m):i&&(c=String(i).match(Bo))?(this.l=!1,Un(this,c[1]||"",!0),this.o=zn(c[2]||""),this.g=zn(c[3]||"",!0),qn(this,c[4]),this.h=zn(c[5]||"",!0),Qr(this,c[6]||"",!0),this.m=zn(c[7]||"")):(this.l=!1,this.i=new Wn(null,this.l))}yt.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(Hn(c,Uo,!0),":");var h=this.g;return(h||c=="file")&&(i.push("//"),(c=this.o)&&i.push(Hn(c,Uo,!0),"@"),i.push($n(h).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.u,h!=null&&i.push(":",String(h))),(h=this.h)&&(this.g&&h.charAt(0)!="/"&&i.push("/"),i.push(Hn(h,h.charAt(0)=="/"?Uu:Bu,!0))),(h=this.i.toString())&&i.push("?",h),(h=this.m)&&i.push("#",Hn(h,zu)),i.join("")},yt.prototype.resolve=function(i){const c=Je(this);let h=!!i.j;h?Un(c,i.j):h=!!i.o,h?c.o=i.o:h=!!i.g,h?c.g=i.g:h=i.u!=null;var g=i.h;if(h)qn(c,i.u);else if(h=!!i.h){if(g.charAt(0)!="/")if(this.g&&!this.h)g="/"+g;else{var x=c.h.lastIndexOf("/");x!=-1&&(g=c.h.slice(0,x+1)+g)}if(x=g,x==".."||x==".")g="";else if(x.indexOf("./")!=-1||x.indexOf("/.")!=-1){g=x.lastIndexOf("/",0)==0,x=x.split("/");const P=[];for(let U=0;U<x.length;){const Z=x[U++];Z=="."?g&&U==x.length&&P.push(""):Z==".."?((P.length>1||P.length==1&&P[0]!="")&&P.pop(),g&&U==x.length&&P.push("")):(P.push(Z),g=!0)}g=P.join("/")}else g=x}return h?c.h=g:h=i.i.toString()!=="",h?Qr(c,Ko(i.i)):h=!!i.m,h&&(c.m=i.m),c};function Je(i){return new yt(i)}function Un(i,c,h){i.j=h?zn(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function qn(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function Qr(i,c,h){c instanceof Wn?(i.i=c,Hu(i.i,i.l)):(h||(c=Hn(c,qu)),i.i=new Wn(c,i.l))}function le(i,c,h){i.i.set(c,h)}function Vs(i){return le(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function zn(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function Hn(i,c,h){return typeof i=="string"?(i=encodeURI(i).replace(c,$u),h&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function $u(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var Uo=/[#\/\?@]/g,Bu=/[#\?:]/g,Uu=/[#\?]/g,qu=/[#\?@]/g,zu=/#/g;function Wn(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function Ut(i){i.g||(i.g=new Map,i.h=0,i.i&&Mu(i.i,function(c,h){i.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}s=Wn.prototype,s.add=function(i,c){Ut(this),this.i=null,i=on(this,i);let h=this.g.get(i);return h||this.g.set(i,h=[]),h.push(c),this.h+=1,this};function qo(i,c){Ut(i),c=on(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function zo(i,c){return Ut(i),c=on(i,c),i.g.has(c)}s.forEach=function(i,c){Ut(this),this.g.forEach(function(h,g){h.forEach(function(x){i.call(c,x,g,this)},this)},this)};function Ho(i,c){Ut(i);let h=[];if(typeof c=="string")zo(i,c)&&(h=h.concat(i.g.get(on(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)h=h.concat(i[c]);return h}s.set=function(i,c){return Ut(this),this.i=null,i=on(this,i),zo(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},s.get=function(i,c){return i?(i=Ho(this,i),i.length>0?String(i[0]):c):c};function Wo(i,c,h){qo(i,c),h.length>0&&(i.i=null,i.g.set(on(i,c),C(h)),i.h+=h.length)}s.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let g=0;g<c.length;g++){var h=c[g];const x=$n(h);h=Ho(this,h);for(let P=0;P<h.length;P++){let U=x;h[P]!==""&&(U+="="+$n(h[P])),i.push(U)}}return this.i=i.join("&")};function Ko(i){const c=new Wn;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function on(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function Hu(i,c){c&&!i.j&&(Ut(i),i.i=null,i.g.forEach(function(h,g){const x=g.toLowerCase();g!=x&&(qo(this,g),Wo(this,x,h))},i)),i.j=c}function Wu(i,c){const h=new Mn;if(a.Image){const g=new Image;g.onload=f(_t,h,"TestLoadImage: loaded",!0,c,g),g.onerror=f(_t,h,"TestLoadImage: error",!1,c,g),g.onabort=f(_t,h,"TestLoadImage: abort",!1,c,g),g.ontimeout=f(_t,h,"TestLoadImage: timeout",!1,c,g),a.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=i}else c(!1)}function Ku(i,c){const h=new Mn,g=new AbortController,x=setTimeout(()=>{g.abort(),_t(h,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:g.signal}).then(P=>{clearTimeout(x),P.ok?_t(h,"TestPingServer: ok",!0,c):_t(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(x),_t(h,"TestPingServer: error",!1,c)})}function _t(i,c,h,g,x){try{x&&(x.onload=null,x.onerror=null,x.onabort=null,x.ontimeout=null),g(h)}catch{}}function Gu(){this.g=new G}function Jr(i){this.i=i.Sb||null,this.h=i.ab||!1}E(Jr,re),Jr.prototype.g=function(){return new js(this.i,this.h)};function js(i,c){ve.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}E(js,ve),s=js.prototype,s.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,Gn(this)},s.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},s.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Kn(this)),this.readyState=0},s.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,Gn(this)),this.g&&(this.readyState=3,Gn(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Go(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function Go(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}s.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?Kn(this):Gn(this),this.readyState==3&&Go(this)}},s.Oa=function(i){this.g&&(this.response=this.responseText=i,Kn(this))},s.Na=function(i){this.g&&(this.response=i,Kn(this))},s.ga=function(){this.g&&Kn(this)};function Kn(i){i.readyState=4,i.l=null,i.j=null,i.B=null,Gn(i)}s.setRequestHeader=function(i,c){this.A.append(i,c)},s.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,i.push(h[0]+": "+h[1]),h=c.next();return i.join(`\r
`)};function Gn(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(js.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function Qo(i){let c="";return M(i,function(h,g){c+=g,c+=":",c+=h,c+=`\r
`}),c}function Yr(i,c,h){e:{for(g in h){var g=!1;break e}g=!0}g||(h=Qo(h),typeof i=="string"?h!=null&&$n(h):le(i,c,h))}function me(i){ve.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}E(me,ve);var Qu=/^https?$/i,Ju=["POST","PUT"];s=me.prototype,s.Fa=function(i){this.H=i},s.ea=function(i,c,h,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ro.g(),this.g.onreadystatechange=w(m(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(P){Jo(this,P);return}if(i=h||"",h=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var x in g)h.set(x,g[x]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(const P of g.keys())h.set(P,g.get(P));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(h.keys()).find(P=>P.toLowerCase()=="content-type"),x=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(Ju,c,void 0)>=0)||g||x||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[P,U]of h)this.g.setRequestHeader(P,U);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(P){Jo(this,P)}};function Jo(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,Yo(i),Fs(i)}function Yo(i){i.A||(i.A=!0,xe(i,"complete"),xe(i,"error"))}s.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,xe(this,"complete"),xe(this,"abort"),Fs(this))},s.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Fs(this,!0)),me.Z.N.call(this)},s.Ca=function(){this.u||(this.B||this.v||this.j?Xo(this):this.Xa())},s.Xa=function(){Xo(this)};function Xo(i){if(i.h&&typeof o<"u"){if(i.v&&vt(i)==4)setTimeout(i.Ca.bind(i),0);else if(xe(i,"readystatechange"),vt(i)==4){i.h=!1;try{const P=i.ca();e:switch(P){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var h;if(!(h=c)){var g;if(g=P===0){let U=String(i.D).match(Bo)[1]||null;!U&&a.self&&a.self.location&&(U=a.self.location.protocol.slice(0,-1)),g=!Qu.test(U?U.toLowerCase():"")}h=g}if(h)xe(i,"complete"),xe(i,"success");else{i.o=6;try{var x=vt(i)>2?i.g.statusText:""}catch{x=""}i.l=x+" ["+i.ca()+"]",Yo(i)}}finally{Fs(i)}}}}function Fs(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const h=i.g;i.g=null,c||xe(i,"ready");try{h.onreadystatechange=null}catch{}}}s.isActive=function(){return!!this.g};function vt(i){return i.g?i.g.readyState:0}s.ca=function(){try{return vt(this)>2?this.g.status:-1}catch{return-1}},s.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},s.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),V(c)}};function Zo(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function Yu(i){const c={};i=(i.g&&vt(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<i.length;g++){if(p(i[g]))continue;var h=ju(i[g]);const x=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const P=c[x]||[];c[x]=P,P.push(h)}K(c,function(g){return g.join(", ")})}s.ya=function(){return this.o},s.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Qn(i,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[i]||c}function ea(i){this.za=0,this.i=[],this.j=new Mn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Qn("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Qn("baseRetryDelayMs",5e3,i),this.Za=Qn("retryDelaySeedMs",1e4,i),this.Ta=Qn("forwardChannelMaxRetries",2,i),this.va=Qn("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new Fo(i&&i.concurrentRequestLimit),this.Ba=new Gu,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}s=ea.prototype,s.ka=8,s.I=1,s.connect=function(i,c,h,g){Fe(0),this.W=i,this.H=c||{},h&&g!==void 0&&(this.H.OSID=h,this.H.OAID=g),this.F=this.X,this.J=ca(this,null,this.W),Ls(this)};function Xr(i){if(ta(i),i.I==3){var c=i.V++,h=Je(i.J);if(le(h,"SID",i.M),le(h,"RID",c),le(h,"TYPE","terminate"),Jn(i,h),c=new gt(i,i.j,c),c.M=2,c.A=Vs(Je(h)),h=!1,a.navigator&&a.navigator.sendBeacon)try{h=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!h&&a.Image&&(new Image().src=c.A,h=!0),h||(c.g=ua(c.j,null),c.g.ea(c.A)),c.F=Date.now(),Ds(c)}la(i)}function Os(i){i.g&&(ei(i),i.g.cancel(),i.g=null)}function ta(i){Os(i),i.v&&(a.clearTimeout(i.v),i.v=null),Ms(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function Ls(i){if(!Oo(i.h)&&!i.m){i.m=!0;var c=i.Ea;$||y(),O||($(),O=!0),b.add(c,i),i.D=0}}function Xu(i,c){return Lo(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=Ln(m(i.Ea,i,c),aa(i,i.D)),i.D++,!0)}s.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const x=new gt(this,this.j,i);let P=this.o;if(this.U&&(P?(P=Ae(P),ht(P,this.U)):P=this.U),this.u!==null||this.R||(x.J=P,P=null),this.S)e:{for(var c=0,h=0;h<this.i.length;h++){t:{var g=this.i[h];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(c+=g,c>4096){c=h;break e}if(c===4096||h===this.i.length-1){c=h+1;break e}}c=1e3}else c=1e3;c=sa(this,x,c),h=Je(this.J),le(h,"RID",i),le(h,"CVER",22),this.G&&le(h,"X-HTTP-Session-Id",this.G),Jn(this,h),P&&(this.R?c="headers="+$n(Qo(P))+"&"+c:this.u&&Yr(h,this.u,P)),Gr(this.h,x),this.Ra&&le(h,"TYPE","init"),this.S?(le(h,"$req",c),le(h,"SID","null"),x.U=!0,zr(x,h,null)):zr(x,h,c),this.I=2}}else this.I==3&&(i?na(this,i):this.i.length==0||Oo(this.h)||na(this))};function na(i,c){var h;c?h=c.l:h=i.V++;const g=Je(i.J);le(g,"SID",i.M),le(g,"RID",h),le(g,"AID",i.K),Jn(i,g),i.u&&i.o&&Yr(g,i.u,i.o),h=new gt(i,i.j,h,i.D+1),i.u===null&&(h.J=i.o),c&&(i.i=c.G.concat(i.i)),c=sa(i,h,1e3),h.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Gr(i.h,h),zr(h,g,c)}function Jn(i,c){i.H&&M(i.H,function(h,g){le(c,g,h)}),i.l&&M({},function(h,g){le(c,g,h)})}function sa(i,c,h){h=Math.min(i.i.length,h);const g=i.l?m(i.l.Ka,i.l,i):null;e:{var x=i.i;let Z=-1;for(;;){const be=["count="+h];Z==-1?h>0?(Z=x[0].g,be.push("ofs="+Z)):Z=0:be.push("ofs="+Z);let ae=!0;for(let Se=0;Se<h;Se++){var P=x[Se].g;const Ye=x[Se].map;if(P-=Z,P<0)Z=Math.max(0,x[Se].g-100),ae=!1;else try{P="req"+P+"_"||"";try{var U=Ye instanceof Map?Ye:Object.entries(Ye);for(const[zt,bt]of U){let Et=bt;u(bt)&&(Et=Fn(bt)),be.push(P+zt+"="+encodeURIComponent(Et))}}catch(zt){throw be.push(P+"type="+encodeURIComponent("_badmap")),zt}}catch{g&&g(Ye)}}if(ae){U=be.join("&");break e}}U=void 0}return i=i.i.splice(0,h),c.G=i,U}function ra(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;$||y(),O||($(),O=!0),b.add(c,i),i.A=0}}function Zr(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=Ln(m(i.Da,i),aa(i,i.A)),i.A++,!0)}s.Da=function(){if(this.v=null,ia(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=Ln(m(this.Wa,this),i)}},s.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Fe(10),Os(this),ia(this))};function ei(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function ia(i){i.g=new gt(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=Je(i.na);le(c,"RID","rpc"),le(c,"SID",i.M),le(c,"AID",i.K),le(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&le(c,"TO",i.ia),le(c,"TYPE","xmlhttp"),Jn(i,c),i.u&&i.o&&Yr(c,i.u,i.o),i.O&&(i.g.H=i.O);var h=i.g;i=i.ba,h.M=1,h.A=Vs(Je(c)),h.u=null,h.R=!0,Do(h,i)}s.Va=function(){this.C!=null&&(this.C=null,Os(this),Zr(this),Fe(19))};function Ms(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function oa(i,c){var h=null;if(i.g==c){Ms(i),ei(i),i.g=null;var g=2}else if(Kr(i.h,c))h=c.G,Mo(i.h,c),g=1;else return;if(i.I!=0){if(c.o)if(g==1){h=c.u?c.u.length:0,c=Date.now()-c.F;var x=i.D;g=Ps(),xe(g,new Co(g,h)),Ls(i)}else ra(i);else if(x=c.m,x==3||x==0&&c.X>0||!(g==1&&Xu(i,c)||g==2&&Zr(i)))switch(h&&h.length>0&&(c=i.h,c.i=c.i.concat(h)),x){case 1:qt(i,5);break;case 4:qt(i,10);break;case 3:qt(i,6);break;default:qt(i,2)}}}function aa(i,c){let h=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(h*=2),h*c}function qt(i,c){if(i.j.info("Error code "+c),c==2){var h=m(i.bb,i),g=i.Ua;const x=!g;g=new yt(g||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Un(g,"https"),Vs(g),x?Wu(g.toString(),h):Ku(g.toString(),h)}else Fe(2);i.I=0,i.l&&i.l.pa(c),la(i),ta(i)}s.bb=function(i){i?(this.j.info("Successfully pinged google.com"),Fe(2)):(this.j.info("Failed to ping google.com"),Fe(1))};function la(i){if(i.I=0,i.ja=[],i.l){const c=$o(i.h);(c.length!=0||i.i.length!=0)&&(I(i.ja,c),I(i.ja,i.i),i.h.i.length=0,C(i.i),i.i.length=0),i.l.oa()}}function ca(i,c,h){var g=h instanceof yt?Je(h):new yt(h);if(g.g!="")c&&(g.g=c+"."+g.g),qn(g,g.u);else{var x=a.location;g=x.protocol,c=c?c+"."+x.hostname:x.hostname,x=+x.port;const P=new yt(null);g&&Un(P,g),c&&(P.g=c),x&&qn(P,x),h&&(P.h=h),g=P}return h=i.G,c=i.wa,h&&c&&le(g,h,c),le(g,"VER",i.ka),Jn(i,g),g}function ua(i,c,h){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new me(new Jr({ab:h})):new me(i.ma),c.Fa(i.L),c}s.isActive=function(){return!!this.l&&this.l.isActive(this)};function ha(){}s=ha.prototype,s.ra=function(){},s.qa=function(){},s.pa=function(){},s.oa=function(){},s.isActive=function(){return!0},s.Ka=function(){};function $s(){}$s.prototype.g=function(i,c){return new Be(i,c)};function Be(i,c){ve.call(this),this.g=new ea(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!p(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!p(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new an(this)}E(Be,ve),Be.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Be.prototype.close=function(){Xr(this.g)},Be.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var h={};h.__data__=i,i=h}else this.v&&(h={},h.__data__=Fn(i),i=h);c.i.push(new Lu(c.Ya++,i)),c.I==3&&Ls(c)},Be.prototype.N=function(){this.g.l=null,delete this.j,Xr(this.g),delete this.g,Be.Z.N.call(this)};function da(i){ot.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){e:{for(const h in c){i=h;break e}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}E(da,ot);function ma(){qe.call(this),this.status=1}E(ma,qe);function an(i){this.g=i}E(an,ha),an.prototype.ra=function(){xe(this.g,"a")},an.prototype.qa=function(i){xe(this.g,new da(i))},an.prototype.pa=function(i){xe(this.g,new ma)},an.prototype.oa=function(){xe(this.g,"b")},$s.prototype.createWebChannel=$s.prototype.g,Be.prototype.send=Be.prototype.o,Be.prototype.open=Be.prototype.m,Be.prototype.close=Be.prototype.close,Jl=function(){return new $s},Ql=function(){return Ps()},Gl=at,Ti={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ks.NO_ERROR=0,ks.TIMEOUT=8,ks.HTTP_ERROR=6,Qs=ks,No.COMPLETE="complete",Kl=No,ie.EventType=We,We.OPEN="a",We.CLOSE="b",We.ERROR="c",We.MESSAGE="d",ve.prototype.listen=ve.prototype.J,Zn=ie,me.prototype.listenOnce=me.prototype.K,me.prototype.getLastError=me.prototype.Ha,me.prototype.getLastErrorCode=me.prototype.ya,me.prototype.getStatus=me.prototype.ca,me.prototype.getResponseJson=me.prototype.La,me.prototype.getResponseText=me.prototype.la,me.prototype.send=me.prototype.ea,me.prototype.setWithCredentials=me.prototype.Fa,Wl=me}).apply(typeof qs<"u"?qs:typeof self<"u"?self:typeof window<"u"?window:{});class Ve{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ve.UNAUTHENTICATED=new Ve(null),Ve.GOOGLE_CREDENTIALS=new Ve("google-credentials-uid"),Ve.FIRST_PARTY=new Ve("first-party-uid"),Ve.MOCK_USER=new Ve("mock-user");let Sn="12.9.0";function Hd(s){Sn=s}const Kt=new Ml("@firebase/firestore");function ln(){return Kt.logLevel}function z(s,...e){if(Kt.logLevel<=se.DEBUG){const t=e.map(zi);Kt.debug(`Firestore (${Sn}): ${s}`,...t)}}function ct(s,...e){if(Kt.logLevel<=se.ERROR){const t=e.map(zi);Kt.error(`Firestore (${Sn}): ${s}`,...t)}}function Gt(s,...e){if(Kt.logLevel<=se.WARN){const t=e.map(zi);Kt.warn(`Firestore (${Sn}): ${s}`,...t)}}function zi(s){if(typeof s=="string")return s;try{return(function(t){return JSON.stringify(t)})(s)}catch{return s}}function Q(s,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,Yl(s,n,t)}function Yl(s,e,t){let n=`FIRESTORE (${Sn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${s.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw ct(n),new Error(n)}function oe(s,e,t,n){let r="Unexpected state";typeof t=="string"?r=t:n=t,s||Yl(e,r,n)}function X(s,e){return s}const L={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class H extends xn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ct{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Xl{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Wd{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Ve.UNAUTHENTICATED)))}shutdown(){}}class Kd{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Gd{constructor(e){this.t=e,this.currentUser=Ve.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){oe(this.o===void 0,42304);let n=this.i;const r=d=>this.i!==n?(n=this.i,t(d)):Promise.resolve();let o=new Ct;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Ct,e.enqueueRetryable((()=>r(this.currentUser)))};const a=()=>{const d=o;e.enqueueRetryable((async()=>{await d.promise,await r(this.currentUser)}))},u=d=>{z("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((d=>u(d))),setTimeout((()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?u(d):(z("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Ct)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((n=>this.i!==e?(z("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(oe(typeof n.accessToken=="string",31837,{l:n}),new Xl(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return oe(e===null||typeof e=="string",2055,{h:e}),new Ve(e)}}class Qd{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=Ve.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class Jd{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Qd(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Ve.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Na{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Yd{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Cd(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){oe(this.o===void 0,3512);const n=o=>{o.error!=null&&z("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,z("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>n(o)))};const r=o=>{z("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>r(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?r(o):z("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Na(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(oe(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Na(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Xd(s){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(s);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<s;n++)t[n]=Math.floor(256*Math.random());return t}class Hi{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const r=Xd(40);for(let o=0;o<r.length;++o)n.length<20&&r[o]<t&&(n+=e.charAt(r[o]%62))}return n}}function ee(s,e){return s<e?-1:s>e?1:0}function wi(s,e){const t=Math.min(s.length,e.length);for(let n=0;n<t;n++){const r=s.charAt(n),o=e.charAt(n);if(r!==o)return ai(r)===ai(o)?ee(r,o):ai(r)?1:-1}return ee(s.length,e.length)}const Zd=55296,em=57343;function ai(s){const e=s.charCodeAt(0);return e>=Zd&&e<=em}function _n(s,e,t){return s.length===e.length&&s.every(((n,r)=>t(n,e[r])))}const Ra="__name__";class Xe{constructor(e,t,n){t===void 0?t=0:t>e.length&&Q(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&Q(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return Xe.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Xe?e.forEach((n=>{t.push(n)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const o=Xe.compareSegments(e.get(r),t.get(r));if(o!==0)return o}return ee(e.length,t.length)}static compareSegments(e,t){const n=Xe.isNumericId(e),r=Xe.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?Xe.extractNumericId(e).compare(Xe.extractNumericId(t)):wi(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return St.fromString(e.substring(4,e.length-2))}}class ce extends Xe{construct(e,t,n){return new ce(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new H(L.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((r=>r.length>0)))}return new ce(t)}static emptyPath(){return new ce([])}}const tm=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Pe extends Xe{construct(e,t,n){return new Pe(e,t,n)}static isValidIdentifier(e){return tm.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Pe.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Ra}static keyField(){return new Pe([Ra])}static fromServerFormat(e){const t=[];let n="",r=0;const o=()=>{if(n.length===0)throw new H(L.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;r<e.length;){const u=e[r];if(u==="\\"){if(r+1===e.length)throw new H(L.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[r+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new H(L.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=d,r+=2}else u==="`"?(a=!a,r++):u!=="."||a?(n+=u,r++):(o(),r++)}if(o(),a)throw new H(L.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Pe(t)}static emptyPath(){return new Pe([])}}class W{constructor(e){this.path=e}static fromPath(e){return new W(ce.fromString(e))}static fromName(e){return new W(ce.fromString(e).popFirst(5))}static empty(){return new W(ce.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ce.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ce.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new W(new ce(e.slice()))}}function Zl(s,e,t){if(!t)throw new H(L.INVALID_ARGUMENT,`Function ${s}() cannot be called with an empty ${e}.`)}function nm(s,e,t,n){if(e===!0&&n===!0)throw new H(L.INVALID_ARGUMENT,`${s} and ${t} cannot be used together.`)}function Pa(s){if(!W.isDocumentKey(s))throw new H(L.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${s} has ${s.length}.`)}function ka(s){if(W.isDocumentKey(s))throw new H(L.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${s} has ${s.length}.`)}function ec(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}function Wi(s){if(s===void 0)return"undefined";if(s===null)return"null";if(typeof s=="string")return s.length>20&&(s=`${s.substring(0,20)}...`),JSON.stringify(s);if(typeof s=="number"||typeof s=="boolean")return""+s;if(typeof s=="object"){if(s instanceof Array)return"an array";{const e=(function(n){return n.constructor?n.constructor.name:null})(s);return e?`a custom ${e} object`:"an object"}}return typeof s=="function"?"a function":Q(12329,{type:typeof s})}function vn(s,e){if("_delegate"in s&&(s=s._delegate),!(s instanceof e)){if(e.name===s.constructor.name)throw new H(L.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Wi(s);throw new H(L.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return s}function _e(s,e){const t={typeString:s};return e&&(t.value=e),t}function bs(s,e){if(!ec(s))throw new H(L.INVALID_ARGUMENT,"JSON must be an object");let t;for(const n in e)if(e[n]){const r=e[n].typeString,o="value"in e[n]?{value:e[n].value}:void 0;if(!(n in s)){t=`JSON missing required field: '${n}'`;break}const a=s[n];if(r&&typeof a!==r){t=`JSON field '${n}' must be a ${r}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${n}' field to equal '${o.value}'`;break}}if(t)throw new H(L.INVALID_ARGUMENT,t);return!0}const Da=-62135596800,Va=1e6;class ue{static now(){return ue.fromMillis(Date.now())}static fromDate(e){return ue.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Va);return new ue(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new H(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new H(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Da)throw new H(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new H(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Va}_compareTo(e){return this.seconds===e.seconds?ee(this.nanoseconds,e.nanoseconds):ee(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ue._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(bs(e,ue._jsonSchema))return new ue(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Da;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ue._jsonSchemaVersion="firestore/timestamp/1.0",ue._jsonSchema={type:_e("string",ue._jsonSchemaVersion),seconds:_e("number"),nanoseconds:_e("number")};class Y{static fromTimestamp(e){return new Y(e)}static min(){return new Y(new ue(0,0))}static max(){return new Y(new ue(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const ms=-1;function sm(s,e){const t=s.toTimestamp().seconds,n=s.toTimestamp().nanoseconds+1,r=Y.fromTimestamp(n===1e9?new ue(t+1,0):new ue(t,n));return new Rt(r,W.empty(),e)}function rm(s){return new Rt(s.readTime,s.key,ms)}class Rt{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Rt(Y.min(),W.empty(),ms)}static max(){return new Rt(Y.max(),W.empty(),ms)}}function im(s,e){let t=s.readTime.compareTo(e.readTime);return t!==0?t:(t=W.comparator(s.documentKey,e.documentKey),t!==0?t:ee(s.largestBatchId,e.largestBatchId))}const om="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class am{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Cn(s){if(s.code!==L.FAILED_PRECONDITION||s.message!==om)throw s;z("LocalStore","Unexpectedly lost primary lease")}class j{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Q(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new j(((n,r)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(n,r)},this.catchCallback=o=>{this.wrapFailure(t,o).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof j?t:j.resolve(t)}catch(t){return j.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):j.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):j.reject(t)}static resolve(e){return new j(((t,n)=>{t(e)}))}static reject(e){return new j(((t,n)=>{n(e)}))}static waitFor(e){return new j(((t,n)=>{let r=0,o=0,a=!1;e.forEach((u=>{++r,u.next((()=>{++o,a&&o===r&&t()}),(d=>n(d)))})),a=!0,o===r&&t()}))}static or(e){let t=j.resolve(!1);for(const n of e)t=t.next((r=>r?j.resolve(r):n()));return t}static forEach(e,t){const n=[];return e.forEach(((r,o)=>{n.push(t.call(this,r,o))})),this.waitFor(n)}static mapArray(e,t){return new j(((n,r)=>{const o=e.length,a=new Array(o);let u=0;for(let d=0;d<o;d++){const m=d;t(e[m]).next((f=>{a[m]=f,++u,u===o&&n(a)}),(f=>r(f)))}}))}static doWhile(e,t){return new j(((n,r)=>{const o=()=>{e()===!0?t().next((()=>{o()}),r):n()};o()}))}}function lm(s){const e=s.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Nn(s){return s.name==="IndexedDbTransactionError"}class _r{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>t.writeSequenceNumber(n))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}_r.ce=-1;const Ki=-1;function vr(s){return s==null}function ir(s){return s===0&&1/s==-1/0}function cm(s){return typeof s=="number"&&Number.isInteger(s)&&!ir(s)&&s<=Number.MAX_SAFE_INTEGER&&s>=Number.MIN_SAFE_INTEGER}const tc="";function um(s){let e="";for(let t=0;t<s.length;t++)e.length>0&&(e=ja(e)),e=hm(s.get(t),e);return ja(e)}function hm(s,e){let t=e;const n=s.length;for(let r=0;r<n;r++){const o=s.charAt(r);switch(o){case"\0":t+="";break;case tc:t+="";break;default:t+=o}}return t}function ja(s){return s+tc+""}function Fa(s){let e=0;for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e++;return e}function Jt(s,e){for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&e(t,s[t])}function nc(s){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e))return!1;return!0}class de{constructor(e,t){this.comparator=e,this.root=t||Re.EMPTY}insert(e,t){return new de(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Re.BLACK,null,null))}remove(e){return new de(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Re.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new zs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new zs(this.root,e,this.comparator,!1)}getReverseIterator(){return new zs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new zs(this.root,e,this.comparator,!0)}}class zs{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?n(e.key,t):1,t&&r&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Re{constructor(e,t,n,r,o){this.key=e,this.value=t,this.color=n??Re.RED,this.left=r??Re.EMPTY,this.right=o??Re.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,o){return new Re(e??this.key,t??this.value,n??this.color,r??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const o=n(e,r.key);return r=o<0?r.copy(null,null,null,r.left.insert(e,t,n),null):o===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Re.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Re.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Re.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Re.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Q(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Q(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Q(27949);return e+(this.isRed()?0:1)}}Re.EMPTY=null,Re.RED=!0,Re.BLACK=!1;Re.EMPTY=new class{constructor(){this.size=0}get key(){throw Q(57766)}get value(){throw Q(16141)}get color(){throw Q(16727)}get left(){throw Q(29726)}get right(){throw Q(36894)}copy(e,t,n,r,o){return this}insert(e,t,n){return new Re(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Te{constructor(e){this.comparator=e,this.data=new de(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Oa(this.data.getIterator())}getIteratorFrom(e){return new Oa(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((n=>{t=t.add(n)})),t}isEqual(e){if(!(e instanceof Te)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,o=n.getNext().key;if(this.comparator(r,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Te(this.comparator);return t.data=e,t}}class Oa{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ke{constructor(e){this.fields=e,e.sort(Pe.comparator)}static empty(){return new Ke([])}unionWith(e){let t=new Te(Pe.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Ke(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return _n(this.fields,e.fields,((t,n)=>t.isEqual(n)))}}class sc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ke{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(r){try{return atob(r)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new sc("Invalid base64 string: "+o):o}})(e);return new ke(t)}static fromUint8Array(e){const t=(function(r){let o="";for(let a=0;a<r.length;++a)o+=String.fromCharCode(r[a]);return o})(e);return new ke(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ee(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ke.EMPTY_BYTE_STRING=new ke("");const dm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pt(s){if(oe(!!s,39018),typeof s=="string"){let e=0;const t=dm.exec(s);if(oe(!!t,46558,{timestamp:s}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const n=new Date(s);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:pe(s.seconds),nanos:pe(s.nanos)}}function pe(s){return typeof s=="number"?s:typeof s=="string"?Number(s):0}function kt(s){return typeof s=="string"?ke.fromBase64String(s):ke.fromUint8Array(s)}const rc="server_timestamp",ic="__type__",oc="__previous_value__",ac="__local_write_time__";function Gi(s){return(s?.mapValue?.fields||{})[ic]?.stringValue===rc}function br(s){const e=s.mapValue.fields[oc];return Gi(e)?br(e):e}function ps(s){const e=Pt(s.mapValue.fields[ac].timestampValue);return new ue(e.seconds,e.nanos)}class mm{constructor(e,t,n,r,o,a,u,d,m,f,E){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=d,this.useFetchStreams=m,this.isUsingEmulator=f,this.apiKey=E}}const or="(default)";class fs{constructor(e,t){this.projectId=e,this.database=t||or}static empty(){return new fs("","")}get isDefaultDatabase(){return this.database===or}isEqual(e){return e instanceof fs&&e.projectId===this.projectId&&e.database===this.database}}function pm(s,e){if(!Object.prototype.hasOwnProperty.apply(s.options,["projectId"]))throw new H(L.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new fs(s.options.projectId,e)}const lc="__type__",fm="__max__",Hs={mapValue:{}},cc="__vector__",ar="value";function Dt(s){return"nullValue"in s?0:"booleanValue"in s?1:"integerValue"in s||"doubleValue"in s?2:"timestampValue"in s?3:"stringValue"in s?5:"bytesValue"in s?6:"referenceValue"in s?7:"geoPointValue"in s?8:"arrayValue"in s?9:"mapValue"in s?Gi(s)?4:ym(s)?9007199254740991:gm(s)?10:11:Q(28295,{value:s})}function st(s,e){if(s===e)return!0;const t=Dt(s);if(t!==Dt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return s.booleanValue===e.booleanValue;case 4:return ps(s).isEqual(ps(e));case 3:return(function(r,o){if(typeof r.timestampValue=="string"&&typeof o.timestampValue=="string"&&r.timestampValue.length===o.timestampValue.length)return r.timestampValue===o.timestampValue;const a=Pt(r.timestampValue),u=Pt(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(s,e);case 5:return s.stringValue===e.stringValue;case 6:return(function(r,o){return kt(r.bytesValue).isEqual(kt(o.bytesValue))})(s,e);case 7:return s.referenceValue===e.referenceValue;case 8:return(function(r,o){return pe(r.geoPointValue.latitude)===pe(o.geoPointValue.latitude)&&pe(r.geoPointValue.longitude)===pe(o.geoPointValue.longitude)})(s,e);case 2:return(function(r,o){if("integerValue"in r&&"integerValue"in o)return pe(r.integerValue)===pe(o.integerValue);if("doubleValue"in r&&"doubleValue"in o){const a=pe(r.doubleValue),u=pe(o.doubleValue);return a===u?ir(a)===ir(u):isNaN(a)&&isNaN(u)}return!1})(s,e);case 9:return _n(s.arrayValue.values||[],e.arrayValue.values||[],st);case 10:case 11:return(function(r,o){const a=r.mapValue.fields||{},u=o.mapValue.fields||{};if(Fa(a)!==Fa(u))return!1;for(const d in a)if(a.hasOwnProperty(d)&&(u[d]===void 0||!st(a[d],u[d])))return!1;return!0})(s,e);default:return Q(52216,{left:s})}}function gs(s,e){return(s.values||[]).find((t=>st(t,e)))!==void 0}function bn(s,e){if(s===e)return 0;const t=Dt(s),n=Dt(e);if(t!==n)return ee(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return ee(s.booleanValue,e.booleanValue);case 2:return(function(o,a){const u=pe(o.integerValue||o.doubleValue),d=pe(a.integerValue||a.doubleValue);return u<d?-1:u>d?1:u===d?0:isNaN(u)?isNaN(d)?0:-1:1})(s,e);case 3:return La(s.timestampValue,e.timestampValue);case 4:return La(ps(s),ps(e));case 5:return wi(s.stringValue,e.stringValue);case 6:return(function(o,a){const u=kt(o),d=kt(a);return u.compareTo(d)})(s.bytesValue,e.bytesValue);case 7:return(function(o,a){const u=o.split("/"),d=a.split("/");for(let m=0;m<u.length&&m<d.length;m++){const f=ee(u[m],d[m]);if(f!==0)return f}return ee(u.length,d.length)})(s.referenceValue,e.referenceValue);case 8:return(function(o,a){const u=ee(pe(o.latitude),pe(a.latitude));return u!==0?u:ee(pe(o.longitude),pe(a.longitude))})(s.geoPointValue,e.geoPointValue);case 9:return Ma(s.arrayValue,e.arrayValue);case 10:return(function(o,a){const u=o.fields||{},d=a.fields||{},m=u[ar]?.arrayValue,f=d[ar]?.arrayValue,E=ee(m?.values?.length||0,f?.values?.length||0);return E!==0?E:Ma(m,f)})(s.mapValue,e.mapValue);case 11:return(function(o,a){if(o===Hs.mapValue&&a===Hs.mapValue)return 0;if(o===Hs.mapValue)return 1;if(a===Hs.mapValue)return-1;const u=o.fields||{},d=Object.keys(u),m=a.fields||{},f=Object.keys(m);d.sort(),f.sort();for(let E=0;E<d.length&&E<f.length;++E){const w=wi(d[E],f[E]);if(w!==0)return w;const C=bn(u[d[E]],m[f[E]]);if(C!==0)return C}return ee(d.length,f.length)})(s.mapValue,e.mapValue);default:throw Q(23264,{he:t})}}function La(s,e){if(typeof s=="string"&&typeof e=="string"&&s.length===e.length)return ee(s,e);const t=Pt(s),n=Pt(e),r=ee(t.seconds,n.seconds);return r!==0?r:ee(t.nanos,n.nanos)}function Ma(s,e){const t=s.values||[],n=e.values||[];for(let r=0;r<t.length&&r<n.length;++r){const o=bn(t[r],n[r]);if(o)return o}return ee(t.length,n.length)}function En(s){return Ii(s)}function Ii(s){return"nullValue"in s?"null":"booleanValue"in s?""+s.booleanValue:"integerValue"in s?""+s.integerValue:"doubleValue"in s?""+s.doubleValue:"timestampValue"in s?(function(t){const n=Pt(t);return`time(${n.seconds},${n.nanos})`})(s.timestampValue):"stringValue"in s?s.stringValue:"bytesValue"in s?(function(t){return kt(t).toBase64()})(s.bytesValue):"referenceValue"in s?(function(t){return W.fromName(t).toString()})(s.referenceValue):"geoPointValue"in s?(function(t){return`geo(${t.latitude},${t.longitude})`})(s.geoPointValue):"arrayValue"in s?(function(t){let n="[",r=!0;for(const o of t.values||[])r?r=!1:n+=",",n+=Ii(o);return n+"]"})(s.arrayValue):"mapValue"in s?(function(t){const n=Object.keys(t.fields||{}).sort();let r="{",o=!0;for(const a of n)o?o=!1:r+=",",r+=`${a}:${Ii(t.fields[a])}`;return r+"}"})(s.mapValue):Q(61005,{value:s})}function Js(s){switch(Dt(s)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=br(s);return e?16+Js(e):16;case 5:return 2*s.stringValue.length;case 6:return kt(s.bytesValue).approximateByteSize();case 7:return s.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce(((r,o)=>r+Js(o)),0)})(s.arrayValue);case 10:case 11:return(function(n){let r=0;return Jt(n.fields,((o,a)=>{r+=o.length+Js(a)})),r})(s.mapValue);default:throw Q(13486,{value:s})}}function Ai(s){return!!s&&"integerValue"in s}function Qi(s){return!!s&&"arrayValue"in s}function $a(s){return!!s&&"nullValue"in s}function Ba(s){return!!s&&"doubleValue"in s&&isNaN(Number(s.doubleValue))}function Ys(s){return!!s&&"mapValue"in s}function gm(s){return(s?.mapValue?.fields||{})[lc]?.stringValue===cc}function rs(s){if(s.geoPointValue)return{geoPointValue:{...s.geoPointValue}};if(s.timestampValue&&typeof s.timestampValue=="object")return{timestampValue:{...s.timestampValue}};if(s.mapValue){const e={mapValue:{fields:{}}};return Jt(s.mapValue.fields,((t,n)=>e.mapValue.fields[t]=rs(n))),e}if(s.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(s.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=rs(s.arrayValue.values[t]);return e}return{...s}}function ym(s){return(((s.mapValue||{}).fields||{}).__type__||{}).stringValue===fm}class ze{constructor(e){this.value=e}static empty(){return new ze({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Ys(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=rs(t)}setAll(e){let t=Pe.emptyPath(),n={},r=[];e.forEach(((a,u)=>{if(!t.isImmediateParentOf(u)){const d=this.getFieldsMap(t);this.applyChanges(d,n,r),n={},r=[],t=u.popLast()}a?n[u.lastSegment()]=rs(a):r.push(u.lastSegment())}));const o=this.getFieldsMap(t);this.applyChanges(o,n,r)}delete(e){const t=this.field(e.popLast());Ys(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return st(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Ys(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Jt(t,((r,o)=>e[r]=o));for(const r of n)delete e[r]}clone(){return new ze(rs(this.value))}}function uc(s){const e=[];return Jt(s.fields,((t,n)=>{const r=new Pe([t]);if(Ys(n)){const o=uc(n.mapValue).fields;if(o.length===0)e.push(r);else for(const a of o)e.push(r.child(a))}else e.push(r)})),new Ke(e)}class je{constructor(e,t,n,r,o,a,u){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new je(e,0,Y.min(),Y.min(),Y.min(),ze.empty(),0)}static newFoundDocument(e,t,n,r){return new je(e,1,t,Y.min(),n,r,0)}static newNoDocument(e,t){return new je(e,2,t,Y.min(),Y.min(),ze.empty(),0)}static newUnknownDocument(e,t){return new je(e,3,t,Y.min(),Y.min(),ze.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Y.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ze.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ze.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Y.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof je&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new je(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class lr{constructor(e,t){this.position=e,this.inclusive=t}}function Ua(s,e,t){let n=0;for(let r=0;r<s.position.length;r++){const o=e[r],a=s.position[r];if(o.field.isKeyField()?n=W.comparator(W.fromName(a.referenceValue),t.key):n=bn(a,t.data.field(o.field)),o.dir==="desc"&&(n*=-1),n!==0)break}return n}function qa(s,e){if(s===null)return e===null;if(e===null||s.inclusive!==e.inclusive||s.position.length!==e.position.length)return!1;for(let t=0;t<s.position.length;t++)if(!st(s.position[t],e.position[t]))return!1;return!0}class cr{constructor(e,t="asc"){this.field=e,this.dir=t}}function _m(s,e){return s.dir===e.dir&&s.field.isEqual(e.field)}class hc{}class Ee extends hc{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new bm(e,t,n):t==="array-contains"?new wm(e,n):t==="in"?new Im(e,n):t==="not-in"?new Am(e,n):t==="array-contains-any"?new xm(e,n):new Ee(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new Em(e,n):new Tm(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(bn(t,this.value)):t!==null&&Dt(this.value)===Dt(t)&&this.matchesComparison(bn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Q(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class rt extends hc{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new rt(e,t)}matches(e){return dc(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function dc(s){return s.op==="and"}function mc(s){return vm(s)&&dc(s)}function vm(s){for(const e of s.filters)if(e instanceof rt)return!1;return!0}function xi(s){if(s instanceof Ee)return s.field.canonicalString()+s.op.toString()+En(s.value);if(mc(s))return s.filters.map((e=>xi(e))).join(",");{const e=s.filters.map((t=>xi(t))).join(",");return`${s.op}(${e})`}}function pc(s,e){return s instanceof Ee?(function(n,r){return r instanceof Ee&&n.op===r.op&&n.field.isEqual(r.field)&&st(n.value,r.value)})(s,e):s instanceof rt?(function(n,r){return r instanceof rt&&n.op===r.op&&n.filters.length===r.filters.length?n.filters.reduce(((o,a,u)=>o&&pc(a,r.filters[u])),!0):!1})(s,e):void Q(19439)}function fc(s){return s instanceof Ee?(function(t){return`${t.field.canonicalString()} ${t.op} ${En(t.value)}`})(s):s instanceof rt?(function(t){return t.op.toString()+" {"+t.getFilters().map(fc).join(" ,")+"}"})(s):"Filter"}class bm extends Ee{constructor(e,t,n){super(e,t,n),this.key=W.fromName(n.referenceValue)}matches(e){const t=W.comparator(e.key,this.key);return this.matchesComparison(t)}}class Em extends Ee{constructor(e,t){super(e,"in",t),this.keys=gc("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Tm extends Ee{constructor(e,t){super(e,"not-in",t),this.keys=gc("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function gc(s,e){return(e.arrayValue?.values||[]).map((t=>W.fromName(t.referenceValue)))}class wm extends Ee{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Qi(t)&&gs(t.arrayValue,this.value)}}class Im extends Ee{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&gs(this.value.arrayValue,t)}}class Am extends Ee{constructor(e,t){super(e,"not-in",t)}matches(e){if(gs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!gs(this.value.arrayValue,t)}}class xm extends Ee{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Qi(t)||!t.arrayValue.values)&&t.arrayValue.values.some((n=>gs(this.value.arrayValue,n)))}}class Sm{constructor(e,t=null,n=[],r=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}}function za(s,e=null,t=[],n=[],r=null,o=null,a=null){return new Sm(s,e,t,n,r,o,a)}function Ji(s){const e=X(s);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((n=>xi(n))).join(","),t+="|ob:",t+=e.orderBy.map((n=>(function(o){return o.field.canonicalString()+o.dir})(n))).join(","),vr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((n=>En(n))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((n=>En(n))).join(",")),e.Te=t}return e.Te}function Yi(s,e){if(s.limit!==e.limit||s.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<s.orderBy.length;t++)if(!_m(s.orderBy[t],e.orderBy[t]))return!1;if(s.filters.length!==e.filters.length)return!1;for(let t=0;t<s.filters.length;t++)if(!pc(s.filters[t],e.filters[t]))return!1;return s.collectionGroup===e.collectionGroup&&!!s.path.isEqual(e.path)&&!!qa(s.startAt,e.startAt)&&qa(s.endAt,e.endAt)}function Si(s){return W.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}class Er{constructor(e,t=null,n=[],r=[],o=null,a="F",u=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=d,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function Cm(s,e,t,n,r,o,a,u){return new Er(s,e,t,n,r,o,a,u)}function yc(s){return new Er(s)}function Ha(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}function Nm(s){return W.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}function Rm(s){return s.collectionGroup!==null}function is(s){const e=X(s);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new Te(Pe.comparator);return a.filters.forEach((d=>{d.getFlattenedFilters().forEach((m=>{m.isInequality()&&(u=u.add(m.field))}))})),u})(e).forEach((o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new cr(o,n))})),t.has(Pe.keyField().canonicalString())||e.Ie.push(new cr(Pe.keyField(),n))}return e.Ie}function Ze(s){const e=X(s);return e.Ee||(e.Ee=Pm(e,is(s))),e.Ee}function Pm(s,e){if(s.limitType==="F")return za(s.path,s.collectionGroup,e,s.filters,s.limit,s.startAt,s.endAt);{e=e.map((r=>{const o=r.dir==="desc"?"asc":"desc";return new cr(r.field,o)}));const t=s.endAt?new lr(s.endAt.position,s.endAt.inclusive):null,n=s.startAt?new lr(s.startAt.position,s.startAt.inclusive):null;return za(s.path,s.collectionGroup,e,s.filters,s.limit,t,n)}}function Ci(s,e,t){return new Er(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),e,t,s.startAt,s.endAt)}function Tr(s,e){return Yi(Ze(s),Ze(e))&&s.limitType===e.limitType}function _c(s){return`${Ji(Ze(s))}|lt:${s.limitType}`}function cn(s){return`Query(target=${(function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map((r=>fc(r))).join(", ")}]`),vr(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map((r=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(r))).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((r=>En(r))).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((r=>En(r))).join(",")),`Target(${n})`})(Ze(s))}; limitType=${s.limitType})`}function wr(s,e){return e.isFoundDocument()&&(function(n,r){const o=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(o):W.isDocumentKey(n.path)?n.path.isEqual(o):n.path.isImmediateParentOf(o)})(s,e)&&(function(n,r){for(const o of is(n))if(!o.field.isKeyField()&&r.data.field(o.field)===null)return!1;return!0})(s,e)&&(function(n,r){for(const o of n.filters)if(!o.matches(r))return!1;return!0})(s,e)&&(function(n,r){return!(n.startAt&&!(function(a,u,d){const m=Ua(a,u,d);return a.inclusive?m<=0:m<0})(n.startAt,is(n),r)||n.endAt&&!(function(a,u,d){const m=Ua(a,u,d);return a.inclusive?m>=0:m>0})(n.endAt,is(n),r))})(s,e)}function km(s){return s.collectionGroup||(s.path.length%2==1?s.path.lastSegment():s.path.get(s.path.length-2))}function vc(s){return(e,t)=>{let n=!1;for(const r of is(s)){const o=Dm(r,e,t);if(o!==0)return o;n=n||r.field.isKeyField()}return 0}}function Dm(s,e,t){const n=s.field.isKeyField()?W.comparator(e.key,t.key):(function(o,a,u){const d=a.data.field(o),m=u.data.field(o);return d!==null&&m!==null?bn(d,m):Q(42886)})(s.field,e,t);switch(s.dir){case"asc":return n;case"desc":return-1*n;default:return Q(19790,{direction:s.dir})}}class Yt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[r,o]of n)if(this.equalsFn(r,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let o=0;o<r.length;o++)if(this.equalsFn(r[o][0],e))return void(r[o]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return n.length===1?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Jt(this.inner,((t,n)=>{for(const[r,o]of n)e(r,o)}))}isEmpty(){return nc(this.inner)}size(){return this.innerSize}}const Vm=new de(W.comparator);function ut(){return Vm}const bc=new de(W.comparator);function es(...s){let e=bc;for(const t of s)e=e.insert(t.key,t);return e}function Ec(s){let e=bc;return s.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Wt(){return os()}function Tc(){return os()}function os(){return new Yt((s=>s.toString()),((s,e)=>s.isEqual(e)))}const jm=new de(W.comparator),Fm=new Te(W.comparator);function te(...s){let e=Fm;for(const t of s)e=e.add(t);return e}const Om=new Te(ee);function Lm(){return Om}function Xi(s,e){if(s.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ir(e)?"-0":e}}function wc(s){return{integerValue:""+s}}function Mm(s,e){return cm(e)?wc(e):Xi(s,e)}class Ir{constructor(){this._=void 0}}function $m(s,e,t){return s instanceof ur?(function(r,o){const a={fields:{[ic]:{stringValue:rc},[ac]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return o&&Gi(o)&&(o=br(o)),o&&(a.fields[oc]=o),{mapValue:a}})(t,e):s instanceof ys?Ac(s,e):s instanceof _s?xc(s,e):(function(r,o){const a=Ic(r,o),u=Wa(a)+Wa(r.Ae);return Ai(a)&&Ai(r.Ae)?wc(u):Xi(r.serializer,u)})(s,e)}function Bm(s,e,t){return s instanceof ys?Ac(s,e):s instanceof _s?xc(s,e):t}function Ic(s,e){return s instanceof hr?(function(n){return Ai(n)||(function(o){return!!o&&"doubleValue"in o})(n)})(e)?e:{integerValue:0}:null}class ur extends Ir{}class ys extends Ir{constructor(e){super(),this.elements=e}}function Ac(s,e){const t=Sc(e);for(const n of s.elements)t.some((r=>st(r,n)))||t.push(n);return{arrayValue:{values:t}}}class _s extends Ir{constructor(e){super(),this.elements=e}}function xc(s,e){let t=Sc(e);for(const n of s.elements)t=t.filter((r=>!st(r,n)));return{arrayValue:{values:t}}}class hr extends Ir{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Wa(s){return pe(s.integerValue||s.doubleValue)}function Sc(s){return Qi(s)&&s.arrayValue.values?s.arrayValue.values.slice():[]}function Um(s,e){return s.field.isEqual(e.field)&&(function(n,r){return n instanceof ys&&r instanceof ys||n instanceof _s&&r instanceof _s?_n(n.elements,r.elements,st):n instanceof hr&&r instanceof hr?st(n.Ae,r.Ae):n instanceof ur&&r instanceof ur})(s.transform,e.transform)}class qm{constructor(e,t){this.version=e,this.transformResults=t}}class et{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new et}static exists(e){return new et(void 0,e)}static updateTime(e){return new et(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Xs(s,e){return s.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(s.updateTime):s.exists===void 0||s.exists===e.isFoundDocument()}class Ar{}function Cc(s,e){if(!s.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return s.isNoDocument()?new Zi(s.key,et.none()):new Es(s.key,s.data,et.none());{const t=s.data,n=ze.empty();let r=new Te(Pe.comparator);for(let o of e.fields)if(!r.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?n.delete(o):n.set(o,a),r=r.add(o)}return new Xt(s.key,n,new Ke(r.toArray()),et.none())}}function zm(s,e,t){s instanceof Es?(function(r,o,a){const u=r.value.clone(),d=Ga(r.fieldTransforms,o,a.transformResults);u.setAll(d),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(s,e,t):s instanceof Xt?(function(r,o,a){if(!Xs(r.precondition,o))return void o.convertToUnknownDocument(a.version);const u=Ga(r.fieldTransforms,o,a.transformResults),d=o.data;d.setAll(Nc(r)),d.setAll(u),o.convertToFoundDocument(a.version,d).setHasCommittedMutations()})(s,e,t):(function(r,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function as(s,e,t,n){return s instanceof Es?(function(o,a,u,d){if(!Xs(o.precondition,a))return u;const m=o.value.clone(),f=Qa(o.fieldTransforms,d,a);return m.setAll(f),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),null})(s,e,t,n):s instanceof Xt?(function(o,a,u,d){if(!Xs(o.precondition,a))return u;const m=Qa(o.fieldTransforms,d,a),f=a.data;return f.setAll(Nc(o)),f.setAll(m),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((E=>E.field)))})(s,e,t,n):(function(o,a,u){return Xs(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(s,e,t)}function Hm(s,e){let t=null;for(const n of s.fieldTransforms){const r=e.data.field(n.field),o=Ic(n.transform,r||null);o!=null&&(t===null&&(t=ze.empty()),t.set(n.field,o))}return t||null}function Ka(s,e){return s.type===e.type&&!!s.key.isEqual(e.key)&&!!s.precondition.isEqual(e.precondition)&&!!(function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&_n(n,r,((o,a)=>Um(o,a)))})(s.fieldTransforms,e.fieldTransforms)&&(s.type===0?s.value.isEqual(e.value):s.type!==1||s.data.isEqual(e.data)&&s.fieldMask.isEqual(e.fieldMask))}class Es extends Ar{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Xt extends Ar{constructor(e,t,n,r,o=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function Nc(s){const e=new Map;return s.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const n=s.data.field(t);e.set(t,n)}})),e}function Ga(s,e,t){const n=new Map;oe(s.length===t.length,32656,{Ve:t.length,de:s.length});for(let r=0;r<t.length;r++){const o=s[r],a=o.transform,u=e.data.field(o.field);n.set(o.field,Bm(a,u,t[r]))}return n}function Qa(s,e,t){const n=new Map;for(const r of s){const o=r.transform,a=t.data.field(r.field);n.set(r.field,$m(o,a,e))}return n}class Zi extends Ar{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Wm extends Ar{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Km{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const o=this.mutations[r];o.key.isEqual(e.key)&&zm(o,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=as(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=as(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Tc();return this.mutations.forEach((r=>{const o=e.get(r.key),a=o.overlayedDocument;let u=this.applyToLocalView(a,o.mutatedFields);u=t.has(r.key)?null:u;const d=Cc(a,u);d!==null&&n.set(r.key,d),a.isValidDocument()||a.convertToNoDocument(Y.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),te())}isEqual(e){return this.batchId===e.batchId&&_n(this.mutations,e.mutations,((t,n)=>Ka(t,n)))&&_n(this.baseMutations,e.baseMutations,((t,n)=>Ka(t,n)))}}class eo{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){oe(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=(function(){return jm})();const o=e.mutations;for(let a=0;a<o.length;a++)r=r.insert(o[a].key,n[a].version);return new eo(e,t,n,r)}}class Gm{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Qm{constructor(e,t){this.count=e,this.unchangedNames=t}}var ge,ne;function Jm(s){switch(s){case L.OK:return Q(64938);case L.CANCELLED:case L.UNKNOWN:case L.DEADLINE_EXCEEDED:case L.RESOURCE_EXHAUSTED:case L.INTERNAL:case L.UNAVAILABLE:case L.UNAUTHENTICATED:return!1;case L.INVALID_ARGUMENT:case L.NOT_FOUND:case L.ALREADY_EXISTS:case L.PERMISSION_DENIED:case L.FAILED_PRECONDITION:case L.ABORTED:case L.OUT_OF_RANGE:case L.UNIMPLEMENTED:case L.DATA_LOSS:return!0;default:return Q(15467,{code:s})}}function Rc(s){if(s===void 0)return ct("GRPC error has no .code"),L.UNKNOWN;switch(s){case ge.OK:return L.OK;case ge.CANCELLED:return L.CANCELLED;case ge.UNKNOWN:return L.UNKNOWN;case ge.DEADLINE_EXCEEDED:return L.DEADLINE_EXCEEDED;case ge.RESOURCE_EXHAUSTED:return L.RESOURCE_EXHAUSTED;case ge.INTERNAL:return L.INTERNAL;case ge.UNAVAILABLE:return L.UNAVAILABLE;case ge.UNAUTHENTICATED:return L.UNAUTHENTICATED;case ge.INVALID_ARGUMENT:return L.INVALID_ARGUMENT;case ge.NOT_FOUND:return L.NOT_FOUND;case ge.ALREADY_EXISTS:return L.ALREADY_EXISTS;case ge.PERMISSION_DENIED:return L.PERMISSION_DENIED;case ge.FAILED_PRECONDITION:return L.FAILED_PRECONDITION;case ge.ABORTED:return L.ABORTED;case ge.OUT_OF_RANGE:return L.OUT_OF_RANGE;case ge.UNIMPLEMENTED:return L.UNIMPLEMENTED;case ge.DATA_LOSS:return L.DATA_LOSS;default:return Q(39323,{code:s})}}(ne=ge||(ge={}))[ne.OK=0]="OK",ne[ne.CANCELLED=1]="CANCELLED",ne[ne.UNKNOWN=2]="UNKNOWN",ne[ne.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ne[ne.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ne[ne.NOT_FOUND=5]="NOT_FOUND",ne[ne.ALREADY_EXISTS=6]="ALREADY_EXISTS",ne[ne.PERMISSION_DENIED=7]="PERMISSION_DENIED",ne[ne.UNAUTHENTICATED=16]="UNAUTHENTICATED",ne[ne.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ne[ne.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ne[ne.ABORTED=10]="ABORTED",ne[ne.OUT_OF_RANGE=11]="OUT_OF_RANGE",ne[ne.UNIMPLEMENTED=12]="UNIMPLEMENTED",ne[ne.INTERNAL=13]="INTERNAL",ne[ne.UNAVAILABLE=14]="UNAVAILABLE",ne[ne.DATA_LOSS=15]="DATA_LOSS";function Ym(){return new TextEncoder}const Xm=new St([4294967295,4294967295],0);function Ja(s){const e=Ym().encode(s),t=new Hl;return t.update(e),new Uint8Array(t.digest())}function Ya(s){const e=new DataView(s.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),r=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new St([t,n],0),new St([r,o],0)]}class to{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new ts(`Invalid padding: ${t}`);if(n<0)throw new ts(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new ts(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new ts(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=St.fromNumber(this.ge)}ye(e,t,n){let r=e.add(t.multiply(St.fromNumber(n)));return r.compare(Xm)===1&&(r=new St([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=Ja(e),[n,r]=Ya(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(n,r,o);if(!this.we(a))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new to(o,r,t);return n.forEach((u=>a.insert(u))),a}insert(e){if(this.ge===0)return;const t=Ja(e),[n,r]=Ya(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(n,r,o);this.be(a)}}be(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class ts extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class xr{constructor(e,t,n,r,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Ts.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new xr(Y.min(),r,new de(ee),ut(),te())}}class Ts{constructor(e,t,n,r,o){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Ts(n,t,te(),te(),te())}}class Zs{constructor(e,t,n,r){this.Se=e,this.removedTargetIds=t,this.key=n,this.De=r}}class Pc{constructor(e,t){this.targetId=e,this.Ce=t}}class kc{constructor(e,t,n=ke.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Xa{constructor(){this.ve=0,this.Fe=Za(),this.Me=ke.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=te(),t=te(),n=te();return this.Fe.forEach(((r,o)=>{switch(o){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Q(38017,{changeType:o})}})),new Ts(this.Me,this.xe,e,t,n)}Ke(){this.Oe=!1,this.Fe=Za()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,oe(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class Zm{constructor(e){this.Ge=e,this.ze=new Map,this.je=ut(),this.He=Ws(),this.Je=Ws(),this.Ze=new de(ee)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.We(),n.Ne||n.Ke(),n.Le(e.resumeToken);break;case 2:n.We(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.Qe(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:Q(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((n,r)=>{this.rt(r)&&t(r)}))}st(e){const t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){const o=r.target;if(Si(o))if(n===0){const a=new W(o.path);this.et(t,a,je.newNoDocument(a,Y.min()))}else oe(n===1,20013,{expectedCount:n});else{const a=this._t(t);if(a!==n){const u=this.ut(e),d=u?this.ct(u,e,a):1;if(d!==0){this.it(t);const m=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,m)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:o=0}=t;let a,u;try{a=kt(n).toUint8Array()}catch(d){if(d instanceof sc)return Gt("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{u=new to(a,r,o)}catch(d){return Gt(d instanceof ts?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return u.ge===0?null:u}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let r=0;return n.forEach((o=>{const a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(t,o,null),r++)})),r}Tt(e){const t=new Map;this.ze.forEach(((o,a)=>{const u=this.ot(a);if(u){if(o.current&&Si(u.target)){const d=new W(u.target.path);this.It(d).has(a)||this.Et(a,d)||this.et(a,d,je.newNoDocument(d,e))}o.Be&&(t.set(a,o.ke()),o.Ke())}}));let n=te();this.Je.forEach(((o,a)=>{let u=!0;a.forEachWhile((d=>{const m=this.ot(d);return!m||m.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(n=n.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(e)));const r=new xr(e,t,this.Ze,this.je,n);return this.je=ut(),this.He=Ws(),this.Je=Ws(),this.Ze=new de(ee),r}Ye(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,n),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.qe(t,1):r.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new Xa,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new Te(ee),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new Te(ee),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||z("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Xa),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Ws(){return new de(W.comparator)}function Za(){return new de(W.comparator)}const ep={asc:"ASCENDING",desc:"DESCENDING"},tp={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},np={and:"AND",or:"OR"};class sp{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ni(s,e){return s.useProto3Json||vr(e)?e:{value:e}}function dr(s,e){return s.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Dc(s,e){return s.useProto3Json?e.toBase64():e.toUint8Array()}function rp(s,e){return dr(s,e.toTimestamp())}function tt(s){return oe(!!s,49232),Y.fromTimestamp((function(t){const n=Pt(t);return new ue(n.seconds,n.nanos)})(s))}function no(s,e){return Ri(s,e).canonicalString()}function Ri(s,e){const t=(function(r){return new ce(["projects",r.projectId,"databases",r.database])})(s).child("documents");return e===void 0?t:t.child(e)}function Vc(s){const e=ce.fromString(s);return oe(Mc(e),10190,{key:e.toString()}),e}function Pi(s,e){return no(s.databaseId,e.path)}function li(s,e){const t=Vc(e);if(t.get(1)!==s.databaseId.projectId)throw new H(L.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+s.databaseId.projectId);if(t.get(3)!==s.databaseId.database)throw new H(L.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+s.databaseId.database);return new W(Fc(t))}function jc(s,e){return no(s.databaseId,e)}function ip(s){const e=Vc(s);return e.length===4?ce.emptyPath():Fc(e)}function ki(s){return new ce(["projects",s.databaseId.projectId,"databases",s.databaseId.database]).canonicalString()}function Fc(s){return oe(s.length>4&&s.get(4)==="documents",29091,{key:s.toString()}),s.popFirst(5)}function el(s,e,t){return{name:Pi(s,e),fields:t.value.mapValue.fields}}function op(s,e){let t;if("targetChange"in e){e.targetChange;const n=(function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:Q(39313,{state:m})})(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],o=(function(m,f){return m.useProto3Json?(oe(f===void 0||typeof f=="string",58123),ke.fromBase64String(f||"")):(oe(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),ke.fromUint8Array(f||new Uint8Array))})(s,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&(function(m){const f=m.code===void 0?L.UNKNOWN:Rc(m.code);return new H(f,m.message||"")})(a);t=new kc(n,r,o,u||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const r=li(s,n.document.name),o=tt(n.document.updateTime),a=n.document.createTime?tt(n.document.createTime):Y.min(),u=new ze({mapValue:{fields:n.document.fields}}),d=je.newFoundDocument(r,o,a,u),m=n.targetIds||[],f=n.removedTargetIds||[];t=new Zs(m,f,d.key,d)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const r=li(s,n.document),o=n.readTime?tt(n.readTime):Y.min(),a=je.newNoDocument(r,o),u=n.removedTargetIds||[];t=new Zs([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const r=li(s,n.document),o=n.removedTargetIds||[];t=new Zs([],o,r,null)}else{if(!("filter"in e))return Q(11601,{Vt:e});{e.filter;const n=e.filter;n.targetId;const{count:r=0,unchangedNames:o}=n,a=new Qm(r,o),u=n.targetId;t=new Pc(u,a)}}return t}function ap(s,e){let t;if(e instanceof Es)t={update:el(s,e.key,e.value)};else if(e instanceof Zi)t={delete:Pi(s,e.key)};else if(e instanceof Xt)t={update:el(s,e.key,e.data),updateMask:gp(e.fieldMask)};else{if(!(e instanceof Wm))return Q(16599,{dt:e.type});t={verify:Pi(s,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((n=>(function(o,a){const u=a.transform;if(u instanceof ur)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ys)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof _s)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof hr)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw Q(20930,{transform:a.transform})})(0,n)))),e.precondition.isNone||(t.currentDocument=(function(r,o){return o.updateTime!==void 0?{updateTime:rp(r,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Q(27497)})(s,e.precondition)),t}function lp(s,e){return s&&s.length>0?(oe(e!==void 0,14353),s.map((t=>(function(r,o){let a=r.updateTime?tt(r.updateTime):tt(o);return a.isEqual(Y.min())&&(a=tt(o)),new qm(a,r.transformResults||[])})(t,e)))):[]}function cp(s,e){return{documents:[jc(s,e.path)]}}function up(s,e){const t={structuredQuery:{}},n=e.path;let r;e.collectionGroup!==null?(r=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=jc(s,r);const o=(function(m){if(m.length!==0)return Lc(rt.create(m,"and"))})(e.filters);o&&(t.structuredQuery.where=o);const a=(function(m){if(m.length!==0)return m.map((f=>(function(w){return{field:un(w.field),direction:mp(w.dir)}})(f)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=Ni(s,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(m){return{before:m.inclusive,values:m.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(m){return{before:!m.inclusive,values:m.position}})(e.endAt)),{ft:t,parent:r}}function hp(s){let e=ip(s.parent);const t=s.structuredQuery,n=t.from?t.from.length:0;let r=null;if(n>0){oe(n===1,65062);const f=t.from[0];f.allDescendants?r=f.collectionId:e=e.child(f.collectionId)}let o=[];t.where&&(o=(function(E){const w=Oc(E);return w instanceof rt&&mc(w)?w.getFilters():[w]})(t.where));let a=[];t.orderBy&&(a=(function(E){return E.map((w=>(function(I){return new cr(hn(I.field),(function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(I.direction))})(w)))})(t.orderBy));let u=null;t.limit&&(u=(function(E){let w;return w=typeof E=="object"?E.value:E,vr(w)?null:w})(t.limit));let d=null;t.startAt&&(d=(function(E){const w=!!E.before,C=E.values||[];return new lr(C,w)})(t.startAt));let m=null;return t.endAt&&(m=(function(E){const w=!E.before,C=E.values||[];return new lr(C,w)})(t.endAt)),Cm(e,r,a,o,u,"F",d,m)}function dp(s,e){const t=(function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Q(28987,{purpose:r})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Oc(s){return s.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=hn(t.unaryFilter.field);return Ee.create(n,"==",{doubleValue:NaN});case"IS_NULL":const r=hn(t.unaryFilter.field);return Ee.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=hn(t.unaryFilter.field);return Ee.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=hn(t.unaryFilter.field);return Ee.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Q(61313);default:return Q(60726)}})(s):s.fieldFilter!==void 0?(function(t){return Ee.create(hn(t.fieldFilter.field),(function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Q(58110);default:return Q(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(s):s.compositeFilter!==void 0?(function(t){return rt.create(t.compositeFilter.filters.map((n=>Oc(n))),(function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return Q(1026)}})(t.compositeFilter.op))})(s):Q(30097,{filter:s})}function mp(s){return ep[s]}function pp(s){return tp[s]}function fp(s){return np[s]}function un(s){return{fieldPath:s.canonicalString()}}function hn(s){return Pe.fromServerFormat(s.fieldPath)}function Lc(s){return s instanceof Ee?(function(t){if(t.op==="=="){if(Ba(t.value))return{unaryFilter:{field:un(t.field),op:"IS_NAN"}};if($a(t.value))return{unaryFilter:{field:un(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Ba(t.value))return{unaryFilter:{field:un(t.field),op:"IS_NOT_NAN"}};if($a(t.value))return{unaryFilter:{field:un(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:un(t.field),op:pp(t.op),value:t.value}}})(s):s instanceof rt?(function(t){const n=t.getFilters().map((r=>Lc(r)));return n.length===1?n[0]:{compositeFilter:{op:fp(t.op),filters:n}}})(s):Q(54877,{filter:s})}function gp(s){const e=[];return s.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Mc(s){return s.length>=4&&s.get(0)==="projects"&&s.get(2)==="databases"}function $c(s){return!!s&&typeof s._toProto=="function"&&s._protoValueType==="ProtoValue"}class wt{constructor(e,t,n,r,o=Y.min(),a=Y.min(),u=ke.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=d}withSequenceNumber(e){return new wt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new wt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new wt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new wt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class yp{constructor(e){this.yt=e}}function _p(s){const e=hp({parent:s.parent,structuredQuery:s.structuredQuery});return s.limitType==="LAST"?Ci(e,e.limit,"L"):e}class vp{constructor(){this.Sn=new bp}addToCollectionParentIndex(e,t){return this.Sn.add(t),j.resolve()}getCollectionParents(e,t){return j.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return j.resolve()}deleteFieldIndex(e,t){return j.resolve()}deleteAllFieldIndexes(e){return j.resolve()}createTargetIndexes(e,t){return j.resolve()}getDocumentsMatchingTarget(e,t){return j.resolve(null)}getIndexType(e,t){return j.resolve(0)}getFieldIndexes(e,t){return j.resolve([])}getNextCollectionGroupToUpdate(e){return j.resolve(null)}getMinOffset(e,t){return j.resolve(Rt.min())}getMinOffsetFromCollectionGroup(e,t){return j.resolve(Rt.min())}updateCollectionGroup(e,t,n){return j.resolve()}updateIndexEntries(e,t){return j.resolve()}}class bp{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Te(ce.comparator),o=!r.has(n);return this.index[t]=r.add(n),o}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Te(ce.comparator)).toArray()}}const tl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Bc=41943040;class Oe{static withCacheSize(e){return new Oe(e,Oe.DEFAULT_COLLECTION_PERCENTILE,Oe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}Oe.DEFAULT_COLLECTION_PERCENTILE=10,Oe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Oe.DEFAULT=new Oe(Bc,Oe.DEFAULT_COLLECTION_PERCENTILE,Oe.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Oe.DISABLED=new Oe(-1,0,0);class Tn{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new Tn(0)}static ar(){return new Tn(-1)}}const nl="LruGarbageCollector",Ep=1048576;function sl([s,e],[t,n]){const r=ee(s,t);return r===0?ee(e,n):r}class Tp{constructor(e){this.Pr=e,this.buffer=new Te(sl),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();sl(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class wp{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){z(nl,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Nn(t)?z(nl,"Ignoring IndexedDB error during garbage collection: ",t):await Cn(t)}await this.Ar(3e5)}))}}class Ip{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next((n=>Math.floor(t/100*n)))}nthSequenceNumber(e,t){if(t===0)return j.resolve(_r.ce);const n=new Tp(t);return this.Vr.forEachTarget(e,(r=>n.Er(r.sequenceNumber))).next((()=>this.Vr.mr(e,(r=>n.Er(r))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.Vr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(z("LruGarbageCollector","Garbage collection skipped; disabled"),j.resolve(tl)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(z("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),tl):this.gr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let n,r,o,a,u,d,m;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((E=>(E>this.params.maximumSequenceNumbersToCollect?(z("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${E}`),r=this.params.maximumSequenceNumbersToCollect):r=E,a=Date.now(),this.nthSequenceNumber(e,r)))).next((E=>(n=E,u=Date.now(),this.removeTargets(e,n,t)))).next((E=>(o=E,d=Date.now(),this.removeOrphanedDocuments(e,n)))).next((E=>(m=Date.now(),ln()<=se.DEBUG&&z("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${r} in `+(u-a)+`ms
	Removed ${o} targets in `+(d-u)+`ms
	Removed ${E} documents in `+(m-d)+`ms
Total Duration: ${m-f}ms`),j.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:o,documentsRemoved:E}))))}}function Ap(s,e){return new Ip(s,e)}class xp{constructor(){this.changes=new Yt((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,je.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?j.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Sp{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Cp{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((r=>(n!==null&&as(n.mutation,r,Ke.empty(),ue.now()),r)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.getLocalViewOfDocuments(e,n,te()).next((()=>n))))}getLocalViewOfDocuments(e,t,n=te()){const r=Wt();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((o=>{let a=es();return o.forEach(((u,d)=>{a=a.insert(u,d.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const n=Wt();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,te())))}populateOverlays(e,t,n){const r=[];return n.forEach((o=>{t.has(o)||r.push(o)})),this.documentOverlayCache.getOverlays(e,r).next((o=>{o.forEach(((a,u)=>{t.set(a,u)}))}))}computeViews(e,t,n,r){let o=ut();const a=os(),u=(function(){return os()})();return t.forEach(((d,m)=>{const f=n.get(m.key);r.has(m.key)&&(f===void 0||f.mutation instanceof Xt)?o=o.insert(m.key,m):f!==void 0?(a.set(m.key,f.mutation.getFieldMask()),as(f.mutation,m,f.mutation.getFieldMask(),ue.now())):a.set(m.key,Ke.empty())})),this.recalculateAndSaveOverlays(e,o).next((d=>(d.forEach(((m,f)=>a.set(m,f))),t.forEach(((m,f)=>u.set(m,new Sp(f,a.get(m)??null)))),u)))}recalculateAndSaveOverlays(e,t){const n=os();let r=new de(((a,u)=>a-u)),o=te();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const u of a)u.keys().forEach((d=>{const m=t.get(d);if(m===null)return;let f=n.get(d)||Ke.empty();f=u.applyToLocalView(m,f),n.set(d,f);const E=(r.get(u.batchId)||te()).add(d);r=r.insert(u.batchId,E)}))})).next((()=>{const a=[],u=r.getReverseIterator();for(;u.hasNext();){const d=u.getNext(),m=d.key,f=d.value,E=Tc();f.forEach((w=>{if(!o.has(w)){const C=Cc(t.get(w),n.get(w));C!==null&&E.set(w,C),o=o.add(w)}})),a.push(this.documentOverlayCache.saveOverlays(e,m,E))}return j.waitFor(a)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((n=>this.recalculateAndSaveOverlays(e,n)))}getDocumentsMatchingQuery(e,t,n,r){return Nm(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Rm(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((o=>{const a=r-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-o.size):j.resolve(Wt());let u=ms,d=o;return a.next((m=>j.forEach(m,((f,E)=>(u<E.largestBatchId&&(u=E.largestBatchId),o.get(f)?j.resolve():this.remoteDocumentCache.getEntry(e,f).next((w=>{d=d.insert(f,w)}))))).next((()=>this.populateOverlays(e,m,o))).next((()=>this.computeViews(e,d,m,te()))).next((f=>({batchId:u,changes:Ec(f)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new W(t)).next((n=>{let r=es();return n.isFoundDocument()&&(r=r.insert(n.key,n)),r}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const o=t.collectionGroup;let a=es();return this.indexManager.getCollectionParents(e,o).next((u=>j.forEach(u,(d=>{const m=(function(E,w){return new Er(w,null,E.explicitOrderBy.slice(),E.filters.slice(),E.limit,E.limitType,E.startAt,E.endAt)})(t,d.child(o));return this.getDocumentsMatchingCollectionQuery(e,m,n,r).next((f=>{f.forEach(((E,w)=>{a=a.insert(E,w)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,o,r)))).next((a=>{o.forEach(((d,m)=>{const f=m.getKey();a.get(f)===null&&(a=a.insert(f,je.newInvalidDocument(f)))}));let u=es();return a.forEach(((d,m)=>{const f=o.get(d);f!==void 0&&as(f.mutation,m,Ke.empty(),ue.now()),wr(t,m)&&(u=u.insert(d,m))})),u}))}}class Np{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return j.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,(function(r){return{id:r.id,version:r.version,createTime:tt(r.createTime)}})(t)),j.resolve()}getNamedQuery(e,t){return j.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,(function(r){return{name:r.name,query:_p(r.bundledQuery),readTime:tt(r.readTime)}})(t)),j.resolve()}}class Rp{constructor(){this.overlays=new de(W.comparator),this.Lr=new Map}getOverlay(e,t){return j.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Wt();return j.forEach(t,(r=>this.getOverlay(e,r).next((o=>{o!==null&&n.set(r,o)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((r,o)=>{this.bt(e,t,o)})),j.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Lr.get(n);return r!==void 0&&(r.forEach((o=>this.overlays=this.overlays.remove(o))),this.Lr.delete(n)),j.resolve()}getOverlaysForCollection(e,t,n){const r=Wt(),o=t.length+1,a=new W(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const d=u.getNext().value,m=d.getKey();if(!t.isPrefixOf(m.path))break;m.path.length===o&&d.largestBatchId>n&&r.set(d.getKey(),d)}return j.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let o=new de(((m,f)=>m-f));const a=this.overlays.getIterator();for(;a.hasNext();){const m=a.getNext().value;if(m.getKey().getCollectionGroup()===t&&m.largestBatchId>n){let f=o.get(m.largestBatchId);f===null&&(f=Wt(),o=o.insert(m.largestBatchId,f)),f.set(m.getKey(),m)}}const u=Wt(),d=o.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach(((m,f)=>u.set(m,f))),!(u.size()>=r)););return j.resolve(u)}bt(e,t,n){const r=this.overlays.get(n.key);if(r!==null){const a=this.Lr.get(r.largestBatchId).delete(n.key);this.Lr.set(r.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Gm(t,n));let o=this.Lr.get(t);o===void 0&&(o=te(),this.Lr.set(t,o)),this.Lr.set(t,o.add(n.key))}}class Pp{constructor(){this.sessionToken=ke.EMPTY_BYTE_STRING}getSessionToken(e){return j.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,j.resolve()}}class so{constructor(){this.kr=new Te(Ce.Kr),this.qr=new Te(Ce.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const n=new Ce(e,t);this.kr=this.kr.add(n),this.qr=this.qr.add(n)}$r(e,t){e.forEach((n=>this.addReference(n,t)))}removeReference(e,t){this.Wr(new Ce(e,t))}Qr(e,t){e.forEach((n=>this.removeReference(n,t)))}Gr(e){const t=new W(new ce([])),n=new Ce(t,e),r=new Ce(t,e+1),o=[];return this.qr.forEachInRange([n,r],(a=>{this.Wr(a),o.push(a.key)})),o}zr(){this.kr.forEach((e=>this.Wr(e)))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new W(new ce([])),n=new Ce(t,e),r=new Ce(t,e+1);let o=te();return this.qr.forEachInRange([n,r],(a=>{o=o.add(a.key)})),o}containsKey(e){const t=new Ce(e,0),n=this.kr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class Ce{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return W.comparator(e.key,t.key)||ee(e.Hr,t.Hr)}static Ur(e,t){return ee(e.Hr,t.Hr)||W.comparator(e.key,t.key)}}class kp{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new Te(Ce.Kr)}checkEmpty(e){return j.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,r){const o=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Km(o,t,n,r);this.mutationQueue.push(a);for(const u of r)this.Jr=this.Jr.add(new Ce(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return j.resolve(a)}lookupMutationBatch(e,t){return j.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.Xr(n),o=r<0?0:r;return j.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return j.resolve(this.mutationQueue.length===0?Ki:this.Yn-1)}getAllMutationBatches(e){return j.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Ce(t,0),r=new Ce(t,Number.POSITIVE_INFINITY),o=[];return this.Jr.forEachInRange([n,r],(a=>{const u=this.Zr(a.Hr);o.push(u)})),j.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Te(ee);return t.forEach((r=>{const o=new Ce(r,0),a=new Ce(r,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([o,a],(u=>{n=n.add(u.Hr)}))})),j.resolve(this.Yr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let o=n;W.isDocumentKey(o)||(o=o.child(""));const a=new Ce(new W(o),0);let u=new Te(ee);return this.Jr.forEachWhile((d=>{const m=d.key.path;return!!n.isPrefixOf(m)&&(m.length===r&&(u=u.add(d.Hr)),!0)}),a),j.resolve(this.Yr(u))}Yr(e){const t=[];return e.forEach((n=>{const r=this.Zr(n);r!==null&&t.push(r)})),t}removeMutationBatch(e,t){oe(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Jr;return j.forEach(t.mutations,(r=>{const o=new Ce(r.key,t.batchId);return n=n.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Jr=n}))}nr(e){}containsKey(e,t){const n=new Ce(t,0),r=this.Jr.firstAfterOrEqual(n);return j.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,j.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Dp{constructor(e){this.ti=e,this.docs=(function(){return new de(W.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),o=r?r.size:0,a=this.ti(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return j.resolve(n?n.document.mutableCopy():je.newInvalidDocument(t))}getEntries(e,t){let n=ut();return t.forEach((r=>{const o=this.docs.get(r);n=n.insert(r,o?o.document.mutableCopy():je.newInvalidDocument(r))})),j.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let o=ut();const a=t.path,u=new W(a.child("__id-9223372036854775808__")),d=this.docs.getIteratorFrom(u);for(;d.hasNext();){const{key:m,value:{document:f}}=d.getNext();if(!a.isPrefixOf(m.path))break;m.path.length>a.length+1||im(rm(f),n)<=0||(r.has(f.key)||wr(t,f))&&(o=o.insert(f.key,f.mutableCopy()))}return j.resolve(o)}getAllFromCollectionGroup(e,t,n,r){Q(9500)}ni(e,t){return j.forEach(this.docs,(n=>t(n)))}newChangeBuffer(e){return new Vp(this)}getSize(e){return j.resolve(this.size)}}class Vp extends xp{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Mr.addEntry(e,r)):this.Mr.removeEntry(n)})),j.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class jp{constructor(e){this.persistence=e,this.ri=new Yt((t=>Ji(t)),Yi),this.lastRemoteSnapshotVersion=Y.min(),this.highestTargetId=0,this.ii=0,this.si=new so,this.targetCount=0,this.oi=Tn._r()}forEachTarget(e,t){return this.ri.forEach(((n,r)=>t(r))),j.resolve()}getLastRemoteSnapshotVersion(e){return j.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return j.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),j.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.ii&&(this.ii=t),j.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new Tn(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,j.resolve()}updateTargetData(e,t){return this.lr(t),j.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,j.resolve()}removeTargets(e,t,n){let r=0;const o=[];return this.ri.forEach(((a,u)=>{u.sequenceNumber<=t&&n.get(u.targetId)===null&&(this.ri.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),r++)})),j.waitFor(o).next((()=>r))}getTargetCount(e){return j.resolve(this.targetCount)}getTargetData(e,t){const n=this.ri.get(t)||null;return j.resolve(n)}addMatchingKeys(e,t,n){return this.si.$r(t,n),j.resolve()}removeMatchingKeys(e,t,n){this.si.Qr(t,n);const r=this.persistence.referenceDelegate,o=[];return r&&t.forEach((a=>{o.push(r.markPotentiallyOrphaned(e,a))})),j.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),j.resolve()}getMatchingKeysForTargetId(e,t){const n=this.si.jr(t);return j.resolve(n)}containsKey(e,t){return j.resolve(this.si.containsKey(t))}}class Uc{constructor(e,t){this._i={},this.overlays={},this.ai=new _r(0),this.ui=!1,this.ui=!0,this.ci=new Pp,this.referenceDelegate=e(this),this.li=new jp(this),this.indexManager=new vp,this.remoteDocumentCache=(function(r){return new Dp(r)})((n=>this.referenceDelegate.hi(n))),this.serializer=new yp(t),this.Pi=new Np(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Rp,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this._i[e.toKey()];return n||(n=new kp(t,this.referenceDelegate),this._i[e.toKey()]=n),n}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,n){z("MemoryPersistence","Starting transaction:",e);const r=new Fp(this.ai.next());return this.referenceDelegate.Ti(),n(r).next((o=>this.referenceDelegate.Ii(r).next((()=>o)))).toPromise().then((o=>(r.raiseOnCommittedEvent(),o)))}Ei(e,t){return j.or(Object.values(this._i).map((n=>()=>n.containsKey(e,t))))}}class Fp extends am{constructor(e){super(),this.currentSequenceNumber=e}}class ro{constructor(e){this.persistence=e,this.Ri=new so,this.Ai=null}static Vi(e){return new ro(e)}get di(){if(this.Ai)return this.Ai;throw Q(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.di.delete(n.toString()),j.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.di.add(n.toString()),j.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),j.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach((r=>this.di.add(r.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((r=>{r.forEach((o=>this.di.add(o.toString())))})).next((()=>n.removeTargetData(e,t)))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return j.forEach(this.di,(n=>{const r=W.fromPath(n);return this.mi(e,r).next((o=>{o||t.removeEntry(r,Y.min())}))})).next((()=>(this.Ai=null,t.apply(e))))}updateLimboDocument(e,t){return this.mi(e,t).next((n=>{n?this.di.delete(t.toString()):this.di.add(t.toString())}))}hi(e){return 0}mi(e,t){return j.or([()=>j.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class mr{constructor(e,t){this.persistence=e,this.fi=new Yt((n=>um(n.path)),((n,r)=>n.isEqual(r))),this.garbageCollector=Ap(this,t)}static Vi(e,t){return new mr(e,t)}Ti(){}Ii(e){return j.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next((n=>t.next((r=>n+r))))}pr(e){let t=0;return this.mr(e,(n=>{t++})).next((()=>t))}mr(e,t){return j.forEach(this.fi,((n,r)=>this.wr(e,n,r).next((o=>o?j.resolve():t(r)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),o=r.newChangeBuffer();return r.ni(e,(a=>this.wr(e,a,t).next((u=>{u||(n++,o.removeEntry(a,Y.min()))})))).next((()=>o.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),j.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),j.resolve()}removeReference(e,t,n){return this.fi.set(n,e.currentSequenceNumber),j.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),j.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Js(e.data.value)),t}wr(e,t,n){return j.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.fi.get(t);return j.resolve(r!==void 0&&r>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class io{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Ts=n,this.Is=r}static Es(e,t){let n=te(),r=te();for(const o of t.docChanges)switch(o.type){case 0:n=n.add(o.doc.key);break;case 1:r=r.add(o.doc.key)}return new io(e,t.fromCache,n,r)}}class Op{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Lp{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return Ah()?8:lm(wh())>0?6:4})()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){const o={result:null};return this.gs(e,t).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ps(e,t,r,n).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new Op;return this.ys(e,t,a).next((u=>{if(o.result=u,this.As)return this.ws(e,t,a,u.size)}))})).next((()=>o.result))}ws(e,t,n,r){return n.documentReadCount<this.Vs?(ln()<=se.DEBUG&&z("QueryEngine","SDK will not create cache indexes for query:",cn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),j.resolve()):(ln()<=se.DEBUG&&z("QueryEngine","Query:",cn(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ds*r?(ln()<=se.DEBUG&&z("QueryEngine","The SDK decides to create cache indexes for query:",cn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ze(t))):j.resolve())}gs(e,t){if(Ha(t))return j.resolve(null);let n=Ze(t);return this.indexManager.getIndexType(e,n).next((r=>r===0?null:(t.limit!==null&&r===1&&(t=Ci(t,null,"F"),n=Ze(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((o=>{const a=te(...o);return this.fs.getDocuments(e,a).next((u=>this.indexManager.getMinOffset(e,n).next((d=>{const m=this.bs(t,u);return this.Ss(t,m,a,d.readTime)?this.gs(e,Ci(t,null,"F")):this.Ds(e,m,t,d)}))))})))))}ps(e,t,n,r){return Ha(t)||r.isEqual(Y.min())?j.resolve(null):this.fs.getDocuments(e,n).next((o=>{const a=this.bs(t,o);return this.Ss(t,a,n,r)?j.resolve(null):(ln()<=se.DEBUG&&z("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),cn(t)),this.Ds(e,a,t,sm(r,ms)).next((u=>u)))}))}bs(e,t){let n=new Te(vc(e));return t.forEach(((r,o)=>{wr(e,o)&&(n=n.add(o))})),n}Ss(e,t,n,r){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(r)>0)}ys(e,t,n){return ln()<=se.DEBUG&&z("QueryEngine","Using full collection scan to execute query:",cn(t)),this.fs.getDocumentsMatchingQuery(e,t,Rt.min(),n)}Ds(e,t,n,r){return this.fs.getDocumentsMatchingQuery(e,n,r).next((o=>(t.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const oo="LocalStore",Mp=3e8;class $p{constructor(e,t,n,r){this.persistence=e,this.Cs=t,this.serializer=r,this.vs=new de(ee),this.Fs=new Yt((o=>Ji(o)),Yi),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(n)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Cp(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.vs)))}}function Bp(s,e,t,n){return new $p(s,e,t,n)}async function qc(s,e){const t=X(s);return await t.persistence.runTransaction("Handle user change","readonly",(n=>{let r;return t.mutationQueue.getAllMutationBatches(n).next((o=>(r=o,t.Os(e),t.mutationQueue.getAllMutationBatches(n)))).next((o=>{const a=[],u=[];let d=te();for(const m of r){a.push(m.batchId);for(const f of m.mutations)d=d.add(f.key)}for(const m of o){u.push(m.batchId);for(const f of m.mutations)d=d.add(f.key)}return t.localDocuments.getDocuments(n,d).next((m=>({Ns:m,removedBatchIds:a,addedBatchIds:u})))}))}))}function Up(s,e){const t=X(s);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(n=>{const r=e.batch.keys(),o=t.xs.newChangeBuffer({trackRemovals:!0});return(function(u,d,m,f){const E=m.batch,w=E.keys();let C=j.resolve();return w.forEach((I=>{C=C.next((()=>f.getEntry(d,I))).next((R=>{const N=m.docVersions.get(I);oe(N!==null,48541),R.version.compareTo(N)<0&&(E.applyToRemoteDocument(R,m),R.isValidDocument()&&(R.setReadTime(m.commitVersion),f.addEntry(R)))}))})),C.next((()=>u.mutationQueue.removeMutationBatch(d,E)))})(t,n,e,o).next((()=>o.apply(n))).next((()=>t.mutationQueue.performConsistencyCheck(n))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(n,r,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(u){let d=te();for(let m=0;m<u.mutationResults.length;++m)u.mutationResults[m].transformResults.length>0&&(d=d.add(u.batch.mutations[m].key));return d})(e)))).next((()=>t.localDocuments.getDocuments(n,r)))}))}function zc(s){const e=X(s);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.li.getLastRemoteSnapshotVersion(t)))}function qp(s,e){const t=X(s),n=e.snapshotVersion;let r=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=t.xs.newChangeBuffer({trackRemovals:!0});r=t.vs;const u=[];e.targetChanges.forEach(((f,E)=>{const w=r.get(E);if(!w)return;u.push(t.li.removeMatchingKeys(o,f.removedDocuments,E).next((()=>t.li.addMatchingKeys(o,f.addedDocuments,E))));let C=w.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(E)!==null?C=C.withResumeToken(ke.EMPTY_BYTE_STRING,Y.min()).withLastLimboFreeSnapshotVersion(Y.min()):f.resumeToken.approximateByteSize()>0&&(C=C.withResumeToken(f.resumeToken,n)),r=r.insert(E,C),(function(R,N,k){return R.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-R.snapshotVersion.toMicroseconds()>=Mp?!0:k.addedDocuments.size+k.modifiedDocuments.size+k.removedDocuments.size>0})(w,C,f)&&u.push(t.li.updateTargetData(o,C))}));let d=ut(),m=te();if(e.documentUpdates.forEach((f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,f))})),u.push(zp(o,a,e.documentUpdates).next((f=>{d=f.Bs,m=f.Ls}))),!n.isEqual(Y.min())){const f=t.li.getLastRemoteSnapshotVersion(o).next((E=>t.li.setTargetsMetadata(o,o.currentSequenceNumber,n)));u.push(f)}return j.waitFor(u).next((()=>a.apply(o))).next((()=>t.localDocuments.getLocalViewOfDocuments(o,d,m))).next((()=>d))})).then((o=>(t.vs=r,o)))}function zp(s,e,t){let n=te(),r=te();return t.forEach((o=>n=n.add(o))),e.getEntries(s,n).next((o=>{let a=ut();return t.forEach(((u,d)=>{const m=o.get(u);d.isFoundDocument()!==m.isFoundDocument()&&(r=r.add(u)),d.isNoDocument()&&d.version.isEqual(Y.min())?(e.removeEntry(u,d.readTime),a=a.insert(u,d)):!m.isValidDocument()||d.version.compareTo(m.version)>0||d.version.compareTo(m.version)===0&&m.hasPendingWrites?(e.addEntry(d),a=a.insert(u,d)):z(oo,"Ignoring outdated watch update for ",u,". Current version:",m.version," Watch version:",d.version)})),{Bs:a,Ls:r}}))}function Hp(s,e){const t=X(s);return t.persistence.runTransaction("Get next mutation batch","readonly",(n=>(e===void 0&&(e=Ki),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e))))}function Wp(s,e){const t=X(s);return t.persistence.runTransaction("Allocate target","readwrite",(n=>{let r;return t.li.getTargetData(n,e).next((o=>o?(r=o,j.resolve(r)):t.li.allocateTargetId(n).next((a=>(r=new wt(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.li.addTargetData(n,r).next((()=>r)))))))})).then((n=>{const r=t.vs.get(n.targetId);return(r===null||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.vs=t.vs.insert(n.targetId,n),t.Fs.set(e,n.targetId)),n}))}async function Di(s,e,t){const n=X(s),r=n.vs.get(e),o=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",o,(a=>n.persistence.referenceDelegate.removeTarget(a,r)))}catch(a){if(!Nn(a))throw a;z(oo,`Failed to update sequence numbers for target ${e}: ${a}`)}n.vs=n.vs.remove(e),n.Fs.delete(r.target)}function rl(s,e,t){const n=X(s);let r=Y.min(),o=te();return n.persistence.runTransaction("Execute query","readwrite",(a=>(function(d,m,f){const E=X(d),w=E.Fs.get(f);return w!==void 0?j.resolve(E.vs.get(w)):E.li.getTargetData(m,f)})(n,a,Ze(e)).next((u=>{if(u)return r=u.lastLimboFreeSnapshotVersion,n.li.getMatchingKeysForTargetId(a,u.targetId).next((d=>{o=d}))})).next((()=>n.Cs.getDocumentsMatchingQuery(a,e,t?r:Y.min(),t?o:te()))).next((u=>(Kp(n,km(e),u),{documents:u,ks:o})))))}function Kp(s,e,t){let n=s.Ms.get(e)||Y.min();t.forEach(((r,o)=>{o.readTime.compareTo(n)>0&&(n=o.readTime)})),s.Ms.set(e,n)}class il{constructor(){this.activeTargetIds=Lm()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Gp{constructor(){this.vo=new il,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,n){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new il,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Qp{Mo(e){}shutdown(){}}const ol="ConnectivityMonitor";class al{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){z(ol,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){z(ol,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Ks=null;function Vi(){return Ks===null?Ks=(function(){return 268435456+Math.round(2147483648*Math.random())})():Ks++,"0x"+Ks.toString(16)}const ci="RestConnection",Jp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class Yp{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${n}/databases/${r}`,this.$o=this.databaseId.database===or?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Wo(e,t,n,r,o){const a=Vi(),u=this.Qo(e,t.toUriEncodedString());z(ci,`Sending RPC '${e}' ${a}:`,u,n);const d={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(d,r,o);const{host:m}=new URL(u),f=Ui(m);return this.zo(e,u,d,n,f).then((E=>(z(ci,`Received RPC '${e}' ${a}: `,E),E)),(E=>{throw Gt(ci,`RPC '${e}' ${a} failed with error: `,E,"url: ",u,"request:",n),E}))}jo(e,t,n,r,o,a){return this.Wo(e,t,n,r,o)}Go(e,t,n){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Sn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((r,o)=>e[o]=r)),n&&n.headers.forEach(((r,o)=>e[o]=r))}Qo(e,t){const n=Jp[e];let r=`${this.qo}/v1/${t}:${n}`;return this.databaseInfo.apiKey&&(r=`${r}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),r}terminate(){}}class Xp{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}const De="WebChannelConnection",Xn=(s,e,t)=>{s.listen(e,(n=>{try{t(n)}catch(r){setTimeout((()=>{throw r}),0)}}))};class mn extends Yp{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!mn.c_){const e=Ql();Xn(e,Gl.STAT_EVENT,(t=>{t.stat===Ti.PROXY?z(De,"STAT_EVENT: detected buffering proxy"):t.stat===Ti.NOPROXY&&z(De,"STAT_EVENT: detected no buffering proxy")})),mn.c_=!0}}zo(e,t,n,r,o){const a=Vi();return new Promise(((u,d)=>{const m=new Wl;m.setWithCredentials(!0),m.listenOnce(Kl.COMPLETE,(()=>{try{switch(m.getLastErrorCode()){case Qs.NO_ERROR:const E=m.getResponseJson();z(De,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(E)),u(E);break;case Qs.TIMEOUT:z(De,`RPC '${e}' ${a} timed out`),d(new H(L.DEADLINE_EXCEEDED,"Request time out"));break;case Qs.HTTP_ERROR:const w=m.getStatus();if(z(De,`RPC '${e}' ${a} failed with status:`,w,"response text:",m.getResponseText()),w>0){let C=m.getResponseJson();Array.isArray(C)&&(C=C[0]);const I=C?.error;if(I&&I.status&&I.message){const R=(function(k){const S=k.toLowerCase().replace(/_/g,"-");return Object.values(L).indexOf(S)>=0?S:L.UNKNOWN})(I.status);d(new H(R,I.message))}else d(new H(L.UNKNOWN,"Server responded with status "+m.getStatus()))}else d(new H(L.UNAVAILABLE,"Connection failed."));break;default:Q(9055,{l_:e,streamId:a,h_:m.getLastErrorCode(),P_:m.getLastError()})}}finally{z(De,`RPC '${e}' ${a} completed.`)}}));const f=JSON.stringify(r);z(De,`RPC '${e}' ${a} sending request:`,r),m.send(t,"POST",f,n,15)}))}T_(e,t,n){const r=Vi(),o=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Go(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;const m=o.join("");z(De,`Creating RPC '${e}' stream ${r}: ${m}`,u);const f=a.createWebChannel(m,u);this.I_(f);let E=!1,w=!1;const C=new Xp({Ho:I=>{w?z(De,`Not sending because RPC '${e}' stream ${r} is closed:`,I):(E||(z(De,`Opening RPC '${e}' stream ${r} transport.`),f.open(),E=!0),z(De,`RPC '${e}' stream ${r} sending:`,I),f.send(I))},Jo:()=>f.close()});return Xn(f,Zn.EventType.OPEN,(()=>{w||(z(De,`RPC '${e}' stream ${r} transport opened.`),C.i_())})),Xn(f,Zn.EventType.CLOSE,(()=>{w||(w=!0,z(De,`RPC '${e}' stream ${r} transport closed`),C.o_(),this.E_(f))})),Xn(f,Zn.EventType.ERROR,(I=>{w||(w=!0,Gt(De,`RPC '${e}' stream ${r} transport errored. Name:`,I.name,"Message:",I.message),C.o_(new H(L.UNAVAILABLE,"The operation could not be completed")))})),Xn(f,Zn.EventType.MESSAGE,(I=>{if(!w){const R=I.data[0];oe(!!R,16349);const N=R,k=N?.error||N[0]?.error;if(k){z(De,`RPC '${e}' stream ${r} received error:`,k);const S=k.status;let F=(function(O){const b=ge[O];if(b!==void 0)return Rc(b)})(S),B=k.message;S==="NOT_FOUND"&&B.includes("database")&&B.includes("does not exist")&&B.includes(this.databaseId.database)&&Gt(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),F===void 0&&(F=L.INTERNAL,B="Unknown error status: "+S+" with message "+k.message),w=!0,C.o_(new H(F,B)),f.close()}else z(De,`RPC '${e}' stream ${r} received:`,R),C.__(R)}})),mn.u_(),setTimeout((()=>{C.s_()}),0),C}terminate(){this.a_.forEach((e=>e.close())),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter((t=>t===e))}Go(e,t,n){super.Go(e,t,n),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Jl()}}function Zp(s){return new mn(s)}function ui(){return typeof document<"u"?document:null}function Sr(s){return new sp(s,!0)}mn.c_=!1;class Hc{constructor(e,t,n=1e3,r=1.5,o=6e4){this.Ci=e,this.timerId=t,this.R_=n,this.A_=r,this.V_=o,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&z("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const ll="PersistentStream";class Wc{constructor(e,t,n,r,o,a,u,d){this.Ci=e,this.b_=n,this.S_=r,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=d,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Hc(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===L.RESOURCE_EXHAUSTED?(ct(t.toString()),ct("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===L.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([n,r])=>{this.D_===t&&this.G_(n,r)}),(n=>{e((()=>{const r=new H(L.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(r)}))}))}G_(e,t){const n=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo((()=>{n((()=>this.listener.Zo()))})),this.stream.Yo((()=>{n((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((r=>{n((()=>this.z_(r)))})),this.stream.onMessage((r=>{n((()=>++this.F_==1?this.H_(r):this.onNext(r)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return z(ll,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget((()=>this.D_===e?t():(z(ll,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class ef extends Wc{constructor(e,t,n,r,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=op(this.serializer,e),n=(function(o){if(!("targetChange"in o))return Y.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?Y.min():a.readTime?tt(a.readTime):Y.min()})(e);return this.listener.J_(t,n)}Z_(e){const t={};t.database=ki(this.serializer),t.addTarget=(function(o,a){let u;const d=a.target;if(u=Si(d)?{documents:cp(o,d)}:{query:up(o,d).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Dc(o,a.resumeToken);const m=Ni(o,a.expectedCount);m!==null&&(u.expectedCount=m)}else if(a.snapshotVersion.compareTo(Y.min())>0){u.readTime=dr(o,a.snapshotVersion.toTimestamp());const m=Ni(o,a.expectedCount);m!==null&&(u.expectedCount=m)}return u})(this.serializer,e);const n=dp(this.serializer,e);n&&(t.labels=n),this.K_(t)}X_(e){const t={};t.database=ki(this.serializer),t.removeTarget=e,this.K_(t)}}class tf extends Wc{constructor(e,t,n,r,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,a),this.serializer=o}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return oe(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,oe(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){oe(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=lp(e.writeResults,e.commitTime),n=tt(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=ki(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((n=>ap(this.serializer,n)))};this.K_(t)}}class nf{}class sf extends nf{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new H(L.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Wo(e,Ri(t,n),r,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new H(L.UNKNOWN,o.toString())}))}jo(e,t,n,r,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,u])=>this.connection.jo(e,Ri(t,n),r,a,u,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new H(L.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function rf(s,e,t,n){return new sf(s,e,t,n)}class of{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ct(t),this.aa=!1):z("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Qt="RemoteStore";class af{constructor(e,t,n,r,o){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=o,this.Aa.Mo((a=>{n.enqueueAndForget((async()=>{Zt(this)&&(z(Qt,"Restarting streams for network reachability change."),await(async function(d){const m=X(d);m.Ea.add(4),await ws(m),m.Va.set("Unknown"),m.Ea.delete(4),await Cr(m)})(this))}))})),this.Va=new of(n,r)}}async function Cr(s){if(Zt(s))for(const e of s.Ra)await e(!0)}async function ws(s){for(const e of s.Ra)await e(!1)}function Kc(s,e){const t=X(s);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),uo(t)?co(t):Rn(t).O_()&&lo(t,e))}function ao(s,e){const t=X(s),n=Rn(t);t.Ia.delete(e),n.O_()&&Gc(t,e),t.Ia.size===0&&(n.O_()?n.L_():Zt(t)&&t.Va.set("Unknown"))}function lo(s,e){if(s.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Y.min())>0){const t=s.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Rn(s).Z_(e)}function Gc(s,e){s.da.$e(e),Rn(s).X_(e)}function co(s){s.da=new Zm({getRemoteKeysForTarget:e=>s.remoteSyncer.getRemoteKeysForTarget(e),At:e=>s.Ia.get(e)||null,ht:()=>s.datastore.serializer.databaseId}),Rn(s).start(),s.Va.ua()}function uo(s){return Zt(s)&&!Rn(s).x_()&&s.Ia.size>0}function Zt(s){return X(s).Ea.size===0}function Qc(s){s.da=void 0}async function lf(s){s.Va.set("Online")}async function cf(s){s.Ia.forEach(((e,t)=>{lo(s,e)}))}async function uf(s,e){Qc(s),uo(s)?(s.Va.ha(e),co(s)):s.Va.set("Unknown")}async function hf(s,e,t){if(s.Va.set("Online"),e instanceof kc&&e.state===2&&e.cause)try{await(async function(r,o){const a=o.cause;for(const u of o.targetIds)r.Ia.has(u)&&(await r.remoteSyncer.rejectListen(u,a),r.Ia.delete(u),r.da.removeTarget(u))})(s,e)}catch(n){z(Qt,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await pr(s,n)}else if(e instanceof Zs?s.da.Xe(e):e instanceof Pc?s.da.st(e):s.da.tt(e),!t.isEqual(Y.min()))try{const n=await zc(s.localStore);t.compareTo(n)>=0&&await(function(o,a){const u=o.da.Tt(a);return u.targetChanges.forEach(((d,m)=>{if(d.resumeToken.approximateByteSize()>0){const f=o.Ia.get(m);f&&o.Ia.set(m,f.withResumeToken(d.resumeToken,a))}})),u.targetMismatches.forEach(((d,m)=>{const f=o.Ia.get(d);if(!f)return;o.Ia.set(d,f.withResumeToken(ke.EMPTY_BYTE_STRING,f.snapshotVersion)),Gc(o,d);const E=new wt(f.target,d,m,f.sequenceNumber);lo(o,E)})),o.remoteSyncer.applyRemoteEvent(u)})(s,t)}catch(n){z(Qt,"Failed to raise snapshot:",n),await pr(s,n)}}async function pr(s,e,t){if(!Nn(e))throw e;s.Ea.add(1),await ws(s),s.Va.set("Offline"),t||(t=()=>zc(s.localStore)),s.asyncQueue.enqueueRetryable((async()=>{z(Qt,"Retrying IndexedDB access"),await t(),s.Ea.delete(1),await Cr(s)}))}function Jc(s,e){return e().catch((t=>pr(s,t,e)))}async function Nr(s){const e=X(s),t=Vt(e);let n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Ki;for(;df(e);)try{const r=await Hp(e.localStore,n);if(r===null){e.Ta.length===0&&t.L_();break}n=r.batchId,mf(e,r)}catch(r){await pr(e,r)}Yc(e)&&Xc(e)}function df(s){return Zt(s)&&s.Ta.length<10}function mf(s,e){s.Ta.push(e);const t=Vt(s);t.O_()&&t.Y_&&t.ea(e.mutations)}function Yc(s){return Zt(s)&&!Vt(s).x_()&&s.Ta.length>0}function Xc(s){Vt(s).start()}async function pf(s){Vt(s).ra()}async function ff(s){const e=Vt(s);for(const t of s.Ta)e.ea(t.mutations)}async function gf(s,e,t){const n=s.Ta.shift(),r=eo.from(n,e,t);await Jc(s,(()=>s.remoteSyncer.applySuccessfulWrite(r))),await Nr(s)}async function yf(s,e){e&&Vt(s).Y_&&await(async function(n,r){if((function(a){return Jm(a)&&a!==L.ABORTED})(r.code)){const o=n.Ta.shift();Vt(n).B_(),await Jc(n,(()=>n.remoteSyncer.rejectFailedWrite(o.batchId,r))),await Nr(n)}})(s,e),Yc(s)&&Xc(s)}async function cl(s,e){const t=X(s);t.asyncQueue.verifyOperationInProgress(),z(Qt,"RemoteStore received new credentials");const n=Zt(t);t.Ea.add(3),await ws(t),n&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await Cr(t)}async function _f(s,e){const t=X(s);e?(t.Ea.delete(2),await Cr(t)):e||(t.Ea.add(2),await ws(t),t.Va.set("Unknown"))}function Rn(s){return s.ma||(s.ma=(function(t,n,r){const o=X(t);return o.sa(),new ef(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,r)})(s.datastore,s.asyncQueue,{Zo:lf.bind(null,s),Yo:cf.bind(null,s),t_:uf.bind(null,s),J_:hf.bind(null,s)}),s.Ra.push((async e=>{e?(s.ma.B_(),uo(s)?co(s):s.Va.set("Unknown")):(await s.ma.stop(),Qc(s))}))),s.ma}function Vt(s){return s.fa||(s.fa=(function(t,n,r){const o=X(t);return o.sa(),new tf(n,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,r)})(s.datastore,s.asyncQueue,{Zo:()=>Promise.resolve(),Yo:pf.bind(null,s),t_:yf.bind(null,s),ta:ff.bind(null,s),na:gf.bind(null,s)}),s.Ra.push((async e=>{e?(s.fa.B_(),await Nr(s)):(await s.fa.stop(),s.Ta.length>0&&(z(Qt,`Stopping write stream with ${s.Ta.length} pending writes`),s.Ta=[]))}))),s.fa}class ho{constructor(e,t,n,r,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=o,this.deferred=new Ct,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,o){const a=Date.now()+n,u=new ho(e,t,a,r,o);return u.start(n),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new H(L.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function mo(s,e){if(ct("AsyncQueue",`${e}: ${s}`),Nn(s))return new H(L.UNAVAILABLE,`${e}: ${s}`);throw s}class pn{static emptySet(e){return new pn(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||W.comparator(t.key,n.key):(t,n)=>W.comparator(t.key,n.key),this.keyedMap=es(),this.sortedSet=new de(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof pn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,o=n.getNext().key;if(!r.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new pn;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class ul{constructor(){this.ga=new de(W.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?e.type!==0&&n.type===3?this.ga=this.ga.insert(t,e):e.type===3&&n.type!==1?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.ga=this.ga.remove(t):e.type===1&&n.type===2?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Q(63341,{Vt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,n)=>{e.push(n)})),e}}class wn{constructor(e,t,n,r,o,a,u,d,m){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=d,this.hasCachedResults=m}static fromInitialDocuments(e,t,n,r,o){const a=[];return t.forEach((u=>{a.push({type:0,doc:u})})),new wn(e,t,pn.emptySet(t),a,n,r,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Tr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class vf{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((e=>e.Da()))}}class bf{constructor(){this.queries=hl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,n){const r=X(t),o=r.queries;r.queries=hl(),o.forEach(((a,u)=>{for(const d of u.ba)d.onError(n)}))})(this,new H(L.ABORTED,"Firestore shutting down"))}}function hl(){return new Yt((s=>_c(s)),Tr)}async function Ef(s,e){const t=X(s);let n=3;const r=e.query;let o=t.queries.get(r);o?!o.Sa()&&e.Da()&&(n=2):(o=new vf,n=e.Da()?0:1);try{switch(n){case 0:o.wa=await t.onListen(r,!0);break;case 1:o.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(a){const u=mo(a,`Initialization of query '${cn(e.query)}' failed`);return void e.onError(u)}t.queries.set(r,o),o.ba.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&po(t)}async function Tf(s,e){const t=X(s),n=e.query;let r=3;const o=t.queries.get(n);if(o){const a=o.ba.indexOf(e);a>=0&&(o.ba.splice(a,1),o.ba.length===0?r=e.Da()?0:1:!o.Sa()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function wf(s,e){const t=X(s);let n=!1;for(const r of e){const o=r.query,a=t.queries.get(o);if(a){for(const u of a.ba)u.Fa(r)&&(n=!0);a.wa=r}}n&&po(t)}function If(s,e,t){const n=X(s),r=n.queries.get(e);if(r)for(const o of r.ba)o.onError(t);n.queries.delete(e)}function po(s){s.Ca.forEach((e=>{e.next()}))}var ji,dl;(dl=ji||(ji={})).Ma="default",dl.Cache="cache";class Af{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const n=[];for(const r of e.docChanges)r.type!==3&&n.push(r);e=new wn(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const n=t!=="Offline";return(!this.options.Ka||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=wn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==ji.Cache}}class Zc{constructor(e){this.key=e}}class eu{constructor(e){this.key=e}}class xf{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=te(),this.mutatedKeys=te(),this.eu=vc(e),this.tu=new pn(this.eu)}get nu(){return this.Za}ru(e,t){const n=t?t.iu:new ul,r=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,a=r,u=!1;const d=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,m=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((f,E)=>{const w=r.get(f),C=wr(this.query,E)?E:null,I=!!w&&this.mutatedKeys.has(w.key),R=!!C&&(C.hasLocalMutations||this.mutatedKeys.has(C.key)&&C.hasCommittedMutations);let N=!1;w&&C?w.data.isEqual(C.data)?I!==R&&(n.track({type:3,doc:C}),N=!0):this.su(w,C)||(n.track({type:2,doc:C}),N=!0,(d&&this.eu(C,d)>0||m&&this.eu(C,m)<0)&&(u=!0)):!w&&C?(n.track({type:0,doc:C}),N=!0):w&&!C&&(n.track({type:1,doc:w}),N=!0,(d||m)&&(u=!0)),N&&(C?(a=a.add(C),o=R?o.add(f):o.delete(f)):(a=a.delete(f),o=o.delete(f)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),o=o.delete(f.key),n.track({type:1,doc:f})}return{tu:a,iu:n,Ss:u,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((f,E)=>(function(C,I){const R=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Q(20277,{Vt:N})}};return R(C)-R(I)})(f.type,E.type)||this.eu(f.doc,E.doc))),this.ou(n),r=r??!1;const u=t&&!r?this._u():[],d=this.Ya.size===0&&this.current&&!r?1:0,m=d!==this.Xa;return this.Xa=d,a.length!==0||m?{snapshot:new wn(this.query,e.tu,o,a,e.mutatedKeys,d===0,m,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new ul,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Za=this.Za.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Za=this.Za.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=te(),this.tu.forEach((n=>{this.uu(n.key)&&(this.Ya=this.Ya.add(n.key))}));const t=[];return e.forEach((n=>{this.Ya.has(n)||t.push(new eu(n))})),this.Ya.forEach((n=>{e.has(n)||t.push(new Zc(n))})),t}cu(e){this.Za=e.ks,this.Ya=te();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return wn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const fo="SyncEngine";class Sf{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Cf{constructor(e){this.key=e,this.hu=!1}}class Nf{constructor(e,t,n,r,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Yt((u=>_c(u)),Tr),this.Iu=new Map,this.Eu=new Set,this.Ru=new de(W.comparator),this.Au=new Map,this.Vu=new so,this.du={},this.mu=new Map,this.fu=Tn.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Rf(s,e,t=!0){const n=ou(s);let r;const o=n.Tu.get(e);return o?(n.sharedClientState.addLocalQueryTarget(o.targetId),r=o.view.lu()):r=await tu(n,e,t,!0),r}async function Pf(s,e){const t=ou(s);await tu(t,e,!0,!1)}async function tu(s,e,t,n){const r=await Wp(s.localStore,Ze(e)),o=r.targetId,a=s.sharedClientState.addLocalQueryTarget(o,t);let u;return n&&(u=await kf(s,e,o,a==="current",r.resumeToken)),s.isPrimaryClient&&t&&Kc(s.remoteStore,r),u}async function kf(s,e,t,n,r){s.pu=(E,w,C)=>(async function(R,N,k,S){let F=N.view.ru(k);F.Ss&&(F=await rl(R.localStore,N.query,!1).then((({documents:b})=>N.view.ru(b,F))));const B=S&&S.targetChanges.get(N.targetId),$=S&&S.targetMismatches.get(N.targetId)!=null,O=N.view.applyChanges(F,R.isPrimaryClient,B,$);return pl(R,N.targetId,O.au),O.snapshot})(s,E,w,C);const o=await rl(s.localStore,e,!0),a=new xf(e,o.ks),u=a.ru(o.documents),d=Ts.createSynthesizedTargetChangeForCurrentChange(t,n&&s.onlineState!=="Offline",r),m=a.applyChanges(u,s.isPrimaryClient,d);pl(s,t,m.au);const f=new Sf(e,t,a);return s.Tu.set(e,f),s.Iu.has(t)?s.Iu.get(t).push(e):s.Iu.set(t,[e]),m.snapshot}async function Df(s,e,t){const n=X(s),r=n.Tu.get(e),o=n.Iu.get(r.targetId);if(o.length>1)return n.Iu.set(r.targetId,o.filter((a=>!Tr(a,e)))),void n.Tu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Di(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),t&&ao(n.remoteStore,r.targetId),Fi(n,r.targetId)})).catch(Cn)):(Fi(n,r.targetId),await Di(n.localStore,r.targetId,!0))}async function Vf(s,e){const t=X(s),n=t.Tu.get(e),r=t.Iu.get(n.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),ao(t.remoteStore,n.targetId))}async function jf(s,e,t){const n=Uf(s);try{const r=await(function(a,u){const d=X(a),m=ue.now(),f=u.reduce(((C,I)=>C.add(I.key)),te());let E,w;return d.persistence.runTransaction("Locally write mutations","readwrite",(C=>{let I=ut(),R=te();return d.xs.getEntries(C,f).next((N=>{I=N,I.forEach(((k,S)=>{S.isValidDocument()||(R=R.add(k))}))})).next((()=>d.localDocuments.getOverlayedDocuments(C,I))).next((N=>{E=N;const k=[];for(const S of u){const F=Hm(S,E.get(S.key).overlayedDocument);F!=null&&k.push(new Xt(S.key,F,uc(F.value.mapValue),et.exists(!0)))}return d.mutationQueue.addMutationBatch(C,m,k,u)})).next((N=>{w=N;const k=N.applyToLocalDocumentSet(E,R);return d.documentOverlayCache.saveOverlays(C,N.batchId,k)}))})).then((()=>({batchId:w.batchId,changes:Ec(E)})))})(n.localStore,e);n.sharedClientState.addPendingMutation(r.batchId),(function(a,u,d){let m=a.du[a.currentUser.toKey()];m||(m=new de(ee)),m=m.insert(u,d),a.du[a.currentUser.toKey()]=m})(n,r.batchId,t),await Is(n,r.changes),await Nr(n.remoteStore)}catch(r){const o=mo(r,"Failed to persist write");t.reject(o)}}async function nu(s,e){const t=X(s);try{const n=await qp(t.localStore,e);e.targetChanges.forEach(((r,o)=>{const a=t.Au.get(o);a&&(oe(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?a.hu=!0:r.modifiedDocuments.size>0?oe(a.hu,14607):r.removedDocuments.size>0&&(oe(a.hu,42227),a.hu=!1))})),await Is(t,n,e)}catch(n){await Cn(n)}}function ml(s,e,t){const n=X(s);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const r=[];n.Tu.forEach(((o,a)=>{const u=a.view.va(e);u.snapshot&&r.push(u.snapshot)})),(function(a,u){const d=X(a);d.onlineState=u;let m=!1;d.queries.forEach(((f,E)=>{for(const w of E.ba)w.va(u)&&(m=!0)})),m&&po(d)})(n.eventManager,e),r.length&&n.Pu.J_(r),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function Ff(s,e,t){const n=X(s);n.sharedClientState.updateQueryState(e,"rejected",t);const r=n.Au.get(e),o=r&&r.key;if(o){let a=new de(W.comparator);a=a.insert(o,je.newNoDocument(o,Y.min()));const u=te().add(o),d=new xr(Y.min(),new Map,new de(ee),a,u);await nu(n,d),n.Ru=n.Ru.remove(o),n.Au.delete(e),go(n)}else await Di(n.localStore,e,!1).then((()=>Fi(n,e,t))).catch(Cn)}async function Of(s,e){const t=X(s),n=e.batch.batchId;try{const r=await Up(t.localStore,e);ru(t,n,null),su(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await Is(t,r)}catch(r){await Cn(r)}}async function Lf(s,e,t){const n=X(s);try{const r=await(function(a,u){const d=X(a);return d.persistence.runTransaction("Reject batch","readwrite-primary",(m=>{let f;return d.mutationQueue.lookupMutationBatch(m,u).next((E=>(oe(E!==null,37113),f=E.keys(),d.mutationQueue.removeMutationBatch(m,E)))).next((()=>d.mutationQueue.performConsistencyCheck(m))).next((()=>d.documentOverlayCache.removeOverlaysForBatchId(m,f,u))).next((()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,f))).next((()=>d.localDocuments.getDocuments(m,f)))}))})(n.localStore,e);ru(n,e,t),su(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await Is(n,r)}catch(r){await Cn(r)}}function su(s,e){(s.mu.get(e)||[]).forEach((t=>{t.resolve()})),s.mu.delete(e)}function ru(s,e,t){const n=X(s);let r=n.du[n.currentUser.toKey()];if(r){const o=r.get(e);o&&(t?o.reject(t):o.resolve(),r=r.remove(e)),n.du[n.currentUser.toKey()]=r}}function Fi(s,e,t=null){s.sharedClientState.removeLocalQueryTarget(e);for(const n of s.Iu.get(e))s.Tu.delete(n),t&&s.Pu.yu(n,t);s.Iu.delete(e),s.isPrimaryClient&&s.Vu.Gr(e).forEach((n=>{s.Vu.containsKey(n)||iu(s,n)}))}function iu(s,e){s.Eu.delete(e.path.canonicalString());const t=s.Ru.get(e);t!==null&&(ao(s.remoteStore,t),s.Ru=s.Ru.remove(e),s.Au.delete(t),go(s))}function pl(s,e,t){for(const n of t)n instanceof Zc?(s.Vu.addReference(n.key,e),Mf(s,n)):n instanceof eu?(z(fo,"Document no longer in limbo: "+n.key),s.Vu.removeReference(n.key,e),s.Vu.containsKey(n.key)||iu(s,n.key)):Q(19791,{wu:n})}function Mf(s,e){const t=e.key,n=t.path.canonicalString();s.Ru.get(t)||s.Eu.has(n)||(z(fo,"New document in limbo: "+t),s.Eu.add(n),go(s))}function go(s){for(;s.Eu.size>0&&s.Ru.size<s.maxConcurrentLimboResolutions;){const e=s.Eu.values().next().value;s.Eu.delete(e);const t=new W(ce.fromString(e)),n=s.fu.next();s.Au.set(n,new Cf(t)),s.Ru=s.Ru.insert(t,n),Kc(s.remoteStore,new wt(Ze(yc(t.path)),n,"TargetPurposeLimboResolution",_r.ce))}}async function Is(s,e,t){const n=X(s),r=[],o=[],a=[];n.Tu.isEmpty()||(n.Tu.forEach(((u,d)=>{a.push(n.pu(d,e,t).then((m=>{if((m||t)&&n.isPrimaryClient){const f=m?!m.fromCache:t?.targetChanges.get(d.targetId)?.current;n.sharedClientState.updateQueryState(d.targetId,f?"current":"not-current")}if(m){r.push(m);const f=io.Es(d.targetId,m);o.push(f)}})))})),await Promise.all(a),n.Pu.J_(r),await(async function(d,m){const f=X(d);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(E=>j.forEach(m,(w=>j.forEach(w.Ts,(C=>f.persistence.referenceDelegate.addReference(E,w.targetId,C))).next((()=>j.forEach(w.Is,(C=>f.persistence.referenceDelegate.removeReference(E,w.targetId,C)))))))))}catch(E){if(!Nn(E))throw E;z(oo,"Failed to update sequence numbers: "+E)}for(const E of m){const w=E.targetId;if(!E.fromCache){const C=f.vs.get(w),I=C.snapshotVersion,R=C.withLastLimboFreeSnapshotVersion(I);f.vs=f.vs.insert(w,R)}}})(n.localStore,o))}async function $f(s,e){const t=X(s);if(!t.currentUser.isEqual(e)){z(fo,"User change. New user:",e.toKey());const n=await qc(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach((u=>{u.forEach((d=>{d.reject(new H(L.CANCELLED,a))}))})),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await Is(t,n.Ns)}}function Bf(s,e){const t=X(s),n=t.Au.get(e);if(n&&n.hu)return te().add(n.key);{let r=te();const o=t.Iu.get(e);if(!o)return r;for(const a of o){const u=t.Tu.get(a);r=r.unionWith(u.view.nu)}return r}}function ou(s){const e=X(s);return e.remoteStore.remoteSyncer.applyRemoteEvent=nu.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Bf.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Ff.bind(null,e),e.Pu.J_=wf.bind(null,e.eventManager),e.Pu.yu=If.bind(null,e.eventManager),e}function Uf(s){const e=X(s);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Of.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Lf.bind(null,e),e}class fr{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Sr(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Bp(this.persistence,new Lp,e.initialUser,this.serializer)}Cu(e){return new Uc(ro.Vi,this.serializer)}Du(e){return new Gp}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}fr.provider={build:()=>new fr};class qf extends fr{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){oe(this.persistence.referenceDelegate instanceof mr,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new wp(n,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Oe.withCacheSize(this.cacheSizeBytes):Oe.DEFAULT;return new Uc((n=>mr.Vi(n,t)),this.serializer)}}class Oi{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>ml(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=$f.bind(null,this.syncEngine),await _f(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new bf})()}createDatastore(e){const t=Sr(e.databaseInfo.databaseId),n=Zp(e.databaseInfo);return rf(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return(function(n,r,o,a,u){return new af(n,r,o,a,u)})(this.localStore,this.datastore,e.asyncQueue,(t=>ml(this.syncEngine,t,0)),(function(){return al.v()?new al:new Qp})())}createSyncEngine(e,t){return(function(r,o,a,u,d,m,f){const E=new Nf(r,o,a,u,d,m);return f&&(E.gu=!0),E})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const n=X(t);z(Qt,"RemoteStore shutting down."),n.Ea.add(5),await ws(n),n.Aa.shutdown(),n.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Oi.provider={build:()=>new Oi};class zf{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ct("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const jt="FirestoreClient";class Hf{constructor(e,t,n,r,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this._databaseInfo=r,this.user=Ve.UNAUTHENTICATED,this.clientId=Hi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(n,(async a=>{z(jt,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,(a=>(z(jt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ct;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=mo(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function hi(s,e){s.asyncQueue.verifyOperationInProgress(),z(jt,"Initializing OfflineComponentProvider");const t=s.configuration;await e.initialize(t);let n=t.initialUser;s.setCredentialChangeListener((async r=>{n.isEqual(r)||(await qc(e.localStore,r),n=r)})),e.persistence.setDatabaseDeletedListener((()=>s.terminate())),s._offlineComponents=e}async function fl(s,e){s.asyncQueue.verifyOperationInProgress();const t=await Wf(s);z(jt,"Initializing OnlineComponentProvider"),await e.initialize(t,s.configuration),s.setCredentialChangeListener((n=>cl(e.remoteStore,n))),s.setAppCheckTokenChangeListener(((n,r)=>cl(e.remoteStore,r))),s._onlineComponents=e}async function Wf(s){if(!s._offlineComponents)if(s._uninitializedComponentsProvider){z(jt,"Using user provided OfflineComponentProvider");try{await hi(s,s._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(r){return r.name==="FirebaseError"?r.code===L.FAILED_PRECONDITION||r.code===L.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11})(t))throw t;Gt("Error using user provided cache. Falling back to memory cache: "+t),await hi(s,new fr)}}else z(jt,"Using default OfflineComponentProvider"),await hi(s,new qf(void 0));return s._offlineComponents}async function au(s){return s._onlineComponents||(s._uninitializedComponentsProvider?(z(jt,"Using user provided OnlineComponentProvider"),await fl(s,s._uninitializedComponentsProvider._online)):(z(jt,"Using default OnlineComponentProvider"),await fl(s,new Oi))),s._onlineComponents}function Kf(s){return au(s).then((e=>e.syncEngine))}async function Gf(s){const e=await au(s),t=e.eventManager;return t.onListen=Rf.bind(null,e.syncEngine),t.onUnlisten=Df.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Pf.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Vf.bind(null,e.syncEngine),t}function Qf(s,e,t={}){const n=new Ct;return s.asyncQueue.enqueueAndForget((async()=>(function(o,a,u,d,m){const f=new zf({next:w=>{f.Nu(),a.enqueueAndForget((()=>Tf(o,E))),w.fromCache&&d.source==="server"?m.reject(new H(L.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(w)},error:w=>m.reject(w)}),E=new Af(u,f,{includeMetadataChanges:!0,Ka:!0});return Ef(o,E)})(await Gf(s),s.asyncQueue,e,t,n))),n.promise}function Jf(s,e){const t=new Ct;return s.asyncQueue.enqueueAndForget((async()=>jf(await Kf(s),e,t))),t.promise}function lu(s){const e={};return s.timeoutSeconds!==void 0&&(e.timeoutSeconds=s.timeoutSeconds),e}const Yf="ComponentProvider",gl=new Map;function Xf(s,e,t,n,r){return new mm(s,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,lu(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator,n)}const cu="firestore.googleapis.com",yl=!0;class _l{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new H(L.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=cu,this.ssl=yl}else this.host=e.host,this.ssl=e.ssl??yl;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Bc;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Ep)throw new H(L.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}nm("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=lu(e.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new H(L.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new H(L.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new H(L.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(n,r){return n.timeoutSeconds===r.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Rr{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new _l({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new H(L.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new H(L.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new _l(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new Wd;switch(n.type){case"firstParty":return new Jd(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new H(L.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const n=gl.get(t);n&&(z(Yf,"Removing Datastore"),gl.delete(t),n.terminate())})(this),Promise.resolve()}}function Zf(s,e,t,n={}){s=vn(s,Rr);const r=Ui(e),o=s._getSettings(),a={...o,emulatorOptions:s._getEmulatorOptions()},u=`${e}:${t}`;r&&(_h(`https://${u}`),Th("Firestore",!0)),o.host!==cu&&o.host!==u&&Gt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const d={...o,host:u,ssl:r,emulatorOptions:n};if(!nr(d,a)&&(s._setSettings(d),n.mockUserToken)){let m,f;if(typeof n.mockUserToken=="string")m=n.mockUserToken,f=Ve.MOCK_USER;else{m=vh(n.mockUserToken,s._app?.options.projectId);const E=n.mockUserToken.sub||n.mockUserToken.user_id;if(!E)throw new H(L.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Ve(E)}s._authCredentials=new Kd(new Xl(m,f))}}class Pr{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Pr(this.firestore,e,this._query)}}class Ne{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Nt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ne(this.firestore,e,this._key)}toJSON(){return{type:Ne._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(bs(t,Ne._jsonSchema))return new Ne(e,n||null,new W(ce.fromString(t.referencePath)))}}Ne._jsonSchemaVersion="firestore/documentReference/1.0",Ne._jsonSchema={type:_e("string",Ne._jsonSchemaVersion),referencePath:_e("string")};class Nt extends Pr{constructor(e,t,n){super(e,t,yc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ne(this.firestore,null,new W(e))}withConverter(e){return new Nt(this.firestore,e,this._path)}}function yo(s,e,...t){if(s=us(s),Zl("collection","path",e),s instanceof Rr){const n=ce.fromString(e,...t);return ka(n),new Nt(s,null,n)}{if(!(s instanceof Ne||s instanceof Nt))throw new H(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(ce.fromString(e,...t));return ka(n),new Nt(s.firestore,null,n)}}function Pn(s,e,...t){if(s=us(s),arguments.length===1&&(e=Hi.newId()),Zl("doc","path",e),s instanceof Rr){const n=ce.fromString(e,...t);return Pa(n),new Ne(s,null,new W(n))}{if(!(s instanceof Ne||s instanceof Nt))throw new H(L.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=s._path.child(ce.fromString(e,...t));return Pa(n),new Ne(s.firestore,s instanceof Nt?s.converter:null,new W(n))}}const vl="AsyncQueue";class bl{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Hc(this,"async_queue_retry"),this._c=()=>{const n=ui();n&&z(vl,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=e;const t=ui();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=ui();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Ct;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Yu.push(e),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!Nn(e))throw e;z(vl,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((n=>{throw this.nc=n,this.rc=!1,ct("INTERNAL UNHANDLED ERROR: ",El(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=ho.createAndSchedule(this,e,t,n,(o=>this.hc(o)));return this.tc.push(r),r}uc(){this.nc&&Q(47125,{Pc:El(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,n)=>t.targetTimeMs-n.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function El(s){let e=s.message||"";return s.stack&&(e=s.stack.includes(s.message)?s.stack:s.message+`
`+s.stack),e}class kr extends Rr{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new bl,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new bl(e),this._firestoreClient=void 0,await e}}}function eg(s,e){const t=typeof s=="object"?s:kd(),n=typeof s=="string"?s:or,r=Sd(t,"firestore").getImmediate({identifier:n});if(!r._initialized){const o=gh("firestore");o&&Zf(r,...o)}return r}function uu(s){if(s._terminated)throw new H(L.FAILED_PRECONDITION,"The client has already been terminated.");return s._firestoreClient||tg(s),s._firestoreClient}function tg(s){const e=s._freezeSettings(),t=Xf(s._databaseId,s._app?.options.appId||"",s._persistenceKey,s._app?.options.apiKey,e);s._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(s._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),s._firestoreClient=new Hf(s._authCredentials,s._appCheckCredentials,s._queue,t,s._componentsProvider&&(function(r){const o=r?._online.build();return{_offline:r?._offline.build(o),_online:o}})(s._componentsProvider))}class He{constructor(e){this._byteString=e}static fromBase64String(e){try{return new He(ke.fromBase64String(e))}catch(t){throw new H(L.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new He(ke.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:He._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(bs(e,He._jsonSchema))return He.fromBase64String(e.bytes)}}He._jsonSchemaVersion="firestore/bytes/1.0",He._jsonSchema={type:_e("string",He._jsonSchemaVersion),bytes:_e("string")};class hu{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new H(L.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Pe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class du{constructor(e){this._methodName=e}}class nt{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new H(L.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new H(L.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return ee(this._lat,e._lat)||ee(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:nt._jsonSchemaVersion}}static fromJSON(e){if(bs(e,nt._jsonSchema))return new nt(e.latitude,e.longitude)}}nt._jsonSchemaVersion="firestore/geoPoint/1.0",nt._jsonSchema={type:_e("string",nt._jsonSchemaVersion),latitude:_e("number"),longitude:_e("number")};class Ge{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(n,r){if(n.length!==r.length)return!1;for(let o=0;o<n.length;++o)if(n[o]!==r[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Ge._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(bs(e,Ge._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new Ge(e.vectorValues);throw new H(L.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ge._jsonSchemaVersion="firestore/vectorValue/1.0",Ge._jsonSchema={type:_e("string",Ge._jsonSchemaVersion),vectorValues:_e("object")};const ng=/^__.*__$/;class sg{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new Xt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Es(e,this.data,t,this.fieldTransforms)}}function mu(s){switch(s){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Q(40011,{dataSource:s})}}class _o{constructor(e,t,n,r,o,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,o===void 0&&this.validatePath(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new _o({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){const t=this.path?.child(e),n=this.contextWith({path:t,arrayElement:!1});return n.validatePathSegment(e),n}childContextForFieldPath(e){const t=this.path?.child(e),n=this.contextWith({path:t,arrayElement:!1});return n.validatePath(),n}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return gr(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(mu(this.dataSource)&&ng.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class rg{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Sr(e)}createContext(e,t,n,r=!1){return new _o({dataSource:e,methodName:t,targetDoc:n,path:Pe.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ig(s){const e=s._freezeSettings(),t=Sr(s._databaseId);return new rg(s._databaseId,!!e.ignoreUndefinedProperties,t)}function og(s,e,t,n,r,o={}){const a=s.createContext(o.merge||o.mergeFields?2:0,e,t,r);yu("Data must be an object, but it was:",a,n);const u=fu(n,a);let d,m;if(o.merge)d=new Ke(a.fieldMask),m=a.fieldTransforms;else if(o.mergeFields){const f=[];for(const E of o.mergeFields){const w=vo(e,E,t);if(!a.contains(w))throw new H(L.INVALID_ARGUMENT,`Field '${w}' is specified in your field mask but missing from your input data.`);cg(f,w)||f.push(w)}d=new Ke(f),m=a.fieldTransforms.filter((E=>d.covers(E.field)))}else d=null,m=a.fieldTransforms;return new sg(new ze(u),d,m)}function pu(s,e){if(gu(s=us(s)))return yu("Unsupported field value:",e,s),fu(s,e);if(s instanceof du)return(function(n,r){if(!mu(r.dataSource))throw r.createError(`${n._methodName}() can only be used with update() and set()`);if(!r.path)throw r.createError(`${n._methodName}() is not currently supported inside arrays`);const o=n._toFieldTransform(r);o&&r.fieldTransforms.push(o)})(s,e),null;if(s===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return(function(n,r){const o=[];let a=0;for(const u of n){let d=pu(u,r.childContextForArray(a));d==null&&(d={nullValue:"NULL_VALUE"}),o.push(d),a++}return{arrayValue:{values:o}}})(s,e)}return(function(n,r){if((n=us(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Mm(r.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const o=ue.fromDate(n);return{timestampValue:dr(r.serializer,o)}}if(n instanceof ue){const o=new ue(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:dr(r.serializer,o)}}if(n instanceof nt)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof He)return{bytesValue:Dc(r.serializer,n._byteString)};if(n instanceof Ne){const o=r.databaseId,a=n.firestore._databaseId;if(!a.isEqual(o))throw r.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:no(n.firestore._databaseId||r.databaseId,n._key.path)}}if(n instanceof Ge)return(function(a,u){const d=a instanceof Ge?a.toArray():a;return{mapValue:{fields:{[lc]:{stringValue:cc},[ar]:{arrayValue:{values:d.map((f=>{if(typeof f!="number")throw u.createError("VectorValues must only contain numeric values.");return Xi(u.serializer,f)}))}}}}}})(n,r);if($c(n))return n._toProto(r.serializer);throw r.createError(`Unsupported field value: ${Wi(n)}`)})(s,e)}function fu(s,e){const t={};return nc(s)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Jt(s,((n,r)=>{const o=pu(r,e.childContextForField(n));o!=null&&(t[n]=o)})),{mapValue:{fields:t}}}function gu(s){return!(typeof s!="object"||s===null||s instanceof Array||s instanceof Date||s instanceof ue||s instanceof nt||s instanceof He||s instanceof Ne||s instanceof du||s instanceof Ge||$c(s))}function yu(s,e,t){if(!gu(t)||!ec(t)){const n=Wi(t);throw n==="an object"?e.createError(s+" a custom object"):e.createError(s+" "+n)}}function vo(s,e,t){if((e=us(e))instanceof hu)return e._internalPath;if(typeof e=="string")return lg(s,e);throw gr("Field path arguments must be of type string or ",s,!1,void 0,t)}const ag=new RegExp("[~\\*/\\[\\]]");function lg(s,e,t){if(e.search(ag)>=0)throw gr(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,s,!1,void 0,t);try{return new hu(...e.split("."))._internalPath}catch{throw gr(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,s,!1,void 0,t)}}function gr(s,e,t,n,r){const o=n&&!n.isEmpty(),a=r!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let d="";return(o||a)&&(d+=" (found",o&&(d+=` in field ${n}`),a&&(d+=` in document ${r}`),d+=")"),new H(L.INVALID_ARGUMENT,u+s+d)}function cg(s,e){return s.some((t=>t.isEqual(e)))}class ug{convertValue(e,t="none"){switch(Dt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return pe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(kt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Q(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Jt(e,((r,o)=>{n[r]=this.convertValue(o,t)})),n}convertVectorValue(e){const t=e.fields?.[ar].arrayValue?.values?.map((n=>pe(n.doubleValue)));return new Ge(t)}convertGeoPoint(e){return new nt(pe(e.latitude),pe(e.longitude))}convertArray(e,t){return(e.values||[]).map((n=>this.convertValue(n,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=br(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ps(e));default:return null}}convertTimestamp(e){const t=Pt(e);return new ue(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ce.fromString(e);oe(Mc(n),9688,{name:e});const r=new fs(n.get(1),n.get(3)),o=new W(n.popFirst(5));return r.isEqual(t)||ct(`Document ${o} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}class hg extends ug{constructor(e){super(),this.firestore=e}convertBytes(e){return new He(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ne(this.firestore,null,t)}}const Tl="@firebase/firestore",wl="4.11.0";class _u{constructor(e,t,n,r,o){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new Ne(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new dg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){const t=this._document.data.field(vo("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class dg extends _u{data(){return super.data()}}function mg(s){if(s.limitType==="L"&&s.explicitOrderBy.length===0)throw new H(L.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function pg(s,e,t){let n;return n=s?s.toFirestore(e):e,n}class Gs{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class fn extends _u{constructor(e,t,n,r,o,a){super(e,t,n,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new er(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(vo("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new H(L.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=fn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}fn._jsonSchemaVersion="firestore/documentSnapshot/1.0",fn._jsonSchema={type:_e("string",fn._jsonSchemaVersion),bundleSource:_e("string","DocumentSnapshot"),bundleName:_e("string"),bundle:_e("string")};class er extends fn{data(e={}){return super.data(e)}}class gn{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Gs(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new er(this._firestore,this._userDataWriter,n.key,n,new Gs(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new H(L.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(r,o){if(r._snapshot.oldDocs.isEmpty()){let a=0;return r._snapshot.docChanges.map((u=>{const d=new er(r._firestore,r._userDataWriter,u.doc.key,u.doc,new Gs(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter);return u.doc,{type:"added",doc:d,oldIndex:-1,newIndex:a++}}))}{let a=r._snapshot.oldDocs;return r._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const d=new er(r._firestore,r._userDataWriter,u.doc.key,u.doc,new Gs(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter);let m=-1,f=-1;return u.type!==0&&(m=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:fg(u.type),doc:d,oldIndex:m,newIndex:f}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new H(L.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=gn._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Hi.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],r=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),n.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),r.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function fg(s){switch(s){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Q(61501,{type:s})}}gn._jsonSchemaVersion="firestore/querySnapshot/1.0",gn._jsonSchema={type:_e("string",gn._jsonSchemaVersion),bundleSource:_e("string","QuerySnapshot"),bundleName:_e("string"),bundle:_e("string")};function bo(s){s=vn(s,Pr);const e=vn(s.firestore,kr),t=uu(e),n=new hg(e);return mg(s._query),Qf(t,s._query).then((r=>new gn(e,n,s,r)))}function Dr(s,e,t){s=vn(s,Ne);const n=vn(s.firestore,kr),r=pg(s.converter,e),o=ig(n);return vu(n,[og(o,"setDoc",s._key,r,s.converter!==null,t).toMutation(s._key,et.none())])}function Eo(s){return vu(vn(s.firestore,kr),[new Zi(s._key,et.none())])}function vu(s,e){const t=uu(s);return Jf(t,e)}(function(e,t=!0){Hd(Pd),rr(new hs("firestore",((n,{instanceIdentifier:r,options:o})=>{const a=n.getProvider("app").getImmediate(),u=new kr(new Gd(n.getProvider("auth-internal")),new Yd(a,n.getProvider("app-check-internal")),pm(a,r),a);return o={useFetchStreams:t,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),dn(Tl,wl,e),dn(Tl,wl,"esm2020")})();const Li={apiKey:"",authDomain:"",projectId:"",storageBucket:"",messagingSenderId:"",appId:""},Le=!!(Li.apiKey&&Li.projectId);let Il=null,it=null;Le&&(Il=Ul(Li),it=eg(Il));const bu="/Claude/",In=`${bu}sodexo-live-logo.svg`,Eu=`${bu}sodexo-dark.svg`,Al="sdx_salt",Vr="sdx_users",Tu="sdx_inspection_vault",xl="sdx_device_secret",gg=600*1e3,wu="sdx_autofill_memory";function ns(){try{return JSON.parse(localStorage.getItem(wu))||{}}catch{return{}}}function yg(s){const e=ns(),t=["siteName","siteNumber","supervisorName","sitePhone","locationType"];for(const n of t)s[n]&&(e[n]||(e[n]=[]),e[n].includes(s[n])||(e[n].unshift(s[n]),e[n]=e[n].slice(0,10)));s.siteName&&s.siteNumber&&(e.siteMap||(e.siteMap={}),e.siteMap[s.siteName]={siteNumber:s.siteNumber,sitePhone:s.sitePhone||"",supervisorName:s.supervisorName||"",locationType:s.locationType||"",floor:s.floor||""}),localStorage.setItem(wu,JSON.stringify(e))}const di={name:"Joxel Da Silva",badge:"365582",department:"Safety Inspector"};async function Iu(){let s=localStorage.getItem(Al);if(s)return new Uint8Array(JSON.parse(s));const e=crypto.getRandomValues(new Uint8Array(16));return localStorage.setItem(Al,JSON.stringify(Array.from(e))),e}async function _g(s){const e=new TextEncoder,t=await Iu(),n=await crypto.subtle.importKey("raw",e.encode(s),"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function jr(s){const e=new TextEncoder,t=await Iu(),n=new Uint8Array([...t,...e.encode(s)]),r=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(r)).map(o=>o.toString(16).padStart(2,"0")).join("")}async function vg(s,e){const t=crypto.getRandomValues(new Uint8Array(12)),n=new TextEncoder,r=await crypto.subtle.encrypt({name:"AES-GCM",iv:t},e,n.encode(JSON.stringify(s)));return JSON.stringify({iv:Array.from(t),ct:Array.from(new Uint8Array(r))})}async function bg(s,e){if(!s)return[];try{const{iv:t,ct:n}=JSON.parse(s),r=await crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(t)},e,new Uint8Array(n));return JSON.parse(new TextDecoder().decode(r))}catch{return[]}}async function Eg(){let s=localStorage.getItem(xl);if(!s){const e=crypto.getRandomValues(new Uint8Array(32));s=Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join(""),localStorage.setItem(xl,s)}return _g("sdx_master_"+s)}async function Ue(){if(Le)try{return(await bo(yo(it,"users"))).docs.map(e=>e.data())}catch{return[]}try{return JSON.parse(localStorage.getItem(Vr)||"[]")}catch{return[]}}async function As(s){if(Le){try{await Dr(Pn(it,"users",s.badgeHash),s)}catch{}return}const e=await Ue(),t=e.findIndex(n=>n.badgeHash===s.badgeHash);t>=0?e[t]=s:e.push(s),localStorage.setItem(Vr,JSON.stringify(e))}async function Tg(s){if(Le){try{await Eo(Pn(it,"users",s))}catch{}return}const e=await Ue();localStorage.setItem(Vr,JSON.stringify(e.filter(t=>t.badgeHash!==s)))}async function Au(){if((await Ue()).length>0)return;const e=await jr(di.badge),t={badgeHash:e,name:di.name,department:di.department,role:"admin",approved:!0,registeredAt:new Date().toISOString()};Le?await Dr(Pn(it,"users",e),t):localStorage.setItem(Vr,JSON.stringify([t]))}let An=null,Mi=null;async function To(){if(Le)try{const t=(await bo(yo(it,"inspections"))).docs.map(n=>n.data());return t.sort((n,r)=>(r.savedAt||"").localeCompare(n.savedAt||"")),t}catch{return[]}if(!An)return[];const s=localStorage.getItem(Tu);return bg(s,An)}async function wo(s){if(Le){try{for(const t of s)await Dr(Pn(it,"inspections",t.id),t)}catch(t){console.error("Firestore saveHistory error:",t)}return}if(!An)return;const e=await vg(s,An);localStorage.setItem(Tu,e)}async function wg(s){if(Le){try{await Dr(Pn(it,"inspections",s.id),s)}catch{}return}const e=await To();e.unshift(s),await wo(e)}async function Ig(s){if(Le){try{await Eo(Pn(it,"inspections",s))}catch{}return}const e=await To();await wo(e.filter(t=>t.id!==s))}async function Ag(){if(Le){try{const s=await bo(yo(it,"inspections"));for(const e of s.docs)await Eo(e.ref)}catch{}return}await wo([])}async function xg(s){await Au();const e=await jr(s),n=(await Ue()).find(r=>r.badgeHash===e);return n?n.approved?(Le||(An=await Eg()),Mi={...n},{ok:!0,user:Mi}):{ok:!1,reason:"pending"}:{ok:!1,reason:"not_found"}}async function Sg(s,e,t){const n=await jr(s);if((await Ue()).find(a=>a.badgeHash===n))return{ok:!1,reason:"exists"};const o={badgeHash:n,name:e,department:t,badgeDisplay:s.length>4?""+s.slice(-4):s,role:"inspector",approved:!1,registeredAt:new Date().toISOString()};return await As(o),{ok:!0}}function Sl(){An=null,Mi=null}async function Cg(s,e,t,n){const r=await jr(s);if((await Ue()).find(u=>u.badgeHash===r))return{ok:!1,reason:"exists"};const a={badgeHash:r,name:e,department:t,badgeDisplay:s.length>4?""+s.slice(-4):s,role:n||"inspector",approved:!0,registeredAt:new Date().toISOString()};return await As(a),{ok:!0}}async function Ng(s){const t=(await Ue()).find(n=>n.badgeHash===s);t&&(t.approved=!0,await As(t))}async function Cl(s){await Tg(s)}async function Rg(s){const t=(await Ue()).find(n=>n.badgeHash===s);t&&(t.role="admin",await As(t))}async function Pg(s){const t=(await Ue()).find(n=>n.badgeHash===s);t&&(t.role="inspector",await As(t))}function kg({onUnlock:s}){const[e,t]=q.useState(""),[n,r]=q.useState("signin"),[o,a]=q.useState(""),[u,d]=q.useState(""),[m,f]=q.useState(""),[E,w]=q.useState(!1),[C,I]=q.useState(""),R=q.useRef(null);q.useEffect(()=>{Au()},[]),q.useEffect(()=>{R.current?.focus()},[n]);async function N(S){S.preventDefault(),f(""),w(!0);try{const F=await xg(e.trim());if(F.ok){s(F.user);return}F.reason==="pending"?r("pending"):f("Badge not recognized. Request access below if youre new.")}catch{f("Something went wrong. Try again.")}finally{w(!1)}}async function k(S){S.preventDefault(),f(""),w(!0);try{const F=await Sg(e.trim(),o.trim(),u.trim());F.ok?(I("Registration submitted! Ask an administrator to approve your badge."),r("pending")):F.reason==="exists"&&f("This badge is already registered. Try signing in.")}catch{f("Registration failed. Try again.")}finally{w(!1)}}return l.jsx("div",{className:"pinOverlay",children:l.jsxs("div",{className:"pinCard",children:[l.jsx("img",{src:Eu,alt:"Sodexo",className:"pinLogo"}),n==="signin"&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"pinTitle",children:"Badge Sign-In"}),l.jsx("div",{className:"pinSub",children:"Enter your work badge number to access inspections"}),l.jsxs("form",{onSubmit:N,className:"pinForm",children:[l.jsx("input",{ref:R,className:"pinInput badgeInput",type:"password",maxLength:20,value:e,onChange:S=>t(S.target.value),placeholder:"Badge #",autoComplete:"off"}),m&&l.jsx("div",{className:"pinError",children:m}),l.jsx("button",{className:"btn btnPrimary pinBtn",type:"submit",disabled:E||e.trim().length<3,children:E?"Verifying...":"Sign In"})]}),l.jsx("button",{className:"btnLink",type:"button",onClick:()=>{r("register"),f(""),t("")},children:"New here? Request access"})]}),n==="register"&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"pinTitle",children:"Request Access"}),l.jsx("div",{className:"pinSub",children:"Fill in your details. An administrator will review your request."}),l.jsxs("form",{onSubmit:k,className:"pinForm",children:[l.jsx("input",{ref:R,className:"pinInput badgeInput",type:"password",maxLength:20,value:e,onChange:S=>t(S.target.value),placeholder:"Badge #",autoComplete:"off"}),l.jsx("input",{className:"input regInput",value:o,onChange:S=>a(S.target.value),placeholder:"Full name",autoComplete:"name"}),l.jsx("input",{className:"input regInput",value:u,onChange:S=>d(S.target.value),placeholder:"Department"}),m&&l.jsx("div",{className:"pinError",children:m}),l.jsx("button",{className:"btn btnPrimary pinBtn",type:"submit",disabled:E||e.trim().length<3||!o.trim()||!u.trim(),children:E?"Submitting...":"Request Access"})]}),l.jsx("button",{className:"btnLink",type:"button",onClick:()=>{r("signin"),f(""),t("")},children:"Already registered? Sign in"})]}),n==="pending"&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"pinTitle",children:"Pending Approval"}),l.jsx("div",{className:"pinSub",children:C||"Your access request is awaiting administrator approval."}),l.jsx("div",{className:"pendingIcon",children:""}),l.jsx("button",{className:"btnLink",type:"button",onClick:()=>{r("signin"),f(""),I(""),t("")},children:"Back to sign in"})]}),l.jsxs("div",{className:"pinFooter",children:[l.jsx("span",{className:"pinLock",children:""})," AES-256 encrypted  stored only on this device"]})]})})}function Io(s,e){const t=URL.createObjectURL(s),n=document.createElement("a");n.href=t,n.download=e,document.body.appendChild(n),n.click(),setTimeout(()=>{document.body.removeChild(n),URL.revokeObjectURL(t)},100)}const yn={inspection:{label:"Kitchen Inspection",contextFields:[{key:"kitchen",label:"Kitchen / Location"},{key:"participants",label:"Participants"},{key:"date",label:"Date"}],useCases:["Email Summary","Google Doc","Slack Update","Evaluation Scorecard"],sample:{meta:{inspectionType:"Event Day",inspectionDate:"2026-02-09",inspectorName:"J. Da Silva"},context:{kitchen:"Concourse Kitchen  North Stand",participants:"Chef Lead, Sanitation Lead, Ops Manager",date:"2026-02-09"},inspection:{facility:{ceiling:{status:"OK",notes:"",photos:[]},walls:{status:"OK",notes:"",photos:[]},floors:{status:"Needs Attention",notes:"Slip hazard near mop sink.",photos:[]},lighting:{status:"Needs Attention",notes:"Bulb out over dish station.",photos:[]}},operations:{employeePractices:{status:"Needs Attention",notes:"Coaching on hot holding.",photos:[]},handwashing:{status:"OK",notes:"Soap low at one hand sink.",photos:[]},labelingDating:{status:"Needs Attention",notes:"A few unlabeled containers.",photos:[]},logs:{status:"Needs Attention",notes:"Chemical logs missing 2/7.",photos:[]}},temps:{handSinkTempF:96,threeCompSinkTempF:110},equipment:{doubleDoorCooler:{status:"OK",notes:"38F",photos:[]},doubleDoorFreezer:{status:"OK",notes:"",photos:[]},walkInCooler:{status:"OK",notes:"",photos:[]},warmers:{status:"Needs Attention",notes:"Hot hold 142F (borderline).",photos:[]},ovens:{status:"OK",notes:"",photos:[]},threeCompSink:{status:"OK",notes:"",photos:[]},ecolab:{status:"OK",notes:"Sanitizer 150 ppm",photos:[]}}},rawNotes:"sitdown after svc. recap insp: cooler 38F ok. hot hold 142F (border). q: when calibrate therms? last wk. found: 3 cutting boards scored. chem logs missing 2/7. pest trap behind dry storage shifted. action: replace boards, backfill logs, reset trap + pic, coach hot holding. owner: chef lead. due: Fri."}}},Dg=["OK","Not Clean","Needs Attention","N/A"],mi=6,Nl=8,Vg=["Event Day","Post Event","Regular Inspection"],jg=["Concession","Subcontractor","Portable"],Fg=["Floor 1","Floor 2","Floor 3"],vs={doubleDoorCooler:{type:"cooler",max:40,label:"Double-door cooler"},doubleDoorFreezer:{type:"freezer",max:20,label:"Double-door freezer"},walkInCooler:{type:"cooler",max:40,label:"Walk-in cooler"},walkInFreezer:{type:"freezer",max:20,label:"Walk-in freezer"},prepCooler:{type:"cooler",max:40,label:"Prep cooler"}};function ls(s){const e=(s||"").toLowerCase();return/freezer|freez/.test(e)?{type:"freezer",max:20}:/cooler|cool|refrig|wic|w\.i\.c|walk.in.*c/i.test(e)?{type:"cooler",max:40}:null}function kn(s){const e=[],t=s?.equipment||{};for(const[n,r]of Object.entries(t)){if(!r?.tempF&&r?.tempF!==0)continue;const o=Number(r.tempF);if(!o&&r.tempF==="")continue;const a=vs[n]||(n.startsWith("custom_")?ls(r.label):null);if(!a)continue;const u=vs[n]?.label||r.label||n;e.push({key:n,label:u,tempF:r.tempF,tempNum:o,type:a.type,max:a.max,pass:o<=a.max})}return e}const yr={"Event Day":{headline:"Event Day Readiness",opening:"This is an Event Day inspection focused on pre-service readiness and risk control before peak volume."},"Post Event":{headline:"Post-Event Close-Out",opening:"This is a Post Event inspection focused on close-out conditions, cleanup effectiveness, and immediate corrective actions after service."},"Regular Inspection":{headline:"Routine Compliance Review",opening:"This is a Regular Inspection focused on routine compliance, sanitation standards, and repeat-risk prevention."}},Og=[[/\bw\//gi,"with"],[/\bKM\b/g,"Kitchen Manager"],[/\bq\b/gi,"question"],[/\btemp(s?)\b/gi,"temperature$1"],[/\bok\b/gi,"OK"],[/\bchk\b/gi,"check"],[/\bwk\b/gi,"week"],[/\b(\d+)x\b/gi,"$1"],[/\binsp\b/gi,"inspection"],[/\bsvc\b/gi,"service"],[/\btherm(s?)\b/gi,"thermometer$1"],[/\bchem\b/gi,"chemical"],[/\bdocs?\b/gi,"document(s)"],[/\bpic\b/gi,"photo"],[/\bborder\b/gi,"borderline"]];function Fr(s){let e=s;for(const[t,n]of Og)e=e.replace(t,n);return e}const Lg=[[/\bi\b/g,"I"],[/\bdoesnt\b/gi,"doesn't"],[/\bdidnt\b/gi,"didn't"],[/\bwasnt\b/gi,"wasn't"],[/\bwerent\b/gi,"weren't"],[/\bcant\b/gi,"can't"],[/\bwont\b/gi,"won't"],[/\bcouldnt\b/gi,"couldn't"],[/\bshouldnt\b/gi,"shouldn't"],[/\bwouldnt\b/gi,"wouldn't"],[/\bisnt\b/gi,"isn't"],[/\barent\b/gi,"aren't"],[/\bhasnt\b/gi,"hasn't"],[/\bhavent\b/gi,"haven't"],[/\btheyre\b/gi,"they're"],[/\btheres\b/gi,"there's"],[/\bwere\b(?!\s)/gi,"we're"],[/\bits\b(?=\s+[a-z])/gi,"it's"],[/\brecieved?\b/gi,"received"],[/\bseperately?\b/gi,"separately"],[/\boccured\b/gi,"occurred"],[/\buntill?\b/gi,"until"],[/\balot\b/gi,"a lot"],[/\bteh\b/gi,"the"],[/\bwich\b/gi,"which"],[/\bthere\s+is\b/gi,"there is"],[/\bthru\b/gi,"through"],[/\bppl\b/gi,"people"],[/\bmgr\b/gi,"manager"],[/\bmgmt\b/gi,"management"],[/\bequip\b/gi,"equipment"],[/\bmaint\b/gi,"maintenance"],[/\brefrig\b/gi,"refrigerator"],[/\binfo\b/gi,"information"],[/\bamt\b/gi,"amount"],[/\bapprox\b/gi,"approximately"],[/\bmin\b(?=\s|\.|\,|$)/gi,"minimum"],[/\bmax\b(?=\s|\.|\,|$)/gi,"maximum"],[/\bF\b(?=\s*[\.\,\)]|$)/g,"F"]],Mg=[{key:"action",patterns:[/\baction\b/i,/\breplace\b/i,/\bfix\b/i,/\brepair\b/i,/\bschedule\b/i,/\bcoach\b/i,/\bfollow\s*up\b/i,/\bbackfill\b/i,/\breset\b/i]},{key:"finding",patterns:[/\bfound\b/i,/\bnoted\b/i,/\bobserved\b/i,/\bscored\b/i,/\bmissing\b/i,/\bshifted\b/i,/\blow\b/i,/\bbroken\b/i,/\bdamaged\b/i,/\bflagged\b/i]},{key:"temp",patterns:[/\d+\s*?F/i,/\btemperature\b/i,/\bcooler\b/i,/\bfreezer\b/i,/\bhot\s*hold/i,/\bwarm/i]},{key:"question",patterns:[/\bquestion\b/i,/\basked\b/i,/\bwhen\b/i,/\?$/]},{key:"owner",patterns:[/\bowner\b/i,/\bdue\b/i,/\bassign/i,/\bchef\s*lead\b/i]},{key:"context",patterns:[/\bsitdown\b/i,/\bsit-down\b/i,/\brecap\b/i,/\bafter\b/i,/\bbefore\b/i,/\bduring\b/i]}];function $g(s){for(const e of Mg)for(const t of e.patterns)if(t.test(s))return e.key;return"general"}const Or={context:"Context",finding:"Findings",temp:"Temperatures",question:"Questions",action:"Action Items",owner:"Ownership & Deadlines",general:"Notes"},Lr=["context","temp","finding","question","action","owner","general"];function Bg(s){let e=s;for(const[t,n]of Lg)e=e.replace(t,n);return e=e.replace(/^\s*([a-z])/,(t,n)=>n.toUpperCase()),e=e.replace(/\s{2,}/g," "),e=e.trim(),e&&!/[.!?]$/.test(e)&&(e+="."),e}function Mr(s){if(!s||!s.trim())return{bullets:[],grouped:{}};const n=Fr(s).split(/(?<=\.)\s+|;\s*|\n+/).map(o=>o.trim()).filter(o=>o.length>2).map(o=>Bg(o)),r={};for(const o of n){const a=$g(o);r[a]||(r[a]=[]),r[a].push(o)}return{bullets:n,grouped:r}}function cs(s){const{grouped:e}=Mr(s),t=[];for(const n of Lr)if(!(!e[n]||!e[n].length)){t.push(`${Or[n]}:`);for(const r of e[n])t.push(`   ${r}`);t.push("")}return t.join(`
`).trim()||s||""}function fe(...s){return s.filter(Boolean).join(" ")}function Rl(s){const e=yn[s],t={};for(const n of e.contextFields)t[n.key]="";return t.date!==void 0&&(t.date=new Date().toISOString().slice(0,10)),t}function ye(s){return{...s,photos:[]}}function pi(){return{facility:{ceiling:ye({status:"OK",notes:""}),walls:ye({status:"OK",notes:""}),floors:ye({status:"OK",notes:""}),lighting:ye({status:"OK",notes:""})},operations:{employeePractices:ye({status:"OK",notes:""}),handwashing:ye({status:"OK",notes:""}),labelingDating:ye({status:"OK",notes:""}),logs:ye({status:"OK",notes:""})},temps:{handSinkTempF:"",threeCompSinkTempF:""},equipment:{doubleDoorCooler:ye({status:"OK",notes:"",tempF:""}),doubleDoorFreezer:ye({status:"OK",notes:"",tempF:""}),walkInCooler:ye({status:"OK",notes:"",tempF:""}),walkInFreezer:ye({status:"OK",notes:"",tempF:""}),prepCooler:ye({status:"OK",notes:"",tempF:""}),warmers:ye({status:"OK",notes:""}),ovens:ye({status:"OK",notes:""}),threeCompSink:ye({status:"OK",notes:""}),ecolab:ye({status:"OK",notes:""})}}}function Ug(s,e){return`${yn[s].label}  ${e}`}function fi(s,e){return e.reduce((t,n)=>t?t[n]:void 0,s)}function Tt(s,e,t){const[n,...r]=e;return n?{...s,[n]:r.length?Tt(s?.[n]??{},r,t):t}:t}function Pl(s){return Math.round(s/(1024*1024)*10)/10}function qg(s,e=800,t=.6){return new Promise(n=>{const r=new Image;r.onload=()=>{let{width:o,height:a}=r;if(o>e||a>e){const m=Math.min(e/o,e/a);o=Math.round(o*m),a=Math.round(a*m)}const u=document.createElement("canvas");u.width=o,u.height=a,u.getContext("2d").drawImage(r,0,0,o,a),n(u.toDataURL("image/jpeg",t))},r.onerror=()=>n(null),r.src=URL.createObjectURL(s)})}function zg(s){let e=0;const t=n=>{if(!(!n||typeof n!="object")){if(Array.isArray(n)){n.forEach(t);return}n.photos?.length&&(e+=n.photos.length);for(const r of Object.values(n))t(r)}};return t(s),e}function It(s){return String(s||"").trim()}function xu(s){const t=String(s||"").match(/action\s*:\s*([\s\S]+)/i);return t?t[1].split(/next\s*chk|next\s*check|follow\s*up|owner\s*:/i)[0].trim().split(",").map(r=>It(r)).filter(Boolean).map(r=>({issue:r})):[]}function Ft(s){const e=[],t=o=>{if(!(!o||typeof o!="object")){o.status&&(o.status==="Needs Attention"||o.status==="Not Clean")&&e.push(!0);for(const a of Object.keys(o))t(o[a])}};t(s?.facility),t(s?.operations),t(s?.equipment);const n=Number(s?.temps?.handSinkTempF),r=Number(s?.temps?.threeCompSinkTempF);return!Number.isNaN(n)&&n&&n<95&&e.push(!0),!Number.isNaN(r)&&r&&r<110&&e.push(!0),e.length?"Needs Attention":"Pass"}function Hg({inspectionDate:s,inspectorName:e,context:t,noteType:n,inspection:r}){const o=[];s||o.push({text:"Inspection Date is missing",fieldId:"field-inspectionDate"}),e||o.push({text:"Inspector Name is missing",fieldId:"field-inspectorName"});const a=yn[n].contextFields;for(const u of a)t[u.key]?.trim()||o.push({text:`${u.label} is missing`,fieldId:`field-ctx-${u.key}`});return r.temps.handSinkTempF||o.push({text:"Hand sink temperature not recorded",fieldId:"field-handSinkTempF"}),r.temps.threeCompSinkTempF||o.push({text:"3-comp sink temperature not recorded",fieldId:"field-threeCompSinkTempF"}),o}function Wg({noteType:s,context:e,inspection:t,inspectionType:n,inspectionDate:r,siteName:o,siteNumber:a}){const u=Ft(t),d=o||e?.kitchen||"Kitchen",m=a?` (#${a})`:"",f=r||e?.date||"Date",E=n?`  ${n}`:"";return`Subject: ${d}${m} Kitchen Inspection${E}  ${f}  ${u}`}function xs(s){const e=[["facility","ceiling","Facility > Ceiling"],["facility","walls","Facility > Walls"],["facility","floors","Facility > Floors"],["facility","lighting","Facility > Lighting"],["operations","employeePractices","Operations > Employee practices"],["operations","handwashing","Operations > Handwashing / supplies"],["operations","labelingDating","Operations > Labeling / dating"],["operations","logs","Operations > Logs / documentation"],["equipment","doubleDoorCooler","Equipment > Double-door cooler"],["equipment","doubleDoorFreezer","Equipment > Double-door freezer"],["equipment","walkInCooler","Equipment > Walk-in cooler"],["equipment","walkInFreezer","Equipment > Walk-in freezer"],["equipment","prepCooler","Equipment > Prep cooler"],["equipment","warmers","Equipment > Warmers / hot holding"],["equipment","ovens","Equipment > Ovens"],["equipment","threeCompSink","Equipment > 3-compartment sink"],["equipment","ecolab","Equipment > Ecolab / chemicals"]];for(const o of["facility","operations","equipment"]){const a=s?.[o]||{};for(const u of Object.keys(a))if(u.startsWith("custom_")){const d=o.charAt(0).toUpperCase()+o.slice(1);e.push([o,u,`${d} > ${a[u]?.label||"Custom"}`])}}let t=0;const n=[],r={};for(const[o,a,u]of e){const d=s?.[o]?.[a],m=d?.photos||[];if(!m.length)continue;const f=`${o}.${a}`;r[f]=[];for(const E of m){t+=1,r[f].push(t);const w=It(d?.notes)||It(E?.name)||"";n.push({num:t,label:u,caption:w,previewUrl:E.previewUrl||null})}}return{index:n,mapByPath:r}}function en({inspection:s,rawNotes:e}){const t=[],{mapByPath:n}=xs(s),r=(d,m,f)=>{f?.status&&(f.status==="Needs Attention"||f.status==="Not Clean")&&t.push({issue:`${m}: ${It(f.notes)||"Issue noted"}`,owner:"",due:"",priority:f.status==="Not Clean"?"High":"Med",photos:n[d]||[]})};r("facility.ceiling","Ceiling",s?.facility?.ceiling),r("facility.walls","Walls",s?.facility?.walls),r("facility.floors","Floors",s?.facility?.floors),r("facility.lighting","Lighting",s?.facility?.lighting),r("operations.employeePractices","Employee practices",s?.operations?.employeePractices),r("operations.handwashing","Handwashing / supplies",s?.operations?.handwashing),r("operations.labelingDating","Labeling / dating",s?.operations?.labelingDating),r("operations.logs","Logs / documentation",s?.operations?.logs),r("equipment.doubleDoorCooler","Double-door cooler",s?.equipment?.doubleDoorCooler),r("equipment.doubleDoorFreezer","Double-door freezer",s?.equipment?.doubleDoorFreezer),r("equipment.walkInCooler","Walk-in cooler",s?.equipment?.walkInCooler),r("equipment.walkInFreezer","Walk-in freezer",s?.equipment?.walkInFreezer),r("equipment.prepCooler","Prep cooler",s?.equipment?.prepCooler),r("equipment.warmers","Warmers / hot holding",s?.equipment?.warmers),r("equipment.ovens","Ovens",s?.equipment?.ovens),r("equipment.threeCompSink","3-compartment sink",s?.equipment?.threeCompSink),r("equipment.ecolab","Ecolab / chemicals",s?.equipment?.ecolab);const o=Number(s?.temps?.handSinkTempF);!Number.isNaN(o)&&o&&o<95&&t.push({issue:`Hand sink temperature below minimum: ${o}F (min 95F)`,owner:"",due:"",priority:"High",photos:[]});const a=Number(s?.temps?.threeCompSinkTempF);!Number.isNaN(a)&&a&&a<110&&t.push({issue:`3-compartment sink wash temperature below minimum: ${a}F (min 110F)`,owner:"",due:"",priority:"High",photos:[]});for(const d of kn(s))d.pass||t.push({issue:`${d.label} temperature above maximum: ${d.tempNum}F (max ${d.max}F)`,owner:"",due:"",priority:"High",photos:[]});for(const d of xu(e))t.push({issue:d.issue,owner:"",due:"",priority:"Med",photos:[]});const u=new Set;return t.filter(d=>{const m=d.issue.toLowerCase();return u.has(m)?!1:(u.add(m),!0)})}function Su(s){const e=`| Issue | Owner | Due | Priority | Photo # |
|---|---|---|---|---|`,t=s.map(n=>{const r=(n.photos||[]).length?n.photos.join(", "):"";return`| ${It(n.issue)} | ${It(n.owner)} | ${It(n.due)} | ${It(n.priority)} | ${r} |`}).join(`
`);return`${e}
${t||"|  |  |  |  |  |"}`}function kl({noteType:s,context:e,inspection:t,rawNotes:n,inspectionType:r,inspectionDate:o,inspectorName:a,siteName:u,siteNumber:d,sitePhone:m,supervisorName:f,floor:E}){const w=yr[r]||yr["Regular Inspection"],C=Wg({noteType:s,context:e,inspection:t,inspectionType:r,inspectionDate:o,siteName:u,siteNumber:d}),I=Ft(t),R=en({inspection:t,rawNotes:n}),{index:N}=xs(t),k=u||e?.kitchen||"Kitchen",S=d?` (#${d})`:"",F=o||e?.date||"",B=[`- Inspection Type: ${r||""}`,`- Site: ${k}${S}`,E?`- Floor: ${E}`:null,`- Date: ${F}`,`- Inspector: ${a||""}`,`- Supervisor: ${f||""}`,m?`- Site Phone: ${m}`:null,`- Overall Status: ${I}`].filter(Boolean).join(`
`),$=[`- siteName: ${u||""}`,`- siteNumber: ${d||""}`,`- supervisorName: ${f||""}`,m?`- sitePhone: ${m}`:null,...Object.entries(e||{}).map(([D,J])=>`- ${D}: ${J||""}`)].filter(Boolean).join(`
`),O=N.length?N.map(D=>`Photo ${D.num}  ${D.label}${D.caption?`  ${D.caption}`:""}`).join(`
`):"No photos attached.",b=[],y=(D,J)=>{J&&J.status&&J.status!=="OK"&&J.status!=="N/A"&&b.push(`- ${D}: ${J.status}${J.notes?`  ${J.notes}`:""}`)};y("Facility > Ceiling",t?.facility?.ceiling),y("Facility > Walls",t?.facility?.walls),y("Facility > Floors",t?.facility?.floors),y("Facility > Lighting",t?.facility?.lighting),y("Operations > Employee practices",t?.operations?.employeePractices),y("Operations > Handwashing / supplies",t?.operations?.handwashing),y("Operations > Labeling / dating",t?.operations?.labelingDating),y("Operations > Logs / documentation",t?.operations?.logs),y("Equipment > Double-door cooler",t?.equipment?.doubleDoorCooler),y("Equipment > Double-door freezer",t?.equipment?.doubleDoorFreezer),y("Equipment > Walk-in cooler",t?.equipment?.walkInCooler),y("Equipment > Warmers / hot holding",t?.equipment?.warmers),y("Equipment > Ovens",t?.equipment?.ovens),y("Equipment > 3-compartment sink",t?.equipment?.threeCompSink),y("Equipment > Ecolab / chemicals",t?.equipment?.ecolab);const _=Number(t?.temps?.handSinkTempF),T=Number(t?.temps?.threeCompSinkTempF);!Number.isNaN(_)&&_&&_<95&&b.push(`- Temps > Hand sink: ${_}F (below 95F minimum)`),!Number.isNaN(T)&&T&&T<110&&b.push(`- Temps > 3-comp wash: ${T}F (below 110F minimum)`);const v=b.length?b.join(`
`):"- No exceptions noted from checklist/temps.",p=R.filter(D=>D.priority==="High").map(D=>`- ${D.issue}${D.photos?.length?` (Photo ${D.photos.join(", ")})`:""}`).join(`
`)||(r==="Event Day"?"- No critical blockers identified for service.":"- No critical issues flagged.");return[C,"","Hi team,","",w.opening,"",`## ${w.headline}  Snapshot`,B,"","## Context (from sit-down notes)",$||"- ","","## Critical Risks",p,"","## Findings by Area",v,"","## Corrective Actions (please assign Owner + Due)",Su(R),"","## Photo Index",O,"","## Inspector Notes (organized)",cs(n)||""].join(`
`)}function Kg({noteType:s,useCase:e,context:t,inspection:n,rawNotes:r,inspectionType:o,inspectionDate:a,inspectorName:u,siteName:d,siteNumber:m,sitePhone:f,supervisorName:E,floor:w}){const C=Ft(n),I=en({inspection:n,rawNotes:r});Fr(r);const R=d||t?.kitchen||"Kitchen",N=a||t?.date||"";if(e==="Email Summary")return kl({noteType:s,context:t,inspection:n,rawNotes:r,inspectionType:o,inspectionDate:a,inspectorName:u,siteName:d,siteNumber:m,sitePhone:f,supervisorName:E,floor:w});if(e==="Slack Update"){const k=[`*${o||"Inspection"}  ${R}  ${N}*`,`Inspector: ${u||""} | Status: *${C}*`,"","*Summary:*",cs(r),""];if(I.length){k.push(`*Action Items (${I.length}):*`);for(const S of I)k.push(`   [${S.priority}] ${S.issue}`)}else k.push("No corrective actions needed.");return k.join(`
`)}if(e==="Google Doc"){const k=[`# ${o||"Inspection"}  ${R}`,`Date: ${N} | Inspector: ${u||""} | Supervisor: ${E||""}`,`Overall Status: ${C}`,"","## Inspector Notes",cs(r),"","## Findings"],S=(F,B)=>{B?.status&&B.status!=="OK"&&B.status!=="N/A"&&k.push(`- **${F}**: ${B.status}${B.notes?`  ${B.notes}`:""}`)};return S("Ceiling",n?.facility?.ceiling),S("Walls",n?.facility?.walls),S("Floors",n?.facility?.floors),S("Lighting",n?.facility?.lighting),S("Employee practices",n?.operations?.employeePractices),S("Handwashing",n?.operations?.handwashing),S("Labeling / dating",n?.operations?.labelingDating),S("Logs",n?.operations?.logs),S("Double-door cooler",n?.equipment?.doubleDoorCooler),S("Double-door freezer",n?.equipment?.doubleDoorFreezer),S("Walk-in cooler",n?.equipment?.walkInCooler),S("Warmers",n?.equipment?.warmers),S("Ovens",n?.equipment?.ovens),S("3-compartment sink",n?.equipment?.threeCompSink),S("Ecolab / chemicals",n?.equipment?.ecolab),k[k.length-1]==="## Findings"&&k.push("- All areas OK."),k.push("","## Action Items"),I.length?k.push(Su(I)):k.push("No corrective actions needed."),k.join(`
`)}if(e==="Evaluation Scorecard"){const k=[{title:"Facility",items:[["Ceiling",n?.facility?.ceiling],["Walls",n?.facility?.walls],["Floors",n?.facility?.floors],["Lighting",n?.facility?.lighting]]},{title:"Operations",items:[["Employee practices",n?.operations?.employeePractices],["Handwashing",n?.operations?.handwashing],["Labeling / dating",n?.operations?.labelingDating],["Logs",n?.operations?.logs]]},{title:"Equipment",items:[["Double-door cooler",n?.equipment?.doubleDoorCooler],["Double-door freezer",n?.equipment?.doubleDoorFreezer],["Walk-in cooler",n?.equipment?.walkInCooler],["Warmers",n?.equipment?.warmers],["Ovens",n?.equipment?.ovens],["3-comp sink",n?.equipment?.threeCompSink],["Ecolab",n?.equipment?.ecolab]]}],S=["EVALUATION SCORECARD",`${"=".repeat(50)}`,`${o||"Inspection"}  ${R}  ${N}`,`Inspector: ${u||""}`,`Overall: ${C}`,""];for(const $ of k){S.push(`--- ${$.title.toUpperCase()} ---`);for(const[O,b]of $.items){const y=b?.status||"N/A",_=y==="OK"?"[PASS]":y==="N/A"?"[ -- ]":"[FAIL]";S.push(`  ${_} ${O}${b?.notes?`  ${b.notes}`:""}`)}S.push("")}S.push("--- TEMPERATURES ---");const F=n?.temps?.handSinkTempF,B=n?.temps?.threeCompSinkTempF;S.push(`  Hand sink: ${F||""}F ${Number(F)>=95?"[PASS]":F?"[FAIL]":""}`),S.push(`  3-comp wash: ${B||""}F ${Number(B)>=110?"[PASS]":B?"[FAIL]":""}`),S.push("",`--- ACTION ITEMS (${I.length}) ---`);for(const $ of I)S.push(`  [${$.priority}] ${$.issue}`);return I.length||S.push("  None."),S.push("","--- INSPECTOR NOTES ---",cs(r)),S.join(`
`)}return kl({noteType:s,context:t,inspection:n,rawNotes:r,inspectionType:o,inspectionDate:a,inspectorName:u,siteName:d,siteNumber:m,sitePhone:f,supervisorName:E,floor:w})}function $i({inspection:s,rawNotes:e,context:t,noteType:n}){const r=[],o=(e||"").toLowerCase(),a=(f,E)=>{E?.status==="Needs Attention"&&!E?.notes?.trim()&&r.push(`"${f}" is flagged Needs Attention but has no notes  add details so corrective actions are clear.`),E?.status==="Not Clean"&&!E?.notes?.trim()&&r.push(`"${f}" is flagged Not Clean but has no notes  describe the issue for the report.`)};a("Ceiling",s?.facility?.ceiling),a("Walls",s?.facility?.walls),a("Floors",s?.facility?.floors),a("Lighting",s?.facility?.lighting),a("Employee practices",s?.operations?.employeePractices),a("Handwashing",s?.operations?.handwashing),a("Labeling / dating",s?.operations?.labelingDating),a("Logs",s?.operations?.logs),a("Double-door cooler",s?.equipment?.doubleDoorCooler),a("Double-door freezer",s?.equipment?.doubleDoorFreezer),a("Walk-in cooler",s?.equipment?.walkInCooler),a("Walk-in freezer",s?.equipment?.walkInFreezer),a("Prep cooler",s?.equipment?.prepCooler),a("Warmers",s?.equipment?.warmers),a("Ovens",s?.equipment?.ovens),a("3-compartment sink",s?.equipment?.threeCompSink),a("Ecolab / chemicals",s?.equipment?.ecolab);const u=Number(s?.temps?.handSinkTempF),d=Number(s?.temps?.threeCompSinkTempF);u&&u<95&&r.push(`Hand sink temp is ${u}F (below 95F min). Flag for immediate maintenance.`),d&&d<110&&r.push(`3-comp sink wash temp is ${d}F (below 110F min). Check water heater.`),u&&u>=95&&u<100&&r.push(`Hand sink temp is ${u}F  passes but is close to the 95F minimum. Monitor.`),d&&d>=110&&d<115&&r.push(`3-comp wash temp is ${d}F  passes but is close to the 110F minimum. Monitor.`);for(const f of kn(s))f.pass?f.type==="cooler"&&f.tempNum>35?r.push(`${f.label} temp is ${f.tempNum}F  passes but close to the 40F maximum. Monitor.`):f.type==="freezer"&&f.tempNum>15&&r.push(`${f.label} temp is ${f.tempNum}F  passes but close to the 20F maximum. Monitor.`):r.push(`${f.label} temp is ${f.tempNum}F (above ${f.max}F max). ${f.type==="freezer"?"Check freezer compressor and door seals.":"Potential food safety hazard  check refrigeration immediately."}`);o.includes("allergen")&&r.push("Allergen concerns detected in notes  ensure allergen training is scheduled and documented."),o.includes("haccp")&&r.push("HACCP mentioned  verify all HACCP logs are complete and signed before next inspection."),(o.includes("pest")||o.includes("trap"))&&r.push("Pest control mentioned  document trap locations and schedule pest vendor follow-up."),(o.includes("cutting board")||o.includes("scored"))&&r.push("Scored cutting boards noted  replace immediately per food safety protocol."),o.includes("calibrat")&&r.push("Thermometer calibration mentioned  document last calibration date and schedule next.");const m=xu(e);return m.length>3&&r.push(`${m.length} action items found in notes  consider prioritizing the top 3 for immediate follow-up.`),r.length||r.push("No issues detected. Inspection looks clean!"),r}function Cu({inspection:s,rawNotes:e,inspectionType:t,inspectionDate:n,siteName:r}){const o=Ft(s),a=en({inspection:s,rawNotes:e});$i({inspection:s,rawNotes:e,context:{},noteType:"Kitchen Inspection"});const u=n||new Date().toLocaleDateString(),d=r||"the inspected location";let m=0,f=0,E=0;const w=["facility","operations","equipment"];for(const $ of w){const O=s?.[$]||{};for(const b of Object.keys(O)){const y=O[b]?.status;y==="OK"?m++:y==="Needs Attention"?f++:y==="Not Clean"&&E++}}const C=m+f+E,I=C>0?Math.round(m/C*100):100,R=[];if(o==="Pass"?R.push(`This ${t||"inspection"} of ${d} on ${u} resulted in an overall PASS with a ${I}% compliance rate. ${m} of ${C} items met standards.`):R.push(`This ${t||"inspection"} of ${d} on ${u} requires attention. ${E+f} of ${C} items were flagged, resulting in a ${I}% compliance rate.`),a.length>0){const $=a.filter(O=>O.priority==="High").length;R.push(`${a.length} corrective action${a.length!==1?"s":""} required${$>0?` (${$} high priority)`:""}. Immediate follow-up recommended for all high-priority items.`)}const N=Number(s?.temps?.handSinkTempF),k=Number(s?.temps?.threeCompSinkTempF),S=kn(s),F=[];N&&N<95&&F.push(`hand sink at ${N}F (below 95F)`),k&&k<110&&F.push(`3-comp wash at ${k}F (below 110F)`);for(const $ of S)$.pass||F.push(`${$.label} at ${$.tempNum}F (above ${$.max}F)`);if(F.length>0)R.push(`Temperature violations: ${F.join("; ")}. Immediate corrective action required.`);else{const $=[];N&&$.push("hand sink"),k&&$.push("3-comp wash");for(const O of S)$.push(O.label.toLowerCase());$.length&&R.push(`All recorded temperatures (${$.join(", ")}) are within acceptable ranges.`)}const B=[];return E>0&&B.push("Schedule re-inspection within 48 hours for all Not Clean items."),f>=3&&B.push("Consider additional staff training  multiple areas flagged for attention."),F.length>0&&B.push("Contact maintenance for equipment check on out-of-range temperatures."),a.length===0&&o==="Pass"&&B.push("No corrective actions needed. Continue current maintenance schedule."),B.length&&R.push("Recommendations: "+B.join(" ")),R.join(`

`)}function Gg({noteType:s,useCase:e,context:t,inspection:n,rawNotes:r,inspectionType:o,inspectionDate:a,inspectorName:u,siteName:d,siteNumber:m,sitePhone:f,supervisorName:E,locationType:w,floor:C}){const I=Ft(n),R=en({inspection:n,rawNotes:r});Fr(r);const N=d||t?.kitchen||"Kitchen",k=a||t?.date||new Date().toLocaleDateString(),S=yr[o]||yr["Regular Inspection"],{index:F}=xs(n),B=Number(n?.temps?.handSinkTempF),$=Number(n?.temps?.threeCompSinkTempF),O=kn(n);function b(v,A){const p=n?.[v]||{};return Object.keys(p).filter(D=>D.startsWith("custom_")).map(D=>({section:A,label:p[D]?.label||"Custom",node:p[D]}))}const y=[{section:"Facility",label:"Ceiling",node:n?.facility?.ceiling},{section:"Facility",label:"Walls",node:n?.facility?.walls},{section:"Facility",label:"Floors",node:n?.facility?.floors},{section:"Facility",label:"Lighting",node:n?.facility?.lighting},...b("facility","Facility"),{section:"Operations",label:"Employee Practices",node:n?.operations?.employeePractices},{section:"Operations",label:"Handwashing / Supplies",node:n?.operations?.handwashing},{section:"Operations",label:"Labeling / Dating",node:n?.operations?.labelingDating},{section:"Operations",label:"Logs / Documentation",node:n?.operations?.logs},...b("operations","Operations"),{section:"Equipment",label:"Double-Door Cooler",node:n?.equipment?.doubleDoorCooler},{section:"Equipment",label:"Double-Door Freezer",node:n?.equipment?.doubleDoorFreezer},{section:"Equipment",label:"Walk-In Cooler",node:n?.equipment?.walkInCooler},{section:"Equipment",label:"Walk-In Freezer",node:n?.equipment?.walkInFreezer},{section:"Equipment",label:"Prep Cooler",node:n?.equipment?.prepCooler},{section:"Equipment",label:"Warmers / Hot Holding",node:n?.equipment?.warmers},{section:"Equipment",label:"Ovens",node:n?.equipment?.ovens},{section:"Equipment",label:"3-Compartment Sink",node:n?.equipment?.threeCompSink},{section:"Equipment",label:"Ecolab / Chemicals",node:n?.equipment?.ecolab},...b("equipment","Equipment")],_=y.filter(v=>v.node?.status&&v.node.status!=="OK"&&v.node.status!=="N/A");B&&B<95&&_.push({section:"Temperature",label:"Hand Sink",node:{status:"Not Clean",notes:`${B}F (below 95F minimum)`}}),$&&$<110&&_.push({section:"Temperature",label:"3-Comp Wash",node:{status:"Not Clean",notes:`${$}F (below 110F minimum)`}});for(const v of O)v.pass||_.push({section:"Temperature",label:v.label,node:{status:"Not Clean",notes:`${v.tempNum}F (above ${v.max}F maximum)`}});const T=["Facility","Operations","Equipment"];return l.jsxs("div",{className:"rpt",children:[l.jsxs("div",{className:"rptHeader",children:[l.jsx("img",{src:Eu,alt:"Sodexo",className:"rptLogo"}),l.jsxs("div",{className:"rptHeaderRight",children:[l.jsx("div",{className:"rptDocType",children:o||"Kitchen Inspection"}),l.jsxs("div",{className:"rptDocId",children:["Report #",Date.now().toString(36).toUpperCase()]})]})]}),l.jsxs("div",{className:"rptTitleBar",children:[l.jsxs("div",{children:[l.jsx("div",{className:"rptTitle",children:N}),l.jsx("div",{className:"rptDate",children:k})]}),l.jsx("div",{className:fe("rptStatus",I==="Pass"?"rptStatusPass":"rptStatusFail"),children:I==="Pass"?"PASSED":"NEEDS ATTENTION"})]}),l.jsxs("div",{className:"rptInfoGrid",children:[l.jsxs("div",{className:"rptInfoItem",children:[l.jsx("div",{className:"rptInfoLabel",children:"Inspector"}),l.jsx("div",{className:"rptInfoValue",children:u||""})]}),l.jsxs("div",{className:"rptInfoItem",children:[l.jsx("div",{className:"rptInfoLabel",children:"Supervisor"}),l.jsx("div",{className:"rptInfoValue",children:E||""})]}),l.jsxs("div",{className:"rptInfoItem",children:[l.jsx("div",{className:"rptInfoLabel",children:"Unit / Location"}),l.jsx("div",{className:"rptInfoValue",children:m||""})]}),w&&l.jsxs("div",{className:"rptInfoItem",children:[l.jsx("div",{className:"rptInfoLabel",children:"Type"}),l.jsx("div",{className:"rptInfoValue",children:w})]}),C&&l.jsxs("div",{className:"rptInfoItem",children:[l.jsx("div",{className:"rptInfoLabel",children:"Floor"}),l.jsx("div",{className:"rptInfoValue",children:C})]}),f&&l.jsxs("div",{className:"rptInfoItem",children:[l.jsx("div",{className:"rptInfoLabel",children:"Phone"}),l.jsx("div",{className:"rptInfoValue",children:f})]}),l.jsxs("div",{className:"rptInfoItem",children:[l.jsx("div",{className:"rptInfoLabel",children:"Hand Sink Temp"}),l.jsxs("div",{className:"rptInfoValue",children:[n?.temps?.handSinkTempF?`${n.temps.handSinkTempF}F`:"",B>=95&&l.jsx("span",{className:"rptCheck",children:" "}),B>0&&B<95&&l.jsx("span",{className:"rptWarn",children:"  Below 95F"})]})]}),l.jsxs("div",{className:"rptInfoItem",children:[l.jsx("div",{className:"rptInfoLabel",children:"3-Comp Wash Temp"}),l.jsxs("div",{className:"rptInfoValue",children:[n?.temps?.threeCompSinkTempF?`${n.temps.threeCompSinkTempF}F`:"",$>=110&&l.jsx("span",{className:"rptCheck",children:" "}),$>0&&$<110&&l.jsx("span",{className:"rptWarn",children:"  Below 110F"})]})]}),O.map(v=>l.jsxs("div",{className:"rptInfoItem",children:[l.jsx("div",{className:"rptInfoLabel",children:v.label}),l.jsxs("div",{className:"rptInfoValue",children:[v.tempF,"F",v.pass&&l.jsx("span",{className:"rptCheck",children:" "}),!v.pass&&l.jsx("span",{className:"rptWarn",children:`  Above ${v.max}F`})]})]},v.key))]}),(e==="Email Summary"||e==="Google Doc")&&S.opening&&l.jsx("div",{className:"rptBlock",children:l.jsx("p",{className:"rptParagraph",children:S.opening})}),l.jsxs("div",{className:"rptBlock",children:[l.jsx("div",{className:"rptBlockTitle",children:"Inspection Scorecard"}),l.jsxs("table",{className:"rptTable",children:[l.jsx("thead",{children:l.jsxs("tr",{children:[l.jsx("th",{children:"Section"}),l.jsx("th",{children:"Item"}),l.jsx("th",{children:"Status"}),l.jsx("th",{children:"Notes"})]})}),l.jsxs("tbody",{children:[T.map(v=>{const A=y.filter(p=>p.section===v);return A.map((p,D)=>l.jsxs("tr",{className:p.node?.status==="Not Clean"?"rptRowFail":p.node?.status==="Needs Attention"?"rptRowWarn":"",children:[D===0&&l.jsx("td",{rowSpan:A.length,className:"rptSectionCell",children:v}),l.jsx("td",{children:p.label}),l.jsx("td",{children:l.jsx("span",{className:fe("rptStatusPill",p.node?.status==="OK"?"rptPillPass":p.node?.status==="Not Clean"?"rptPillFail":p.node?.status==="Needs Attention"?"rptPillWarn":"rptPillNa"),children:p.node?.status||"N/A"})}),l.jsx("td",{className:"rptNoteCell",children:p.node?.notes||""})]},p.label))}),l.jsxs("tr",{className:B>0&&B<95?"rptRowFail":"",children:[l.jsx("td",{rowSpan:2,className:"rptSectionCell",children:"Temps"}),l.jsx("td",{children:"Hand Sink"}),l.jsx("td",{children:l.jsx("span",{className:fe("rptStatusPill",B>=95?"rptPillPass":B?"rptPillFail":"rptPillNa"),children:n?.temps?.handSinkTempF?`${n.temps.handSinkTempF}F`:"N/A"})}),l.jsx("td",{className:"rptNoteCell",children:B>=95?"Meets minimum":B?"Below 95F minimum":""})]}),l.jsxs("tr",{className:$>0&&$<110?"rptRowFail":"",children:[l.jsx("td",{children:"3-Comp Wash"}),l.jsx("td",{children:l.jsx("span",{className:fe("rptStatusPill",$>=110?"rptPillPass":$?"rptPillFail":"rptPillNa"),children:n?.temps?.threeCompSinkTempF?`${n.temps.threeCompSinkTempF}F`:"N/A"})}),l.jsx("td",{className:"rptNoteCell",children:$>=110?"Meets minimum":$?"Below 110F minimum":""})]})]})]})]}),_.length>0&&l.jsxs("div",{className:"rptBlock rptBlockAlert",children:[l.jsxs("div",{className:"rptBlockTitle rptBlockTitleAlert",children:["Issues Found (",_.length,")"]}),_.map((v,A)=>l.jsxs("div",{className:"rptIssueRow",children:[l.jsx("span",{className:"rptIssueNum",children:A+1}),l.jsxs("div",{className:"rptIssueContent",children:[l.jsxs("div",{className:"rptIssueName",children:[v.label," ",l.jsxs("span",{className:"rptIssueSection",children:["(",v.section,")"]})]}),v.node?.notes&&l.jsx("div",{className:"rptIssueDetail",children:v.node.notes})]}),l.jsx("span",{className:fe("rptStatusPill",v.node?.status==="Not Clean"?"rptPillFail":"rptPillWarn"),children:v.node?.status})]},A))]}),R.length>0&&l.jsxs("div",{className:"rptBlock",children:[l.jsx("div",{className:"rptBlockTitle",children:"Corrective Actions Required"}),R.map((v,A)=>l.jsxs("div",{className:"rptActionRow",children:[l.jsx("span",{className:fe("rptPriorityDot",v.priority==="High"?"rptDotHigh":"rptDotMed")}),l.jsxs("div",{className:"rptActionContent",children:[l.jsx("span",{className:"rptActionText",children:v.issue}),l.jsxs("span",{className:fe("rptPriorityLabel",v.priority==="High"?"rptLabelHigh":"rptLabelMed"),children:[v.priority," Priority"]})]})]},A))]}),F.length>0&&l.jsxs("div",{className:"rptBlock",children:[l.jsxs("div",{className:"rptBlockTitle",children:["Photo Evidence (",F.length,")"]}),l.jsx("div",{className:"rptPhotoGallery",children:F.map(v=>l.jsxs("div",{className:"rptPhotoCard",children:[v.previewUrl?l.jsx("img",{src:v.previewUrl,alt:`Photo #${v.num}`,className:"rptPhotoImg"}):l.jsx("div",{className:"rptPhotoPlaceholder",children:"No preview"}),l.jsxs("div",{className:"rptPhotoCaption",children:[l.jsxs("span",{className:"rptPhotoNum",children:["#",v.num]}),l.jsxs("span",{children:[v.label,v.caption?`  ${v.caption}`:""]})]})]},v.num))})]}),r&&(()=>{const{grouped:v}=Mr(r);return Object.values(v).some(p=>p.length>0)?l.jsxs("div",{className:"rptBlock",children:[l.jsx("div",{className:"rptBlockTitle",children:"Inspector Notes"}),l.jsx("div",{className:"rptNotesOrganized",children:Lr.map(p=>!v[p]||!v[p].length?null:l.jsxs("div",{className:"rptNoteCategory",children:[l.jsx("div",{className:fe("rptNoteCatLabel",`rptNoteCat--${p}`),children:Or[p]}),l.jsx("ul",{className:"rptNoteBullets",children:v[p].map((D,J)=>l.jsx("li",{children:D},J))})]},p))})]}):null})(),l.jsxs("div",{className:"rptFooter",children:[l.jsxs("div",{children:["Generated ",new Date().toLocaleDateString()," ",new Date().toLocaleTimeString(),"  Sodexo Kitchen Inspection System"]}),l.jsx("div",{children:"This report is confidential and intended for internal use only."})]})]})}function Qg({inspection:s,rawNotes:e,inspectionType:t,inspectionDate:n,inspectorName:r,siteName:o,siteNumber:a,supervisorName:u}){const d=[["Section","Item","Status","Notes","Priority"]],m=(f,E,w)=>{if(!w)return;const C=w.status==="Not Clean"?"High":w.status==="Needs Attention"?"Med":"";d.push([f,E,w.status||"",(w.notes||"").replace(/"/g,'""'),C])};m("Facility","Ceiling",s?.facility?.ceiling),m("Facility","Walls",s?.facility?.walls),m("Facility","Floors",s?.facility?.floors),m("Facility","Lighting",s?.facility?.lighting),m("Operations","Employee practices",s?.operations?.employeePractices),m("Operations","Handwashing / supplies",s?.operations?.handwashing),m("Operations","Labeling / dating",s?.operations?.labelingDating),m("Operations","Logs / documentation",s?.operations?.logs),m("Equipment","Double-door cooler",s?.equipment?.doubleDoorCooler),m("Equipment","Double-door freezer",s?.equipment?.doubleDoorFreezer),m("Equipment","Walk-in cooler",s?.equipment?.walkInCooler),m("Equipment","Walk-in freezer",s?.equipment?.walkInFreezer),m("Equipment","Prep cooler",s?.equipment?.prepCooler),m("Equipment","Warmers / hot holding",s?.equipment?.warmers),m("Equipment","Ovens",s?.equipment?.ovens),m("Equipment","3-compartment sink",s?.equipment?.threeCompSink),m("Equipment","Ecolab / chemicals",s?.equipment?.ecolab),d.push(["Temps","Hand sink (F)",s?.temps?.handSinkTempF||"",Number(s?.temps?.handSinkTempF)>=95?"Pass":"Below min",""]),d.push(["Temps","3-comp wash (F)",s?.temps?.threeCompSinkTempF||"",Number(s?.temps?.threeCompSinkTempF)>=110?"Pass":"Below min",""]);for(const f of kn(s))d.push(["Temps",`${f.label} (F)`,f.tempF,f.pass?"Pass":"Above max",""]);return d}function Jg({inspection:s,rawNotes:e,inspectionType:t,inspectionDate:n,inspectorName:r,siteName:o,siteNumber:a,supervisorName:u,floor:d}){const m=Qg({inspection:s,rawNotes:e,inspectionType:t,inspectionDate:n,inspectorName:r,siteName:o,siteNumber:a,supervisorName:u}),f=Ft(s),E=en({inspection:s,rawNotes:e}),{index:w}=xs(s),C=Cu({inspection:s,rawNotes:e,inspectionType:t,inspectionDate:n,siteName:o}),I=`<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
<head><meta charset="utf-8">
<!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>
<x:Name>Inspection</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions>
</x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]-->
<style>
  td, th { mso-number-format:"\\@"; padding: 6px 10px; border: 1px solid #ccc; font-family: Calibri, Arial; font-size: 11pt; }
  th { background: #2A295C; color: white; font-weight: bold; }
  .section-header { background: #F0F1F5; font-weight: bold; color: #2A295C; font-size: 12pt; }
  .pass { background: #ECFDF5; color: #15803D; font-weight: bold; }
  .fail { background: #FEF2F2; color: #DC2626; font-weight: bold; }
  .warn { background: #FFFBEB; color: #D97706; }
  .meta-label { font-weight: bold; color: #2A295C; background: #F7F8FA; }
  .title { font-size: 16pt; font-weight: bold; color: #2A295C; }
</style></head><body>
<table>
  <tr><td class="title" colspan="5">SODEXO KITCHEN INSPECTION REPORT</td></tr>
  <tr><td colspan="5" style="border-bottom: 3px solid #EE0000; padding: 0;"></td></tr>
  <tr><td class="meta-label">Inspection Type</td><td colspan="4">${t||""}</td></tr>
  <tr><td class="meta-label">Date</td><td colspan="4">${n||""}</td></tr>
  <tr><td class="meta-label">Inspector</td><td colspan="4">${r||""}</td></tr>
  <tr><td class="meta-label">Site / Location</td><td colspan="4">${o||""}</td></tr>
  <tr><td class="meta-label">Unit #</td><td colspan="4">${a||""}</td></tr>
  <tr><td class="meta-label">Floor</td><td colspan="4">${d||""}</td></tr>
  <tr><td class="meta-label">Supervisor</td><td colspan="4">${u||""}</td></tr>
  <tr><td class="meta-label">Overall Status</td><td colspan="4" class="${f==="Pass"?"pass":"fail"}">${f}</td></tr>
  <tr><td colspan="5"></td></tr>
  <tr><td class="section-header" colspan="5">EXECUTIVE SUMMARY</td></tr>
  <tr><td colspan="5" style="white-space:pre-wrap;font-size:10pt;background:#F0F4FF;line-height:1.7;padding:12px;">${C.replace(/</g,"&lt;")}</td></tr>
  <tr><td colspan="5"></td></tr>
  <tr><td class="section-header" colspan="5">INSPECTION SCORECARD</td></tr>
  <tr><th>Section</th><th>Item</th><th>Status</th><th>Notes</th><th>Priority</th></tr>
  ${m.slice(1).map(k=>{const S=k[2]==="OK"?"pass":k[2]==="Not Clean"?"fail":k[2]==="Needs Attention"?"warn":"";return`<tr><td>${k[0]}</td><td>${k[1]}</td><td class="${S}">${k[2]}</td><td>${k[3]}</td><td>${k[4]}</td></tr>`}).join(`
  `)}
  <tr><td colspan="5"></td></tr>
  ${E.length>0?`
  <tr><td class="section-header" colspan="5">CORRECTIVE ACTIONS</td></tr>
  <tr><th>#</th><th colspan="3">Issue</th><th>Priority</th></tr>
  ${E.map((k,S)=>`<tr><td>${S+1}</td><td colspan="3">${k.issue}</td><td class="${k.priority==="High"?"fail":"warn"}">${k.priority}</td></tr>`).join(`
  `)}
  <tr><td colspan="5"></td></tr>`:""}
  <tr><td class="section-header" colspan="5">INSPECTOR NOTES</td></tr>
  <tr><td colspan="5" style="white-space:pre-wrap;font-size:10pt;">${cs(e).replace(/</g,"&lt;")}</td></tr>
  ${w.length>0?`
  <tr><td colspan="5"></td></tr>
  <tr><td class="section-header" colspan="5">PHOTO EVIDENCE (${w.length})</td></tr>
  ${w.map(k=>`<tr><td style="text-align:center;font-weight:bold;color:#2A295C;">#${k.num}</td><td colspan="2">${k.previewUrl?`<img src="${k.previewUrl}" width="200" height="150" style="object-fit:cover;" />`:"No preview"}</td><td colspan="2" style="font-size:9pt;vertical-align:top;">${(k.label||"").replace(/</g,"&lt;")}${k.caption?`<br/>${k.caption.replace(/</g,"&lt;")}`:""}</td></tr>`).join(`
  `)}`:""}
</table></body></html>`,R=new Blob([I],{type:"application/vnd.ms-excel"}),N=`inspection_${n||"undated"}_${(o||"site").replace(/\s+/g,"_")}.xls`;Io(R,N)}function Nu({output:s,inspection:e,rawNotes:t,inspectionType:n,inspectionDate:r,siteName:o,siteNumber:a,sitePhone:u,inspectorName:d,supervisorName:m}){const f=Ft(e),E=en({inspection:e,rawNotes:t});Fr(t);const{index:w}=xs(e),C=Cu({inspection:e,rawNotes:t,inspectionType:n,inspectionDate:r,siteName:o}),I=[["Facility","Ceiling",e?.facility?.ceiling],["Facility","Walls",e?.facility?.walls],["Facility","Floors",e?.facility?.floors],["Facility","Lighting",e?.facility?.lighting],["Operations","Employee Practices",e?.operations?.employeePractices],["Operations","Handwashing / Supplies",e?.operations?.handwashing],["Operations","Labeling / Dating",e?.operations?.labelingDating],["Operations","Logs / Documentation",e?.operations?.logs],["Equipment","Double-Door Cooler",e?.equipment?.doubleDoorCooler],["Equipment","Double-Door Freezer",e?.equipment?.doubleDoorFreezer],["Equipment","Walk-In Cooler",e?.equipment?.walkInCooler],["Equipment","Walk-In Freezer",e?.equipment?.walkInFreezer],["Equipment","Prep Cooler",e?.equipment?.prepCooler],["Equipment","Warmers / Hot Holding",e?.equipment?.warmers],["Equipment","Ovens",e?.equipment?.ovens],["Equipment","3-Compartment Sink",e?.equipment?.threeCompSink],["Equipment","Ecolab / Chemicals",e?.equipment?.ecolab]],R=I.filter(([,,O])=>O?.status&&O.status!=="OK"&&O.status!=="N/A"),N=Number(e?.temps?.handSinkTempF),k=Number(e?.temps?.threeCompSinkTempF),S=kn(e),F=`<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">
<head><meta charset="utf-8">
<!--[if gte mso 9]><xml><w:WordDocument><w:View>Print</w:View><w:Zoom>100</w:Zoom></w:WordDocument></xml><![endif]-->
<style>
  @page { size: letter; margin: 1in; }
  body { font-family: Calibri, Arial, sans-serif; font-size: 11pt; color: #1F2937; line-height: 1.5; }
  h1 { color: #2A295C; font-size: 22pt; margin-bottom: 4px; }
  h2 { color: #2A295C; font-size: 14pt; border-bottom: 2px solid #2A295C; padding-bottom: 4px; margin-top: 24px; }
  .red-line { border-bottom: 3px solid #EE0000; margin-bottom: 20px; }
  .info-table { width: 100%; border-collapse: collapse; margin: 16px 0; }
  .info-table td { padding: 8px 12px; border: 1px solid #E5E7EB; font-size: 10pt; }
  .info-label { background: #F7F8FA; font-weight: bold; color: #2A295C; width: 30%; }
  .status-pass { background: #ECFDF5; color: #15803D; font-weight: bold; font-size: 12pt; text-align: center; padding: 10px; }
  .status-fail { background: #FEF2F2; color: #DC2626; font-weight: bold; font-size: 12pt; text-align: center; padding: 10px; }
  table.scorecard { width: 100%; border-collapse: collapse; margin: 12px 0; }
  table.scorecard th { background: #2A295C; color: white; padding: 8px 12px; text-align: left; font-size: 10pt; }
  table.scorecard td { padding: 7px 12px; border: 1px solid #E5E7EB; font-size: 10pt; }
  .sc-section { background: #F0F1F5; font-weight: bold; color: #2A295C; }
  .pill-pass { background: #ECFDF5; color: #15803D; font-weight: bold; padding: 2px 8px; }
  .pill-fail { background: #FEF2F2; color: #DC2626; font-weight: bold; padding: 2px 8px; }
  .pill-warn { background: #FFFBEB; color: #D97706; font-weight: bold; padding: 2px 8px; }
  .pill-na { background: #F3F4F6; color: #9CA3AF; padding: 2px 8px; }
  .issue-num { background: #DC2626; color: white; font-weight: bold; padding: 2px 8px; text-align: center; width: 30px; }
  .notes-box { background: #F7F8FA; padding: 16px; border-left: 3px solid #2A295C; white-space: pre-wrap; font-size: 10pt; line-height: 1.7; }
  .exec-summary { background: #F0F4FF; border: 1px solid #C7D2FE; border-radius: 6px; padding: 16px 20px; margin: 16px 0; font-size: 10pt; line-height: 1.7; color: #1E293B; }
  .exec-summary p { margin: 0 0 8px 0; }
  .photo-grid { display: flex; flex-wrap: wrap; gap: 12px; margin: 12px 0; }
  .photo-card { width: 200px; border: 1px solid #E5E7EB; border-radius: 6px; overflow: hidden; break-inside: avoid; page-break-inside: avoid; }
  .photo-card img { width: 100%; height: 150px; object-fit: cover; display: block; }
  .photo-caption { padding: 6px 8px; font-size: 8pt; color: #4B5563; background: #F9FAFB; }
  .photo-num { font-weight: bold; color: #2A295C; }
  .footer { margin-top: 32px; padding-top: 12px; border-top: 1px solid #E5E7EB; font-size: 8pt; color: #9CA3AF; text-align: center; }
</style></head><body>

<h1>Sodexo Kitchen Inspection Report</h1>
<div class="red-line"></div>

<table class="info-table">
  <tr><td class="info-label">Inspection Type</td><td>${n||""}</td><td class="info-label">Date</td><td>${r||""}</td></tr>
  <tr><td class="info-label">Inspector</td><td>${d||""}</td><td class="info-label">Supervisor</td><td>${m||""}</td></tr>
  <tr><td class="info-label">Site / Location</td><td>${o||""}</td><td class="info-label">Unit #</td><td>${a||""}</td></tr>
  ${u?`<tr><td class="info-label">Phone</td><td>${u}</td><td></td><td></td></tr>`:""}
  <tr><td class="info-label">Hand Sink Temp</td><td>${e?.temps?.handSinkTempF?e.temps.handSinkTempF+"F":""} ${N>=95?"":N?" Below 95F":""}</td>
      <td class="info-label">3-Comp Wash Temp</td><td>${e?.temps?.threeCompSinkTempF?e.temps.threeCompSinkTempF+"F":""} ${k>=110?"":k?" Below 110F":""}</td></tr>
  ${S.length>0?S.map((O,b,y)=>{if(b%2===0){const _=y[b+1];return`<tr><td class="info-label">${O.label}</td><td>${O.tempF}F ${O.pass?"":" Above "+O.max+"F"}</td>${_?`<td class="info-label">${_.label}</td><td>${_.tempF}F ${_.pass?"":" Above "+_.max+"F"}</td>`:"<td></td><td></td>"}</tr>`}return""}).filter(Boolean).join(`
  `):""}
  <tr><td class="info-label">Overall Status</td><td colspan="3" class="${f==="Pass"?"status-pass":"status-fail"}">${f==="Pass"?"PASSED":"NEEDS ATTENTION"}</td></tr>
</table>

<h2>Executive Summary</h2>
<div class="exec-summary">
${C.split(`

`).map(O=>`<p>${O.replace(/</g,"&lt;")}</p>`).join(`
`)}
</div>

<h2>Inspection Scorecard</h2>
<table class="scorecard">
  <tr><th>Section</th><th>Item</th><th>Status</th><th>Notes</th></tr>
  ${I.map(([O,b,y])=>{const _=y?.status||"N/A";return`<tr><td>${O}</td><td>${b}</td><td><span class="${_==="OK"?"pill-pass":_==="Not Clean"?"pill-fail":_==="Needs Attention"?"pill-warn":"pill-na"}">${_}</span></td><td>${y?.notes||""}</td></tr>`}).join(`
  `)}
  <tr><td>Temps</td><td>Hand Sink</td><td><span class="${N>=95?"pill-pass":N?"pill-fail":"pill-na"}">${e?.temps?.handSinkTempF?e.temps.handSinkTempF+"F":"N/A"}</span></td><td>${N>=95?"Meets minimum":N?"Below 95F minimum":""}</td></tr>
  <tr><td>Temps</td><td>3-Comp Wash</td><td><span class="${k>=110?"pill-pass":k?"pill-fail":"pill-na"}">${e?.temps?.threeCompSinkTempF?e.temps.threeCompSinkTempF+"F":"N/A"}</span></td><td>${k>=110?"Meets minimum":k?"Below 110F minimum":""}</td></tr>
  ${S.map(O=>`<tr><td>Temps</td><td>${O.label}</td><td><span class="${O.pass?"pill-pass":"pill-fail"}">${O.tempF}F</span></td><td>${O.pass?`Meets ${O.max}F`:`Above ${O.max}F maximum`}</td></tr>`).join(`
  `)}
</table>

${R.length>0?`
<h2>Issues Found (${R.length})</h2>
<table class="scorecard">
  <tr><th>#</th><th>Area</th><th>Item</th><th>Status</th><th>Notes</th></tr>
  ${R.map(([O,b,y],_)=>`<tr><td class="issue-num">${_+1}</td><td>${O}</td><td>${b}</td><td><span class="pill-fail">${y.status}</span></td><td>${y.notes||""}</td></tr>`).join(`
  `)}
</table>`:'<h2>Issues</h2><p style="background:#ECFDF5;padding:12px;color:#15803D;font-weight:bold;text-align:center;">All areas passed inspection</p>'}

${E.length>0?`
<h2>Corrective Actions Required</h2>
<table class="scorecard">
  <tr><th>#</th><th>Issue</th><th>Priority</th></tr>
  ${E.map((O,b)=>`<tr><td style="text-align:center">${b+1}</td><td>${O.issue}</td><td><span class="${O.priority==="High"?"pill-fail":"pill-warn"}">${O.priority}</span></td></tr>`).join(`
  `)}
</table>`:""}

<h2>Inspector Notes</h2>
${(()=>{const{grouped:O}=Mr(t),b=Lr.filter(y=>O[y]?.length);return b.length?b.map(y=>`<div style="margin-bottom:12px;"><p style="font-weight:bold;color:#2A295C;font-size:10pt;margin:0 0 4px 0;">${Or[y]}</p><ul style="margin:0;padding-left:20px;">${O[y].map(_=>`<li style="margin-bottom:4px;font-size:10pt;line-height:1.5;">${_.replace(/</g,"&lt;")}</li>`).join("")}</ul></div>`).join(""):'<div class="notes-box"></div>'})()}

${w.length>0?`
<h2>Photo Evidence (${w.length})</h2>
<div class="photo-grid">
${w.map(O=>`<div class="photo-card">${O.previewUrl?`<img src="${O.previewUrl}" alt="Photo #${O.num}" />`:'<div style="width:200px;height:150px;background:#F3F4F6;display:flex;align-items:center;justify-content:center;color:#9CA3AF;font-size:9pt;">No preview</div>'}<div class="photo-caption"><span class="photo-num">#${O.num}</span> ${(O.label||"").replace(/</g,"&lt;")}${O.caption?`  ${O.caption.replace(/</g,"&lt;")}`:""}</div></div>`).join(`
`)}
</div>`:""}

<div class="footer">
  <p>Generated ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}  Sodexo Kitchen Inspection System</p>
  <p>This report is confidential and intended for internal use only.</p>
</div>
</body></html>`,B=new Blob([F],{type:"application/msword"}),$=`inspection_${r||"undated"}_${(o||"site").replace(/\s+/g,"_")}.doc`;Io(B,$)}function Ru({output:s,inspectionDate:e,siteName:t}){const n=new Blob([s||""],{type:"text/plain;charset=utf-8;"}),r=`inspection_${e||"undated"}_${(t||"site").replace(/\s+/g,"_")}.txt`;Io(n,r)}function Yg({history:s}){const[e,t]=q.useState(null),[n,r]=q.useState(null),o=q.useMemo(()=>{const C={};for(const I of s){const R=`${I.siteName||I.location||"Unknown"}${I.floor?` - ${I.floor}`:""}`,N=I.siteNumber||"";C[R]||(C[R]={points:[],unitNum:N});const k=Number(I.temps?.handSinkTempF),S=Number(I.temps?.threeCompSinkTempF);let F=[],B=[];const $=I.inspection?.equipment||{};for(const[y,_]of Object.entries($)){if(!_?.tempF)continue;const T=Number(_.tempF);if(!T)continue;const v=vs[y]||(y.startsWith("custom_")?ls(_.label):null);v?.type==="cooler"?F.push(T):v?.type==="freezer"&&B.push(T)}if(!F.length&&I.temps?.coolerTempF){const y=Number(I.temps.coolerTempF);y&&F.push(y)}if(!B.length&&I.temps?.freezerTempF){const y=Number(I.temps.freezerTempF);y&&B.push(y)}const O=F.length?Math.round(F.reduce((y,_)=>y+_,0)/F.length):null,b=B.length?Math.round(B.reduce((y,_)=>y+_,0)/B.length):null;(k||S||O||b)&&C[R].points.push({date:I.inspectionDate||I.savedAt?.slice(0,10)||"",handSink:k||null,threeComp:S||null,cooler:O,freezer:b,floor:I.floor||"",status:I.overallStatus||""})}for(const I of Object.keys(C))C[I].points.sort((R,N)=>R.date.localeCompare(N.date));return C},[s]),a=Object.keys(o);if(a.length===0)return null;const u=500,d=220,m=45,f=20,E=20,w=50;return l.jsxs("div",{className:"card",style:{marginBottom:24},children:[l.jsxs("div",{className:"cardHeader",children:[l.jsx("div",{className:"cardTitle",children:"Temperature Trends by Location"}),l.jsxs("div",{className:"cardSub",style:{fontSize:"0.72rem",color:"#6b7280"},children:[a.length," location",a.length!==1?"s":""," tracked"]})]}),l.jsx("div",{className:"cardBody",children:l.jsx("div",{className:"tempChartsGrid",children:a.map(C=>{const{points:I,unitNum:R}=o[C],N=I.flatMap(M=>[M.handSink,M.threeComp,M.cooler,M.freezer]).filter(Boolean);if(N.length===0)return null;const k=Math.min(...N,0)-5,S=Math.max(...N,115)+5,F=S-k||1,B=I.length>1?(u-m-f)/(I.length-1):(u-m-f)/2,$=I.length===1?(u-m-f)/2:0,O=M=>m+$+M*B,b=M=>E+(d-E-w)*(1-(M-k)/F),y=I.map((M,K)=>M.handSink?[O(K),b(M.handSink)]:null).filter(Boolean),_=I.map((M,K)=>M.threeComp?[O(K),b(M.threeComp)]:null).filter(Boolean),T=I.map((M,K)=>M.cooler?[O(K),b(M.cooler)]:null).filter(Boolean),v=I.map((M,K)=>M.freezer?[O(K),b(M.freezer)]:null).filter(Boolean),A=M=>M.map((K,Ae)=>`${Ae===0?"M":"L"}${K[0]},${K[1]}`).join(" "),p=M=>{if(M.length<2)return"";const K=d-w;return`${A(M)} L${M[M.length-1][0]},${K} L${M[0][0]},${K} Z`},D=[];for(let M=Math.ceil(k/10)*10;M<=S;M+=10)D.push(M);const J=y.length>0?Math.round(I.reduce((M,K)=>M+(K.handSink||0),0)/I.filter(M=>M.handSink).length):null,we=_.length>0?Math.round(I.reduce((M,K)=>M+(K.threeComp||0),0)/I.filter(M=>M.threeComp).length):null,Ie=T.length>0?Math.round(I.reduce((M,K)=>M+(K.cooler||0),0)/I.filter(M=>M.cooler).length):null,he=v.length>0?Math.round(I.reduce((M,K)=>M+(K.freezer||0),0)/I.filter(M=>M.freezer).length):null;return l.jsxs("div",{className:"tempChartItem",children:[l.jsxs("div",{className:"tempChartHeader",children:[l.jsx("div",{className:"tempChartLabel",children:C}),R&&l.jsxs("span",{className:"tempChartUnit",children:["#",R]})]}),l.jsxs("div",{className:"tempChartAvgs",children:[J!==null&&l.jsxs("span",{className:fe("tempAvgPill","tempAvgPillClickable",n==="hand"&&"tempAvgPillActive"),style:{background:n==="hand"?"#3b82f6":J>=95?"#dbeafe":"#fee2e2",color:n==="hand"?"#fff":J>=95?"#1d4ed8":"#dc2626"},onClick:()=>r(n==="hand"?null:"hand"),children:["Avg Hand: ",J,"F"]}),we!==null&&l.jsxs("span",{className:fe("tempAvgPill","tempAvgPillClickable",n==="three"&&"tempAvgPillActive"),style:{background:n==="three"?"#8b5cf6":we>=110?"#ede9fe":"#fee2e2",color:n==="three"?"#fff":we>=110?"#7c3aed":"#dc2626"},onClick:()=>r(n==="three"?null:"three"),children:["Avg 3-Comp: ",we,"F"]}),Ie!==null&&l.jsxs("span",{className:fe("tempAvgPill","tempAvgPillClickable",n==="cooler"&&"tempAvgPillActive"),style:{background:n==="cooler"?"#059669":Ie<=40?"#d1fae5":"#fee2e2",color:n==="cooler"?"#fff":Ie<=40?"#059669":"#dc2626"},onClick:()=>r(n==="cooler"?null:"cooler"),children:["Avg Cooler: ",Ie,"F"]}),he!==null&&l.jsxs("span",{className:fe("tempAvgPill","tempAvgPillClickable",n==="freezer"&&"tempAvgPillActive"),style:{background:n==="freezer"?"#0891b2":he<=20?"#cffafe":"#fee2e2",color:n==="freezer"?"#fff":he<=20?"#0891b2":"#dc2626"},onClick:()=>r(n==="freezer"?null:"freezer"),children:["Avg Freezer: ",he,"F"]}),l.jsxs("span",{className:"tempAvgPill",style:{background:"#f0fdf4",color:"#15803d"},children:[I.length," reading",I.length!==1?"s":""]})]}),l.jsxs("svg",{viewBox:`0 0 ${u} ${d}`,className:"tempChartSvg",onMouseLeave:()=>t(null),children:[l.jsxs("defs",{children:[l.jsxs("linearGradient",{id:`handGrad-${C.replace(/\W/g,"")}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[l.jsx("stop",{offset:"0%",stopColor:"#3b82f6",stopOpacity:"0.25"}),l.jsx("stop",{offset:"100%",stopColor:"#3b82f6",stopOpacity:"0.02"})]}),l.jsxs("linearGradient",{id:`threeGrad-${C.replace(/\W/g,"")}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[l.jsx("stop",{offset:"0%",stopColor:"#8b5cf6",stopOpacity:"0.25"}),l.jsx("stop",{offset:"100%",stopColor:"#8b5cf6",stopOpacity:"0.02"})]}),l.jsxs("linearGradient",{id:`coolerGrad-${C.replace(/\W/g,"")}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[l.jsx("stop",{offset:"0%",stopColor:"#059669",stopOpacity:"0.25"}),l.jsx("stop",{offset:"100%",stopColor:"#059669",stopOpacity:"0.02"})]}),l.jsxs("linearGradient",{id:`freezerGrad-${C.replace(/\W/g,"")}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[l.jsx("stop",{offset:"0%",stopColor:"#0891b2",stopOpacity:"0.25"}),l.jsx("stop",{offset:"100%",stopColor:"#0891b2",stopOpacity:"0.02"})]})]}),D.map(M=>l.jsxs("g",{children:[l.jsx("line",{x1:m,y1:b(M),x2:u-f,y2:b(M),stroke:"#e5e7eb",strokeWidth:"1"}),l.jsxs("text",{x:m-6,y:b(M)+4,textAnchor:"end",fontSize:"9",fill:"#9ca3af",children:[M,""]})]},M)),[{v:95,line:"hand",c:"#3b82f6"},{v:110,line:"three",c:"#8b5cf6"},{v:40,line:"cooler",c:"#059669"},{v:20,line:"freezer",c:"#0891b2"}].map(({v:M,line:K,c:Ae})=>{if(M<k||M>S)return null;const Me=b(M),ht=n&&n!==K;return l.jsxs("g",{opacity:ht?.15:1,style:{transition:"opacity 0.3s"},children:[l.jsx("line",{x1:m,y1:Me,x2:u-f,y2:Me,stroke:Ae,strokeDasharray:"6,4",strokeWidth:"1.5",opacity:"0.6"}),l.jsx("rect",{x:u-f+2,y:Me-8,width:"36",height:"16",rx:"3",fill:Ae,opacity:"0.9"}),l.jsxs("text",{x:u-f+20,y:Me+4,textAnchor:"middle",fontSize:"8",fill:"white",fontWeight:"bold",children:[M,"F"]})]},M)}),y.length>=2&&l.jsx("path",{d:p(y),fill:`url(#handGrad-${C.replace(/\W/g,"")})`,opacity:n&&n!=="hand"?.1:1,style:{transition:"opacity 0.3s"}}),_.length>=2&&l.jsx("path",{d:p(_),fill:`url(#threeGrad-${C.replace(/\W/g,"")})`,opacity:n&&n!=="three"?.1:1,style:{transition:"opacity 0.3s"}}),T.length>=2&&l.jsx("path",{d:p(T),fill:`url(#coolerGrad-${C.replace(/\W/g,"")})`,opacity:n&&n!=="cooler"?.1:1,style:{transition:"opacity 0.3s"}}),v.length>=2&&l.jsx("path",{d:p(v),fill:`url(#freezerGrad-${C.replace(/\W/g,"")})`,opacity:n&&n!=="freezer"?.1:1,style:{transition:"opacity 0.3s"}}),y.length>1&&l.jsx("path",{d:A(y),fill:"none",stroke:"#3b82f6",strokeWidth:n==="hand"?"3.5":"2.5",strokeLinecap:"round",strokeLinejoin:"round",opacity:n&&n!=="hand"?.15:1,style:{transition:"opacity 0.3s, stroke-width 0.3s"}}),_.length>1&&l.jsx("path",{d:A(_),fill:"none",stroke:"#8b5cf6",strokeWidth:n==="three"?"3.5":"2.5",strokeLinecap:"round",strokeLinejoin:"round",opacity:n&&n!=="three"?.15:1,style:{transition:"opacity 0.3s, stroke-width 0.3s"}}),T.length>1&&l.jsx("path",{d:A(T),fill:"none",stroke:"#059669",strokeWidth:n==="cooler"?"3.5":"2.5",strokeLinecap:"round",strokeLinejoin:"round",opacity:n&&n!=="cooler"?.15:1,style:{transition:"opacity 0.3s, stroke-width 0.3s"}}),v.length>1&&l.jsx("path",{d:A(v),fill:"none",stroke:"#0891b2",strokeWidth:n==="freezer"?"3.5":"2.5",strokeLinecap:"round",strokeLinejoin:"round",opacity:n&&n!=="freezer"?.15:1,style:{transition:"opacity 0.3s, stroke-width 0.3s"}}),I.map((M,K)=>{const Ae=`${C}-${K}`;return l.jsxs("g",{onMouseEnter:()=>t(Ae),onTouchStart:()=>t(Ae),children:[M.handSink&&l.jsxs("g",{opacity:n&&n!=="hand"?.15:1,style:{transition:"opacity 0.3s"},children:[l.jsx("circle",{cx:O(K),cy:b(M.handSink),r:n==="hand"?6:5,fill:"white",stroke:M.handSink>=95?"#3b82f6":"#ef4444",strokeWidth:"2.5",style:{transition:"r 0.3s"}}),(e===Ae||n==="hand")&&l.jsxs("g",{children:[l.jsx("rect",{x:O(K)-30,y:b(M.handSink)-26,width:"60",height:"20",rx:"4",fill:"#1e293b",opacity:"0.9"}),l.jsxs("text",{x:O(K),y:b(M.handSink)-12,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:[M.handSink,"F"]})]})]}),M.threeComp&&l.jsxs("g",{opacity:n&&n!=="three"?.15:1,style:{transition:"opacity 0.3s"},children:[l.jsx("circle",{cx:O(K),cy:b(M.threeComp),r:n==="three"?6:5,fill:"white",stroke:M.threeComp>=110?"#8b5cf6":"#ef4444",strokeWidth:"2.5",style:{transition:"r 0.3s"}}),(e===Ae||n==="three")&&l.jsxs("g",{children:[l.jsx("rect",{x:O(K)-30,y:b(M.threeComp)-26,width:"60",height:"20",rx:"4",fill:"#1e293b",opacity:"0.9"}),l.jsxs("text",{x:O(K),y:b(M.threeComp)-12,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:[M.threeComp,"F"]})]})]}),M.cooler&&l.jsxs("g",{opacity:n&&n!=="cooler"?.15:1,style:{transition:"opacity 0.3s"},children:[l.jsx("circle",{cx:O(K),cy:b(M.cooler),r:n==="cooler"?6:5,fill:"white",stroke:M.cooler<=40?"#059669":"#ef4444",strokeWidth:"2.5",style:{transition:"r 0.3s"}}),(e===Ae||n==="cooler")&&l.jsxs("g",{children:[l.jsx("rect",{x:O(K)-30,y:b(M.cooler)-26,width:"60",height:"20",rx:"4",fill:"#1e293b",opacity:"0.9"}),l.jsxs("text",{x:O(K),y:b(M.cooler)-12,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:[M.cooler,"F"]})]})]}),M.freezer&&l.jsxs("g",{opacity:n&&n!=="freezer"?.15:1,style:{transition:"opacity 0.3s"},children:[l.jsx("circle",{cx:O(K),cy:b(M.freezer),r:n==="freezer"?6:5,fill:"white",stroke:M.freezer<=20?"#0891b2":"#ef4444",strokeWidth:"2.5",style:{transition:"r 0.3s"}}),(e===Ae||n==="freezer")&&l.jsxs("g",{children:[l.jsx("rect",{x:O(K)-30,y:b(M.freezer)-26,width:"60",height:"20",rx:"4",fill:"#1e293b",opacity:"0.9"}),l.jsxs("text",{x:O(K),y:b(M.freezer)-12,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:[M.freezer,"F"]})]})]}),l.jsx("rect",{x:O(K)-15,y:E,width:"30",height:d-E-w,fill:"transparent"})]},K)}),I.map((M,K)=>l.jsx("text",{x:O(K),y:d-10,textAnchor:"middle",fontSize:"9",fill:"#6b7280",fontWeight:"500",children:M.date.slice(5)},K))]}),l.jsxs("div",{className:"tempChartLegend",children:[l.jsxs("span",{className:"tempLegendItem",children:[l.jsx("span",{className:"tempLegendDot",style:{background:"#3b82f6"}})," Hand Sink (min 95F)"]}),l.jsxs("span",{className:"tempLegendItem",children:[l.jsx("span",{className:"tempLegendDot",style:{background:"#8b5cf6"}})," 3-Comp (min 110F)"]}),l.jsxs("span",{className:"tempLegendItem",children:[l.jsx("span",{className:"tempLegendDot",style:{background:"#059669"}})," Cooler (max 40F)"]}),l.jsxs("span",{className:"tempLegendItem",children:[l.jsx("span",{className:"tempLegendDot",style:{background:"#0891b2"}})," Freezer (max 20F)"]}),l.jsxs("span",{className:"tempLegendItem",children:[l.jsx("span",{className:"tempLegendDot",style:{background:"#ef4444"}})," Out of range"]})]})]},C)})})})]})}function Xg({history:s,onLocationClick:e}){const t=q.useMemo(()=>{if(s.length<2)return null;const n={},r={},o={},a={};for(const I of s){const R=`${I.siteName||I.location||"Unknown"}${I.floor?` (${I.floor})`:""}`,N=I.siteNumber||"";a[R]=(a[R]||0)+1;const k=new Set;for(const S of I.actionItems||[]){const F=S.issue?.split(":")[0]?.trim()||"Other";k.has(F)||(k.add(F),n[F]=(n[F]||0)+1,r[F]||(r[F]=[]),r[F].push({name:I.siteName||I.location||"Unknown",unit:N,floor:I.floor||"",date:I.inspectionDate||""}),o[R]||(o[R]={}),o[R][F]=(o[R][F]||0)+1)}}const u=Object.entries(n).filter(([,I])=>I>=2).sort((I,R)=>R[1]-I[1]).map(([I,R])=>{const N={};for(const S of r[I]){const F=`${S.name}${S.unit?` #${S.unit}`:""}${S.floor?` (${S.floor})`:""}`;N[F]||(N[F]={label:F,count:0,dates:[]}),N[F].count++,S.date&&N[F].dates.push(S.date)}const k=Object.values(N).sort((S,F)=>F.count-S.count);return{category:I,count:R,kitchens:k}}),d={};for(const[I,R]of Object.entries(o)){const N=a[I]||1,k=Object.entries(R).filter(([,S])=>S>=2).map(([S,F])=>({category:S,count:F,rate:Math.round(F/N*100)})).sort((S,F)=>F.rate-S.rate);k.length>0&&(d[I]=k)}let m=0,f=0;for(const I of s){const R=Number(I.temps?.handSinkTempF),N=Number(I.temps?.threeCompSinkTempF);R&&(m++,R<95&&f++),N&&(m++,N<110&&f++)}const E=m>0?Math.round((m-f)/m*100):null,w={};for(const I of s){const R=`${I.siteName||I.location||"Unknown"}${I.siteNumber?` #${I.siteNumber}`:""}${I.floor?` (${I.floor})`:""}`;w[R]=(w[R]||0)+(I.actionItems||[]).length}const C=Object.entries(w).filter(([,I])=>I>=2).sort((I,R)=>R[1]-I[1]).slice(0,5);return{recurring:u,locationRecurring:d,tempComplianceRate:E,tempChecks:m,tempFails:f,totalInspections:s.length,worstLocations:C}},[s]);return!t||t.recurring.length===0&&Object.keys(t.locationRecurring).length===0&&t.worstLocations.length===0?null:l.jsxs("div",{className:"card",style:{marginBottom:24},children:[l.jsx("div",{className:"cardHeader",children:l.jsx("div",{className:"cardTitle",children:"Recurring Issues Tracker"})}),l.jsxs("div",{className:"cardBody",children:[l.jsxs("div",{className:"analysisStatsRow",children:[l.jsxs("div",{className:"analysisStat",children:[l.jsx("div",{className:"analysisStatNum",children:t.totalInspections}),l.jsx("div",{className:"analysisStatLabel",children:"Total Inspections"})]}),t.tempComplianceRate!==null&&l.jsxs("div",{className:"analysisStat",children:[l.jsxs("div",{className:"analysisStatNum",style:{color:t.tempComplianceRate>=90?"#15803D":"#EE0000"},children:[t.tempComplianceRate,"%"]}),l.jsx("div",{className:"analysisStatLabel",children:"Temp Compliance"})]}),l.jsxs("div",{className:"analysisStat",children:[l.jsx("div",{className:"analysisStatNum",style:{color:t.recurring.length>0?"#EE0000":"#15803D"},children:t.recurring.length}),l.jsx("div",{className:"analysisStatLabel",children:"Repeat Issues"})]})]}),t.recurring.length>0&&l.jsxs("div",{style:{marginTop:16},children:[l.jsx("div",{className:"guideSectionTitle",children:"Issues That Keep Coming Back"}),l.jsx("div",{className:"recurringList",children:t.recurring.map(({category:n,count:r,kitchens:o})=>l.jsxs("div",{className:"recurringItem recurringItemExpanded",children:[l.jsx("span",{className:"recurringBar",style:{width:`${Math.min(100,r/t.totalInspections*100)}%`}}),l.jsxs("div",{className:"recurringTop",children:[l.jsx("span",{className:"recurringLabel",children:n}),l.jsxs("span",{className:"recurringBadge",children:[r,"/",t.totalInspections," (",Math.round(r/t.totalInspections*100),"%)"]})]}),l.jsx("div",{className:"recurringKitchens",children:o.map((a,u)=>l.jsxs("span",{className:"recurringKitchenTag recurringKitchenClickable",onClick:()=>e?.(a.label.split(" #")[0].split(" (")[0]),children:[a.label," ",l.jsxs("span",{className:"recurringKitchenCount",children:["",a.count]})]},u))})]},n))})]}),t.worstLocations.length>0&&l.jsxs("div",{style:{marginTop:20},children:[l.jsx("div",{className:"guideSectionTitle",children:"Locations With Most Issues"}),l.jsx("div",{className:"worstLocationsList",children:t.worstLocations.map(([n,r],o)=>l.jsxs("div",{className:"worstLocation worstLocationClickable",onClick:()=>e?.(n.split(" #")[0].split(" (")[0]),children:[l.jsxs("span",{className:"worstRank",style:{background:o===0?"#EE0000":o===1?"#f97316":"#eab308"},children:["#",o+1]}),l.jsx("span",{className:"worstName",children:n}),l.jsxs("span",{className:"worstCount",children:[r," issue",r!==1?"s":""]}),l.jsx("span",{className:"worstArrow",children:""})]},n))})]}),Object.keys(t.locationRecurring).length>0&&l.jsxs("div",{style:{marginTop:20},children:[l.jsx("div",{className:"guideSectionTitle",children:"Flagged Locations  Repeat Problems"}),Object.entries(t.locationRecurring).map(([n,r])=>l.jsxs("div",{className:"flaggedLocation",children:[l.jsx("div",{className:"flaggedLocationName",children:n}),l.jsx("div",{className:"flaggedIssuesList",children:r.map((o,a)=>l.jsxs("div",{className:"flaggedIssue",children:[l.jsx("span",{className:"flaggedIssueCat",children:o.category}),l.jsxs("span",{className:"flaggedIssueRate",style:{color:o.rate>=50?"#EE0000":"#b45309"},children:[o.count,"x (",o.rate,"% of inspections)"]})]},a))})]},n))]})]})]})}function Zg({onBack:s}){const[e,t]=q.useState([]),[n,r]=q.useState(""),[o,a]=q.useState(""),[u,d]=q.useState(""),[m,f]=q.useState(""),[E,w]=q.useState(""),[C,I]=q.useState(""),[R,N]=q.useState(null),[k,S]=q.useState(!1),[F,B]=q.useState("reports");q.useEffect(()=>{To().then(p=>{t(p),S(!0)})},[]),q.useMemo(()=>{const p=new Set;for(const D of e)for(const J of D.actionItems||[])p.add(J.issue?.split(":")[0]?.trim()||"Other");return Array.from(p).sort()},[e]);const $=q.useMemo(()=>e.filter(p=>!(n&&p.inspectionDate!==n||o&&p.inspectionType!==o||u&&p.floor!==u||C&&p.locationType!==C||E&&!`${p.siteName||p.location||""}${p.siteNumber?` #${p.siteNumber}`:""}`.toLowerCase().includes(E.toLowerCase())||m&&!(p.actionItems||[]).some(J=>J.issue?.toLowerCase().includes(m.toLowerCase())))),[e,n,o,u,E,m]);function O(p){w(p),r(""),a(""),d(""),f(""),B("reports"),setTimeout(()=>{const D=document.getElementById("history-results");D&&D.scrollIntoView({behavior:"smooth",block:"start"})},100)}function b(p){const D=e.filter(J=>J.id!==p);t(D),Ig(p).catch(()=>{})}function y(){confirm("Delete all inspection history? This cannot be undone.")&&(t([]),Ag().catch(()=>{}))}const _=[...new Set(e.map(p=>p.inspectionDate).filter(Boolean))].sort().reverse(),T=[...new Set(e.map(p=>p.inspectionType).filter(Boolean))].sort(),v=[...new Set(e.map(p=>p.floor).filter(Boolean))].sort(),A=[...new Set(e.map(p=>p.locationType).filter(Boolean))].sort();return l.jsxs("div",{className:"appShell",children:[l.jsxs("header",{className:"topBar",children:[l.jsxs("div",{className:"brandLeft brandClickable",onClick:s,title:"Back to Inspector",children:[l.jsx("img",{src:In,alt:"Sodexo",className:"brandLogo"}),l.jsxs("div",{children:[l.jsx("div",{className:"brandTitle",children:"Inspection History"}),l.jsxs("div",{className:"brandSub",children:[e.length," saved inspection",e.length!==1?"s":""]})]})]}),l.jsxs("div",{className:"topActions",children:[l.jsx("button",{className:"btn btnGhost",onClick:s,type:"button",children:"Back to Inspector"}),e.length>0&&l.jsx("button",{className:"btn btnGhost",onClick:y,type:"button",style:{color:"#EE0000",borderColor:"#EE0000"},children:"Clear All"})]})]}),l.jsx("div",{className:"topBarSpacer"}),l.jsxs("main",{className:"pageMain pageMainWide",children:[l.jsxs("div",{className:"card",style:{marginBottom:24},children:[l.jsxs("div",{className:"cardHeader",children:[l.jsx("div",{className:"cardTitle",children:"Filters"}),(n||o||u||E||m)&&l.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{r(""),a(""),d(""),w(""),f("")},children:"Clear filters"})]}),l.jsx("div",{className:"cardBody",children:l.jsxs("div",{className:"fieldGrid filterGrid",children:[l.jsxs("label",{className:"field",children:[l.jsx("span",{className:"fieldLabel",children:"Date"}),l.jsxs("select",{className:"select",value:n,onChange:p=>r(p.target.value),children:[l.jsx("option",{value:"",children:"All dates"}),_.map(p=>l.jsx("option",{value:p,children:p},p))]})]}),l.jsxs("label",{className:"field",children:[l.jsx("span",{className:"fieldLabel",children:"Inspection Type"}),l.jsxs("select",{className:"select",value:o,onChange:p=>a(p.target.value),children:[l.jsx("option",{value:"",children:"All types"}),T.map(p=>l.jsx("option",{value:p,children:p},p))]})]}),l.jsxs("label",{className:"field",children:[l.jsx("span",{className:"fieldLabel",children:"Floor"}),l.jsxs("select",{className:"select",value:u,onChange:p=>d(p.target.value),children:[l.jsx("option",{value:"",children:"All floors"}),v.map(p=>l.jsx("option",{value:p,children:p},p))]})]}),l.jsxs("label",{className:"field",children:[l.jsx("span",{className:"fieldLabel",children:"Location Type"}),l.jsxs("select",{className:"select",value:C,onChange:p=>I(p.target.value),children:[l.jsx("option",{value:"",children:"All types"}),A.map(p=>l.jsx("option",{value:p,children:p},p))]})]}),l.jsxs("label",{className:"field",children:[l.jsx("span",{className:"fieldLabel",children:"Location"}),l.jsx("input",{className:"input",value:E,onChange:p=>w(p.target.value),placeholder:"e.g., North Kitchen #204"})]}),l.jsxs("label",{className:"field",children:[l.jsx("span",{className:"fieldLabel",children:"Search Issues"}),l.jsx("input",{className:"input",value:m,onChange:p=>f(p.target.value),placeholder:"e.g., ceiling, temp, allergen..."})]})]})})]}),e.length>=2&&l.jsxs("div",{className:"historyTabs",children:[l.jsxs("button",{className:fe("historyTab",F==="reports"&&"historyTabActive"),onClick:()=>B("reports"),type:"button",children:["Reports (",$.length,")"]}),l.jsx("button",{className:fe("historyTab",F==="analytics"&&"historyTabActive"),onClick:()=>B("analytics"),type:"button",children:"Analytics"})]}),F==="analytics"&&e.length>=2&&l.jsxs(l.Fragment,{children:[l.jsx(Yg,{history:$.length>0?$:e}),l.jsx(Xg,{history:$.length>0?$:e,onLocationClick:O})]}),F==="reports"&&($.length===0?l.jsx("div",{className:"card",children:l.jsx("div",{className:"cardBody",children:l.jsxs("div",{className:"emptyState",children:[l.jsx("div",{className:"emptyTitle",children:e.length===0?"No inspections saved yet":"No matches"}),l.jsx("div",{className:"emptySub",children:e.length===0?"Complete an inspection and click Save to build your history.":"Try adjusting your filters."})]})})}):l.jsx("div",{className:"historyList",id:"history-results",children:$.map(p=>{const D=R===p.id,J=p.actionItems||[],we=p.overallStatus==="Pass"?"#15803D":"#EE0000";return l.jsxs("div",{className:"card historyCard",style:{marginBottom:16},children:[l.jsxs("div",{className:"cardHeader",style:{cursor:"pointer"},onClick:()=>N(D?null:p.id),children:[l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,flex:1},children:[l.jsx("span",{className:"historyStatus",style:{background:we},children:p.overallStatus}),l.jsxs("div",{children:[l.jsx("div",{className:"cardTitle",children:p.siteName||p.location||"Inspection"}),l.jsxs("div",{className:"cardSub",children:[p.inspectionDate," "," ",l.jsx("span",{className:fe("typeBadge",p.inspectionType==="Event Day"?"typeBadgeEvent":p.inspectionType==="Post Event"?"typeBadgePost":"typeBadgeRegular"),children:p.inspectionType}),p.locationType&&l.jsxs(l.Fragment,{children:[" "," ",l.jsx("span",{className:"typeBadge typeBadgeLocType",children:p.locationType})]}),p.floor&&l.jsxs(l.Fragment,{children:[" "," ",l.jsx("span",{className:"typeBadge typeBadgeFloor",children:p.floor})]})," "," ",p.inspectorName||""]})]})]}),l.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[J.length>0&&l.jsxs("span",{className:"pill",children:[J.length," issue",J.length!==1?"s":""]}),l.jsx("span",{style:{fontSize:"1.2rem",color:"var(--sdx-gray-400)"},children:D?"":""})]})]}),D&&l.jsxs("div",{className:"cardBody",children:[l.jsxs("div",{className:"historyMeta",children:[l.jsxs("div",{children:[l.jsx("strong",{children:"Inspector:"})," ",p.inspectorName||""]}),l.jsxs("div",{children:[l.jsx("strong",{children:"Supervisor:"})," ",p.supervisorName||""]}),l.jsxs("div",{children:[l.jsx("strong",{children:"Unit #:"})," ",p.siteNumber||""]}),l.jsxs("div",{children:[l.jsx("strong",{children:"Floor:"})," ",p.floor||""]}),l.jsxs("div",{children:[l.jsx("strong",{children:"Hand sink:"})," ",p.temps?.handSinkTempF||"","F"]}),l.jsxs("div",{children:[l.jsx("strong",{children:"3-comp wash:"})," ",p.temps?.threeCompSinkTempF||"","F"]})]}),J.length>0&&l.jsxs("div",{style:{marginTop:16},children:[l.jsx("div",{className:"guideSectionTitle",children:"Action Items"}),l.jsxs("table",{className:"historyTable",children:[l.jsx("thead",{children:l.jsxs("tr",{children:[l.jsx("th",{children:"Issue"}),l.jsx("th",{children:"Priority"})]})}),l.jsx("tbody",{children:J.map((Ie,he)=>l.jsxs("tr",{children:[l.jsx("td",{children:Ie.issue}),l.jsx("td",{children:l.jsx("span",{className:fe("priorityBadge",Ie.priority==="High"?"priorityHigh":"priorityMed"),children:Ie.priority})})]},he))})]})]}),p.rawNotes&&l.jsxs("div",{style:{marginTop:16},children:[l.jsx("div",{className:"guideSectionTitle",children:"Inspector Notes"}),l.jsx("div",{className:"historyNotesFormatted",style:{maxHeight:250,overflowY:"auto"},children:(()=>{const{grouped:Ie}=Mr(p.rawNotes);return Lr.map(he=>Ie[he]?.length?l.jsxs("div",{style:{marginBottom:10},children:[l.jsx("div",{className:fe("rptNoteCatLabel",`rptNoteCat--${he}`),children:Or[he]}),l.jsx("ul",{className:"rptNoteBullets",children:Ie[he].map((M,K)=>l.jsx("li",{children:M},K))})]},he):null)})()})]}),l.jsxs("div",{style:{marginTop:16,display:"flex",gap:8},children:[l.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{Ru({output:p.output||p.rawNotes||"",inspectionDate:p.inspectionDate,siteName:p.siteName})},children:"Download TXT"}),l.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{Nu({output:p.output||p.rawNotes||"",inspectionType:p.inspectionType,inspectionDate:p.inspectionDate,siteName:p.siteName,inspectorName:p.inspectorName})},children:"Download HTML"}),l.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>b(p.id),style:{color:"#EE0000",borderColor:"rgba(238,0,0,.3)",marginLeft:"auto"},children:"Delete"})]})]})]},p.id)})}))]}),l.jsxs("footer",{className:"footer",children:[l.jsx("img",{src:In,alt:"Sodexo",className:"footerLogo"}),l.jsx("span",{children:Le?" Inspection history synced to cloud database.":"Inspection history is stored locally in your browser."})]})]})}function ey({currentUser:s,onBack:e}){const[t,n]=q.useState([]),[r,o]=q.useState(!1),[a,u]=q.useState(""),[d,m]=q.useState(""),[f,E]=q.useState(""),[w,C]=q.useState("inspector"),[I,R]=q.useState(""),[N,k]=q.useState(""),[S,F]=q.useState(!1);q.useEffect(()=>{Ue().then(n);const D=setInterval(()=>{Ue().then(n)},1e4);return()=>clearInterval(D)},[]);async function B(){n(await Ue())}async function $(D){await Ng(D),await B()}async function O(D){confirm("Remove this access request?")&&(await Cl(D),await B())}async function b(D){await Rg(D),await B()}async function y(D){await Pg(D),await B()}async function _(D){confirm("Remove this user? They will need to request access again.")&&(await Cl(D),await B())}async function T(D){D.preventDefault(),R(""),k(""),F(!0);try{if(a.trim().length<3){R("Badge number must be at least 3 characters.");return}const J=await Cg(a.trim(),d.trim(),f.trim(),w);J.ok?(k(`${d.trim()} added as ${w==="admin"?"Admin":"Inspector"}.`),u(""),m(""),E(""),C("inspector"),await B(),setTimeout(()=>k(""),3e3)):J.reason==="exists"&&R("This badge number is already registered.")}catch{R("Failed to add user. Try again.")}finally{F(!1)}}const v=t.filter(D=>!D.approved),A=t.filter(D=>D.approved),p=t.filter(D=>D.role==="admin"&&D.approved).length;return l.jsxs("div",{className:"appShell",children:[l.jsxs("header",{className:"topBar",children:[l.jsxs("div",{className:"brandLeft brandClickable",onClick:e,title:"Back to Inspector",children:[l.jsx("img",{src:In,alt:"Sodexo",className:"brandLogo"}),l.jsxs("div",{children:[l.jsx("div",{className:"brandTitle",children:"Admin Panel"}),l.jsx("div",{className:"brandSub",children:"Manage user access & permissions"})]})]}),l.jsx("div",{className:"topActions",children:l.jsx("button",{className:"btn btnGhost",onClick:e,type:"button",children:"Back to Inspector"})})]}),l.jsx("div",{className:"topBarSpacer"}),l.jsxs("main",{className:"pageMain pageMainNarrow",children:[l.jsxs("div",{className:"card adminCard",style:{marginBottom:24},children:[l.jsxs("div",{className:"cardHeader",children:[l.jsx("div",{className:"cardTitle",children:"Add New User"}),l.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{o(!r),R(""),k("")},children:r?"Cancel":"+ Add User"})]}),r&&l.jsx("div",{className:"cardBody",children:l.jsxs("form",{onSubmit:T,className:"addUserForm",children:[l.jsxs("div",{className:"fieldGrid",children:[l.jsxs("label",{className:"field",children:[l.jsx("span",{className:"fieldLabel",children:"Badge Number"}),l.jsx("input",{className:"input",type:"password",value:a,onChange:D=>u(D.target.value),placeholder:"Enter badge #",autoComplete:"off"})]}),l.jsxs("label",{className:"field",children:[l.jsx("span",{className:"fieldLabel",children:"Full Name"}),l.jsx("input",{className:"input",value:d,onChange:D=>m(D.target.value),placeholder:"e.g., Jane Smith"})]}),l.jsxs("label",{className:"field",children:[l.jsx("span",{className:"fieldLabel",children:"Department"}),l.jsx("input",{className:"input",value:f,onChange:D=>E(D.target.value),placeholder:"e.g., Safety Inspector"})]}),l.jsxs("label",{className:"field",children:[l.jsx("span",{className:"fieldLabel",children:"Role"}),l.jsxs("select",{className:"select",value:w,onChange:D=>C(D.target.value),children:[l.jsx("option",{value:"inspector",children:"Inspector"}),l.jsx("option",{value:"admin",children:"Admin"})]})]})]}),I&&l.jsx("div",{className:"pinError",style:{marginTop:8},children:I}),N&&l.jsx("div",{className:"addUserSuccess",children:N}),l.jsx("button",{className:"btn btnPrimary",type:"submit",style:{marginTop:12},disabled:S||a.trim().length<3||!d.trim()||!f.trim(),children:S?"Adding...":`Add as ${w==="admin"?"Admin":"Inspector"}`})]})})]}),v.length>0&&l.jsxs("div",{className:"card adminCard",style:{marginBottom:24},children:[l.jsx("div",{className:"cardHeader",children:l.jsxs("div",{className:"cardTitle",children:["Pending Approvals",l.jsx("span",{className:"adminCount",children:v.length})]})}),l.jsx("div",{className:"cardBody",children:v.map(D=>l.jsxs("div",{className:"adminUserRow",children:[l.jsxs("div",{className:"adminUserInfo",children:[l.jsxs("div",{className:"adminUserName",children:[D.name," ",D.badgeDisplay&&l.jsxs("span",{className:"badgeNumDisplay",children:["Badge: ",D.badgeDisplay]})]}),l.jsxs("div",{className:"adminUserMeta",children:[D.department,"  Requested ",new Date(D.registeredAt).toLocaleDateString()]})]}),l.jsxs("div",{className:"adminUserActions",children:[l.jsx("button",{className:"btn btnPrimary btnSmall",onClick:()=>$(D.badgeHash),children:"Approve"}),l.jsx("button",{className:"btn btnGhost btnSmall adminDenyBtn",onClick:()=>O(D.badgeHash),children:"Deny"})]})]},D.badgeHash))})]}),l.jsxs("div",{className:"card adminCard",children:[l.jsx("div",{className:"cardHeader",children:l.jsxs("div",{className:"cardTitle",children:["Team Members",l.jsx("span",{className:"adminCount",children:A.length})]})}),l.jsx("div",{className:"cardBody",children:A.length===0?l.jsx("div",{className:"emptyState",children:l.jsx("div",{className:"emptyTitle",children:"No approved users"})}):A.map(D=>{const J=D.badgeHash===s?.badgeHash,we=D.role==="admin"&&p<=1;return l.jsxs("div",{className:"adminUserRow",children:[l.jsxs("div",{className:"adminUserInfo",children:[l.jsxs("div",{className:"adminUserName",children:[D.name,D.role==="admin"&&l.jsx("span",{className:"roleBadge adminRoleBadge",children:"Admin"}),D.role==="inspector"&&l.jsx("span",{className:"roleBadge inspectorRoleBadge",children:"Inspector"}),J&&l.jsx("span",{className:"roleBadge youRoleBadge",children:"You"}),D.badgeDisplay&&l.jsxs("span",{className:"badgeNumDisplay",children:["Badge: ",D.badgeDisplay]})]}),l.jsxs("div",{className:"adminUserMeta",children:[D.department,"  Since ",new Date(D.registeredAt).toLocaleDateString()]})]}),l.jsxs("div",{className:"adminUserActions",children:[D.role==="inspector"&&l.jsx("button",{className:"btn btnGhost btnSmall",onClick:()=>b(D.badgeHash),children:"Make Admin"}),D.role==="admin"&&!we&&!J&&l.jsx("button",{className:"btn btnGhost btnSmall",onClick:()=>y(D.badgeHash),children:"Remove Admin"}),!J&&l.jsx("button",{className:"btn btnGhost btnSmall adminDenyBtn",onClick:()=>_(D.badgeHash),children:"Remove"})]})]},D.badgeHash)})})]})]}),l.jsxs("footer",{className:"footer",children:[l.jsx("img",{src:In,alt:"Sodexo",className:"footerLogo"}),l.jsx("span",{children:Le?" User accounts synced to cloud database.":"User accounts are stored locally on this device."})]})]})}function ty({photos:s,onRemove:e}){return s?.length?l.jsx("div",{className:"photoStrip",children:s.map(t=>l.jsxs("div",{className:"photoThumb",children:[l.jsx("img",{src:t.previewUrl,alt:t.name}),l.jsx("button",{className:"thumbX",type:"button",onClick:()=>e(t.id),"aria-label":"Remove photo",children:""})]},t.id))}):null}function gi({title:s,items:e,inspection:t,setInspection:n,allowCustom:r,sectionKey:o,coldEquipmentMap:a}){const u=q.useRef({}),[d,m]=q.useState("");async function f(I,R){const N=Array.from(R||[]).slice(0,mi),k=[];for(const S of N){if(!S.type.startsWith("image/")||Pl(S.size)>Nl)continue;const F=await qg(S);F&&k.push({id:`${Date.now()}_${Math.random().toString(16).slice(2)}`,name:S.name,sizeMb:Pl(S.size),type:"image/jpeg",previewUrl:F})}k.length!==0&&n(S=>{const F=I.split("."),B=fi(S,F)||ye({status:"OK",notes:""}),$={...B,photos:[...B.photos||[],...k].slice(0,mi)};return Tt(S,F,$)})}function E(I,R){n(N=>{const k=I.split("."),S=fi(N,k)||ye({status:"OK",notes:""}),F={...S,photos:(S.photos||[]).filter(B=>B.id!==R)};return Tt(N,k,F)})}const w=q.useMemo(()=>{if(!r||!o)return[];const I=t?.[o]||{};return Object.keys(I).filter(R=>R.startsWith("custom_")).map(R=>({path:[o,R],label:I[R]?.label||"Custom item",isCustom:!0,customKey:R}))},[r,o,t]),C=[...e,...w];return l.jsxs("div",{className:"guideSection",children:[l.jsx("div",{className:"guideSectionTitle",children:s}),l.jsx("div",{className:"guideItems",children:C.map(I=>{const R=I.path.join("."),N=I.path[I.path.length-1],k=fi(t,I.path)||ye({status:"OK",notes:""}),S=a?.[N]||(I.isCustom?ls(I.label):null),F=k.tempF||"",B=Number(F);return l.jsxs("div",{className:"guideItem",children:[l.jsxs("div",{className:"guideItemHead",children:[l.jsxs("div",{className:"guideLabel",children:[I.label,S&&l.jsx("span",{className:"coldTypeBadge",children:S.type==="cooler"?" Cooler":" Freezer"})]}),l.jsx("select",{className:"select selectSmall",value:k.status,onChange:$=>n(O=>Tt(O,I.path,{...k,status:$.target.value})),children:Dg.map($=>l.jsx("option",{value:$,children:$},$))})]}),S&&l.jsxs("div",{className:"equipTempRow",children:[l.jsxs("div",{className:"tempInputWrap",style:{flex:1},children:[l.jsx("input",{className:"input inputSmall tempInput",inputMode:"numeric",value:F,onChange:$=>n(O=>Tt(O,I.path,{...k,tempF:$.target.value})),placeholder:S.type==="cooler"?"40":"10"}),l.jsx("span",{className:"tempUnit",children:"F"})]}),l.jsx("span",{className:"hint",style:{whiteSpace:"nowrap"},children:F?B<=S.max?` ${S.max}F`:` Above ${S.max}F`:`Max ${S.max}F`})]}),l.jsx("input",{className:"input inputSmall",value:k.notes,onChange:$=>n(O=>Tt(O,I.path,{...k,notes:$.target.value})),placeholder:"Issue / observation (optional)"}),l.jsxs("div",{className:"photoRow",children:[l.jsx("input",{ref:$=>u.current[R]=$,className:"fileInput",type:"file",accept:"image/*",multiple:!0,onChange:$=>{f(R,$.target.files),$.target.value=""}}),l.jsx("button",{className:"btn btnGhost btnSmall photoBtn",type:"button",onClick:()=>u.current[R]?.click(),children:" Add photos"}),l.jsxs("span",{className:"hint",children:["Up to ",mi," (",Nl,"MB each)"]})]}),l.jsx(ty,{photos:k.photos,onRemove:$=>E(R,$)})]},R)})}),r&&l.jsxs("div",{className:"guideAddItem",children:[l.jsx("input",{className:"input inputSmall",value:d,onChange:I=>m(I.target.value),placeholder:"Add new item (e.g., Walk-in freezer)",onKeyDown:I=>{if(I.key==="Enter"&&d.trim()){const R=`custom_${Date.now()}`,N=ls(d.trim());n(k=>Tt(k,[o,R],{status:"OK",notes:"",photos:[],label:d.trim(),...N?{tempF:""}:{}})),m("")}}}),l.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{if(!d.trim())return;const I=`custom_${Date.now()}`,R=ls(d.trim());n(N=>Tt(N,[o,I],{status:"OK",notes:"",photos:[],label:d.trim(),...R?{tempF:""}:{}})),m("")},children:"+ Add"})]})]})}function ny(){const[s,e]=q.useState(!0),[t,n]=q.useState(null),[r,o]=q.useState("inspector"),[a,u]=q.useState(0),[d,m]=q.useState(64),f=q.useRef(null),E=q.useRef(Date.now());q.useEffect(()=>{const V=document.getElementById("splash");V&&(V.classList.add("hide"),setTimeout(()=>V.remove(),350))},[]),q.useEffect(()=>{if(!f.current)return;const V=new ResizeObserver(([G])=>m(G.contentRect.height));return V.observe(f.current),m(f.current.offsetHeight),()=>V.disconnect()},[s,r]),q.useEffect(()=>{if(!t||t.role!=="admin"||s){u(0);return}async function V(){try{const re=await Ue();u(re.filter(ie=>!ie.approved).length)}catch{}}V();const G=setInterval(V,3e4);return()=>clearInterval(G)},[t,s,r]),q.useEffect(()=>{const V="sdx_last_cache_clean";function G(){const ie=new Date().toISOString().slice(0,10);localStorage.getItem(V)!==ie&&(localStorage.setItem(V,ie),navigator.serviceWorker?.controller&&navigator.serviceWorker.controller.postMessage("CLEAN_CACHE"))}G();const re=setInterval(G,3600*1e3);return()=>clearInterval(re)},[]);const[w,C]=q.useState("inspection"),[I,R]=q.useState(()=>Rl("inspection")),[N,k]=q.useState(()=>pi()),[S,F]=q.useState(""),[B,$]=q.useState(yn.inspection.useCases[0]),[O,b]=q.useState("Regular Inspection"),[y,_]=q.useState(()=>new Date().toISOString().slice(0,10)),[T,v]=q.useState(""),[A,p]=q.useState(""),[D,J]=q.useState(""),[we,Ie]=q.useState(""),[he,M]=q.useState(""),[K,Ae]=q.useState("Concession"),[Me,ht]=q.useState("Floor 1"),[dt,tn]=q.useState(!1),[$e,Ot]=q.useState(""),[nn,Dn]=q.useState(!1),[Ss,mt]=q.useState(""),[Vn,pt]=q.useState([]),[jn,Lt]=q.useState([]),[Qe,Mt]=q.useState(!1),$t=q.useCallback(()=>{E.current=Date.now()},[]);if(q.useEffect(()=>{if(s)return;const V=["mousedown","keydown","touchstart","scroll"];V.forEach(re=>window.addEventListener(re,$t,{passive:!0}));const G=setInterval(()=>{Date.now()-E.current>gg&&(Sl(),e(!0))},3e4);return()=>{V.forEach(re=>window.removeEventListener(re,$t)),clearInterval(G)}},[s,$t]),q.useEffect(()=>{function V(G){S.trim()&&!Qe&&(G.preventDefault(),G.returnValue="")}return window.addEventListener("beforeunload",V),()=>window.removeEventListener("beforeunload",V)},[S,Qe]),s)return l.jsx(kg,{onUnlock:V=>{n(V),e(!1),$t(),V?.name&&!T&&v(V.name)}});if(r==="history")return l.jsx(Zg,{onBack:()=>o("inspector")});if(r==="admin")return l.jsx(ey,{currentUser:t,onBack:()=>o("inspector")});const ve=yn[w];function xe(){R(Rl(w)),k(pi()),F(""),Ot(""),mt(""),pt([]),Lt([]),Mt(!1),b("Regular Inspection"),_(new Date().toISOString().slice(0,10)),v(t?.name||""),p(""),J(""),Ie(""),M(""),Ae("Concession"),ht("Floor 1"),window.scrollTo({top:0,behavior:"smooth"})}function sn(){const V=yn[w].sample;R({...V.context}),k(V.inspection?{...V.inspection}:pi()),F(V.rawNotes||""),b(V.meta?.inspectionType||"Regular Inspection"),_(V.meta?.inspectionDate||V.context?.date||""),v(V.meta?.inspectorName||""),p(""),J(""),Ie(""),M(""),Ot(""),mt(""),pt([]),Lt([])}function $r(){mt(""),pt([]),Lt([]);const V=Hg({inspectionDate:y,inspectorName:T,context:I,noteType:w,inspection:N});if(V.length&&pt(V),!S.trim()){mt("Please enter raw notes before transforming.");return}Dn(!0);try{const G=Kg({noteType:w,useCase:B,context:I,inspection:N,rawNotes:S,inspectionType:O,inspectionDate:y,inspectorName:T,siteName:A,siteNumber:D,sitePhone:he,supervisorName:we,floor:Me});Ot(G);const re=$i({inspection:N,rawNotes:S,context:I,noteType:w});Lt(re)}catch(G){mt(G?.message||"Something went wrong")}finally{Dn(!1)}}async function Cs(){$e&&await navigator.clipboard.writeText($e)}function Br(){const V=$i({inspection:N,rawNotes:S,context:I,noteType:w});Lt(V)}async function ft(){function V(re){if(!re||typeof re!="object")return re;if(Array.isArray(re))return re.map(V);const ie={};for(const[We,ot]of Object.entries(re))We==="photos"&&Array.isArray(ot)?ie.photos=ot.map(qe=>({id:qe.id,name:qe.name,sizeMb:qe.sizeMb,type:qe.type})):ie[We]=V(ot);return ie}const G={id:`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,savedAt:new Date().toISOString(),noteType:w,inspectionType:O,inspectionDate:y,inspectorName:T,siteName:A,siteNumber:D,supervisorName:we,sitePhone:he,locationType:K,floor:Me,location:A||I?.kitchen||"Kitchen",context:{...I},temps:{...N.temps},overallStatus:Ft(N),actionItems:en({inspection:N,rawNotes:S}),rawNotes:S,output:$e,inspection:V(N),photoCount:zg(N)};try{await wg(G),yg(G),Mt(!0),setTimeout(()=>Mt(!1),2500)}catch(re){console.error("Save failed:",re),mt("Save failed  record may be too large. Try removing some photos.")}}function Ns(){Jg({inspection:N,rawNotes:S,inspectionType:O,inspectionDate:y,inspectorName:T,siteName:A,siteNumber:D,supervisorName:we,floor:Me})}function Rs(){Nu({output:$e,inspection:N,rawNotes:S,inspectionType:O,inspectionDate:y,siteName:A,siteNumber:D,sitePhone:he,inspectorName:T,supervisorName:we})}function Fn(){Ru({output:$e,inspectionDate:y,siteName:A})}return l.jsxs("div",{className:"appShell",children:[l.jsxs("header",{className:"topBar",ref:f,children:[l.jsxs("div",{className:"brandLeft brandClickable",onClick:()=>{o("inspector"),window.scrollTo({top:0,behavior:"smooth"})},title:"Home",children:[l.jsx("img",{src:In,alt:"Sodexo",className:"brandLogo"}),l.jsxs("div",{children:[l.jsx("div",{className:"brandTitle",children:"Kitchen Inspection"}),l.jsx("div",{className:"brandSub",children:"Turn sit-down inspection notes into organized documents"})]})]}),l.jsxs("div",{className:"topActionsHamburger",children:[l.jsx("button",{className:fe("btn","btnPrimary","btnGenHeader"),onClick:$r,type:"button",disabled:nn,children:nn?"Generating...":"Generate Report"}),l.jsxs("button",{className:"hamburgerBtn",onClick:()=>tn(!dt),type:"button","aria-label":"Menu",children:[l.jsxs("span",{className:fe("hamburgerIcon",dt&&"hamburgerOpen"),children:[l.jsx("span",{}),l.jsx("span",{}),l.jsx("span",{})]}),a>0&&l.jsx("span",{className:"hamburgerBadge",children:a})]})]}),dt&&l.jsxs("div",{className:"dropdownMenu",onClick:()=>tn(!1),children:[t&&l.jsxs("div",{className:"dropdownMenuUser",children:[t.name,t.role==="admin"?" (Admin)":""]}),l.jsx("button",{className:"dropdownMenuItem",onClick:xe,type:"button",children:"+ New Inspection"}),l.jsx("button",{className:"dropdownMenuItem",onClick:()=>o("history"),type:"button",children:"Past Reports"}),t?.role==="admin"&&l.jsxs("button",{className:"dropdownMenuItem",onClick:()=>o("admin"),type:"button",children:["Admin Panel",a>0&&l.jsxs("span",{className:"menuBadge",children:[a," pending"]})]}),l.jsx("button",{className:"dropdownMenuItem dropdownMenuDanger",onClick:()=>{Sl(),n(null),e(!0)},type:"button",children:"Lock App"})]})]}),l.jsx("div",{style:{height:d,flexShrink:0}}),l.jsxs("main",{className:"grid",children:[l.jsxs("section",{className:"card",children:[l.jsx("div",{className:"cardHeader",children:l.jsx("div",{className:"cardTitle",children:"Inspection Details"})}),l.jsxs("div",{className:"cardBody",children:[l.jsxs("div",{className:"fieldGrid",children:[l.jsxs("label",{className:"field",children:[l.jsx("span",{className:"fieldLabel",children:"Type"}),l.jsx("select",{className:"select",value:O,onChange:V=>b(V.target.value),children:Vg.map(V=>l.jsx("option",{value:V,children:V},V))})]}),l.jsxs("label",{className:"field",id:"field-inspectionDate",children:[l.jsx("span",{className:"fieldLabel",children:"Date"}),l.jsx("input",{className:"input",type:"date",value:y,onChange:V=>_(V.target.value)})]}),l.jsxs("label",{className:"field",id:"field-inspectorName",children:[l.jsx("span",{className:"fieldLabel",children:"Inspector"}),l.jsx("input",{className:"input",value:T,onChange:V=>v(V.target.value),placeholder:"e.g., J. Da Silva"})]}),l.jsxs("label",{className:"field",id:"field-supervisorName",children:[l.jsx("span",{className:"fieldLabel",children:"Supervisor"}),l.jsx("input",{className:"input",list:"supervisorSuggestions",value:we,onChange:V=>Ie(V.target.value),placeholder:"e.g., GM / Chef Lead"}),l.jsx("datalist",{id:"supervisorSuggestions",children:(ns().supervisorName||[]).map((V,G)=>l.jsx("option",{value:V},G))})]}),l.jsxs("label",{className:"field",id:"field-siteName",children:[l.jsx("span",{className:"fieldLabel",children:"Restaurant / Location"}),l.jsx("input",{className:"input",list:"siteNameSuggestions",value:A,onChange:V=>{const G=V.target.value;p(G);const ie=ns().siteMap?.[G];ie&&(ie.siteNumber&&!D&&J(ie.siteNumber),ie.sitePhone&&!he&&M(ie.sitePhone),ie.supervisorName&&!we&&Ie(ie.supervisorName),ie.locationType&&Ae(ie.locationType),ie.floor&&ht(ie.floor))},placeholder:"e.g., North Stand Kitchen"}),l.jsx("datalist",{id:"siteNameSuggestions",children:(ns().siteName||[]).map((V,G)=>l.jsx("option",{value:V},G))})]}),l.jsxs("label",{className:"field",id:"field-siteNumber",children:[l.jsx("span",{className:"fieldLabel",children:"Unit Number"}),l.jsx("input",{className:"input",list:"siteNumberSuggestions",value:D,onChange:V=>J(V.target.value),placeholder:"e.g., Unit 12 / Loc-204"}),l.jsx("datalist",{id:"siteNumberSuggestions",children:(ns().siteNumber||[]).map((V,G)=>l.jsx("option",{value:V},G))})]}),l.jsxs("label",{className:"field",children:[l.jsx("span",{className:"fieldLabel",children:"Location Type"}),l.jsx("select",{className:"select",value:K,onChange:V=>Ae(V.target.value),children:jg.map(V=>l.jsx("option",{value:V,children:V},V))})]}),l.jsxs("label",{className:"field",children:[l.jsx("span",{className:"fieldLabel",children:"Phone (optional)"}),l.jsx("input",{className:"input",value:he,onChange:V=>M(V.target.value),placeholder:"e.g., (305) 555-0123"})]}),l.jsxs("label",{className:"field",children:[l.jsx("span",{className:"fieldLabel",children:"Floor"}),l.jsx("select",{className:"select",value:Me,onChange:V=>ht(V.target.value),children:Fg.map(V=>l.jsx("option",{value:V,children:V},V))})]})]}),l.jsx("div",{className:"fieldGrid",children:ve.contextFields.map(V=>l.jsxs("label",{className:"field",id:`field-ctx-${V.key}`,children:[l.jsx("span",{className:"fieldLabel",children:V.label}),V.key==="date"?l.jsx("input",{className:"input",type:"date",value:I[V.key]??"",onChange:G=>R(re=>({...re,[V.key]:G.target.value}))}):l.jsx("input",{className:"input",value:I[V.key]??"",onChange:G=>R(re=>({...re,[V.key]:G.target.value})),placeholder:V.label})]},V.key))}),l.jsxs("div",{className:"field",children:[l.jsxs("div",{className:"fieldLabelRow",children:[l.jsx("span",{className:"fieldLabel",children:"Final output format"}),l.jsx("span",{className:"hint",children:"Adapts to the selected note type"})]}),l.jsx("select",{className:"select",value:B,onChange:V=>$(V.target.value),children:ve.useCases.map(V=>l.jsx("option",{value:V,children:V},V))})]}),l.jsxs("div",{className:"guide",children:[l.jsxs("div",{className:"guideHeader",children:[l.jsxs("div",{children:[l.jsx("div",{className:"guideTitle",children:"Inspector guide"}),l.jsx("div",{className:"guideSub",children:"Fast checklist for sit-down kitchen inspections"})]}),l.jsxs("div",{className:"pillRow",children:[l.jsxs("span",{className:"pill",children:["Hand sink ",""," 95 F"]}),l.jsxs("span",{className:"pill",children:["3-comp wash ",""," 110 F"]}),l.jsxs("span",{className:"pill",children:["Cooler ",""," 40 F"]}),l.jsxs("span",{className:"pill",children:["Freezer ",""," 20 F"]})]})]}),l.jsx(gi,{title:"Facility: ceiling, walls, floors, lighting",items:[{path:["facility","ceiling"],label:"Ceiling"},{path:["facility","walls"],label:"Walls"},{path:["facility","floors"],label:"Floors"},{path:["facility","lighting"],label:"Lighting"}],inspection:N,setInspection:k,allowCustom:!0,sectionKey:"facility"}),l.jsx(gi,{title:"Operations: employees + process controls",items:[{path:["operations","employeePractices"],label:"Employee practices"},{path:["operations","handwashing"],label:"Handwashing / supplies"},{path:["operations","labelingDating"],label:"Labeling / dating"},{path:["operations","logs"],label:"Logs / documentation"}],inspection:N,setInspection:k,allowCustom:!0,sectionKey:"operations"}),l.jsxs("div",{className:"tempsRow",children:[l.jsx("div",{className:"tempsTitle",children:"Key temperatures"}),l.jsxs("div",{className:"tempsGrid",children:[l.jsxs("label",{className:"field",id:"field-handSinkTempF",style:{marginTop:0},children:[l.jsx("span",{className:"fieldLabel",children:"Hand sink temp"}),l.jsxs("div",{className:"tempInputWrap",children:[l.jsx("input",{className:"input tempInput",inputMode:"numeric",value:N.temps.handSinkTempF,onChange:V=>k(G=>({...G,temps:{...G.temps,handSinkTempF:V.target.value}})),placeholder:"97"}),l.jsx("span",{className:"tempUnit",children:"F"})]}),l.jsx("span",{className:"hint",children:Number(N.temps.handSinkTempF)>=95?"Meets >=95 F":N.temps.handSinkTempF?"Below 95 F - flag":""})]}),l.jsxs("label",{className:"field",id:"field-threeCompSinkTempF",style:{marginTop:0},children:[l.jsx("span",{className:"fieldLabel",children:"3-comp wash temp"}),l.jsxs("div",{className:"tempInputWrap",children:[l.jsx("input",{className:"input tempInput",inputMode:"numeric",value:N.temps.threeCompSinkTempF,onChange:V=>k(G=>({...G,temps:{...G.temps,threeCompSinkTempF:V.target.value}})),placeholder:"112"}),l.jsx("span",{className:"tempUnit",children:"F"})]}),l.jsx("span",{className:"hint",children:Number(N.temps.threeCompSinkTempF)>=110?"Meets >=110 F":N.temps.threeCompSinkTempF?"Below 110 F - flag":""})]}),Object.entries(vs).map(([V,G])=>{const ie=N.equipment?.[V]?.tempF||"",We=Number(ie);return l.jsxs("label",{className:"field",style:{marginTop:0},children:[l.jsxs("span",{className:"fieldLabel",children:[G.label," temp"]}),l.jsxs("div",{className:"tempInputWrap",children:[l.jsx("input",{className:"input tempInput",inputMode:"numeric",value:ie,onChange:ot=>k(qe=>{const at=qe.equipment?.[V]||{status:"OK",notes:"",photos:[]};return{...qe,equipment:{...qe.equipment,[V]:{...at,tempF:ot.target.value}}}}),placeholder:G.type==="cooler"?"38":"10"}),l.jsx("span",{className:"tempUnit",children:"F"})]}),l.jsx("span",{className:"hint",children:ie?We<=G.max?`Meets ${G.max} F`:`Above ${G.max} F - flag`:""})]},V)})]})]}),l.jsx(gi,{title:"Equipment check",items:[{path:["equipment","doubleDoorCooler"],label:"Double-door cooler"},{path:["equipment","doubleDoorFreezer"],label:"Double-door freezer"},{path:["equipment","walkInCooler"],label:"Walk-in cooler"},{path:["equipment","walkInFreezer"],label:"Walk-in freezer"},{path:["equipment","prepCooler"],label:"Prep cooler"},{path:["equipment","warmers"],label:"Warmers / hot holding"},{path:["equipment","ovens"],label:"Ovens"},{path:["equipment","threeCompSink"],label:"3-compartment sink"},{path:["equipment","ecolab"],label:"Ecolab / chemicals"}],inspection:N,setInspection:k,allowCustom:!0,sectionKey:"equipment",coldEquipmentMap:vs})]}),l.jsxs("div",{className:"field",children:[l.jsxs("div",{className:"fieldLabelRow",children:[l.jsx("span",{className:"fieldLabel",children:"Raw notes"}),l.jsx("span",{className:"hint",children:"Abbreviations are expanded while preserving meaning"})]}),l.jsx("textarea",{className:"textarea",value:S,onChange:V=>F(V.target.value),placeholder:"Paste quick inspection notes here...",rows:10})]}),Vn.length>0&&l.jsxs("div",{className:"warningBox",children:[l.jsx("strong",{children:"Missing information:"}),l.jsx("ul",{children:Vn.map((V,G)=>l.jsx("li",{className:"warningLink",onClick:()=>{const re=document.getElementById(V.fieldId);if(re){re.scrollIntoView({behavior:"smooth",block:"center"});const ie=re.querySelector("input, select, textarea");ie&&setTimeout(()=>ie.focus(),400),re.classList.add("fieldHighlight"),setTimeout(()=>re.classList.remove("fieldHighlight"),2e3)}},children:V.text},G))})]}),Ss?l.jsx("div",{className:"errorBox",children:Ss}):null]})]}),l.jsxs("section",{className:"card",id:"report-output",children:[l.jsxs("div",{className:"cardHeader",children:[l.jsxs("div",{children:[l.jsx("div",{className:"cardTitle",children:"Output"}),l.jsx("div",{className:"cardSub",children:Ug(w,B)})]}),l.jsxs("div",{className:"outputActions",children:[l.jsx("button",{className:"btn btnGhost",type:"button",onClick:Cs,disabled:!$e,children:"Copy"}),l.jsx("button",{className:fe("btn",Qe?"btnSaved":"btnSave"),type:"button",onClick:ft,disabled:!$e,children:Qe?"Saved!":"Save"})]})]}),l.jsxs("div",{className:"cardBody",children:[jn.length>0&&l.jsxs("div",{className:"aiBox",children:[l.jsx("div",{className:"aiBoxTitle",children:"AI Assistant"}),l.jsx("ul",{children:jn.map((V,G)=>l.jsx("li",{children:V},G))})]}),$e?l.jsxs(l.Fragment,{children:[l.jsx(Gg,{noteType:w,useCase:B,context:I,inspection:N,rawNotes:S,inspectionType:O,inspectionDate:y,inspectorName:T,siteName:A,siteNumber:D,sitePhone:he,supervisorName:we,locationType:K,floor:Me}),l.jsxs("div",{className:"downloadBar",children:[l.jsx("span",{className:"downloadLabel",children:"Download:"}),l.jsx("button",{className:"btn btnDownload",type:"button",onClick:Ns,children:"Excel (.xls)"}),l.jsx("button",{className:"btn btnDownload",type:"button",onClick:Rs,children:"Word (.doc)"}),l.jsx("button",{className:"btn btnDownload",type:"button",onClick:Fn,children:"Text (.txt)"})]})]}):l.jsxs("div",{className:"emptyState",children:[l.jsx("div",{className:"emptyIcon",children:""}),l.jsx("div",{className:"emptyTitle",children:"Ready to generate your report"}),l.jsxs("div",{className:"emptySub",children:["Fill in the inspection details on the left, then click ",l.jsx("strong",{children:"Generate Report"}),"."]})]})]})]})]}),l.jsx("button",{className:"fab fabLeft",onClick:sn,type:"button",title:"Try Example",children:" Try Example"}),l.jsx("button",{className:"fab fabRight",onClick:Br,type:"button",title:"AI Tips",children:" AI Tips"}),$e&&l.jsxs("div",{className:"stickyActionBar",children:[l.jsx("button",{className:"btn stickyBtn stickyBtnView",type:"button",onClick:()=>{const V=document.getElementById("report-output");V&&V.scrollIntoView({behavior:"smooth",block:"start"})},children:" View Report"}),l.jsx("button",{className:fe("btn stickyBtn",Qe?"stickyBtnSaved":"stickyBtnSave"),type:"button",onClick:ft,children:Qe?" Saved!":"&#128190; Save Report"}),l.jsx("button",{className:"btn stickyBtn stickyBtnNew",type:"button",onClick:xe,children:"+ New"})]}),l.jsxs("footer",{className:"footer",children:[l.jsx("img",{src:In,alt:"Sodexo",className:"footerLogo"}),l.jsx("span",{children:Le?" Cloud database connected  data syncs across all devices.":"U0001F512 Data stored locally on this device."})]})]})}ih.createRoot(document.getElementById("root")).render(l.jsx(nh.StrictMode,{children:l.jsx(ny,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/Claude/sw.js").catch(()=>{})});
