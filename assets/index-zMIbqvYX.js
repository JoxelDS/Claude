import{r as xl,g as Cl,a as Wu}from"./react-N--QU9DW.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();var Wr={exports:{}},Wn={};var aa;function Gu(){if(aa)return Wn;aa=1;var n=xl(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function a(u,d,f){var p,_={},w=null,A=null;f!==void 0&&(w=""+f),d.key!==void 0&&(w=""+d.key),d.ref!==void 0&&(A=d.ref);for(p in d)s.call(d,p)&&!o.hasOwnProperty(p)&&(_[p]=d[p]);if(u&&u.defaultProps)for(p in d=u.defaultProps,d)_[p]===void 0&&(_[p]=d[p]);return{$$typeof:e,type:u,key:w,ref:A,props:_,_owner:r.current}}return Wn.Fragment=t,Wn.jsx=a,Wn.jsxs=a,Wn}var la;function Qu(){return la||(la=1,Wr.exports=Gu()),Wr.exports}var c=Qu(),B=xl();const Ju=Cl(B);var ks={},ca;function Yu(){if(ca)return ks;ca=1;var n=Wu();return ks.createRoot=n.createRoot,ks.hydrateRoot=n.hydrateRoot,ks}var Xu=Yu();const Zu=Cl(Xu),eh=()=>{};var ua={};const Nl=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let r=n.charCodeAt(s);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},th=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const r=n[t++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const o=n[t++];e[s++]=String.fromCharCode((r&31)<<6|o&63)}else if(r>239&&r<365){const o=n[t++],a=n[t++],u=n[t++],d=((r&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;e[s++]=String.fromCharCode(55296+(d>>10)),e[s++]=String.fromCharCode(56320+(d&1023))}else{const o=n[t++],a=n[t++];e[s++]=String.fromCharCode((r&15)<<12|(o&63)<<6|a&63)}}return e.join("")},Rl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){const o=n[r],a=r+1<n.length,u=a?n[r+1]:0,d=r+2<n.length,f=d?n[r+2]:0,p=o>>2,_=(o&3)<<4|u>>4;let w=(u&15)<<2|f>>6,A=f&63;d||(A=64,a||(w=64)),s.push(t[p],t[_],t[w],t[A])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Nl(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):th(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<n.length;){const o=t[n.charAt(r++)],u=r<n.length?t[n.charAt(r)]:0;++r;const f=r<n.length?t[n.charAt(r)]:64;++r;const _=r<n.length?t[n.charAt(r)]:64;if(++r,o==null||u==null||f==null||_==null)throw new nh;const w=o<<2|u>>4;if(s.push(w),f!==64){const A=u<<4&240|f>>2;if(s.push(A),_!==64){const S=f<<6&192|_;s.push(S)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class nh extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const sh=function(n){const e=Nl(n);return Rl.encodeByteArray(e,!0)},zs=function(n){return sh(n).replace(/\./g,"")},rh=function(n){try{return Rl.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function ih(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const oh=()=>ih().__FIREBASE_DEFAULTS__,ah=()=>{if(typeof process>"u"||typeof ua>"u")return;const n=ua.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},lh=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&rh(n[1]);return e&&JSON.parse(e)},Pi=()=>{try{return eh()||oh()||ah()||lh()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},ch=n=>Pi()?.emulatorHosts?.[n],uh=n=>{const e=ch(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},Pl=()=>Pi()?.config;class hh{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}function ki(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function dh(n){return(await fetch(n,{credentials:"include"})).ok}function fh(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",r=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[zs(JSON.stringify(t)),zs(JSON.stringify(a)),""].join(".")}const Zn={};function mh(){const n={prod:[],emulator:[]};for(const e of Object.keys(Zn))Zn[e]?n.emulator.push(e):n.prod.push(e);return n}function ph(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let ha=!1;function gh(n,e){if(typeof window>"u"||typeof document>"u"||!ki(window.location.host)||Zn[n]===e||Zn[n]||ha)return;Zn[n]=e;function t(w){return`__firebase__banner__${w}`}const s="__firebase__banner",o=mh().prod.length>0;function a(){const w=document.getElementById(s);w&&w.remove()}function u(w){w.style.display="flex",w.style.background="#7faaf0",w.style.position="fixed",w.style.bottom="5px",w.style.left="5px",w.style.padding=".5em",w.style.borderRadius="5px",w.style.alignItems="center"}function d(w,A){w.setAttribute("width","24"),w.setAttribute("id",A),w.setAttribute("height","24"),w.setAttribute("viewBox","0 0 24 24"),w.setAttribute("fill","none"),w.style.marginLeft="-6px"}function f(){const w=document.createElement("span");return w.style.cursor="pointer",w.style.marginLeft="16px",w.style.fontSize="24px",w.innerHTML=" &times;",w.onclick=()=>{ha=!0,a()},w}function p(w,A){w.setAttribute("id",A),w.innerText="Learn more",w.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",w.setAttribute("target","__blank"),w.style.paddingLeft="5px",w.style.textDecoration="underline"}function _(){const w=ph(s),A=t("text"),S=document.getElementById(A)||document.createElement("span"),N=t("learnmore"),D=document.getElementById(N)||document.createElement("a"),O=t("preprendIcon"),R=document.getElementById(O)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(w.created){const P=w.element;u(P),p(D,N);const U=f();d(R,O),P.append(R,S,D,U),document.body.appendChild(P)}o?(S.innerText="Preview backend disconnected.",R.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(R.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,S.innerText="Preview backend running in this workspace."),S.setAttribute("id",A)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",_):_()}function yh(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function _h(){const n=Pi()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function vh(){return!_h()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Eh(){try{return typeof indexedDB=="object"}catch{return!1}}function bh(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{e(r.error?.message||"")}}catch(t){e(t)}})}const Th="FirebaseError";class gn extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=Th,Object.setPrototypeOf(this,gn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,kl.prototype.create)}}class kl{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,o=this.errors[e],a=o?wh(o,s):"Error",u=`${this.serviceName}: ${a} (${r}).`;return new gn(r,u,s)}}function wh(n,e){return n.replace(Ih,(t,s)=>{const r=e[s];return r!=null?String(r):`<${s}?>`})}const Ih=/\{\$([^}]+)}/g;function Ks(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const r of t){if(!s.includes(r))return!1;const o=n[r],a=e[r];if(da(o)&&da(a)){if(!Ks(o,a))return!1}else if(o!==a)return!1}for(const r of s)if(!t.includes(r))return!1;return!0}function da(n){return n!==null&&typeof n=="object"}function is(n){return n&&n._delegate?n._delegate:n}class os{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Pt="[DEFAULT]";class Ah{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new hh;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&s.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(xh(e))try{this.getOrInitializeService({instanceIdentifier:Pt})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:r});s.resolve(o)}catch{}}}}clearInstance(e=Pt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Pt){return this.instances.has(e)}getOptions(e=Pt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[o,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);s===u&&a.resolve(r)}return r}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(s)??new Set;r.add(e),this.onInitCallbacks.set(s,r);const o=this.instances.get(s);return o&&e(o,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Sh(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Pt){return this.component?this.component.multipleInstances?e:Pt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Sh(n){return n===Pt?void 0:n}function xh(n){return n.instantiationMode==="EAGER"}class Ch{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Ah(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var te;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(te||(te={}));const Nh={debug:te.DEBUG,verbose:te.VERBOSE,info:te.INFO,warn:te.WARN,error:te.ERROR,silent:te.SILENT},Rh=te.INFO,Ph={[te.DEBUG]:"log",[te.VERBOSE]:"log",[te.INFO]:"info",[te.WARN]:"warn",[te.ERROR]:"error"},kh=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),r=Ph[e];if(r)console[r](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Dl{constructor(e){this.name=e,this._logLevel=Rh,this._logHandler=kh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in te))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Nh[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,te.DEBUG,...e),this._logHandler(this,te.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,te.VERBOSE,...e),this._logHandler(this,te.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,te.INFO,...e),this._logHandler(this,te.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,te.WARN,...e),this._logHandler(this,te.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,te.ERROR,...e),this._logHandler(this,te.ERROR,...e)}}const Dh=(n,e)=>e.some(t=>n instanceof t);let fa,ma;function Vh(){return fa||(fa=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function jh(){return ma||(ma=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Vl=new WeakMap,li=new WeakMap,jl=new WeakMap,Gr=new WeakMap,Di=new WeakMap;function Fh(n){const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{t(pt(n.result)),r()},a=()=>{s(n.error),r()};n.addEventListener("success",o),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Vl.set(t,n)}).catch(()=>{}),Di.set(e,n),e}function Oh(n){if(li.has(n))return;const e=new Promise((t,s)=>{const r=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{t(),r()},a=()=>{s(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});li.set(n,e)}let ci={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return li.get(n);if(e==="objectStoreNames")return n.objectStoreNames||jl.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return pt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Lh(n){ci=n(ci)}function Mh(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(Qr(this),e,...t);return jl.set(s,e.sort?e.sort():[e]),pt(s)}:jh().includes(n)?function(...e){return n.apply(Qr(this),e),pt(Vl.get(this))}:function(...e){return pt(n.apply(Qr(this),e))}}function Bh(n){return typeof n=="function"?Mh(n):(n instanceof IDBTransaction&&Oh(n),Dh(n,Vh())?new Proxy(n,ci):n)}function pt(n){if(n instanceof IDBRequest)return Fh(n);if(Gr.has(n))return Gr.get(n);const e=Bh(n);return e!==n&&(Gr.set(n,e),Di.set(e,n)),e}const Qr=n=>Di.get(n);function $h(n,e,{blocked:t,upgrade:s,blocking:r,terminated:o}={}){const a=indexedDB.open(n,e),u=pt(a);return s&&a.addEventListener("upgradeneeded",d=>{s(pt(a.result),d.oldVersion,d.newVersion,pt(a.transaction),d)}),t&&a.addEventListener("blocked",d=>t(d.oldVersion,d.newVersion,d)),u.then(d=>{o&&d.addEventListener("close",()=>o()),r&&d.addEventListener("versionchange",f=>r(f.oldVersion,f.newVersion,f))}).catch(()=>{}),u}const Uh=["get","getKey","getAll","getAllKeys","count"],qh=["put","add","delete","clear"],Jr=new Map;function pa(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Jr.get(e))return Jr.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,r=qh.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(r||Uh.includes(t)))return;const o=async function(a,...u){const d=this.transaction(a,r?"readwrite":"readonly");let f=d.store;return s&&(f=f.index(u.shift())),(await Promise.all([f[t](...u),r&&d.done]))[0]};return Jr.set(e,o),o}Lh(n=>({...n,get:(e,t,s)=>pa(e,t)||n.get(e,t,s),has:(e,t)=>!!pa(e,t)||n.has(e,t)}));class Hh{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(zh(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function zh(n){return n.getComponent()?.type==="VERSION"}const ui="@firebase/app",ga="0.14.8";const nt=new Dl("@firebase/app"),Kh="@firebase/app-compat",Wh="@firebase/analytics-compat",Gh="@firebase/analytics",Qh="@firebase/app-check-compat",Jh="@firebase/app-check",Yh="@firebase/auth",Xh="@firebase/auth-compat",Zh="@firebase/database",ed="@firebase/data-connect",td="@firebase/database-compat",nd="@firebase/functions",sd="@firebase/functions-compat",rd="@firebase/installations",id="@firebase/installations-compat",od="@firebase/messaging",ad="@firebase/messaging-compat",ld="@firebase/performance",cd="@firebase/performance-compat",ud="@firebase/remote-config",hd="@firebase/remote-config-compat",dd="@firebase/storage",fd="@firebase/storage-compat",md="@firebase/firestore",pd="@firebase/ai",gd="@firebase/firestore-compat",yd="firebase",_d="12.9.0";const hi="[DEFAULT]",vd={[ui]:"fire-core",[Kh]:"fire-core-compat",[Gh]:"fire-analytics",[Wh]:"fire-analytics-compat",[Jh]:"fire-app-check",[Qh]:"fire-app-check-compat",[Yh]:"fire-auth",[Xh]:"fire-auth-compat",[Zh]:"fire-rtdb",[ed]:"fire-data-connect",[td]:"fire-rtdb-compat",[nd]:"fire-fn",[sd]:"fire-fn-compat",[rd]:"fire-iid",[id]:"fire-iid-compat",[od]:"fire-fcm",[ad]:"fire-fcm-compat",[ld]:"fire-perf",[cd]:"fire-perf-compat",[ud]:"fire-rc",[hd]:"fire-rc-compat",[dd]:"fire-gcs",[fd]:"fire-gcs-compat",[md]:"fire-fst",[gd]:"fire-fst-compat",[pd]:"fire-vertex","fire-js":"fire-js",[yd]:"fire-js-all"};const Ws=new Map,Ed=new Map,di=new Map;function ya(n,e){try{n.container.addComponent(e)}catch(t){nt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Gs(n){const e=n.name;if(di.has(e))return nt.debug(`There were multiple attempts to register component ${e}.`),!1;di.set(e,n);for(const t of Ws.values())ya(t,n);for(const t of Ed.values())ya(t,n);return!0}function bd(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Td(n){return n==null?!1:n.settings!==void 0}const wd={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},gt=new kl("app","Firebase",wd);class Id{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new os("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw gt.create("app-deleted",{appName:this._name})}}const Ad=_d;function Fl(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:hi,automaticDataCollectionEnabled:!0,...e},r=s.name;if(typeof r!="string"||!r)throw gt.create("bad-app-name",{appName:String(r)});if(t||(t=Pl()),!t)throw gt.create("no-options");const o=Ws.get(r);if(o){if(Ks(t,o.options)&&Ks(s,o.config))return o;throw gt.create("duplicate-app",{appName:r})}const a=new Ch(r);for(const d of di.values())a.addComponent(d);const u=new Id(t,s,a);return Ws.set(r,u),u}function Sd(n=hi){const e=Ws.get(n);if(!e&&n===hi&&Pl())return Fl();if(!e)throw gt.create("no-app",{appName:n});return e}function tn(n,e,t){let s=vd[n]??n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const a=[`Unable to register library "${s}" with version "${e}":`];r&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),nt.warn(a.join(" "));return}Gs(new os(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}const xd="firebase-heartbeat-database",Cd=1,as="firebase-heartbeat-store";let Yr=null;function Ol(){return Yr||(Yr=$h(xd,Cd,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(as)}catch(t){console.warn(t)}}}}).catch(n=>{throw gt.create("idb-open",{originalErrorMessage:n.message})})),Yr}async function Nd(n){try{const t=(await Ol()).transaction(as),s=await t.objectStore(as).get(Ll(n));return await t.done,s}catch(e){if(e instanceof gn)nt.warn(e.message);else{const t=gt.create("idb-get",{originalErrorMessage:e?.message});nt.warn(t.message)}}}async function _a(n,e){try{const s=(await Ol()).transaction(as,"readwrite");await s.objectStore(as).put(e,Ll(n)),await s.done}catch(t){if(t instanceof gn)nt.warn(t.message);else{const s=gt.create("idb-set",{originalErrorMessage:t?.message});nt.warn(s.message)}}}function Ll(n){return`${n.name}!${n.options.appId}`}const Rd=1024,Pd=30;class kd{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Vd(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=va();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(r=>r.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>Pd){const r=jd(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){nt.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=va(),{heartbeatsToSend:t,unsentEntries:s}=Dd(this._heartbeatsCache.heartbeats),r=zs(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return nt.warn(e),""}}}function va(){return new Date().toISOString().substring(0,10)}function Dd(n,e=Rd){const t=[];let s=n.slice();for(const r of n){const o=t.find(a=>a.agent===r.agent);if(o){if(o.dates.push(r.date),Ea(t)>e){o.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),Ea(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class Vd{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Eh()?bh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Nd(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return _a(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return _a(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Ea(n){return zs(JSON.stringify({version:2,heartbeats:n})).length}function jd(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}function Fd(n){Gs(new os("platform-logger",e=>new Hh(e),"PRIVATE")),Gs(new os("heartbeat",e=>new kd(e),"PRIVATE")),tn(ui,ga,n),tn(ui,ga,"esm2020"),tn("fire-js","")}Fd("");var Od="firebase",Ld="12.9.0";tn(Od,Ld,"app");var ba=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var yt,Ml;(function(){var n;function e(b,y){function v(){}v.prototype=y.prototype,b.F=y.prototype,b.prototype=new v,b.prototype.constructor=b,b.D=function(g,T,I){for(var E=Array(arguments.length-2),F=2;F<arguments.length;F++)E[F-2]=arguments[F];return y.prototype[T].apply(g,E)}}function t(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(s,t),s.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(b,y,v){v||(v=0);const g=Array(16);if(typeof y=="string")for(var T=0;T<16;++T)g[T]=y.charCodeAt(v++)|y.charCodeAt(v++)<<8|y.charCodeAt(v++)<<16|y.charCodeAt(v++)<<24;else for(T=0;T<16;++T)g[T]=y[v++]|y[v++]<<8|y[v++]<<16|y[v++]<<24;y=b.g[0],v=b.g[1],T=b.g[2];let I=b.g[3],E;E=y+(I^v&(T^I))+g[0]+3614090360&4294967295,y=v+(E<<7&4294967295|E>>>25),E=I+(T^y&(v^T))+g[1]+3905402710&4294967295,I=y+(E<<12&4294967295|E>>>20),E=T+(v^I&(y^v))+g[2]+606105819&4294967295,T=I+(E<<17&4294967295|E>>>15),E=v+(y^T&(I^y))+g[3]+3250441966&4294967295,v=T+(E<<22&4294967295|E>>>10),E=y+(I^v&(T^I))+g[4]+4118548399&4294967295,y=v+(E<<7&4294967295|E>>>25),E=I+(T^y&(v^T))+g[5]+1200080426&4294967295,I=y+(E<<12&4294967295|E>>>20),E=T+(v^I&(y^v))+g[6]+2821735955&4294967295,T=I+(E<<17&4294967295|E>>>15),E=v+(y^T&(I^y))+g[7]+4249261313&4294967295,v=T+(E<<22&4294967295|E>>>10),E=y+(I^v&(T^I))+g[8]+1770035416&4294967295,y=v+(E<<7&4294967295|E>>>25),E=I+(T^y&(v^T))+g[9]+2336552879&4294967295,I=y+(E<<12&4294967295|E>>>20),E=T+(v^I&(y^v))+g[10]+4294925233&4294967295,T=I+(E<<17&4294967295|E>>>15),E=v+(y^T&(I^y))+g[11]+2304563134&4294967295,v=T+(E<<22&4294967295|E>>>10),E=y+(I^v&(T^I))+g[12]+1804603682&4294967295,y=v+(E<<7&4294967295|E>>>25),E=I+(T^y&(v^T))+g[13]+4254626195&4294967295,I=y+(E<<12&4294967295|E>>>20),E=T+(v^I&(y^v))+g[14]+2792965006&4294967295,T=I+(E<<17&4294967295|E>>>15),E=v+(y^T&(I^y))+g[15]+1236535329&4294967295,v=T+(E<<22&4294967295|E>>>10),E=y+(T^I&(v^T))+g[1]+4129170786&4294967295,y=v+(E<<5&4294967295|E>>>27),E=I+(v^T&(y^v))+g[6]+3225465664&4294967295,I=y+(E<<9&4294967295|E>>>23),E=T+(y^v&(I^y))+g[11]+643717713&4294967295,T=I+(E<<14&4294967295|E>>>18),E=v+(I^y&(T^I))+g[0]+3921069994&4294967295,v=T+(E<<20&4294967295|E>>>12),E=y+(T^I&(v^T))+g[5]+3593408605&4294967295,y=v+(E<<5&4294967295|E>>>27),E=I+(v^T&(y^v))+g[10]+38016083&4294967295,I=y+(E<<9&4294967295|E>>>23),E=T+(y^v&(I^y))+g[15]+3634488961&4294967295,T=I+(E<<14&4294967295|E>>>18),E=v+(I^y&(T^I))+g[4]+3889429448&4294967295,v=T+(E<<20&4294967295|E>>>12),E=y+(T^I&(v^T))+g[9]+568446438&4294967295,y=v+(E<<5&4294967295|E>>>27),E=I+(v^T&(y^v))+g[14]+3275163606&4294967295,I=y+(E<<9&4294967295|E>>>23),E=T+(y^v&(I^y))+g[3]+4107603335&4294967295,T=I+(E<<14&4294967295|E>>>18),E=v+(I^y&(T^I))+g[8]+1163531501&4294967295,v=T+(E<<20&4294967295|E>>>12),E=y+(T^I&(v^T))+g[13]+2850285829&4294967295,y=v+(E<<5&4294967295|E>>>27),E=I+(v^T&(y^v))+g[2]+4243563512&4294967295,I=y+(E<<9&4294967295|E>>>23),E=T+(y^v&(I^y))+g[7]+1735328473&4294967295,T=I+(E<<14&4294967295|E>>>18),E=v+(I^y&(T^I))+g[12]+2368359562&4294967295,v=T+(E<<20&4294967295|E>>>12),E=y+(v^T^I)+g[5]+4294588738&4294967295,y=v+(E<<4&4294967295|E>>>28),E=I+(y^v^T)+g[8]+2272392833&4294967295,I=y+(E<<11&4294967295|E>>>21),E=T+(I^y^v)+g[11]+1839030562&4294967295,T=I+(E<<16&4294967295|E>>>16),E=v+(T^I^y)+g[14]+4259657740&4294967295,v=T+(E<<23&4294967295|E>>>9),E=y+(v^T^I)+g[1]+2763975236&4294967295,y=v+(E<<4&4294967295|E>>>28),E=I+(y^v^T)+g[4]+1272893353&4294967295,I=y+(E<<11&4294967295|E>>>21),E=T+(I^y^v)+g[7]+4139469664&4294967295,T=I+(E<<16&4294967295|E>>>16),E=v+(T^I^y)+g[10]+3200236656&4294967295,v=T+(E<<23&4294967295|E>>>9),E=y+(v^T^I)+g[13]+681279174&4294967295,y=v+(E<<4&4294967295|E>>>28),E=I+(y^v^T)+g[0]+3936430074&4294967295,I=y+(E<<11&4294967295|E>>>21),E=T+(I^y^v)+g[3]+3572445317&4294967295,T=I+(E<<16&4294967295|E>>>16),E=v+(T^I^y)+g[6]+76029189&4294967295,v=T+(E<<23&4294967295|E>>>9),E=y+(v^T^I)+g[9]+3654602809&4294967295,y=v+(E<<4&4294967295|E>>>28),E=I+(y^v^T)+g[12]+3873151461&4294967295,I=y+(E<<11&4294967295|E>>>21),E=T+(I^y^v)+g[15]+530742520&4294967295,T=I+(E<<16&4294967295|E>>>16),E=v+(T^I^y)+g[2]+3299628645&4294967295,v=T+(E<<23&4294967295|E>>>9),E=y+(T^(v|~I))+g[0]+4096336452&4294967295,y=v+(E<<6&4294967295|E>>>26),E=I+(v^(y|~T))+g[7]+1126891415&4294967295,I=y+(E<<10&4294967295|E>>>22),E=T+(y^(I|~v))+g[14]+2878612391&4294967295,T=I+(E<<15&4294967295|E>>>17),E=v+(I^(T|~y))+g[5]+4237533241&4294967295,v=T+(E<<21&4294967295|E>>>11),E=y+(T^(v|~I))+g[12]+1700485571&4294967295,y=v+(E<<6&4294967295|E>>>26),E=I+(v^(y|~T))+g[3]+2399980690&4294967295,I=y+(E<<10&4294967295|E>>>22),E=T+(y^(I|~v))+g[10]+4293915773&4294967295,T=I+(E<<15&4294967295|E>>>17),E=v+(I^(T|~y))+g[1]+2240044497&4294967295,v=T+(E<<21&4294967295|E>>>11),E=y+(T^(v|~I))+g[8]+1873313359&4294967295,y=v+(E<<6&4294967295|E>>>26),E=I+(v^(y|~T))+g[15]+4264355552&4294967295,I=y+(E<<10&4294967295|E>>>22),E=T+(y^(I|~v))+g[6]+2734768916&4294967295,T=I+(E<<15&4294967295|E>>>17),E=v+(I^(T|~y))+g[13]+1309151649&4294967295,v=T+(E<<21&4294967295|E>>>11),E=y+(T^(v|~I))+g[4]+4149444226&4294967295,y=v+(E<<6&4294967295|E>>>26),E=I+(v^(y|~T))+g[11]+3174756917&4294967295,I=y+(E<<10&4294967295|E>>>22),E=T+(y^(I|~v))+g[2]+718787259&4294967295,T=I+(E<<15&4294967295|E>>>17),E=v+(I^(T|~y))+g[9]+3951481745&4294967295,b.g[0]=b.g[0]+y&4294967295,b.g[1]=b.g[1]+(T+(E<<21&4294967295|E>>>11))&4294967295,b.g[2]=b.g[2]+T&4294967295,b.g[3]=b.g[3]+I&4294967295}s.prototype.v=function(b,y){y===void 0&&(y=b.length);const v=y-this.blockSize,g=this.C;let T=this.h,I=0;for(;I<y;){if(T==0)for(;I<=v;)r(this,b,I),I+=this.blockSize;if(typeof b=="string"){for(;I<y;)if(g[T++]=b.charCodeAt(I++),T==this.blockSize){r(this,g),T=0;break}}else for(;I<y;)if(g[T++]=b[I++],T==this.blockSize){r(this,g),T=0;break}}this.h=T,this.o+=y},s.prototype.A=function(){var b=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);b[0]=128;for(var y=1;y<b.length-8;++y)b[y]=0;y=this.o*8;for(var v=b.length-8;v<b.length;++v)b[v]=y&255,y/=256;for(this.v(b),b=Array(16),y=0,v=0;v<4;++v)for(let g=0;g<32;g+=8)b[y++]=this.g[v]>>>g&255;return b};function o(b,y){var v=u;return Object.prototype.hasOwnProperty.call(v,b)?v[b]:v[b]=y(b)}function a(b,y){this.h=y;const v=[];let g=!0;for(let T=b.length-1;T>=0;T--){const I=b[T]|0;g&&I==y||(v[T]=I,g=!1)}this.g=v}var u={};function d(b){return-128<=b&&b<128?o(b,function(y){return new a([y|0],y<0?-1:0)}):new a([b|0],b<0?-1:0)}function f(b){if(isNaN(b)||!isFinite(b))return _;if(b<0)return D(f(-b));const y=[];let v=1;for(let g=0;b>=v;g++)y[g]=b/v|0,v*=4294967296;return new a(y,0)}function p(b,y){if(b.length==0)throw Error("number format error: empty string");if(y=y||10,y<2||36<y)throw Error("radix out of range: "+y);if(b.charAt(0)=="-")return D(p(b.substring(1),y));if(b.indexOf("-")>=0)throw Error('number format error: interior "-" character');const v=f(Math.pow(y,8));let g=_;for(let I=0;I<b.length;I+=8){var T=Math.min(8,b.length-I);const E=parseInt(b.substring(I,I+T),y);T<8?(T=f(Math.pow(y,T)),g=g.j(T).add(f(E))):(g=g.j(v),g=g.add(f(E)))}return g}var _=d(0),w=d(1),A=d(16777216);n=a.prototype,n.m=function(){if(N(this))return-D(this).m();let b=0,y=1;for(let v=0;v<this.g.length;v++){const g=this.i(v);b+=(g>=0?g:4294967296+g)*y,y*=4294967296}return b},n.toString=function(b){if(b=b||10,b<2||36<b)throw Error("radix out of range: "+b);if(S(this))return"0";if(N(this))return"-"+D(this).toString(b);const y=f(Math.pow(b,6));var v=this;let g="";for(;;){const T=U(v,y).g;v=O(v,T.j(y));let I=((v.g.length>0?v.g[0]:v.h)>>>0).toString(b);if(v=T,S(v))return I+g;for(;I.length<6;)I="0"+I;g=I+g}},n.i=function(b){return b<0?0:b<this.g.length?this.g[b]:this.h};function S(b){if(b.h!=0)return!1;for(let y=0;y<b.g.length;y++)if(b.g[y]!=0)return!1;return!0}function N(b){return b.h==-1}n.l=function(b){return b=O(this,b),N(b)?-1:S(b)?0:1};function D(b){const y=b.g.length,v=[];for(let g=0;g<y;g++)v[g]=~b.g[g];return new a(v,~b.h).add(w)}n.abs=function(){return N(this)?D(this):this},n.add=function(b){const y=Math.max(this.g.length,b.g.length),v=[];let g=0;for(let T=0;T<=y;T++){let I=g+(this.i(T)&65535)+(b.i(T)&65535),E=(I>>>16)+(this.i(T)>>>16)+(b.i(T)>>>16);g=E>>>16,I&=65535,E&=65535,v[T]=E<<16|I}return new a(v,v[v.length-1]&-2147483648?-1:0)};function O(b,y){return b.add(D(y))}n.j=function(b){if(S(this)||S(b))return _;if(N(this))return N(b)?D(this).j(D(b)):D(D(this).j(b));if(N(b))return D(this.j(D(b)));if(this.l(A)<0&&b.l(A)<0)return f(this.m()*b.m());const y=this.g.length+b.g.length,v=[];for(var g=0;g<2*y;g++)v[g]=0;for(g=0;g<this.g.length;g++)for(let T=0;T<b.g.length;T++){const I=this.i(g)>>>16,E=this.i(g)&65535,F=b.i(T)>>>16,j=b.i(T)&65535;v[2*g+2*T]+=E*j,R(v,2*g+2*T),v[2*g+2*T+1]+=I*j,R(v,2*g+2*T+1),v[2*g+2*T+1]+=E*F,R(v,2*g+2*T+1),v[2*g+2*T+2]+=I*F,R(v,2*g+2*T+2)}for(b=0;b<y;b++)v[b]=v[2*b+1]<<16|v[2*b];for(b=y;b<2*y;b++)v[b]=0;return new a(v,0)};function R(b,y){for(;(b[y]&65535)!=b[y];)b[y+1]+=b[y]>>>16,b[y]&=65535,y++}function P(b,y){this.g=b,this.h=y}function U(b,y){if(S(y))throw Error("division by zero");if(S(b))return new P(_,_);if(N(b))return y=U(D(b),y),new P(D(y.g),D(y.h));if(N(y))return y=U(b,D(y)),new P(D(y.g),y.h);if(b.g.length>30){if(N(b)||N(y))throw Error("slowDivide_ only works with positive integers.");for(var v=w,g=y;g.l(b)<=0;)v=W(v),g=W(g);var T=H(v,1),I=H(g,1);for(g=H(g,2),v=H(v,2);!S(g);){var E=I.add(g);E.l(b)<=0&&(T=T.add(v),I=E),g=H(g,1),v=H(v,1)}return y=O(b,T.j(y)),new P(T,y)}for(T=_;b.l(y)>=0;){for(v=Math.max(1,Math.floor(b.m()/y.m())),g=Math.ceil(Math.log(v)/Math.LN2),g=g<=48?1:Math.pow(2,g-48),I=f(v),E=I.j(y);N(E)||E.l(b)>0;)v-=g,I=f(v),E=I.j(y);S(I)&&(I=w),T=T.add(I),b=O(b,E)}return new P(T,b)}n.B=function(b){return U(this,b).h},n.and=function(b){const y=Math.max(this.g.length,b.g.length),v=[];for(let g=0;g<y;g++)v[g]=this.i(g)&b.i(g);return new a(v,this.h&b.h)},n.or=function(b){const y=Math.max(this.g.length,b.g.length),v=[];for(let g=0;g<y;g++)v[g]=this.i(g)|b.i(g);return new a(v,this.h|b.h)},n.xor=function(b){const y=Math.max(this.g.length,b.g.length),v=[];for(let g=0;g<y;g++)v[g]=this.i(g)^b.i(g);return new a(v,this.h^b.h)};function W(b){const y=b.g.length+1,v=[];for(let g=0;g<y;g++)v[g]=b.i(g)<<1|b.i(g-1)>>>31;return new a(v,b.h)}function H(b,y){const v=y>>5;y%=32;const g=b.g.length-v,T=[];for(let I=0;I<g;I++)T[I]=y>0?b.i(I+v)>>>y|b.i(I+v+1)<<32-y:b.i(I+v);return new a(T,b.h)}s.prototype.digest=s.prototype.A,s.prototype.reset=s.prototype.u,s.prototype.update=s.prototype.v,Ml=s,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=f,a.fromString=p,yt=a}).apply(typeof ba<"u"?ba:typeof self<"u"?self:typeof window<"u"?window:{});var Ds=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Bl,Qn,$l,Ms,fi,Ul,ql,Hl;(function(){var n,e=Object.defineProperty;function t(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ds=="object"&&Ds];for(var l=0;l<i.length;++l){var h=i[l];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var s=t(this);function r(i,l){if(l)e:{var h=s;i=i.split(".");for(var m=0;m<i.length-1;m++){var x=i[m];if(!(x in h))break e;h=h[x]}i=i[i.length-1],m=h[i],l=l(m),l!=m&&l!=null&&e(h,i,{configurable:!0,writable:!0,value:l})}}r("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(i){return i||function(l){var h=[],m;for(m in l)Object.prototype.hasOwnProperty.call(l,m)&&h.push([m,l[m]]);return h}});var o=o||{},a=this||self;function u(i){var l=typeof i;return l=="object"&&i!=null||l=="function"}function d(i,l,h){return i.call.apply(i.bind,arguments)}function f(i,l,h){return f=d,f.apply(null,arguments)}function p(i,l){var h=Array.prototype.slice.call(arguments,1);return function(){var m=h.slice();return m.push.apply(m,arguments),i.apply(this,m)}}function _(i,l){function h(){}h.prototype=l.prototype,i.Z=l.prototype,i.prototype=new h,i.prototype.constructor=i,i.Ob=function(m,x,C){for(var M=Array(arguments.length-2),Y=2;Y<arguments.length;Y++)M[Y-2]=arguments[Y];return l.prototype[x].apply(m,M)}}var w=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function A(i){const l=i.length;if(l>0){const h=Array(l);for(let m=0;m<l;m++)h[m]=i[m];return h}return[]}function S(i,l){for(let m=1;m<arguments.length;m++){const x=arguments[m];var h=typeof x;if(h=h!="object"?h:x?Array.isArray(x)?"array":h:"null",h=="array"||h=="object"&&typeof x.length=="number"){h=i.length||0;const C=x.length||0;i.length=h+C;for(let M=0;M<C;M++)i[h+M]=x[M]}else i.push(x)}}class N{constructor(l,h){this.i=l,this.j=h,this.h=0,this.g=null}get(){let l;return this.h>0?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function D(i){a.setTimeout(()=>{throw i},0)}function O(){var i=b;let l=null;return i.g&&(l=i.g,i.g=i.g.next,i.g||(i.h=null),l.next=null),l}class R{constructor(){this.h=this.g=null}add(l,h){const m=P.get();m.set(l,h),this.h?this.h.next=m:this.g=m,this.h=m}}var P=new N(()=>new U,i=>i.reset());class U{constructor(){this.next=this.g=this.h=null}set(l,h){this.h=l,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let W,H=!1,b=new R,y=()=>{const i=Promise.resolve(void 0);W=()=>{i.then(v)}};function v(){for(var i;i=O();){try{i.h.call(i.g)}catch(h){D(h)}var l=P;l.j(i),l.h<100&&(l.h++,i.next=l.g,l.g=i)}H=!1}function g(){this.u=this.u,this.C=this.C}g.prototype.u=!1,g.prototype.dispose=function(){this.u||(this.u=!0,this.N())},g.prototype[Symbol.dispose]=function(){this.dispose()},g.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function T(i,l){this.type=i,this.g=this.target=l,this.defaultPrevented=!1}T.prototype.h=function(){this.defaultPrevented=!0};var I=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,l=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const h=()=>{};a.addEventListener("test",h,l),a.removeEventListener("test",h,l)}catch{}return i})();function E(i){return/^[\s\xa0]*$/.test(i)}function F(i,l){T.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,l)}_(F,T),F.prototype.init=function(i,l){const h=this.type=i.type,m=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=l,l=i.relatedTarget,l||(h=="mouseover"?l=i.fromElement:h=="mouseout"&&(l=i.toElement)),this.relatedTarget=l,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&F.Z.h.call(this)},F.prototype.h=function(){F.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var j="closure_listenable_"+(Math.random()*1e6|0),J=0;function _e(i,l,h,m,x){this.listener=i,this.proxy=null,this.src=l,this.type=h,this.capture=!!m,this.ha=x,this.key=++J,this.da=this.fa=!1}function Ze(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function De(i,l,h){for(const m in i)l.call(h,i[m],m,i)}function wn(i,l){for(const h in i)l.call(void 0,i[h],h,i)}function In(i){const l={};for(const h in i)l[h]=i[h];return l}const An="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Sn(i,l){let h,m;for(let x=1;x<arguments.length;x++){m=arguments[x];for(h in m)i[h]=m[h];for(let C=0;C<An.length;C++)h=An[C],Object.prototype.hasOwnProperty.call(m,h)&&(i[h]=m[h])}}function Me(i){this.src=i,this.g={},this.h=0}Me.prototype.add=function(i,l,h,m,x){const C=i.toString();i=this.g[C],i||(i=this.g[C]=[],this.h++);const M=it(i,l,m,x);return M>-1?(l=i[M],h||(l.fa=!1)):(l=new _e(l,this.src,C,!!m,x),l.fa=h,i.push(l)),l};function $t(i,l){const h=l.type;if(h in i.g){var m=i.g[h],x=Array.prototype.indexOf.call(m,l,void 0),C;(C=x>=0)&&Array.prototype.splice.call(m,x,1),C&&(Ze(l),i.g[h].length==0&&(delete i.g[h],i.h--))}}function it(i,l,h,m){for(let x=0;x<i.length;++x){const C=i[x];if(!C.da&&C.listener==l&&C.capture==!!h&&C.ha==m)return x}return-1}var Ut="closure_lm_"+(Math.random()*1e6|0),et={};function tt(i,l,h,m,x){if(Array.isArray(l)){for(let C=0;C<l.length;C++)tt(i,l[C],h,m,x);return null}return h=Pn(h),i&&i[j]?i.J(l,h,u(m)?!!m.capture:!1,x):xn(i,l,h,!1,m,x)}function xn(i,l,h,m,x,C){if(!l)throw Error("Invalid event type");const M=u(x)?!!x.capture:!!x;let Y=Nn(i);if(Y||(i[Ut]=Y=new Me(i)),h=Y.add(l,h,m,M,C),h.proxy)return h;if(m=qt(),h.proxy=m,m.src=i,m.listener=h,i.addEventListener)I||(x=M),x===void 0&&(x=!1),i.addEventListener(l.toString(),m,x);else if(i.attachEvent)i.attachEvent(Es(l.toString()),m);else if(i.addListener&&i.removeListener)i.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return h}function qt(){function i(h){return l.call(i.src,i.listener,h)}const l=Rr;return i}function Cn(i,l,h,m,x){if(Array.isArray(l))for(var C=0;C<l.length;C++)Cn(i,l[C],h,m,x);else m=u(m)?!!m.capture:!!m,h=Pn(h),i&&i[j]?(i=i.i,C=String(l).toString(),C in i.g&&(l=i.g[C],h=it(l,h,m,x),h>-1&&(Ze(l[h]),Array.prototype.splice.call(l,h,1),l.length==0&&(delete i.g[C],i.h--)))):i&&(i=Nn(i))&&(l=i.g[l.toString()],i=-1,l&&(i=it(l,h,m,x)),(h=i>-1?l[i]:null)&&Ht(h))}function Ht(i){if(typeof i!="number"&&i&&!i.da){var l=i.src;if(l&&l[j])$t(l.i,i);else{var h=i.type,m=i.proxy;l.removeEventListener?l.removeEventListener(h,m,i.capture):l.detachEvent?l.detachEvent(Es(h),m):l.addListener&&l.removeListener&&l.removeListener(m),(h=Nn(l))?($t(h,i),h.h==0&&(h.src=null,l[Ut]=null)):Ze(i)}}}function Es(i){return i in et?et[i]:et[i]="on"+i}function Rr(i,l){if(i.da)i=!0;else{l=new F(l,this);const h=i.listener,m=i.ha||i.src;i.fa&&Ht(i),i=h.call(m,l)}return i}function Nn(i){return i=i[Ut],i instanceof Me?i:null}var Rn="__closure_events_fn_"+(Math.random()*1e9>>>0);function Pn(i){return typeof i=="function"?i:(i[Rn]||(i[Rn]=function(l){return i.handleEvent(l)}),i[Rn])}function ve(){g.call(this),this.i=new Me(this),this.M=this,this.G=null}_(ve,g),ve.prototype[j]=!0,ve.prototype.removeEventListener=function(i,l,h,m){Cn(this,i,l,h,m)};function Ie(i,l){var h,m=i.G;if(m)for(h=[];m;m=m.G)h.push(m);if(i=i.M,m=l.type||l,typeof l=="string")l=new T(l,i);else if(l instanceof T)l.target=l.target||i;else{var x=l;l=new T(m,i),Sn(l,x)}x=!0;let C,M;if(h)for(M=h.length-1;M>=0;M--)C=l.g=h[M],x=zt(C,m,!0,l)&&x;if(C=l.g=i,x=zt(C,m,!0,l)&&x,x=zt(C,m,!1,l)&&x,h)for(M=0;M<h.length;M++)C=l.g=h[M],x=zt(C,m,!1,l)&&x}ve.prototype.N=function(){if(ve.Z.N.call(this),this.i){var i=this.i;for(const l in i.g){const h=i.g[l];for(let m=0;m<h.length;m++)Ze(h[m]);delete i.g[l],i.h--}}this.G=null},ve.prototype.J=function(i,l,h,m){return this.i.add(String(i),l,!1,h,m)},ve.prototype.K=function(i,l,h,m){return this.i.add(String(i),l,!0,h,m)};function zt(i,l,h,m){if(l=i.i.g[String(l)],!l)return!0;l=l.concat();let x=!0;for(let C=0;C<l.length;++C){const M=l[C];if(M&&!M.da&&M.capture==h){const Y=M.listener,me=M.ha||M.src;M.fa&&$t(i.i,M),x=Y.call(me,m)!==!1&&x}}return x&&!m.defaultPrevented}function L(i,l){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=f(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(l)>2147483647?-1:a.setTimeout(i,l||0)}function se(i){i.g=L(()=>{i.g=null,i.i&&(i.i=!1,se(i))},i.l);const l=i.h;i.h=null,i.m.apply(null,l)}class ie extends g{constructor(l,h){super(),this.m=l,this.l=h,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:se(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Pe(i){g.call(this),this.h=i,this.g={}}_(Pe,g);var Kt=[];function Wt(i){De(i.g,function(l,h){this.g.hasOwnProperty(h)&&Ht(l)},i),i.g={}}Pe.prototype.N=function(){Pe.Z.N.call(this),Wt(this)},Pe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ot=a.JSON.stringify,wu=a.JSON.parse,Iu=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function go(){}function yo(){}var kn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Pr(){T.call(this,"d")}_(Pr,T);function kr(){T.call(this,"c")}_(kr,T);var St={},_o=null;function bs(){return _o=_o||new ve}St.Ia="serverreachability";function vo(i){T.call(this,St.Ia,i)}_(vo,T);function Dn(i){const l=bs();Ie(l,new vo(l))}St.STAT_EVENT="statevent";function Eo(i,l){T.call(this,St.STAT_EVENT,i),this.stat=l}_(Eo,T);function ke(i){const l=bs();Ie(l,new Eo(l,i))}St.Ja="timingevent";function bo(i,l){T.call(this,St.Ja,i),this.size=l}_(bo,T);function Vn(i,l){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},l)}function jn(){this.g=!0}jn.prototype.ua=function(){this.g=!1};function Au(i,l,h,m,x,C){i.info(function(){if(i.g)if(C){var M="",Y=C.split("&");for(let re=0;re<Y.length;re++){var me=Y[re].split("=");if(me.length>1){const Ee=me[0];me=me[1];const He=Ee.split("_");M=He.length>=2&&He[1]=="type"?M+(Ee+"="+me+"&"):M+(Ee+"=redacted&")}}}else M=null;else M=C;return"XMLHTTP REQ ("+m+") [attempt "+x+"]: "+l+`
`+h+`
`+M})}function Su(i,l,h,m,x,C,M){i.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+x+"]: "+l+`
`+h+`
`+C+" "+M})}function Gt(i,l,h,m){i.info(function(){return"XMLHTTP TEXT ("+l+"): "+Cu(i,h)+(m?" "+m:"")})}function xu(i,l){i.info(function(){return"TIMEOUT: "+l})}jn.prototype.info=function(){};function Cu(i,l){if(!i.g)return l;if(!l)return null;try{const C=JSON.parse(l);if(C){for(i=0;i<C.length;i++)if(Array.isArray(C[i])){var h=C[i];if(!(h.length<2)){var m=h[1];if(Array.isArray(m)&&!(m.length<1)){var x=m[0];if(x!="noop"&&x!="stop"&&x!="close")for(let M=1;M<m.length;M++)m[M]=""}}}}return ot(C)}catch{return l}}var Ts={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},To={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},wo;function Dr(){}_(Dr,go),Dr.prototype.g=function(){return new XMLHttpRequest},wo=new Dr;function Fn(i){return encodeURIComponent(String(i))}function Nu(i){var l=1;i=i.split(":");const h=[];for(;l>0&&i.length;)h.push(i.shift()),l--;return i.length&&h.push(i.join(":")),h}function at(i,l,h,m){this.j=i,this.i=l,this.l=h,this.S=m||1,this.V=new Pe(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Io}function Io(){this.i=null,this.g="",this.h=!1}var Ao={},Vr={};function jr(i,l,h){i.M=1,i.A=Is(qe(l)),i.u=h,i.R=!0,So(i,null)}function So(i,l){i.F=Date.now(),ws(i),i.B=qe(i.A);var h=i.B,m=i.S;Array.isArray(m)||(m=[String(m)]),Mo(h.i,"t",m),i.C=0,h=i.j.L,i.h=new Io,i.g=sa(i.j,h?l:null,!i.u),i.P>0&&(i.O=new ie(f(i.Y,i,i.g),i.P)),l=i.V,h=i.g,m=i.ba;var x="readystatechange";Array.isArray(x)||(x&&(Kt[0]=x.toString()),x=Kt);for(let C=0;C<x.length;C++){const M=tt(h,x[C],m||l.handleEvent,!1,l.h||l);if(!M)break;l.g[M.key]=M}l=i.J?In(i.J):{},i.u?(i.v||(i.v="POST"),l["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,l)):(i.v="GET",i.g.ea(i.B,i.v,null,l)),Dn(),Au(i.i,i.v,i.B,i.l,i.S,i.u)}at.prototype.ba=function(i){i=i.target;const l=this.O;l&&ut(i)==3?l.j():this.Y(i)},at.prototype.Y=function(i){try{if(i==this.g)e:{const Y=ut(this.g),me=this.g.ya(),re=this.g.ca();if(!(Y<3)&&(Y!=3||this.g&&(this.h.h||this.g.la()||Ko(this.g)))){this.K||Y!=4||me==7||(me==8||re<=0?Dn(3):Dn(2)),Fr(this);var l=this.g.ca();this.X=l;var h=Ru(this);if(this.o=l==200,Su(this.i,this.v,this.B,this.l,this.S,Y,l),this.o){if(this.U&&!this.L){t:{if(this.g){var m,x=this.g;if((m=x.g?x.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!E(m)){var C=m;break t}}C=null}if(i=C)Gt(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Or(this,i);else{this.o=!1,this.m=3,ke(12),xt(this),On(this);break e}}if(this.R){i=!0;let Ee;for(;!this.K&&this.C<h.length;)if(Ee=Pu(this,h),Ee==Vr){Y==4&&(this.m=4,ke(14),i=!1),Gt(this.i,this.l,null,"[Incomplete Response]");break}else if(Ee==Ao){this.m=4,ke(15),Gt(this.i,this.l,h,"[Invalid Chunk]"),i=!1;break}else Gt(this.i,this.l,Ee,null),Or(this,Ee);if(xo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Y!=4||h.length!=0||this.h.h||(this.m=1,ke(16),i=!1),this.o=this.o&&i,!i)Gt(this.i,this.l,h,"[Invalid Chunked Response]"),xt(this),On(this);else if(h.length>0&&!this.W){this.W=!0;var M=this.j;M.g==this&&M.aa&&!M.P&&(M.j.info("Great, no buffering proxy detected. Bytes received: "+h.length),zr(M),M.P=!0,ke(11))}}else Gt(this.i,this.l,h,null),Or(this,h);Y==4&&xt(this),this.o&&!this.K&&(Y==4?Zo(this.j,this):(this.o=!1,ws(this)))}else zu(this.g),l==400&&h.indexOf("Unknown SID")>0?(this.m=3,ke(12)):(this.m=0,ke(13)),xt(this),On(this)}}}catch{}};function Ru(i){if(!xo(i))return i.g.la();const l=Ko(i.g);if(l==="")return"";let h="";const m=l.length,x=ut(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return xt(i),On(i),"";i.h.i=new a.TextDecoder}for(let C=0;C<m;C++)i.h.h=!0,h+=i.h.i.decode(l[C],{stream:!(x&&C==m-1)});return l.length=0,i.h.g+=h,i.C=0,i.h.g}function xo(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function Pu(i,l){var h=i.C,m=l.indexOf(`
`,h);return m==-1?Vr:(h=Number(l.substring(h,m)),isNaN(h)?Ao:(m+=1,m+h>l.length?Vr:(l=l.slice(m,m+h),i.C=m+h,l)))}at.prototype.cancel=function(){this.K=!0,xt(this)};function ws(i){i.T=Date.now()+i.H,Co(i,i.H)}function Co(i,l){if(i.D!=null)throw Error("WatchDog timer not null");i.D=Vn(f(i.aa,i),l)}function Fr(i){i.D&&(a.clearTimeout(i.D),i.D=null)}at.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(xu(this.i,this.B),this.M!=2&&(Dn(),ke(17)),xt(this),this.m=2,On(this)):Co(this,this.T-i)};function On(i){i.j.I==0||i.K||Zo(i.j,i)}function xt(i){Fr(i);var l=i.O;l&&typeof l.dispose=="function"&&l.dispose(),i.O=null,Wt(i.V),i.g&&(l=i.g,i.g=null,l.abort(),l.dispose())}function Or(i,l){try{var h=i.j;if(h.I!=0&&(h.g==i||Lr(h.h,i))){if(!i.L&&Lr(h.h,i)&&h.I==3){try{var m=h.Ba.g.parse(l)}catch{m=null}if(Array.isArray(m)&&m.length==3){var x=m;if(x[0]==0){e:if(!h.v){if(h.g)if(h.g.F+3e3<i.F)Ns(h),xs(h);else break e;Hr(h),ke(18)}}else h.xa=x[1],0<h.xa-h.K&&x[2]<37500&&h.F&&h.A==0&&!h.C&&(h.C=Vn(f(h.Va,h),6e3));Po(h.h)<=1&&h.ta&&(h.ta=void 0)}else Nt(h,11)}else if((i.L||h.g==i)&&Ns(h),!E(l))for(x=h.Ba.g.parse(l),l=0;l<x.length;l++){let re=x[l];const Ee=re[0];if(!(Ee<=h.K))if(h.K=Ee,re=re[1],h.I==2)if(re[0]=="c"){h.M=re[1],h.ba=re[2];const He=re[3];He!=null&&(h.ka=He,h.j.info("VER="+h.ka));const Rt=re[4];Rt!=null&&(h.za=Rt,h.j.info("SVER="+h.za));const ht=re[5];ht!=null&&typeof ht=="number"&&ht>0&&(m=1.5*ht,h.O=m,h.j.info("backChannelRequestTimeoutMs_="+m)),m=h;const dt=i.g;if(dt){const Ps=dt.g?dt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ps){var C=m.h;C.g||Ps.indexOf("spdy")==-1&&Ps.indexOf("quic")==-1&&Ps.indexOf("h2")==-1||(C.j=C.l,C.g=new Set,C.h&&(Mr(C,C.h),C.h=null))}if(m.G){const Kr=dt.g?dt.g.getResponseHeader("X-HTTP-Session-Id"):null;Kr&&(m.wa=Kr,oe(m.J,m.G,Kr))}}h.I=3,h.l&&h.l.ra(),h.aa&&(h.T=Date.now()-i.F,h.j.info("Handshake RTT: "+h.T+"ms")),m=h;var M=i;if(m.na=na(m,m.L?m.ba:null,m.W),M.L){ko(m.h,M);var Y=M,me=m.O;me&&(Y.H=me),Y.D&&(Fr(Y),ws(Y)),m.g=M}else Yo(m);h.i.length>0&&Cs(h)}else re[0]!="stop"&&re[0]!="close"||Nt(h,7);else h.I==3&&(re[0]=="stop"||re[0]=="close"?re[0]=="stop"?Nt(h,7):qr(h):re[0]!="noop"&&h.l&&h.l.qa(re),h.A=0)}}Dn(4)}catch{}}var ku=class{constructor(i,l){this.g=i,this.map=l}};function No(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ro(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function Po(i){return i.h?1:i.g?i.g.size:0}function Lr(i,l){return i.h?i.h==l:i.g?i.g.has(l):!1}function Mr(i,l){i.g?i.g.add(l):i.h=l}function ko(i,l){i.h&&i.h==l?i.h=null:i.g&&i.g.has(l)&&i.g.delete(l)}No.prototype.cancel=function(){if(this.i=Do(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function Do(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let l=i.i;for(const h of i.g.values())l=l.concat(h.G);return l}return A(i.i)}var Vo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Du(i,l){if(i){i=i.split("&");for(let h=0;h<i.length;h++){const m=i[h].indexOf("=");let x,C=null;m>=0?(x=i[h].substring(0,m),C=i[h].substring(m+1)):x=i[h],l(x,C?decodeURIComponent(C.replace(/\+/g," ")):"")}}}function lt(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let l;i instanceof lt?(this.l=i.l,Ln(this,i.j),this.o=i.o,this.g=i.g,Mn(this,i.u),this.h=i.h,Br(this,Bo(i.i)),this.m=i.m):i&&(l=String(i).match(Vo))?(this.l=!1,Ln(this,l[1]||"",!0),this.o=Bn(l[2]||""),this.g=Bn(l[3]||"",!0),Mn(this,l[4]),this.h=Bn(l[5]||"",!0),Br(this,l[6]||"",!0),this.m=Bn(l[7]||"")):(this.l=!1,this.i=new Un(null,this.l))}lt.prototype.toString=function(){const i=[];var l=this.j;l&&i.push($n(l,jo,!0),":");var h=this.g;return(h||l=="file")&&(i.push("//"),(l=this.o)&&i.push($n(l,jo,!0),"@"),i.push(Fn(h).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.u,h!=null&&i.push(":",String(h))),(h=this.h)&&(this.g&&h.charAt(0)!="/"&&i.push("/"),i.push($n(h,h.charAt(0)=="/"?Fu:ju,!0))),(h=this.i.toString())&&i.push("?",h),(h=this.m)&&i.push("#",$n(h,Lu)),i.join("")},lt.prototype.resolve=function(i){const l=qe(this);let h=!!i.j;h?Ln(l,i.j):h=!!i.o,h?l.o=i.o:h=!!i.g,h?l.g=i.g:h=i.u!=null;var m=i.h;if(h)Mn(l,i.u);else if(h=!!i.h){if(m.charAt(0)!="/")if(this.g&&!this.h)m="/"+m;else{var x=l.h.lastIndexOf("/");x!=-1&&(m=l.h.slice(0,x+1)+m)}if(x=m,x==".."||x==".")m="";else if(x.indexOf("./")!=-1||x.indexOf("/.")!=-1){m=x.lastIndexOf("/",0)==0,x=x.split("/");const C=[];for(let M=0;M<x.length;){const Y=x[M++];Y=="."?m&&M==x.length&&C.push(""):Y==".."?((C.length>1||C.length==1&&C[0]!="")&&C.pop(),m&&M==x.length&&C.push("")):(C.push(Y),m=!0)}m=C.join("/")}else m=x}return h?l.h=m:h=i.i.toString()!=="",h?Br(l,Bo(i.i)):h=!!i.m,h&&(l.m=i.m),l};function qe(i){return new lt(i)}function Ln(i,l,h){i.j=h?Bn(l,!0):l,i.j&&(i.j=i.j.replace(/:$/,""))}function Mn(i,l){if(l){if(l=Number(l),isNaN(l)||l<0)throw Error("Bad port number "+l);i.u=l}else i.u=null}function Br(i,l,h){l instanceof Un?(i.i=l,Mu(i.i,i.l)):(h||(l=$n(l,Ou)),i.i=new Un(l,i.l))}function oe(i,l,h){i.i.set(l,h)}function Is(i){return oe(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function Bn(i,l){return i?l?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function $n(i,l,h){return typeof i=="string"?(i=encodeURI(i).replace(l,Vu),h&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Vu(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var jo=/[#\/\?@]/g,ju=/[#\?:]/g,Fu=/[#\?]/g,Ou=/[#\?@]/g,Lu=/#/g;function Un(i,l){this.h=this.g=null,this.i=i||null,this.j=!!l}function Ct(i){i.g||(i.g=new Map,i.h=0,i.i&&Du(i.i,function(l,h){i.add(decodeURIComponent(l.replace(/\+/g," ")),h)}))}n=Un.prototype,n.add=function(i,l){Ct(this),this.i=null,i=Qt(this,i);let h=this.g.get(i);return h||this.g.set(i,h=[]),h.push(l),this.h+=1,this};function Fo(i,l){Ct(i),l=Qt(i,l),i.g.has(l)&&(i.i=null,i.h-=i.g.get(l).length,i.g.delete(l))}function Oo(i,l){return Ct(i),l=Qt(i,l),i.g.has(l)}n.forEach=function(i,l){Ct(this),this.g.forEach(function(h,m){h.forEach(function(x){i.call(l,x,m,this)},this)},this)};function Lo(i,l){Ct(i);let h=[];if(typeof l=="string")Oo(i,l)&&(h=h.concat(i.g.get(Qt(i,l))));else for(i=Array.from(i.g.values()),l=0;l<i.length;l++)h=h.concat(i[l]);return h}n.set=function(i,l){return Ct(this),this.i=null,i=Qt(this,i),Oo(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[l]),this.h+=1,this},n.get=function(i,l){return i?(i=Lo(this,i),i.length>0?String(i[0]):l):l};function Mo(i,l,h){Fo(i,l),h.length>0&&(i.i=null,i.g.set(Qt(i,l),A(h)),i.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],l=Array.from(this.g.keys());for(let m=0;m<l.length;m++){var h=l[m];const x=Fn(h);h=Lo(this,h);for(let C=0;C<h.length;C++){let M=x;h[C]!==""&&(M+="="+Fn(h[C])),i.push(M)}}return this.i=i.join("&")};function Bo(i){const l=new Un;return l.i=i.i,i.g&&(l.g=new Map(i.g),l.h=i.h),l}function Qt(i,l){return l=String(l),i.j&&(l=l.toLowerCase()),l}function Mu(i,l){l&&!i.j&&(Ct(i),i.i=null,i.g.forEach(function(h,m){const x=m.toLowerCase();m!=x&&(Fo(this,m),Mo(this,x,h))},i)),i.j=l}function Bu(i,l){const h=new jn;if(a.Image){const m=new Image;m.onload=p(ct,h,"TestLoadImage: loaded",!0,l,m),m.onerror=p(ct,h,"TestLoadImage: error",!1,l,m),m.onabort=p(ct,h,"TestLoadImage: abort",!1,l,m),m.ontimeout=p(ct,h,"TestLoadImage: timeout",!1,l,m),a.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=i}else l(!1)}function $u(i,l){const h=new jn,m=new AbortController,x=setTimeout(()=>{m.abort(),ct(h,"TestPingServer: timeout",!1,l)},1e4);fetch(i,{signal:m.signal}).then(C=>{clearTimeout(x),C.ok?ct(h,"TestPingServer: ok",!0,l):ct(h,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(x),ct(h,"TestPingServer: error",!1,l)})}function ct(i,l,h,m,x){try{x&&(x.onload=null,x.onerror=null,x.onabort=null,x.ontimeout=null),m(h)}catch{}}function Uu(){this.g=new Iu}function $r(i){this.i=i.Sb||null,this.h=i.ab||!1}_($r,go),$r.prototype.g=function(){return new As(this.i,this.h)};function As(i,l){ve.call(this),this.H=i,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}_(As,ve),n=As.prototype,n.open=function(i,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=l,this.readyState=1,Hn(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const l={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(l.body=i),(this.H||a).fetch(new Request(this.D,l)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,qn(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,Hn(this)),this.g&&(this.readyState=3,Hn(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;$o(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function $o(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var l=i.value?i.value:new Uint8Array(0);(l=this.B.decode(l,{stream:!i.done}))&&(this.response=this.responseText+=l)}i.done?qn(this):Hn(this),this.readyState==3&&$o(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,qn(this))},n.Na=function(i){this.g&&(this.response=i,qn(this))},n.ga=function(){this.g&&qn(this)};function qn(i){i.readyState=4,i.l=null,i.j=null,i.B=null,Hn(i)}n.setRequestHeader=function(i,l){this.A.append(i,l)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],l=this.h.entries();for(var h=l.next();!h.done;)h=h.value,i.push(h[0]+": "+h[1]),h=l.next();return i.join(`\r
`)};function Hn(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(As.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function Uo(i){let l="";return De(i,function(h,m){l+=m,l+=":",l+=h,l+=`\r
`}),l}function Ur(i,l,h){e:{for(m in h){var m=!1;break e}m=!0}m||(h=Uo(h),typeof i=="string"?h!=null&&Fn(h):oe(i,l,h))}function ue(i){ve.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}_(ue,ve);var qu=/^https?$/i,Hu=["POST","PUT"];n=ue.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,l,h,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);l=l?l.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():wo.g(),this.g.onreadystatechange=w(f(this.Ca,this));try{this.B=!0,this.g.open(l,String(i),!0),this.B=!1}catch(C){qo(this,C);return}if(i=h||"",h=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var x in m)h.set(x,m[x]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(const C of m.keys())h.set(C,m.get(C));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(h.keys()).find(C=>C.toLowerCase()=="content-type"),x=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(Hu,l,void 0)>=0)||m||x||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[C,M]of h)this.g.setRequestHeader(C,M);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(C){qo(this,C)}};function qo(i,l){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=l,i.o=5,Ho(i),Ss(i)}function Ho(i){i.A||(i.A=!0,Ie(i,"complete"),Ie(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,Ie(this,"complete"),Ie(this,"abort"),Ss(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ss(this,!0)),ue.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?zo(this):this.Xa())},n.Xa=function(){zo(this)};function zo(i){if(i.h&&typeof o<"u"){if(i.v&&ut(i)==4)setTimeout(i.Ca.bind(i),0);else if(Ie(i,"readystatechange"),ut(i)==4){i.h=!1;try{const C=i.ca();e:switch(C){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var h;if(!(h=l)){var m;if(m=C===0){let M=String(i.D).match(Vo)[1]||null;!M&&a.self&&a.self.location&&(M=a.self.location.protocol.slice(0,-1)),m=!qu.test(M?M.toLowerCase():"")}h=m}if(h)Ie(i,"complete"),Ie(i,"success");else{i.o=6;try{var x=ut(i)>2?i.g.statusText:""}catch{x=""}i.l=x+" ["+i.ca()+"]",Ho(i)}}finally{Ss(i)}}}}function Ss(i,l){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const h=i.g;i.g=null,l||Ie(i,"ready");try{h.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function ut(i){return i.g?i.g.readyState:0}n.ca=function(){try{return ut(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var l=this.g.responseText;return i&&l.indexOf(i)==0&&(l=l.substring(i.length)),wu(l)}};function Ko(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function zu(i){const l={};i=(i.g&&ut(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<i.length;m++){if(E(i[m]))continue;var h=Nu(i[m]);const x=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const C=l[x]||[];l[x]=C,C.push(h)}wn(l,function(m){return m.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function zn(i,l,h){return h&&h.internalChannelParams&&h.internalChannelParams[i]||l}function Wo(i){this.za=0,this.i=[],this.j=new jn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=zn("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=zn("baseRetryDelayMs",5e3,i),this.Za=zn("retryDelaySeedMs",1e4,i),this.Ta=zn("forwardChannelMaxRetries",2,i),this.va=zn("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new No(i&&i.concurrentRequestLimit),this.Ba=new Uu,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Wo.prototype,n.ka=8,n.I=1,n.connect=function(i,l,h,m){ke(0),this.W=i,this.H=l||{},h&&m!==void 0&&(this.H.OSID=h,this.H.OAID=m),this.F=this.X,this.J=na(this,null,this.W),Cs(this)};function qr(i){if(Go(i),i.I==3){var l=i.V++,h=qe(i.J);if(oe(h,"SID",i.M),oe(h,"RID",l),oe(h,"TYPE","terminate"),Kn(i,h),l=new at(i,i.j,l),l.M=2,l.A=Is(qe(h)),h=!1,a.navigator&&a.navigator.sendBeacon)try{h=a.navigator.sendBeacon(l.A.toString(),"")}catch{}!h&&a.Image&&(new Image().src=l.A,h=!0),h||(l.g=sa(l.j,null),l.g.ea(l.A)),l.F=Date.now(),ws(l)}ta(i)}function xs(i){i.g&&(zr(i),i.g.cancel(),i.g=null)}function Go(i){xs(i),i.v&&(a.clearTimeout(i.v),i.v=null),Ns(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function Cs(i){if(!Ro(i.h)&&!i.m){i.m=!0;var l=i.Ea;W||y(),H||(W(),H=!0),b.add(l,i),i.D=0}}function Ku(i,l){return Po(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=l.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=Vn(f(i.Ea,i,l),ea(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const x=new at(this,this.j,i);let C=this.o;if(this.U&&(C?(C=In(C),Sn(C,this.U)):C=this.U),this.u!==null||this.R||(x.J=C,C=null),this.S)e:{for(var l=0,h=0;h<this.i.length;h++){t:{var m=this.i[h];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break t}m=void 0}if(m===void 0)break;if(l+=m,l>4096){l=h;break e}if(l===4096||h===this.i.length-1){l=h+1;break e}}l=1e3}else l=1e3;l=Jo(this,x,l),h=qe(this.J),oe(h,"RID",i),oe(h,"CVER",22),this.G&&oe(h,"X-HTTP-Session-Id",this.G),Kn(this,h),C&&(this.R?l="headers="+Fn(Uo(C))+"&"+l:this.u&&Ur(h,this.u,C)),Mr(this.h,x),this.Ra&&oe(h,"TYPE","init"),this.S?(oe(h,"$req",l),oe(h,"SID","null"),x.U=!0,jr(x,h,null)):jr(x,h,l),this.I=2}}else this.I==3&&(i?Qo(this,i):this.i.length==0||Ro(this.h)||Qo(this))};function Qo(i,l){var h;l?h=l.l:h=i.V++;const m=qe(i.J);oe(m,"SID",i.M),oe(m,"RID",h),oe(m,"AID",i.K),Kn(i,m),i.u&&i.o&&Ur(m,i.u,i.o),h=new at(i,i.j,h,i.D+1),i.u===null&&(h.J=i.o),l&&(i.i=l.G.concat(i.i)),l=Jo(i,h,1e3),h.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Mr(i.h,h),jr(h,m,l)}function Kn(i,l){i.H&&De(i.H,function(h,m){oe(l,m,h)}),i.l&&De({},function(h,m){oe(l,m,h)})}function Jo(i,l,h){h=Math.min(i.i.length,h);const m=i.l?f(i.l.Ka,i.l,i):null;e:{var x=i.i;let Y=-1;for(;;){const me=["count="+h];Y==-1?h>0?(Y=x[0].g,me.push("ofs="+Y)):Y=0:me.push("ofs="+Y);let re=!0;for(let Ee=0;Ee<h;Ee++){var C=x[Ee].g;const He=x[Ee].map;if(C-=Y,C<0)Y=Math.max(0,x[Ee].g-100),re=!1;else try{C="req"+C+"_"||"";try{var M=He instanceof Map?He:Object.entries(He);for(const[Rt,ht]of M){let dt=ht;u(ht)&&(dt=ot(ht)),me.push(C+Rt+"="+encodeURIComponent(dt))}}catch(Rt){throw me.push(C+"type="+encodeURIComponent("_badmap")),Rt}}catch{m&&m(He)}}if(re){M=me.join("&");break e}}M=void 0}return i=i.i.splice(0,h),l.G=i,M}function Yo(i){if(!i.g&&!i.v){i.Y=1;var l=i.Da;W||y(),H||(W(),H=!0),b.add(l,i),i.A=0}}function Hr(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=Vn(f(i.Da,i),ea(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,Xo(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=Vn(f(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,ke(10),xs(this),Xo(this))};function zr(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function Xo(i){i.g=new at(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var l=qe(i.na);oe(l,"RID","rpc"),oe(l,"SID",i.M),oe(l,"AID",i.K),oe(l,"CI",i.F?"0":"1"),!i.F&&i.ia&&oe(l,"TO",i.ia),oe(l,"TYPE","xmlhttp"),Kn(i,l),i.u&&i.o&&Ur(l,i.u,i.o),i.O&&(i.g.H=i.O);var h=i.g;i=i.ba,h.M=1,h.A=Is(qe(l)),h.u=null,h.R=!0,So(h,i)}n.Va=function(){this.C!=null&&(this.C=null,xs(this),Hr(this),ke(19))};function Ns(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function Zo(i,l){var h=null;if(i.g==l){Ns(i),zr(i),i.g=null;var m=2}else if(Lr(i.h,l))h=l.G,ko(i.h,l),m=1;else return;if(i.I!=0){if(l.o)if(m==1){h=l.u?l.u.length:0,l=Date.now()-l.F;var x=i.D;m=bs(),Ie(m,new bo(m,h)),Cs(i)}else Yo(i);else if(x=l.m,x==3||x==0&&l.X>0||!(m==1&&Ku(i,l)||m==2&&Hr(i)))switch(h&&h.length>0&&(l=i.h,l.i=l.i.concat(h)),x){case 1:Nt(i,5);break;case 4:Nt(i,10);break;case 3:Nt(i,6);break;default:Nt(i,2)}}}function ea(i,l){let h=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(h*=2),h*l}function Nt(i,l){if(i.j.info("Error code "+l),l==2){var h=f(i.bb,i),m=i.Ua;const x=!m;m=new lt(m||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Ln(m,"https"),Is(m),x?Bu(m.toString(),h):$u(m.toString(),h)}else ke(2);i.I=0,i.l&&i.l.pa(l),ta(i),Go(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),ke(2)):(this.j.info("Failed to ping google.com"),ke(1))};function ta(i){if(i.I=0,i.ja=[],i.l){const l=Do(i.h);(l.length!=0||i.i.length!=0)&&(S(i.ja,l),S(i.ja,i.i),i.h.i.length=0,A(i.i),i.i.length=0),i.l.oa()}}function na(i,l,h){var m=h instanceof lt?qe(h):new lt(h);if(m.g!="")l&&(m.g=l+"."+m.g),Mn(m,m.u);else{var x=a.location;m=x.protocol,l=l?l+"."+x.hostname:x.hostname,x=+x.port;const C=new lt(null);m&&Ln(C,m),l&&(C.g=l),x&&Mn(C,x),h&&(C.h=h),m=C}return h=i.G,l=i.wa,h&&l&&oe(m,h,l),oe(m,"VER",i.ka),Kn(i,m),m}function sa(i,l,h){if(l&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return l=i.Aa&&!i.ma?new ue(new $r({ab:h})):new ue(i.ma),l.Fa(i.L),l}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ra(){}n=ra.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Rs(){}Rs.prototype.g=function(i,l){return new Fe(i,l)};function Fe(i,l){ve.call(this),this.g=new Wo(l),this.l=i,this.h=l&&l.messageUrlParams||null,i=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(i?i["X-WebChannel-Content-Type"]=l.messageContentType:i={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.sa&&(i?i["X-WebChannel-Client-Profile"]=l.sa:i={"X-WebChannel-Client-Profile":l.sa}),this.g.U=i,(i=l&&l.Qb)&&!E(i)&&(this.g.u=i),this.A=l&&l.supportsCrossDomainXhr||!1,this.v=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!E(l)&&(this.g.G=l,i=this.h,i!==null&&l in i&&(i=this.h,l in i&&delete i[l])),this.j=new Jt(this)}_(Fe,ve),Fe.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Fe.prototype.close=function(){qr(this.g)},Fe.prototype.o=function(i){var l=this.g;if(typeof i=="string"){var h={};h.__data__=i,i=h}else this.v&&(h={},h.__data__=ot(i),i=h);l.i.push(new ku(l.Ya++,i)),l.I==3&&Cs(l)},Fe.prototype.N=function(){this.g.l=null,delete this.j,qr(this.g),delete this.g,Fe.Z.N.call(this)};function ia(i){Pr.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var l=i.__sm__;if(l){e:{for(const h in l){i=h;break e}i=void 0}(this.i=i)&&(i=this.i,l=l!==null&&i in l?l[i]:void 0),this.data=l}else this.data=i}_(ia,Pr);function oa(){kr.call(this),this.status=1}_(oa,kr);function Jt(i){this.g=i}_(Jt,ra),Jt.prototype.ra=function(){Ie(this.g,"a")},Jt.prototype.qa=function(i){Ie(this.g,new ia(i))},Jt.prototype.pa=function(i){Ie(this.g,new oa)},Jt.prototype.oa=function(){Ie(this.g,"b")},Rs.prototype.createWebChannel=Rs.prototype.g,Fe.prototype.send=Fe.prototype.o,Fe.prototype.open=Fe.prototype.m,Fe.prototype.close=Fe.prototype.close,Hl=function(){return new Rs},ql=function(){return bs()},Ul=St,fi={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ts.NO_ERROR=0,Ts.TIMEOUT=8,Ts.HTTP_ERROR=6,Ms=Ts,To.COMPLETE="complete",$l=To,yo.EventType=kn,kn.OPEN="a",kn.CLOSE="b",kn.ERROR="c",kn.MESSAGE="d",ve.prototype.listen=ve.prototype.J,Qn=yo,ue.prototype.listenOnce=ue.prototype.K,ue.prototype.getLastError=ue.prototype.Ha,ue.prototype.getLastErrorCode=ue.prototype.ya,ue.prototype.getStatus=ue.prototype.ca,ue.prototype.getResponseJson=ue.prototype.La,ue.prototype.getResponseText=ue.prototype.la,ue.prototype.send=ue.prototype.ea,ue.prototype.setWithCredentials=ue.prototype.Fa,Bl=ue}).apply(typeof Ds<"u"?Ds:typeof self<"u"?self:typeof window<"u"?window:{});class Ne{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ne.UNAUTHENTICATED=new Ne(null),Ne.GOOGLE_CREDENTIALS=new Ne("google-credentials-uid"),Ne.FIRST_PARTY=new Ne("first-party-uid"),Ne.MOCK_USER=new Ne("mock-user");let yn="12.9.0";function Md(n){yn=n}const Dt=new Dl("@firebase/firestore");function Yt(){return Dt.logLevel}function $(n,...e){if(Dt.logLevel<=te.DEBUG){const t=e.map(Vi);Dt.debug(`Firestore (${yn}): ${n}`,...t)}}function st(n,...e){if(Dt.logLevel<=te.ERROR){const t=e.map(Vi);Dt.error(`Firestore (${yn}): ${n}`,...t)}}function Vt(n,...e){if(Dt.logLevel<=te.WARN){const t=e.map(Vi);Dt.warn(`Firestore (${yn}): ${n}`,...t)}}function Vi(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function K(n,e,t){let s="Unexpected state";typeof e=="string"?s=e:t=e,zl(n,s,t)}function zl(n,e,t){let s=`FIRESTORE (${yn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{s+=" CONTEXT: "+JSON.stringify(t)}catch{s+=" CONTEXT: "+t}throw st(s),new Error(s)}function ne(n,e,t,s){let r="Unexpected state";typeof t=="string"?r=t:s=t,n||zl(e,r,s)}function Q(n,e){return n}const V={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class q extends gn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class _t{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Kl{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Bd{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Ne.UNAUTHENTICATED)))}shutdown(){}}class $d{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Ud{constructor(e){this.t=e,this.currentUser=Ne.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ne(this.o===void 0,42304);let s=this.i;const r=d=>this.i!==s?(s=this.i,t(d)):Promise.resolve();let o=new _t;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new _t,e.enqueueRetryable((()=>r(this.currentUser)))};const a=()=>{const d=o;e.enqueueRetryable((async()=>{await d.promise,await r(this.currentUser)}))},u=d=>{$("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=d,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((d=>u(d))),setTimeout((()=>{if(!this.auth){const d=this.t.getImmediate({optional:!0});d?u(d):($("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new _t)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((s=>this.i!==e?($("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(ne(typeof s.accessToken=="string",31837,{l:s}),new Kl(s.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ne(e===null||typeof e=="string",2055,{h:e}),new Ne(e)}}class qd{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=Ne.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class Hd{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new qd(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Ne.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ta{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class zd{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Td(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ne(this.o===void 0,3512);const s=o=>{o.error!=null&&$("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,$("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable((()=>s(o)))};const r=o=>{$("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>r(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?r(o):$("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Ta(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(ne(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Ta(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Kd(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let s=0;s<n;s++)t[s]=Math.floor(256*Math.random());return t}class ji{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let s="";for(;s.length<20;){const r=Kd(40);for(let o=0;o<r.length;++o)s.length<20&&r[o]<t&&(s+=e.charAt(r[o]%62))}return s}}function X(n,e){return n<e?-1:n>e?1:0}function mi(n,e){const t=Math.min(n.length,e.length);for(let s=0;s<t;s++){const r=n.charAt(s),o=e.charAt(s);if(r!==o)return Xr(r)===Xr(o)?X(r,o):Xr(r)?1:-1}return X(n.length,e.length)}const Wd=55296,Gd=57343;function Xr(n){const e=n.charCodeAt(0);return e>=Wd&&e<=Gd}function ln(n,e,t){return n.length===e.length&&n.every(((s,r)=>t(s,e[r])))}const wa="__name__";class ze{constructor(e,t,s){t===void 0?t=0:t>e.length&&K(637,{offset:t,range:e.length}),s===void 0?s=e.length-t:s>e.length-t&&K(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return ze.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ze?e.forEach((s=>{t.push(s)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const o=ze.compareSegments(e.get(r),t.get(r));if(o!==0)return o}return X(e.length,t.length)}static compareSegments(e,t){const s=ze.isNumericId(e),r=ze.isNumericId(t);return s&&!r?-1:!s&&r?1:s&&r?ze.extractNumericId(e).compare(ze.extractNumericId(t)):mi(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return yt.fromString(e.substring(4,e.length-2))}}class ae extends ze{construct(e,t,s){return new ae(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new q(V.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter((r=>r.length>0)))}return new ae(t)}static emptyPath(){return new ae([])}}const Qd=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Se extends ze{construct(e,t,s){return new Se(e,t,s)}static isValidIdentifier(e){return Qd.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Se.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===wa}static keyField(){return new Se([wa])}static fromServerFormat(e){const t=[];let s="",r=0;const o=()=>{if(s.length===0)throw new q(V.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let a=!1;for(;r<e.length;){const u=e[r];if(u==="\\"){if(r+1===e.length)throw new q(V.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[r+1];if(d!=="\\"&&d!=="."&&d!=="`")throw new q(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=d,r+=2}else u==="`"?(a=!a,r++):u!=="."||a?(s+=u,r++):(o(),r++)}if(o(),a)throw new q(V.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Se(t)}static emptyPath(){return new Se([])}}class z{constructor(e){this.path=e}static fromPath(e){return new z(ae.fromString(e))}static fromName(e){return new z(ae.fromString(e).popFirst(5))}static empty(){return new z(ae.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ae.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ae.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new z(new ae(e.slice()))}}function Wl(n,e,t){if(!t)throw new q(V.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Jd(n,e,t,s){if(e===!0&&s===!0)throw new q(V.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Ia(n){if(!z.isDocumentKey(n))throw new q(V.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Aa(n){if(z.isDocumentKey(n))throw new q(V.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Gl(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Fi(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(s){return s.constructor?s.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":K(12329,{type:typeof n})}function cn(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new q(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Fi(n);throw new q(V.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function fe(n,e){const t={typeString:n};return e&&(t.value=e),t}function ms(n,e){if(!Gl(n))throw new q(V.INVALID_ARGUMENT,"JSON must be an object");let t;for(const s in e)if(e[s]){const r=e[s].typeString,o="value"in e[s]?{value:e[s].value}:void 0;if(!(s in n)){t=`JSON missing required field: '${s}'`;break}const a=n[s];if(r&&typeof a!==r){t=`JSON field '${s}' must be a ${r}.`;break}if(o!==void 0&&a!==o.value){t=`Expected '${s}' field to equal '${o.value}'`;break}}if(t)throw new q(V.INVALID_ARGUMENT,t);return!0}const Sa=-62135596800,xa=1e6;class le{static now(){return le.fromMillis(Date.now())}static fromDate(e){return le.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*xa);return new le(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new q(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new q(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Sa)throw new q(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new q(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/xa}_compareTo(e){return this.seconds===e.seconds?X(this.nanoseconds,e.nanoseconds):X(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:le._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ms(e,le._jsonSchema))return new le(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Sa;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}le._jsonSchemaVersion="firestore/timestamp/1.0",le._jsonSchema={type:fe("string",le._jsonSchemaVersion),seconds:fe("number"),nanoseconds:fe("number")};class G{static fromTimestamp(e){return new G(e)}static min(){return new G(new le(0,0))}static max(){return new G(new le(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const ls=-1;function Yd(n,e){const t=n.toTimestamp().seconds,s=n.toTimestamp().nanoseconds+1,r=G.fromTimestamp(s===1e9?new le(t+1,0):new le(t,s));return new Et(r,z.empty(),e)}function Xd(n){return new Et(n.readTime,n.key,ls)}class Et{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new Et(G.min(),z.empty(),ls)}static max(){return new Et(G.max(),z.empty(),ls)}}function Zd(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=z.comparator(n.documentKey,e.documentKey),t!==0?t:X(n.largestBatchId,e.largestBatchId))}const ef="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class tf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function _n(n){if(n.code!==V.FAILED_PRECONDITION||n.message!==ef)throw n;$("LocalStore","Unexpectedly lost primary lease")}class k{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&K(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new k(((s,r)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(s,r)},this.catchCallback=o=>{this.wrapFailure(t,o).next(s,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof k?t:k.resolve(t)}catch(t){return k.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):k.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):k.reject(t)}static resolve(e){return new k(((t,s)=>{t(e)}))}static reject(e){return new k(((t,s)=>{s(e)}))}static waitFor(e){return new k(((t,s)=>{let r=0,o=0,a=!1;e.forEach((u=>{++r,u.next((()=>{++o,a&&o===r&&t()}),(d=>s(d)))})),a=!0,o===r&&t()}))}static or(e){let t=k.resolve(!1);for(const s of e)t=t.next((r=>r?k.resolve(r):s()));return t}static forEach(e,t){const s=[];return e.forEach(((r,o)=>{s.push(t.call(this,r,o))})),this.waitFor(s)}static mapArray(e,t){return new k(((s,r)=>{const o=e.length,a=new Array(o);let u=0;for(let d=0;d<o;d++){const f=d;t(e[f]).next((p=>{a[f]=p,++u,u===o&&s(a)}),(p=>r(p)))}}))}static doWhile(e,t){return new k(((s,r)=>{const o=()=>{e()===!0?t().next((()=>{o()}),r):s()};o()}))}}function nf(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function vn(n){return n.name==="IndexedDbTransactionError"}class lr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=s=>this.ae(s),this.ue=s=>t.writeSequenceNumber(s))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}lr.ce=-1;const Oi=-1;function cr(n){return n==null}function Qs(n){return n===0&&1/n==-1/0}function sf(n){return typeof n=="number"&&Number.isInteger(n)&&!Qs(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const Ql="";function rf(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Ca(e)),e=of(n.get(t),e);return Ca(e)}function of(n,e){let t=e;const s=n.length;for(let r=0;r<s;r++){const o=n.charAt(r);switch(o){case"\0":t+="";break;case Ql:t+="";break;default:t+=o}}return t}function Ca(n){return n+Ql+""}function Na(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ft(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Jl(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class ce{constructor(e,t){this.comparator=e,this.root=t||Ae.EMPTY}insert(e,t){return new ce(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ae.BLACK,null,null))}remove(e){return new ce(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ae.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(s===0)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(r===0)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,s)=>(e(t,s),!1)))}toString(){const e=[];return this.inorderTraversal(((t,s)=>(e.push(`${t}:${s}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Vs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Vs(this.root,e,this.comparator,!1)}getReverseIterator(){return new Vs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Vs(this.root,e,this.comparator,!0)}}class Vs{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?s(e.key,t):1,t&&r&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ae{constructor(e,t,s,r,o){this.key=e,this.value=t,this.color=s??Ae.RED,this.left=r??Ae.EMPTY,this.right=o??Ae.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,o){return new Ae(e??this.key,t??this.value,s??this.color,r??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const o=s(e,r.key);return r=o<0?r.copy(null,null,null,r.left.insert(e,t,s),null):o===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Ae.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return Ae.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ae.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ae.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw K(43730,{key:this.key,value:this.value});if(this.right.isRed())throw K(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw K(27949);return e+(this.isRed()?0:1)}}Ae.EMPTY=null,Ae.RED=!0,Ae.BLACK=!1;Ae.EMPTY=new class{constructor(){this.size=0}get key(){throw K(57766)}get value(){throw K(16141)}get color(){throw K(16727)}get left(){throw K(29726)}get right(){throw K(36894)}copy(e,t,s,r,o){return this}insert(e,t,s){return new Ae(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ye{constructor(e){this.comparator=e,this.data=new ce(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,s)=>(e(t),!1)))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ra(this.data.getIterator())}getIteratorFrom(e){return new Ra(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((s=>{t=t.add(s)})),t}isEqual(e){if(!(e instanceof ye)||this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,o=s.getNext().key;if(this.comparator(r,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new ye(this.comparator);return t.data=e,t}}class Ra{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Be{constructor(e){this.fields=e,e.sort(Se.comparator)}static empty(){return new Be([])}unionWith(e){let t=new ye(Se.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new Be(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ln(this.fields,e.fields,((t,s)=>t.isEqual(s)))}}class Yl extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class xe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(r){try{return atob(r)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Yl("Invalid base64 string: "+o):o}})(e);return new xe(t)}static fromUint8Array(e){const t=(function(r){let o="";for(let a=0;a<r.length;++a)o+=String.fromCharCode(r[a]);return o})(e);return new xe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const s=new Uint8Array(t.length);for(let r=0;r<t.length;r++)s[r]=t.charCodeAt(r);return s})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return X(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}xe.EMPTY_BYTE_STRING=new xe("");const af=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function bt(n){if(ne(!!n,39018),typeof n=="string"){let e=0;const t=af.exec(n);if(ne(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const s=new Date(n);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:he(n.seconds),nanos:he(n.nanos)}}function he(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Tt(n){return typeof n=="string"?xe.fromBase64String(n):xe.fromUint8Array(n)}const Xl="server_timestamp",Zl="__type__",ec="__previous_value__",tc="__local_write_time__";function Li(n){return(n?.mapValue?.fields||{})[Zl]?.stringValue===Xl}function ur(n){const e=n.mapValue.fields[ec];return Li(e)?ur(e):e}function cs(n){const e=bt(n.mapValue.fields[tc].timestampValue);return new le(e.seconds,e.nanos)}class lf{constructor(e,t,s,r,o,a,u,d,f,p,_){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=d,this.useFetchStreams=f,this.isUsingEmulator=p,this.apiKey=_}}const Js="(default)";class us{constructor(e,t){this.projectId=e,this.database=t||Js}static empty(){return new us("","")}get isDefaultDatabase(){return this.database===Js}isEqual(e){return e instanceof us&&e.projectId===this.projectId&&e.database===this.database}}function cf(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new q(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new us(n.options.projectId,e)}const nc="__type__",uf="__max__",js={mapValue:{}},sc="__vector__",Ys="value";function wt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Li(n)?4:df(n)?9007199254740991:hf(n)?10:11:K(28295,{value:n})}function Je(n,e){if(n===e)return!0;const t=wt(n);if(t!==wt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return cs(n).isEqual(cs(e));case 3:return(function(r,o){if(typeof r.timestampValue=="string"&&typeof o.timestampValue=="string"&&r.timestampValue.length===o.timestampValue.length)return r.timestampValue===o.timestampValue;const a=bt(r.timestampValue),u=bt(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(r,o){return Tt(r.bytesValue).isEqual(Tt(o.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(r,o){return he(r.geoPointValue.latitude)===he(o.geoPointValue.latitude)&&he(r.geoPointValue.longitude)===he(o.geoPointValue.longitude)})(n,e);case 2:return(function(r,o){if("integerValue"in r&&"integerValue"in o)return he(r.integerValue)===he(o.integerValue);if("doubleValue"in r&&"doubleValue"in o){const a=he(r.doubleValue),u=he(o.doubleValue);return a===u?Qs(a)===Qs(u):isNaN(a)&&isNaN(u)}return!1})(n,e);case 9:return ln(n.arrayValue.values||[],e.arrayValue.values||[],Je);case 10:case 11:return(function(r,o){const a=r.mapValue.fields||{},u=o.mapValue.fields||{};if(Na(a)!==Na(u))return!1;for(const d in a)if(a.hasOwnProperty(d)&&(u[d]===void 0||!Je(a[d],u[d])))return!1;return!0})(n,e);default:return K(52216,{left:n})}}function hs(n,e){return(n.values||[]).find((t=>Je(t,e)))!==void 0}function un(n,e){if(n===e)return 0;const t=wt(n),s=wt(e);if(t!==s)return X(t,s);switch(t){case 0:case 9007199254740991:return 0;case 1:return X(n.booleanValue,e.booleanValue);case 2:return(function(o,a){const u=he(o.integerValue||o.doubleValue),d=he(a.integerValue||a.doubleValue);return u<d?-1:u>d?1:u===d?0:isNaN(u)?isNaN(d)?0:-1:1})(n,e);case 3:return Pa(n.timestampValue,e.timestampValue);case 4:return Pa(cs(n),cs(e));case 5:return mi(n.stringValue,e.stringValue);case 6:return(function(o,a){const u=Tt(o),d=Tt(a);return u.compareTo(d)})(n.bytesValue,e.bytesValue);case 7:return(function(o,a){const u=o.split("/"),d=a.split("/");for(let f=0;f<u.length&&f<d.length;f++){const p=X(u[f],d[f]);if(p!==0)return p}return X(u.length,d.length)})(n.referenceValue,e.referenceValue);case 8:return(function(o,a){const u=X(he(o.latitude),he(a.latitude));return u!==0?u:X(he(o.longitude),he(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return ka(n.arrayValue,e.arrayValue);case 10:return(function(o,a){const u=o.fields||{},d=a.fields||{},f=u[Ys]?.arrayValue,p=d[Ys]?.arrayValue,_=X(f?.values?.length||0,p?.values?.length||0);return _!==0?_:ka(f,p)})(n.mapValue,e.mapValue);case 11:return(function(o,a){if(o===js.mapValue&&a===js.mapValue)return 0;if(o===js.mapValue)return 1;if(a===js.mapValue)return-1;const u=o.fields||{},d=Object.keys(u),f=a.fields||{},p=Object.keys(f);d.sort(),p.sort();for(let _=0;_<d.length&&_<p.length;++_){const w=mi(d[_],p[_]);if(w!==0)return w;const A=un(u[d[_]],f[p[_]]);if(A!==0)return A}return X(d.length,p.length)})(n.mapValue,e.mapValue);default:throw K(23264,{he:t})}}function Pa(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return X(n,e);const t=bt(n),s=bt(e),r=X(t.seconds,s.seconds);return r!==0?r:X(t.nanos,s.nanos)}function ka(n,e){const t=n.values||[],s=e.values||[];for(let r=0;r<t.length&&r<s.length;++r){const o=un(t[r],s[r]);if(o)return o}return X(t.length,s.length)}function hn(n){return pi(n)}function pi(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const s=bt(t);return`time(${s.seconds},${s.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return Tt(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return z.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let s="[",r=!0;for(const o of t.values||[])r?r=!1:s+=",",s+=pi(o);return s+"]"})(n.arrayValue):"mapValue"in n?(function(t){const s=Object.keys(t.fields||{}).sort();let r="{",o=!0;for(const a of s)o?o=!1:r+=",",r+=`${a}:${pi(t.fields[a])}`;return r+"}"})(n.mapValue):K(61005,{value:n})}function Bs(n){switch(wt(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=ur(n);return e?16+Bs(e):16;case 5:return 2*n.stringValue.length;case 6:return Tt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(s){return(s.values||[]).reduce(((r,o)=>r+Bs(o)),0)})(n.arrayValue);case 10:case 11:return(function(s){let r=0;return Ft(s.fields,((o,a)=>{r+=o.length+Bs(a)})),r})(n.mapValue);default:throw K(13486,{value:n})}}function gi(n){return!!n&&"integerValue"in n}function Mi(n){return!!n&&"arrayValue"in n}function Da(n){return!!n&&"nullValue"in n}function Va(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function $s(n){return!!n&&"mapValue"in n}function hf(n){return(n?.mapValue?.fields||{})[nc]?.stringValue===sc}function es(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return Ft(n.mapValue.fields,((t,s)=>e.mapValue.fields[t]=es(s))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=es(n.arrayValue.values[t]);return e}return{...n}}function df(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===uf}class Oe{constructor(e){this.value=e}static empty(){return new Oe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!$s(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=es(t)}setAll(e){let t=Se.emptyPath(),s={},r=[];e.forEach(((a,u)=>{if(!t.isImmediateParentOf(u)){const d=this.getFieldsMap(t);this.applyChanges(d,s,r),s={},r=[],t=u.popLast()}a?s[u.lastSegment()]=es(a):r.push(u.lastSegment())}));const o=this.getFieldsMap(t);this.applyChanges(o,s,r)}delete(e){const t=this.field(e.popLast());$s(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Je(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];$s(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){Ft(t,((r,o)=>e[r]=o));for(const r of s)delete e[r]}clone(){return new Oe(es(this.value))}}function rc(n){const e=[];return Ft(n.fields,((t,s)=>{const r=new Se([t]);if($s(s)){const o=rc(s.mapValue).fields;if(o.length===0)e.push(r);else for(const a of o)e.push(r.child(a))}else e.push(r)})),new Be(e)}class Re{constructor(e,t,s,r,o,a,u){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(e){return new Re(e,0,G.min(),G.min(),G.min(),Oe.empty(),0)}static newFoundDocument(e,t,s,r){return new Re(e,1,t,G.min(),s,r,0)}static newNoDocument(e,t){return new Re(e,2,t,G.min(),G.min(),Oe.empty(),0)}static newUnknownDocument(e,t){return new Re(e,3,t,G.min(),G.min(),Oe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(G.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Oe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Oe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=G.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Re&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Re(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Xs{constructor(e,t){this.position=e,this.inclusive=t}}function ja(n,e,t){let s=0;for(let r=0;r<n.position.length;r++){const o=e[r],a=n.position[r];if(o.field.isKeyField()?s=z.comparator(z.fromName(a.referenceValue),t.key):s=un(a,t.data.field(o.field)),o.dir==="desc"&&(s*=-1),s!==0)break}return s}function Fa(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Je(n.position[t],e.position[t]))return!1;return!0}class Zs{constructor(e,t="asc"){this.field=e,this.dir=t}}function ff(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class ic{}class ge extends ic{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,s):new pf(e,t,s):t==="array-contains"?new _f(e,s):t==="in"?new vf(e,s):t==="not-in"?new Ef(e,s):t==="array-contains-any"?new bf(e,s):new ge(e,t,s)}static createKeyFieldInFilter(e,t,s){return t==="in"?new gf(e,s):new yf(e,s)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(un(t,this.value)):t!==null&&wt(this.value)===wt(t)&&this.matchesComparison(un(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return K(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ye extends ic{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ye(e,t)}matches(e){return oc(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function oc(n){return n.op==="and"}function ac(n){return mf(n)&&oc(n)}function mf(n){for(const e of n.filters)if(e instanceof Ye)return!1;return!0}function yi(n){if(n instanceof ge)return n.field.canonicalString()+n.op.toString()+hn(n.value);if(ac(n))return n.filters.map((e=>yi(e))).join(",");{const e=n.filters.map((t=>yi(t))).join(",");return`${n.op}(${e})`}}function lc(n,e){return n instanceof ge?(function(s,r){return r instanceof ge&&s.op===r.op&&s.field.isEqual(r.field)&&Je(s.value,r.value)})(n,e):n instanceof Ye?(function(s,r){return r instanceof Ye&&s.op===r.op&&s.filters.length===r.filters.length?s.filters.reduce(((o,a,u)=>o&&lc(a,r.filters[u])),!0):!1})(n,e):void K(19439)}function cc(n){return n instanceof ge?(function(t){return`${t.field.canonicalString()} ${t.op} ${hn(t.value)}`})(n):n instanceof Ye?(function(t){return t.op.toString()+" {"+t.getFilters().map(cc).join(" ,")+"}"})(n):"Filter"}class pf extends ge{constructor(e,t,s){super(e,t,s),this.key=z.fromName(s.referenceValue)}matches(e){const t=z.comparator(e.key,this.key);return this.matchesComparison(t)}}class gf extends ge{constructor(e,t){super(e,"in",t),this.keys=uc("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class yf extends ge{constructor(e,t){super(e,"not-in",t),this.keys=uc("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function uc(n,e){return(e.arrayValue?.values||[]).map((t=>z.fromName(t.referenceValue)))}class _f extends ge{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Mi(t)&&hs(t.arrayValue,this.value)}}class vf extends ge{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&hs(this.value.arrayValue,t)}}class Ef extends ge{constructor(e,t){super(e,"not-in",t)}matches(e){if(hs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!hs(this.value.arrayValue,t)}}class bf extends ge{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Mi(t)||!t.arrayValue.values)&&t.arrayValue.values.some((s=>hs(this.value.arrayValue,s)))}}class Tf{constructor(e,t=null,s=[],r=[],o=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}}function Oa(n,e=null,t=[],s=[],r=null,o=null,a=null){return new Tf(n,e,t,s,r,o,a)}function Bi(n){const e=Q(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((s=>yi(s))).join(","),t+="|ob:",t+=e.orderBy.map((s=>(function(o){return o.field.canonicalString()+o.dir})(s))).join(","),cr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((s=>hn(s))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((s=>hn(s))).join(",")),e.Te=t}return e.Te}function $i(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!ff(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!lc(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Fa(n.startAt,e.startAt)&&Fa(n.endAt,e.endAt)}function _i(n){return z.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class hr{constructor(e,t=null,s=[],r=[],o=null,a="F",u=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=d,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function wf(n,e,t,s,r,o,a,u){return new hr(n,e,t,s,r,o,a,u)}function hc(n){return new hr(n)}function La(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function If(n){return z.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Af(n){return n.collectionGroup!==null}function ts(n){const e=Q(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ie.push(o),t.add(o.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new ye(Se.comparator);return a.filters.forEach((d=>{d.getFlattenedFilters().forEach((f=>{f.isInequality()&&(u=u.add(f.field))}))})),u})(e).forEach((o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ie.push(new Zs(o,s))})),t.has(Se.keyField().canonicalString())||e.Ie.push(new Zs(Se.keyField(),s))}return e.Ie}function Ke(n){const e=Q(n);return e.Ee||(e.Ee=Sf(e,ts(n))),e.Ee}function Sf(n,e){if(n.limitType==="F")return Oa(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((r=>{const o=r.dir==="desc"?"asc":"desc";return new Zs(r.field,o)}));const t=n.endAt?new Xs(n.endAt.position,n.endAt.inclusive):null,s=n.startAt?new Xs(n.startAt.position,n.startAt.inclusive):null;return Oa(n.path,n.collectionGroup,e,n.filters,n.limit,t,s)}}function vi(n,e,t){return new hr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function dr(n,e){return $i(Ke(n),Ke(e))&&n.limitType===e.limitType}function dc(n){return`${Bi(Ke(n))}|lt:${n.limitType}`}function Xt(n){return`Query(target=${(function(t){let s=t.path.canonicalString();return t.collectionGroup!==null&&(s+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(s+=`, filters: [${t.filters.map((r=>cc(r))).join(", ")}]`),cr(t.limit)||(s+=", limit: "+t.limit),t.orderBy.length>0&&(s+=`, orderBy: [${t.orderBy.map((r=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(r))).join(", ")}]`),t.startAt&&(s+=", startAt: ",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map((r=>hn(r))).join(",")),t.endAt&&(s+=", endAt: ",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map((r=>hn(r))).join(",")),`Target(${s})`})(Ke(n))}; limitType=${n.limitType})`}function fr(n,e){return e.isFoundDocument()&&(function(s,r){const o=r.key.path;return s.collectionGroup!==null?r.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(o):z.isDocumentKey(s.path)?s.path.isEqual(o):s.path.isImmediateParentOf(o)})(n,e)&&(function(s,r){for(const o of ts(s))if(!o.field.isKeyField()&&r.data.field(o.field)===null)return!1;return!0})(n,e)&&(function(s,r){for(const o of s.filters)if(!o.matches(r))return!1;return!0})(n,e)&&(function(s,r){return!(s.startAt&&!(function(a,u,d){const f=ja(a,u,d);return a.inclusive?f<=0:f<0})(s.startAt,ts(s),r)||s.endAt&&!(function(a,u,d){const f=ja(a,u,d);return a.inclusive?f>=0:f>0})(s.endAt,ts(s),r))})(n,e)}function xf(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function fc(n){return(e,t)=>{let s=!1;for(const r of ts(n)){const o=Cf(r,e,t);if(o!==0)return o;s=s||r.field.isKeyField()}return 0}}function Cf(n,e,t){const s=n.field.isKeyField()?z.comparator(e.key,t.key):(function(o,a,u){const d=a.data.field(o),f=u.data.field(o);return d!==null&&f!==null?un(d,f):K(42886)})(n.field,e,t);switch(n.dir){case"asc":return s;case"desc":return-1*s;default:return K(19790,{direction:n.dir})}}class Ot{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s!==void 0){for(const[r,o]of s)if(this.equalsFn(r,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(r===void 0)return this.inner[s]=[[e,t]],void this.innerSize++;for(let o=0;o<r.length;o++)if(this.equalsFn(r[o][0],e))return void(r[o]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(s===void 0)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return s.length===1?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Ft(this.inner,((t,s)=>{for(const[r,o]of s)e(r,o)}))}isEmpty(){return Jl(this.inner)}size(){return this.innerSize}}const Nf=new ce(z.comparator);function rt(){return Nf}const mc=new ce(z.comparator);function Jn(...n){let e=mc;for(const t of n)e=e.insert(t.key,t);return e}function pc(n){let e=mc;return n.forEach(((t,s)=>e=e.insert(t,s.overlayedDocument))),e}function kt(){return ns()}function gc(){return ns()}function ns(){return new Ot((n=>n.toString()),((n,e)=>n.isEqual(e)))}const Rf=new ce(z.comparator),Pf=new ye(z.comparator);function Z(...n){let e=Pf;for(const t of n)e=e.add(t);return e}const kf=new ye(X);function Df(){return kf}function Ui(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qs(e)?"-0":e}}function yc(n){return{integerValue:""+n}}function Vf(n,e){return sf(e)?yc(e):Ui(n,e)}class mr{constructor(){this._=void 0}}function jf(n,e,t){return n instanceof er?(function(r,o){const a={fields:{[Zl]:{stringValue:Xl},[tc]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return o&&Li(o)&&(o=ur(o)),o&&(a.fields[ec]=o),{mapValue:a}})(t,e):n instanceof ds?vc(n,e):n instanceof fs?Ec(n,e):(function(r,o){const a=_c(r,o),u=Ma(a)+Ma(r.Ae);return gi(a)&&gi(r.Ae)?yc(u):Ui(r.serializer,u)})(n,e)}function Ff(n,e,t){return n instanceof ds?vc(n,e):n instanceof fs?Ec(n,e):t}function _c(n,e){return n instanceof tr?(function(s){return gi(s)||(function(o){return!!o&&"doubleValue"in o})(s)})(e)?e:{integerValue:0}:null}class er extends mr{}class ds extends mr{constructor(e){super(),this.elements=e}}function vc(n,e){const t=bc(e);for(const s of n.elements)t.some((r=>Je(r,s)))||t.push(s);return{arrayValue:{values:t}}}class fs extends mr{constructor(e){super(),this.elements=e}}function Ec(n,e){let t=bc(e);for(const s of n.elements)t=t.filter((r=>!Je(r,s)));return{arrayValue:{values:t}}}class tr extends mr{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Ma(n){return he(n.integerValue||n.doubleValue)}function bc(n){return Mi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Of(n,e){return n.field.isEqual(e.field)&&(function(s,r){return s instanceof ds&&r instanceof ds||s instanceof fs&&r instanceof fs?ln(s.elements,r.elements,Je):s instanceof tr&&r instanceof tr?Je(s.Ae,r.Ae):s instanceof er&&r instanceof er})(n.transform,e.transform)}class Lf{constructor(e,t){this.version=e,this.transformResults=t}}class We{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new We}static exists(e){return new We(void 0,e)}static updateTime(e){return new We(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Us(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class pr{}function Tc(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new qi(n.key,We.none()):new ps(n.key,n.data,We.none());{const t=n.data,s=Oe.empty();let r=new ye(Se.comparator);for(let o of e.fields)if(!r.has(o)){let a=t.field(o);a===null&&o.length>1&&(o=o.popLast(),a=t.field(o)),a===null?s.delete(o):s.set(o,a),r=r.add(o)}return new Lt(n.key,s,new Be(r.toArray()),We.none())}}function Mf(n,e,t){n instanceof ps?(function(r,o,a){const u=r.value.clone(),d=$a(r.fieldTransforms,o,a.transformResults);u.setAll(d),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):n instanceof Lt?(function(r,o,a){if(!Us(r.precondition,o))return void o.convertToUnknownDocument(a.version);const u=$a(r.fieldTransforms,o,a.transformResults),d=o.data;d.setAll(wc(r)),d.setAll(u),o.convertToFoundDocument(a.version,d).setHasCommittedMutations()})(n,e,t):(function(r,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function ss(n,e,t,s){return n instanceof ps?(function(o,a,u,d){if(!Us(o.precondition,a))return u;const f=o.value.clone(),p=Ua(o.fieldTransforms,d,a);return f.setAll(p),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null})(n,e,t,s):n instanceof Lt?(function(o,a,u,d){if(!Us(o.precondition,a))return u;const f=Ua(o.fieldTransforms,d,a),p=a.data;return p.setAll(wc(o)),p.setAll(f),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((_=>_.field)))})(n,e,t,s):(function(o,a,u){return Us(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,e,t)}function Bf(n,e){let t=null;for(const s of n.fieldTransforms){const r=e.data.field(s.field),o=_c(s.transform,r||null);o!=null&&(t===null&&(t=Oe.empty()),t.set(s.field,o))}return t||null}function Ba(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(s,r){return s===void 0&&r===void 0||!(!s||!r)&&ln(s,r,((o,a)=>Of(o,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class ps extends pr{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Lt extends pr{constructor(e,t,s,r,o=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function wc(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const s=n.data.field(t);e.set(t,s)}})),e}function $a(n,e,t){const s=new Map;ne(n.length===t.length,32656,{Ve:t.length,de:n.length});for(let r=0;r<t.length;r++){const o=n[r],a=o.transform,u=e.data.field(o.field);s.set(o.field,Ff(a,u,t[r]))}return s}function Ua(n,e,t){const s=new Map;for(const r of n){const o=r.transform,a=t.data.field(r.field);s.set(r.field,jf(o,a,e))}return s}class qi extends pr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class $f extends pr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Uf{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const o=this.mutations[r];o.key.isEqual(e.key)&&Mf(o,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=ss(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=ss(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=gc();return this.mutations.forEach((r=>{const o=e.get(r.key),a=o.overlayedDocument;let u=this.applyToLocalView(a,o.mutatedFields);u=t.has(r.key)?null:u;const d=Tc(a,u);d!==null&&s.set(r.key,d),a.isValidDocument()||a.convertToNoDocument(G.min())})),s}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Z())}isEqual(e){return this.batchId===e.batchId&&ln(this.mutations,e.mutations,((t,s)=>Ba(t,s)))&&ln(this.baseMutations,e.baseMutations,((t,s)=>Ba(t,s)))}}class Hi{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){ne(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let r=(function(){return Rf})();const o=e.mutations;for(let a=0;a<o.length;a++)r=r.insert(o[a].key,s[a].version);return new Hi(e,t,s,r)}}class qf{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Hf{constructor(e,t){this.count=e,this.unchangedNames=t}}var de,ee;function zf(n){switch(n){case V.OK:return K(64938);case V.CANCELLED:case V.UNKNOWN:case V.DEADLINE_EXCEEDED:case V.RESOURCE_EXHAUSTED:case V.INTERNAL:case V.UNAVAILABLE:case V.UNAUTHENTICATED:return!1;case V.INVALID_ARGUMENT:case V.NOT_FOUND:case V.ALREADY_EXISTS:case V.PERMISSION_DENIED:case V.FAILED_PRECONDITION:case V.ABORTED:case V.OUT_OF_RANGE:case V.UNIMPLEMENTED:case V.DATA_LOSS:return!0;default:return K(15467,{code:n})}}function Ic(n){if(n===void 0)return st("GRPC error has no .code"),V.UNKNOWN;switch(n){case de.OK:return V.OK;case de.CANCELLED:return V.CANCELLED;case de.UNKNOWN:return V.UNKNOWN;case de.DEADLINE_EXCEEDED:return V.DEADLINE_EXCEEDED;case de.RESOURCE_EXHAUSTED:return V.RESOURCE_EXHAUSTED;case de.INTERNAL:return V.INTERNAL;case de.UNAVAILABLE:return V.UNAVAILABLE;case de.UNAUTHENTICATED:return V.UNAUTHENTICATED;case de.INVALID_ARGUMENT:return V.INVALID_ARGUMENT;case de.NOT_FOUND:return V.NOT_FOUND;case de.ALREADY_EXISTS:return V.ALREADY_EXISTS;case de.PERMISSION_DENIED:return V.PERMISSION_DENIED;case de.FAILED_PRECONDITION:return V.FAILED_PRECONDITION;case de.ABORTED:return V.ABORTED;case de.OUT_OF_RANGE:return V.OUT_OF_RANGE;case de.UNIMPLEMENTED:return V.UNIMPLEMENTED;case de.DATA_LOSS:return V.DATA_LOSS;default:return K(39323,{code:n})}}(ee=de||(de={}))[ee.OK=0]="OK",ee[ee.CANCELLED=1]="CANCELLED",ee[ee.UNKNOWN=2]="UNKNOWN",ee[ee.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ee[ee.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ee[ee.NOT_FOUND=5]="NOT_FOUND",ee[ee.ALREADY_EXISTS=6]="ALREADY_EXISTS",ee[ee.PERMISSION_DENIED=7]="PERMISSION_DENIED",ee[ee.UNAUTHENTICATED=16]="UNAUTHENTICATED",ee[ee.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ee[ee.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ee[ee.ABORTED=10]="ABORTED",ee[ee.OUT_OF_RANGE=11]="OUT_OF_RANGE",ee[ee.UNIMPLEMENTED=12]="UNIMPLEMENTED",ee[ee.INTERNAL=13]="INTERNAL",ee[ee.UNAVAILABLE=14]="UNAVAILABLE",ee[ee.DATA_LOSS=15]="DATA_LOSS";function Kf(){return new TextEncoder}const Wf=new yt([4294967295,4294967295],0);function qa(n){const e=Kf().encode(n),t=new Ml;return t.update(e),new Uint8Array(t.digest())}function Ha(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),s=e.getUint32(4,!0),r=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new yt([t,s],0),new yt([r,o],0)]}class zi{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new Yn(`Invalid padding: ${t}`);if(s<0)throw new Yn(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new Yn(`Invalid hash count: ${s}`);if(e.length===0&&t!==0)throw new Yn(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=yt.fromNumber(this.ge)}ye(e,t,s){let r=e.add(t.multiply(yt.fromNumber(s)));return r.compare(Wf)===1&&(r=new yt([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=qa(e),[s,r]=Ha(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(s,r,o);if(!this.we(a))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,o=new Uint8Array(Math.ceil(e/8)),a=new zi(o,r,t);return s.forEach((u=>a.insert(u))),a}insert(e){if(this.ge===0)return;const t=qa(e),[s,r]=Ha(t);for(let o=0;o<this.hashCount;o++){const a=this.ye(s,r,o);this.be(a)}}be(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class Yn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class gr{constructor(e,t,s,r,o){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,gs.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new gr(G.min(),r,new ce(X),rt(),Z())}}class gs{constructor(e,t,s,r,o){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new gs(s,t,Z(),Z(),Z())}}class qs{constructor(e,t,s,r){this.Se=e,this.removedTargetIds=t,this.key=s,this.De=r}}class Ac{constructor(e,t){this.targetId=e,this.Ce=t}}class Sc{constructor(e,t,s=xe.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class za{constructor(){this.ve=0,this.Fe=Ka(),this.Me=xe.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Z(),t=Z(),s=Z();return this.Fe.forEach(((r,o)=>{switch(o){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:K(38017,{changeType:o})}})),new gs(this.Me,this.xe,e,t,s)}Ke(){this.Oe=!1,this.Fe=Ka()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,ne(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class Gf{constructor(e){this.Ge=e,this.ze=new Map,this.je=rt(),this.He=Fs(),this.Je=Fs(),this.Ze=new ce(X)}Xe(e){for(const t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.We(),s.Ne||s.Ke(),s.Le(e.resumeToken);break;case 2:s.We(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.Qe(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:K(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((s,r)=>{this.rt(r)&&t(r)}))}st(e){const t=e.targetId,s=e.Ce.count,r=this.ot(t);if(r){const o=r.target;if(_i(o))if(s===0){const a=new z(o.path);this.et(t,a,Re.newNoDocument(a,G.min()))}else ne(s===1,20013,{expectedCount:s});else{const a=this._t(t);if(a!==s){const u=this.ut(e),d=u?this.ct(u,e,a):1;if(d!==0){this.it(t);const f=d===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,f)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:o=0}=t;let a,u;try{a=Tt(s).toUint8Array()}catch(d){if(d instanceof Yl)return Vt("Decoding the base64 bloom filter in existence filter failed ("+d.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw d}try{u=new zi(a,r,o)}catch(d){return Vt(d instanceof Yn?"BloomFilter error: ":"Applying bloom filter failed: ",d),null}return u.ge===0?null:u}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let r=0;return s.forEach((o=>{const a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;e.mightContain(u)||(this.et(t,o,null),r++)})),r}Tt(e){const t=new Map;this.ze.forEach(((o,a)=>{const u=this.ot(a);if(u){if(o.current&&_i(u.target)){const d=new z(u.target.path);this.It(d).has(a)||this.Et(a,d)||this.et(a,d,Re.newNoDocument(d,e))}o.Be&&(t.set(a,o.ke()),o.Ke())}}));let s=Z();this.Je.forEach(((o,a)=>{let u=!0;a.forEachWhile((d=>{const f=this.ot(d);return!f||f.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(s=s.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(e)));const r=new gr(e,t,this.Ze,this.je,s);return this.je=rt(),this.He=Fs(),this.Je=Fs(),this.Ze=new ce(X),r}Ye(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).qe(t.key,s),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.qe(t,1):r.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new za,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new ye(X),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new ye(X),this.He=this.He.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||$("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new za),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Fs(){return new ce(z.comparator)}function Ka(){return new ce(z.comparator)}const Qf={asc:"ASCENDING",desc:"DESCENDING"},Jf={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Yf={and:"AND",or:"OR"};class Xf{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ei(n,e){return n.useProto3Json||cr(e)?e:{value:e}}function nr(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function xc(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Zf(n,e){return nr(n,e.toTimestamp())}function Ge(n){return ne(!!n,49232),G.fromTimestamp((function(t){const s=bt(t);return new le(s.seconds,s.nanos)})(n))}function Ki(n,e){return bi(n,e).canonicalString()}function bi(n,e){const t=(function(r){return new ae(["projects",r.projectId,"databases",r.database])})(n).child("documents");return e===void 0?t:t.child(e)}function Cc(n){const e=ae.fromString(n);return ne(Dc(e),10190,{key:e.toString()}),e}function Ti(n,e){return Ki(n.databaseId,e.path)}function Zr(n,e){const t=Cc(e);if(t.get(1)!==n.databaseId.projectId)throw new q(V.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new q(V.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new z(Rc(t))}function Nc(n,e){return Ki(n.databaseId,e)}function em(n){const e=Cc(n);return e.length===4?ae.emptyPath():Rc(e)}function wi(n){return new ae(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Rc(n){return ne(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Wa(n,e,t){return{name:Ti(n,e),fields:t.value.mapValue.fields}}function tm(n,e){let t;if("targetChange"in e){e.targetChange;const s=(function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:K(39313,{state:f})})(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],o=(function(f,p){return f.useProto3Json?(ne(p===void 0||typeof p=="string",58123),xe.fromBase64String(p||"")):(ne(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),xe.fromUint8Array(p||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&(function(f){const p=f.code===void 0?V.UNKNOWN:Ic(f.code);return new q(p,f.message||"")})(a);t=new Sc(s,r,o,u||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=Zr(n,s.document.name),o=Ge(s.document.updateTime),a=s.document.createTime?Ge(s.document.createTime):G.min(),u=new Oe({mapValue:{fields:s.document.fields}}),d=Re.newFoundDocument(r,o,a,u),f=s.targetIds||[],p=s.removedTargetIds||[];t=new qs(f,p,d.key,d)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=Zr(n,s.document),o=s.readTime?Ge(s.readTime):G.min(),a=Re.newNoDocument(r,o),u=s.removedTargetIds||[];t=new qs([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=Zr(n,s.document),o=s.removedTargetIds||[];t=new qs([],o,r,null)}else{if(!("filter"in e))return K(11601,{Vt:e});{e.filter;const s=e.filter;s.targetId;const{count:r=0,unchangedNames:o}=s,a=new Hf(r,o),u=s.targetId;t=new Ac(u,a)}}return t}function nm(n,e){let t;if(e instanceof ps)t={update:Wa(n,e.key,e.value)};else if(e instanceof qi)t={delete:Ti(n,e.key)};else if(e instanceof Lt)t={update:Wa(n,e.key,e.data),updateMask:hm(e.fieldMask)};else{if(!(e instanceof $f))return K(16599,{dt:e.type});t={verify:Ti(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((s=>(function(o,a){const u=a.transform;if(u instanceof er)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ds)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof fs)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof tr)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw K(20930,{transform:a.transform})})(0,s)))),e.precondition.isNone||(t.currentDocument=(function(r,o){return o.updateTime!==void 0?{updateTime:Zf(r,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:K(27497)})(n,e.precondition)),t}function sm(n,e){return n&&n.length>0?(ne(e!==void 0,14353),n.map((t=>(function(r,o){let a=r.updateTime?Ge(r.updateTime):Ge(o);return a.isEqual(G.min())&&(a=Ge(o)),new Lf(a,r.transformResults||[])})(t,e)))):[]}function rm(n,e){return{documents:[Nc(n,e.path)]}}function im(n,e){const t={structuredQuery:{}},s=e.path;let r;e.collectionGroup!==null?(r=s,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=s.popLast(),t.structuredQuery.from=[{collectionId:s.lastSegment()}]),t.parent=Nc(n,r);const o=(function(f){if(f.length!==0)return kc(Ye.create(f,"and"))})(e.filters);o&&(t.structuredQuery.where=o);const a=(function(f){if(f.length!==0)return f.map((p=>(function(w){return{field:Zt(w.field),direction:lm(w.dir)}})(p)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=Ei(n,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=(function(f){return{before:f.inclusive,values:f.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(f){return{before:!f.inclusive,values:f.position}})(e.endAt)),{ft:t,parent:r}}function om(n){let e=em(n.parent);const t=n.structuredQuery,s=t.from?t.from.length:0;let r=null;if(s>0){ne(s===1,65062);const p=t.from[0];p.allDescendants?r=p.collectionId:e=e.child(p.collectionId)}let o=[];t.where&&(o=(function(_){const w=Pc(_);return w instanceof Ye&&ac(w)?w.getFilters():[w]})(t.where));let a=[];t.orderBy&&(a=(function(_){return _.map((w=>(function(S){return new Zs(en(S.field),(function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(S.direction))})(w)))})(t.orderBy));let u=null;t.limit&&(u=(function(_){let w;return w=typeof _=="object"?_.value:_,cr(w)?null:w})(t.limit));let d=null;t.startAt&&(d=(function(_){const w=!!_.before,A=_.values||[];return new Xs(A,w)})(t.startAt));let f=null;return t.endAt&&(f=(function(_){const w=!_.before,A=_.values||[];return new Xs(A,w)})(t.endAt)),wf(e,r,a,o,u,"F",d,f)}function am(n,e){const t=(function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return K(28987,{purpose:r})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Pc(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const s=en(t.unaryFilter.field);return ge.create(s,"==",{doubleValue:NaN});case"IS_NULL":const r=en(t.unaryFilter.field);return ge.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=en(t.unaryFilter.field);return ge.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=en(t.unaryFilter.field);return ge.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return K(61313);default:return K(60726)}})(n):n.fieldFilter!==void 0?(function(t){return ge.create(en(t.fieldFilter.field),(function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return K(58110);default:return K(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return Ye.create(t.compositeFilter.filters.map((s=>Pc(s))),(function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return K(1026)}})(t.compositeFilter.op))})(n):K(30097,{filter:n})}function lm(n){return Qf[n]}function cm(n){return Jf[n]}function um(n){return Yf[n]}function Zt(n){return{fieldPath:n.canonicalString()}}function en(n){return Se.fromServerFormat(n.fieldPath)}function kc(n){return n instanceof ge?(function(t){if(t.op==="=="){if(Va(t.value))return{unaryFilter:{field:Zt(t.field),op:"IS_NAN"}};if(Da(t.value))return{unaryFilter:{field:Zt(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Va(t.value))return{unaryFilter:{field:Zt(t.field),op:"IS_NOT_NAN"}};if(Da(t.value))return{unaryFilter:{field:Zt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Zt(t.field),op:cm(t.op),value:t.value}}})(n):n instanceof Ye?(function(t){const s=t.getFilters().map((r=>kc(r)));return s.length===1?s[0]:{compositeFilter:{op:um(t.op),filters:s}}})(n):K(54877,{filter:n})}function hm(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Dc(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}function Vc(n){return!!n&&typeof n._toProto=="function"&&n._protoValueType==="ProtoValue"}class ft{constructor(e,t,s,r,o=G.min(),a=G.min(),u=xe.EMPTY_BYTE_STRING,d=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=d}withSequenceNumber(e){return new ft(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ft(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ft(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ft(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class dm{constructor(e){this.yt=e}}function fm(n){const e=om({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?vi(e,e.limit,"L"):e}class mm{constructor(){this.Sn=new pm}addToCollectionParentIndex(e,t){return this.Sn.add(t),k.resolve()}getCollectionParents(e,t){return k.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return k.resolve()}deleteFieldIndex(e,t){return k.resolve()}deleteAllFieldIndexes(e){return k.resolve()}createTargetIndexes(e,t){return k.resolve()}getDocumentsMatchingTarget(e,t){return k.resolve(null)}getIndexType(e,t){return k.resolve(0)}getFieldIndexes(e,t){return k.resolve([])}getNextCollectionGroupToUpdate(e){return k.resolve(null)}getMinOffset(e,t){return k.resolve(Et.min())}getMinOffsetFromCollectionGroup(e,t){return k.resolve(Et.min())}updateCollectionGroup(e,t,s){return k.resolve()}updateIndexEntries(e,t){return k.resolve()}}class pm{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new ye(ae.comparator),o=!r.has(s);return this.index[t]=r.add(s),o}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new ye(ae.comparator)).toArray()}}const Ga={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},jc=41943040;class Ve{static withCacheSize(e){return new Ve(e,Ve.DEFAULT_COLLECTION_PERCENTILE,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}Ve.DEFAULT_COLLECTION_PERCENTILE=10,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ve.DEFAULT=new Ve(jc,Ve.DEFAULT_COLLECTION_PERCENTILE,Ve.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ve.DISABLED=new Ve(-1,0,0);class dn{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new dn(0)}static ar(){return new dn(-1)}}const Qa="LruGarbageCollector",gm=1048576;function Ja([n,e],[t,s]){const r=X(n,t);return r===0?X(e,s):r}class ym{constructor(e){this.Pr=e,this.buffer=new ye(Ja),this.Tr=0}Ir(){return++this.Tr}Er(e){const t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{const s=this.buffer.last();Ja(t,s)<0&&(this.buffer=this.buffer.delete(s).add(t))}}get maxValue(){return this.buffer.last()[0]}}class _m{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){$(Qa,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){vn(t)?$(Qa,"Ignoring IndexedDB error during garbage collection: ",t):await _n(t)}await this.Ar(3e5)}))}}class vm{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next((s=>Math.floor(t/100*s)))}nthSequenceNumber(e,t){if(t===0)return k.resolve(lr.ce);const s=new ym(t);return this.Vr.forEachTarget(e,(r=>s.Er(r.sequenceNumber))).next((()=>this.Vr.mr(e,(r=>s.Er(r))))).next((()=>s.maxValue))}removeTargets(e,t,s){return this.Vr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?($("LruGarbageCollector","Garbage collection skipped; disabled"),k.resolve(Ga)):this.getCacheSize(e).next((s=>s<this.params.cacheSizeCollectionThreshold?($("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ga):this.gr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let s,r,o,a,u,d,f;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((_=>(_>this.params.maximumSequenceNumbersToCollect?($("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),r=this.params.maximumSequenceNumbersToCollect):r=_,a=Date.now(),this.nthSequenceNumber(e,r)))).next((_=>(s=_,u=Date.now(),this.removeTargets(e,s,t)))).next((_=>(o=_,d=Date.now(),this.removeOrphanedDocuments(e,s)))).next((_=>(f=Date.now(),Yt()<=te.DEBUG&&$("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${r} in `+(u-a)+`ms
	Removed ${o} targets in `+(d-u)+`ms
	Removed ${_} documents in `+(f-d)+`ms
Total Duration: ${f-p}ms`),k.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:o,documentsRemoved:_}))))}}function Em(n,e){return new vm(n,e)}class bm{constructor(){this.changes=new Ot((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Re.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return s!==void 0?k.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Tm{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class wm{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(s=r,this.remoteDocumentCache.getEntry(e,t)))).next((r=>(s!==null&&ss(s.mutation,r,Be.empty(),le.now()),r)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.getLocalViewOfDocuments(e,s,Z()).next((()=>s))))}getLocalViewOfDocuments(e,t,s=Z()){const r=kt();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,s).next((o=>{let a=Jn();return o.forEach(((u,d)=>{a=a.insert(u,d.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const s=kt();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,Z())))}populateOverlays(e,t,s){const r=[];return s.forEach((o=>{t.has(o)||r.push(o)})),this.documentOverlayCache.getOverlays(e,r).next((o=>{o.forEach(((a,u)=>{t.set(a,u)}))}))}computeViews(e,t,s,r){let o=rt();const a=ns(),u=(function(){return ns()})();return t.forEach(((d,f)=>{const p=s.get(f.key);r.has(f.key)&&(p===void 0||p.mutation instanceof Lt)?o=o.insert(f.key,f):p!==void 0?(a.set(f.key,p.mutation.getFieldMask()),ss(p.mutation,f,p.mutation.getFieldMask(),le.now())):a.set(f.key,Be.empty())})),this.recalculateAndSaveOverlays(e,o).next((d=>(d.forEach(((f,p)=>a.set(f,p))),t.forEach(((f,p)=>u.set(f,new Tm(p,a.get(f)??null)))),u)))}recalculateAndSaveOverlays(e,t){const s=ns();let r=new ce(((a,u)=>a-u)),o=Z();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const u of a)u.keys().forEach((d=>{const f=t.get(d);if(f===null)return;let p=s.get(d)||Be.empty();p=u.applyToLocalView(f,p),s.set(d,p);const _=(r.get(u.batchId)||Z()).add(d);r=r.insert(u.batchId,_)}))})).next((()=>{const a=[],u=r.getReverseIterator();for(;u.hasNext();){const d=u.getNext(),f=d.key,p=d.value,_=gc();p.forEach((w=>{if(!o.has(w)){const A=Tc(t.get(w),s.get(w));A!==null&&_.set(w,A),o=o.add(w)}})),a.push(this.documentOverlayCache.saveOverlays(e,f,_))}return k.waitFor(a)})).next((()=>s))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((s=>this.recalculateAndSaveOverlays(e,s)))}getDocumentsMatchingQuery(e,t,s,r){return If(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Af(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r)}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next((o=>{const a=r-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-o.size):k.resolve(kt());let u=ls,d=o;return a.next((f=>k.forEach(f,((p,_)=>(u<_.largestBatchId&&(u=_.largestBatchId),o.get(p)?k.resolve():this.remoteDocumentCache.getEntry(e,p).next((w=>{d=d.insert(p,w)}))))).next((()=>this.populateOverlays(e,f,o))).next((()=>this.computeViews(e,d,f,Z()))).next((p=>({batchId:u,changes:pc(p)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new z(t)).next((s=>{let r=Jn();return s.isFoundDocument()&&(r=r.insert(s.key,s)),r}))}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const o=t.collectionGroup;let a=Jn();return this.indexManager.getCollectionParents(e,o).next((u=>k.forEach(u,(d=>{const f=(function(_,w){return new hr(w,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt)})(t,d.child(o));return this.getDocumentsMatchingCollectionQuery(e,f,s,r).next((p=>{p.forEach(((_,w)=>{a=a.insert(_,w)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,s,r){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,o,r)))).next((a=>{o.forEach(((d,f)=>{const p=f.getKey();a.get(p)===null&&(a=a.insert(p,Re.newInvalidDocument(p)))}));let u=Jn();return a.forEach(((d,f)=>{const p=o.get(d);p!==void 0&&ss(p.mutation,f,Be.empty(),le.now()),fr(t,f)&&(u=u.insert(d,f))})),u}))}}class Im{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return k.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,(function(r){return{id:r.id,version:r.version,createTime:Ge(r.createTime)}})(t)),k.resolve()}getNamedQuery(e,t){return k.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,(function(r){return{name:r.name,query:fm(r.bundledQuery),readTime:Ge(r.readTime)}})(t)),k.resolve()}}class Am{constructor(){this.overlays=new ce(z.comparator),this.Lr=new Map}getOverlay(e,t){return k.resolve(this.overlays.get(t))}getOverlays(e,t){const s=kt();return k.forEach(t,(r=>this.getOverlay(e,r).next((o=>{o!==null&&s.set(r,o)})))).next((()=>s))}saveOverlays(e,t,s){return s.forEach(((r,o)=>{this.bt(e,t,o)})),k.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.Lr.get(s);return r!==void 0&&(r.forEach((o=>this.overlays=this.overlays.remove(o))),this.Lr.delete(s)),k.resolve()}getOverlaysForCollection(e,t,s){const r=kt(),o=t.length+1,a=new z(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const d=u.getNext().value,f=d.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===o&&d.largestBatchId>s&&r.set(d.getKey(),d)}return k.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let o=new ce(((f,p)=>f-p));const a=this.overlays.getIterator();for(;a.hasNext();){const f=a.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>s){let p=o.get(f.largestBatchId);p===null&&(p=kt(),o=o.insert(f.largestBatchId,p)),p.set(f.getKey(),f)}}const u=kt(),d=o.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach(((f,p)=>u.set(f,p))),!(u.size()>=r)););return k.resolve(u)}bt(e,t,s){const r=this.overlays.get(s.key);if(r!==null){const a=this.Lr.get(r.largestBatchId).delete(s.key);this.Lr.set(r.largestBatchId,a)}this.overlays=this.overlays.insert(s.key,new qf(t,s));let o=this.Lr.get(t);o===void 0&&(o=Z(),this.Lr.set(t,o)),this.Lr.set(t,o.add(s.key))}}class Sm{constructor(){this.sessionToken=xe.EMPTY_BYTE_STRING}getSessionToken(e){return k.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,k.resolve()}}class Wi{constructor(){this.kr=new ye(Te.Kr),this.qr=new ye(Te.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){const s=new Te(e,t);this.kr=this.kr.add(s),this.qr=this.qr.add(s)}$r(e,t){e.forEach((s=>this.addReference(s,t)))}removeReference(e,t){this.Wr(new Te(e,t))}Qr(e,t){e.forEach((s=>this.removeReference(s,t)))}Gr(e){const t=new z(new ae([])),s=new Te(t,e),r=new Te(t,e+1),o=[];return this.qr.forEachInRange([s,r],(a=>{this.Wr(a),o.push(a.key)})),o}zr(){this.kr.forEach((e=>this.Wr(e)))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const t=new z(new ae([])),s=new Te(t,e),r=new Te(t,e+1);let o=Z();return this.qr.forEachInRange([s,r],(a=>{o=o.add(a.key)})),o}containsKey(e){const t=new Te(e,0),s=this.kr.firstAfterOrEqual(t);return s!==null&&e.isEqual(s.key)}}class Te{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return z.comparator(e.key,t.key)||X(e.Hr,t.Hr)}static Ur(e,t){return X(e.Hr,t.Hr)||z.comparator(e.key,t.key)}}class xm{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new ye(Te.Kr)}checkEmpty(e){return k.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,s,r){const o=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Uf(o,t,s,r);this.mutationQueue.push(a);for(const u of r)this.Jr=this.Jr.add(new Te(u.key,o)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return k.resolve(a)}lookupMutationBatch(e,t){return k.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.Xr(s),o=r<0?0:r;return k.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return k.resolve(this.mutationQueue.length===0?Oi:this.Yn-1)}getAllMutationBatches(e){return k.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new Te(t,0),r=new Te(t,Number.POSITIVE_INFINITY),o=[];return this.Jr.forEachInRange([s,r],(a=>{const u=this.Zr(a.Hr);o.push(u)})),k.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new ye(X);return t.forEach((r=>{const o=new Te(r,0),a=new Te(r,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([o,a],(u=>{s=s.add(u.Hr)}))})),k.resolve(this.Yr(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let o=s;z.isDocumentKey(o)||(o=o.child(""));const a=new Te(new z(o),0);let u=new ye(X);return this.Jr.forEachWhile((d=>{const f=d.key.path;return!!s.isPrefixOf(f)&&(f.length===r&&(u=u.add(d.Hr)),!0)}),a),k.resolve(this.Yr(u))}Yr(e){const t=[];return e.forEach((s=>{const r=this.Zr(s);r!==null&&t.push(r)})),t}removeMutationBatch(e,t){ne(this.ei(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let s=this.Jr;return k.forEach(t.mutations,(r=>{const o=new Te(r.key,t.batchId);return s=s.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Jr=s}))}nr(e){}containsKey(e,t){const s=new Te(t,0),r=this.Jr.firstAfterOrEqual(s);return k.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,k.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Cm{constructor(e){this.ti=e,this.docs=(function(){return new ce(z.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),o=r?r.size:0,a=this.ti(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return k.resolve(s?s.document.mutableCopy():Re.newInvalidDocument(t))}getEntries(e,t){let s=rt();return t.forEach((r=>{const o=this.docs.get(r);s=s.insert(r,o?o.document.mutableCopy():Re.newInvalidDocument(r))})),k.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let o=rt();const a=t.path,u=new z(a.child("__id-9223372036854775808__")),d=this.docs.getIteratorFrom(u);for(;d.hasNext();){const{key:f,value:{document:p}}=d.getNext();if(!a.isPrefixOf(f.path))break;f.path.length>a.length+1||Zd(Xd(p),s)<=0||(r.has(p.key)||fr(t,p))&&(o=o.insert(p.key,p.mutableCopy()))}return k.resolve(o)}getAllFromCollectionGroup(e,t,s,r){K(9500)}ni(e,t){return k.forEach(this.docs,(s=>t(s)))}newChangeBuffer(e){return new Nm(this)}getSize(e){return k.resolve(this.size)}}class Nm extends bm{constructor(e){super(),this.Mr=e}applyChanges(e){const t=[];return this.changes.forEach(((s,r)=>{r.isValidDocument()?t.push(this.Mr.addEntry(e,r)):this.Mr.removeEntry(s)})),k.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class Rm{constructor(e){this.persistence=e,this.ri=new Ot((t=>Bi(t)),$i),this.lastRemoteSnapshotVersion=G.min(),this.highestTargetId=0,this.ii=0,this.si=new Wi,this.targetCount=0,this.oi=dn._r()}forEachTarget(e,t){return this.ri.forEach(((s,r)=>t(r))),k.resolve()}getLastRemoteSnapshotVersion(e){return k.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return k.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),k.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.ii&&(this.ii=t),k.resolve()}lr(e){this.ri.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.oi=new dn(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,k.resolve()}updateTargetData(e,t){return this.lr(t),k.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,k.resolve()}removeTargets(e,t,s){let r=0;const o=[];return this.ri.forEach(((a,u)=>{u.sequenceNumber<=t&&s.get(u.targetId)===null&&(this.ri.delete(a),o.push(this.removeMatchingKeysForTargetId(e,u.targetId)),r++)})),k.waitFor(o).next((()=>r))}getTargetCount(e){return k.resolve(this.targetCount)}getTargetData(e,t){const s=this.ri.get(t)||null;return k.resolve(s)}addMatchingKeys(e,t,s){return this.si.$r(t,s),k.resolve()}removeMatchingKeys(e,t,s){this.si.Qr(t,s);const r=this.persistence.referenceDelegate,o=[];return r&&t.forEach((a=>{o.push(r.markPotentiallyOrphaned(e,a))})),k.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),k.resolve()}getMatchingKeysForTargetId(e,t){const s=this.si.jr(t);return k.resolve(s)}containsKey(e,t){return k.resolve(this.si.containsKey(t))}}class Fc{constructor(e,t){this._i={},this.overlays={},this.ai=new lr(0),this.ui=!1,this.ui=!0,this.ci=new Sm,this.referenceDelegate=e(this),this.li=new Rm(this),this.indexManager=new mm,this.remoteDocumentCache=(function(r){return new Cm(r)})((s=>this.referenceDelegate.hi(s))),this.serializer=new dm(t),this.Pi=new Im(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Am,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this._i[e.toKey()];return s||(s=new xm(t,this.referenceDelegate),this._i[e.toKey()]=s),s}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,s){$("MemoryPersistence","Starting transaction:",e);const r=new Pm(this.ai.next());return this.referenceDelegate.Ti(),s(r).next((o=>this.referenceDelegate.Ii(r).next((()=>o)))).toPromise().then((o=>(r.raiseOnCommittedEvent(),o)))}Ei(e,t){return k.or(Object.values(this._i).map((s=>()=>s.containsKey(e,t))))}}class Pm extends tf{constructor(e){super(),this.currentSequenceNumber=e}}class Gi{constructor(e){this.persistence=e,this.Ri=new Wi,this.Ai=null}static Vi(e){return new Gi(e)}get di(){if(this.Ai)return this.Ai;throw K(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.di.delete(s.toString()),k.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.di.add(s.toString()),k.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),k.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach((r=>this.di.add(r.toString())));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next((r=>{r.forEach((o=>this.di.add(o.toString())))})).next((()=>s.removeTargetData(e,t)))}Ti(){this.Ai=new Set}Ii(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return k.forEach(this.di,(s=>{const r=z.fromPath(s);return this.mi(e,r).next((o=>{o||t.removeEntry(r,G.min())}))})).next((()=>(this.Ai=null,t.apply(e))))}updateLimboDocument(e,t){return this.mi(e,t).next((s=>{s?this.di.delete(t.toString()):this.di.add(t.toString())}))}hi(e){return 0}mi(e,t){return k.or([()=>k.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class sr{constructor(e,t){this.persistence=e,this.fi=new Ot((s=>rf(s.path)),((s,r)=>s.isEqual(r))),this.garbageCollector=Em(this,t)}static Vi(e,t){return new sr(e,t)}Ti(){}Ii(e){return k.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){const t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next((s=>t.next((r=>s+r))))}pr(e){let t=0;return this.mr(e,(s=>{t++})).next((()=>t))}mr(e,t){return k.forEach(this.fi,((s,r)=>this.wr(e,s,r).next((o=>o?k.resolve():t(r)))))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const r=this.persistence.getRemoteDocumentCache(),o=r.newChangeBuffer();return r.ni(e,(a=>this.wr(e,a,t).next((u=>{u||(s++,o.removeEntry(a,G.min()))})))).next((()=>o.apply(e))).next((()=>s))}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),k.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.fi.set(s,e.currentSequenceNumber),k.resolve()}removeReference(e,t,s){return this.fi.set(s,e.currentSequenceNumber),k.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),k.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Bs(e.data.value)),t}wr(e,t,s){return k.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.fi.get(t);return k.resolve(r!==void 0&&r>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Qi{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Ts=s,this.Is=r}static Es(e,t){let s=Z(),r=Z();for(const o of t.docChanges)switch(o.type){case 0:s=s.add(o.doc.key);break;case 1:r=r.add(o.doc.key)}return new Qi(e,t.fromCache,s,r)}}class km{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Dm{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=(function(){return vh()?8:nf(yh())>0?6:4})()}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,r){const o={result:null};return this.gs(e,t).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ps(e,t,r,s).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new km;return this.ys(e,t,a).next((u=>{if(o.result=u,this.As)return this.ws(e,t,a,u.size)}))})).next((()=>o.result))}ws(e,t,s,r){return s.documentReadCount<this.Vs?(Yt()<=te.DEBUG&&$("QueryEngine","SDK will not create cache indexes for query:",Xt(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),k.resolve()):(Yt()<=te.DEBUG&&$("QueryEngine","Query:",Xt(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.ds*r?(Yt()<=te.DEBUG&&$("QueryEngine","The SDK decides to create cache indexes for query:",Xt(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ke(t))):k.resolve())}gs(e,t){if(La(t))return k.resolve(null);let s=Ke(t);return this.indexManager.getIndexType(e,s).next((r=>r===0?null:(t.limit!==null&&r===1&&(t=vi(t,null,"F"),s=Ke(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next((o=>{const a=Z(...o);return this.fs.getDocuments(e,a).next((u=>this.indexManager.getMinOffset(e,s).next((d=>{const f=this.bs(t,u);return this.Ss(t,f,a,d.readTime)?this.gs(e,vi(t,null,"F")):this.Ds(e,f,t,d)}))))})))))}ps(e,t,s,r){return La(t)||r.isEqual(G.min())?k.resolve(null):this.fs.getDocuments(e,s).next((o=>{const a=this.bs(t,o);return this.Ss(t,a,s,r)?k.resolve(null):(Yt()<=te.DEBUG&&$("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Xt(t)),this.Ds(e,a,t,Yd(r,ls)).next((u=>u)))}))}bs(e,t){let s=new ye(fc(e));return t.forEach(((r,o)=>{fr(e,o)&&(s=s.add(o))})),s}Ss(e,t,s,r){if(e.limit===null)return!1;if(s.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(r)>0)}ys(e,t,s){return Yt()<=te.DEBUG&&$("QueryEngine","Using full collection scan to execute query:",Xt(t)),this.fs.getDocumentsMatchingQuery(e,t,Et.min(),s)}Ds(e,t,s,r){return this.fs.getDocumentsMatchingQuery(e,s,r).next((o=>(t.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const Ji="LocalStore",Vm=3e8;class jm{constructor(e,t,s,r){this.persistence=e,this.Cs=t,this.serializer=r,this.vs=new ce(X),this.Fs=new Ot((o=>Bi(o)),$i),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(s)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new wm(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.vs)))}}function Fm(n,e,t,s){return new jm(n,e,t,s)}async function Oc(n,e){const t=Q(n);return await t.persistence.runTransaction("Handle user change","readonly",(s=>{let r;return t.mutationQueue.getAllMutationBatches(s).next((o=>(r=o,t.Os(e),t.mutationQueue.getAllMutationBatches(s)))).next((o=>{const a=[],u=[];let d=Z();for(const f of r){a.push(f.batchId);for(const p of f.mutations)d=d.add(p.key)}for(const f of o){u.push(f.batchId);for(const p of f.mutations)d=d.add(p.key)}return t.localDocuments.getDocuments(s,d).next((f=>({Ns:f,removedBatchIds:a,addedBatchIds:u})))}))}))}function Om(n,e){const t=Q(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(s=>{const r=e.batch.keys(),o=t.xs.newChangeBuffer({trackRemovals:!0});return(function(u,d,f,p){const _=f.batch,w=_.keys();let A=k.resolve();return w.forEach((S=>{A=A.next((()=>p.getEntry(d,S))).next((N=>{const D=f.docVersions.get(S);ne(D!==null,48541),N.version.compareTo(D)<0&&(_.applyToRemoteDocument(N,f),N.isValidDocument()&&(N.setReadTime(f.commitVersion),p.addEntry(N)))}))})),A.next((()=>u.mutationQueue.removeMutationBatch(d,_)))})(t,s,e,o).next((()=>o.apply(s))).next((()=>t.mutationQueue.performConsistencyCheck(s))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(s,r,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,(function(u){let d=Z();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(d=d.add(u.batch.mutations[f].key));return d})(e)))).next((()=>t.localDocuments.getDocuments(s,r)))}))}function Lc(n){const e=Q(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.li.getLastRemoteSnapshotVersion(t)))}function Lm(n,e){const t=Q(n),s=e.snapshotVersion;let r=t.vs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=t.xs.newChangeBuffer({trackRemovals:!0});r=t.vs;const u=[];e.targetChanges.forEach(((p,_)=>{const w=r.get(_);if(!w)return;u.push(t.li.removeMatchingKeys(o,p.removedDocuments,_).next((()=>t.li.addMatchingKeys(o,p.addedDocuments,_))));let A=w.withSequenceNumber(o.currentSequenceNumber);e.targetMismatches.get(_)!==null?A=A.withResumeToken(xe.EMPTY_BYTE_STRING,G.min()).withLastLimboFreeSnapshotVersion(G.min()):p.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(p.resumeToken,s)),r=r.insert(_,A),(function(N,D,O){return N.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=Vm?!0:O.addedDocuments.size+O.modifiedDocuments.size+O.removedDocuments.size>0})(w,A,p)&&u.push(t.li.updateTargetData(o,A))}));let d=rt(),f=Z();if(e.documentUpdates.forEach((p=>{e.resolvedLimboDocuments.has(p)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(o,p))})),u.push(Mm(o,a,e.documentUpdates).next((p=>{d=p.Bs,f=p.Ls}))),!s.isEqual(G.min())){const p=t.li.getLastRemoteSnapshotVersion(o).next((_=>t.li.setTargetsMetadata(o,o.currentSequenceNumber,s)));u.push(p)}return k.waitFor(u).next((()=>a.apply(o))).next((()=>t.localDocuments.getLocalViewOfDocuments(o,d,f))).next((()=>d))})).then((o=>(t.vs=r,o)))}function Mm(n,e,t){let s=Z(),r=Z();return t.forEach((o=>s=s.add(o))),e.getEntries(n,s).next((o=>{let a=rt();return t.forEach(((u,d)=>{const f=o.get(u);d.isFoundDocument()!==f.isFoundDocument()&&(r=r.add(u)),d.isNoDocument()&&d.version.isEqual(G.min())?(e.removeEntry(u,d.readTime),a=a.insert(u,d)):!f.isValidDocument()||d.version.compareTo(f.version)>0||d.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(d),a=a.insert(u,d)):$(Ji,"Ignoring outdated watch update for ",u,". Current version:",f.version," Watch version:",d.version)})),{Bs:a,Ls:r}}))}function Bm(n,e){const t=Q(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(s=>(e===void 0&&(e=Oi),t.mutationQueue.getNextMutationBatchAfterBatchId(s,e))))}function $m(n,e){const t=Q(n);return t.persistence.runTransaction("Allocate target","readwrite",(s=>{let r;return t.li.getTargetData(s,e).next((o=>o?(r=o,k.resolve(r)):t.li.allocateTargetId(s).next((a=>(r=new ft(e,a,"TargetPurposeListen",s.currentSequenceNumber),t.li.addTargetData(s,r).next((()=>r)))))))})).then((s=>{const r=t.vs.get(s.targetId);return(r===null||s.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.vs=t.vs.insert(s.targetId,s),t.Fs.set(e,s.targetId)),s}))}async function Ii(n,e,t){const s=Q(n),r=s.vs.get(e),o=t?"readwrite":"readwrite-primary";try{t||await s.persistence.runTransaction("Release target",o,(a=>s.persistence.referenceDelegate.removeTarget(a,r)))}catch(a){if(!vn(a))throw a;$(Ji,`Failed to update sequence numbers for target ${e}: ${a}`)}s.vs=s.vs.remove(e),s.Fs.delete(r.target)}function Ya(n,e,t){const s=Q(n);let r=G.min(),o=Z();return s.persistence.runTransaction("Execute query","readwrite",(a=>(function(d,f,p){const _=Q(d),w=_.Fs.get(p);return w!==void 0?k.resolve(_.vs.get(w)):_.li.getTargetData(f,p)})(s,a,Ke(e)).next((u=>{if(u)return r=u.lastLimboFreeSnapshotVersion,s.li.getMatchingKeysForTargetId(a,u.targetId).next((d=>{o=d}))})).next((()=>s.Cs.getDocumentsMatchingQuery(a,e,t?r:G.min(),t?o:Z()))).next((u=>(Um(s,xf(e),u),{documents:u,ks:o})))))}function Um(n,e,t){let s=n.Ms.get(e)||G.min();t.forEach(((r,o)=>{o.readTime.compareTo(s)>0&&(s=o.readTime)})),n.Ms.set(e,s)}class Xa{constructor(){this.activeTargetIds=Df()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class qm{constructor(){this.vo=new Xa,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,s){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new Xa,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Hm{Mo(e){}shutdown(){}}const Za="ConnectivityMonitor";class el{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){$(Za,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){$(Za,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Os=null;function Ai(){return Os===null?Os=(function(){return 268435456+Math.round(2147483648*Math.random())})():Os++,"0x"+Os.toString(16)}const ei="RestConnection",zm={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class Km{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${s}/databases/${r}`,this.$o=this.databaseId.database===Js?`project_id=${s}`:`project_id=${s}&database_id=${r}`}Wo(e,t,s,r,o){const a=Ai(),u=this.Qo(e,t.toUriEncodedString());$(ei,`Sending RPC '${e}' ${a}:`,u,s);const d={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(d,r,o);const{host:f}=new URL(u),p=ki(f);return this.zo(e,u,d,s,p).then((_=>($(ei,`Received RPC '${e}' ${a}: `,_),_)),(_=>{throw Vt(ei,`RPC '${e}' ${a} failed with error: `,_,"url: ",u,"request:",s),_}))}jo(e,t,s,r,o,a){return this.Wo(e,t,s,r,o)}Go(e,t,s){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+yn})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((r,o)=>e[o]=r)),s&&s.headers.forEach(((r,o)=>e[o]=r))}Qo(e,t){const s=zm[e];let r=`${this.qo}/v1/${t}:${s}`;return this.databaseInfo.apiKey&&(r=`${r}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),r}terminate(){}}class Wm{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}const Ce="WebChannelConnection",Gn=(n,e,t)=>{n.listen(e,(s=>{try{t(s)}catch(r){setTimeout((()=>{throw r}),0)}}))};class nn extends Km{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!nn.c_){const e=ql();Gn(e,Ul.STAT_EVENT,(t=>{t.stat===fi.PROXY?$(Ce,"STAT_EVENT: detected buffering proxy"):t.stat===fi.NOPROXY&&$(Ce,"STAT_EVENT: detected no buffering proxy")})),nn.c_=!0}}zo(e,t,s,r,o){const a=Ai();return new Promise(((u,d)=>{const f=new Bl;f.setWithCredentials(!0),f.listenOnce($l.COMPLETE,(()=>{try{switch(f.getLastErrorCode()){case Ms.NO_ERROR:const _=f.getResponseJson();$(Ce,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(_)),u(_);break;case Ms.TIMEOUT:$(Ce,`RPC '${e}' ${a} timed out`),d(new q(V.DEADLINE_EXCEEDED,"Request time out"));break;case Ms.HTTP_ERROR:const w=f.getStatus();if($(Ce,`RPC '${e}' ${a} failed with status:`,w,"response text:",f.getResponseText()),w>0){let A=f.getResponseJson();Array.isArray(A)&&(A=A[0]);const S=A?.error;if(S&&S.status&&S.message){const N=(function(O){const R=O.toLowerCase().replace(/_/g,"-");return Object.values(V).indexOf(R)>=0?R:V.UNKNOWN})(S.status);d(new q(N,S.message))}else d(new q(V.UNKNOWN,"Server responded with status "+f.getStatus()))}else d(new q(V.UNAVAILABLE,"Connection failed."));break;default:K(9055,{l_:e,streamId:a,h_:f.getLastErrorCode(),P_:f.getLastError()})}}finally{$(Ce,`RPC '${e}' ${a} completed.`)}}));const p=JSON.stringify(r);$(Ce,`RPC '${e}' ${a} sending request:`,r),f.send(t,"POST",p,s,15)}))}T_(e,t,s){const r=Ai(),o=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=this.createWebChannelTransport(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Go(u.initMessageHeaders,t,s),u.encodeInitMessageHeaders=!0;const f=o.join("");$(Ce,`Creating RPC '${e}' stream ${r}: ${f}`,u);const p=a.createWebChannel(f,u);this.I_(p);let _=!1,w=!1;const A=new Wm({Ho:S=>{w?$(Ce,`Not sending because RPC '${e}' stream ${r} is closed:`,S):(_||($(Ce,`Opening RPC '${e}' stream ${r} transport.`),p.open(),_=!0),$(Ce,`RPC '${e}' stream ${r} sending:`,S),p.send(S))},Jo:()=>p.close()});return Gn(p,Qn.EventType.OPEN,(()=>{w||($(Ce,`RPC '${e}' stream ${r} transport opened.`),A.i_())})),Gn(p,Qn.EventType.CLOSE,(()=>{w||(w=!0,$(Ce,`RPC '${e}' stream ${r} transport closed`),A.o_(),this.E_(p))})),Gn(p,Qn.EventType.ERROR,(S=>{w||(w=!0,Vt(Ce,`RPC '${e}' stream ${r} transport errored. Name:`,S.name,"Message:",S.message),A.o_(new q(V.UNAVAILABLE,"The operation could not be completed")))})),Gn(p,Qn.EventType.MESSAGE,(S=>{if(!w){const N=S.data[0];ne(!!N,16349);const D=N,O=D?.error||D[0]?.error;if(O){$(Ce,`RPC '${e}' stream ${r} received error:`,O);const R=O.status;let P=(function(H){const b=de[H];if(b!==void 0)return Ic(b)})(R),U=O.message;R==="NOT_FOUND"&&U.includes("database")&&U.includes("does not exist")&&U.includes(this.databaseId.database)&&Vt(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),P===void 0&&(P=V.INTERNAL,U="Unknown error status: "+R+" with message "+O.message),w=!0,A.o_(new q(P,U)),p.close()}else $(Ce,`RPC '${e}' stream ${r} received:`,N),A.__(N)}})),nn.u_(),setTimeout((()=>{A.s_()}),0),A}terminate(){this.a_.forEach((e=>e.close())),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter((t=>t===e))}Go(e,t,s){super.Go(e,t,s),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return Hl()}}function Gm(n){return new nn(n)}function ti(){return typeof document<"u"?document:null}function yr(n){return new Xf(n,!0)}nn.c_=!1;class Mc{constructor(e,t,s=1e3,r=1.5,o=6e4){this.Ci=e,this.timerId=t,this.R_=s,this.A_=r,this.V_=o,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const t=Math.floor(this.d_+this.y_()),s=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-s);r>0&&$("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),e()))),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}const tl="PersistentStream";class Bc{constructor(e,t,s,r,o,a,u,d){this.Ci=e,this.b_=s,this.S_=r,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=d,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Mc(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,(()=>this.k_())))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===V.RESOURCE_EXHAUSTED?(st(t.toString()),st("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===V.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([s,r])=>{this.D_===t&&this.G_(s,r)}),(s=>{e((()=>{const r=new q(V.UNKNOWN,"Fetching auth token failed: "+s.message);return this.z_(r)}))}))}G_(e,t){const s=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo((()=>{s((()=>this.listener.Zo()))})),this.stream.Yo((()=>{s((()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.Yo())))})),this.stream.t_((r=>{s((()=>this.z_(r)))})),this.stream.onMessage((r=>{s((()=>++this.F_==1?this.H_(r):this.onNext(r)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return $(tl,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget((()=>this.D_===e?t():($(tl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Qm extends Bc{constructor(e,t,s,r,o,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,a),this.serializer=o}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=tm(this.serializer,e),s=(function(o){if(!("targetChange"in o))return G.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?G.min():a.readTime?Ge(a.readTime):G.min()})(e);return this.listener.J_(t,s)}Z_(e){const t={};t.database=wi(this.serializer),t.addTarget=(function(o,a){let u;const d=a.target;if(u=_i(d)?{documents:rm(o,d)}:{query:im(o,d).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=xc(o,a.resumeToken);const f=Ei(o,a.expectedCount);f!==null&&(u.expectedCount=f)}else if(a.snapshotVersion.compareTo(G.min())>0){u.readTime=nr(o,a.snapshotVersion.toTimestamp());const f=Ei(o,a.expectedCount);f!==null&&(u.expectedCount=f)}return u})(this.serializer,e);const s=am(this.serializer,e);s&&(t.labels=s),this.K_(t)}X_(e){const t={};t.database=wi(this.serializer),t.removeTarget=e,this.K_(t)}}class Jm extends Bc{constructor(e,t,s,r,o,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,a),this.serializer=o}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return ne(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ne(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ne(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=sm(e.writeResults,e.commitTime),s=Ge(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=wi(this.serializer),this.K_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((s=>nm(this.serializer,s)))};this.K_(t)}}class Ym{}class Xm extends Ym{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new q(V.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Wo(e,bi(t,s),r,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new q(V.UNKNOWN,o.toString())}))}jo(e,t,s,r,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,u])=>this.connection.jo(e,bi(t,s),r,a,u,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new q(V.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}function Zm(n,e,t,s){return new Xm(n,e,t,s)}class ep{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(st(t),this.aa=!1):$("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const jt="RemoteStore";class tp{constructor(e,t,s,r,o){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=o,this.Aa.Mo((a=>{s.enqueueAndForget((async()=>{Mt(this)&&($(jt,"Restarting streams for network reachability change."),await(async function(d){const f=Q(d);f.Ea.add(4),await ys(f),f.Va.set("Unknown"),f.Ea.delete(4),await _r(f)})(this))}))})),this.Va=new ep(s,r)}}async function _r(n){if(Mt(n))for(const e of n.Ra)await e(!0)}async function ys(n){for(const e of n.Ra)await e(!1)}function $c(n,e){const t=Q(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),eo(t)?Zi(t):En(t).O_()&&Xi(t,e))}function Yi(n,e){const t=Q(n),s=En(t);t.Ia.delete(e),s.O_()&&Uc(t,e),t.Ia.size===0&&(s.O_()?s.L_():Mt(t)&&t.Va.set("Unknown"))}function Xi(n,e){if(n.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(G.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}En(n).Z_(e)}function Uc(n,e){n.da.$e(e),En(n).X_(e)}function Zi(n){n.da=new Gf({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),En(n).start(),n.Va.ua()}function eo(n){return Mt(n)&&!En(n).x_()&&n.Ia.size>0}function Mt(n){return Q(n).Ea.size===0}function qc(n){n.da=void 0}async function np(n){n.Va.set("Online")}async function sp(n){n.Ia.forEach(((e,t)=>{Xi(n,e)}))}async function rp(n,e){qc(n),eo(n)?(n.Va.ha(e),Zi(n)):n.Va.set("Unknown")}async function ip(n,e,t){if(n.Va.set("Online"),e instanceof Sc&&e.state===2&&e.cause)try{await(async function(r,o){const a=o.cause;for(const u of o.targetIds)r.Ia.has(u)&&(await r.remoteSyncer.rejectListen(u,a),r.Ia.delete(u),r.da.removeTarget(u))})(n,e)}catch(s){$(jt,"Failed to remove targets %s: %s ",e.targetIds.join(","),s),await rr(n,s)}else if(e instanceof qs?n.da.Xe(e):e instanceof Ac?n.da.st(e):n.da.tt(e),!t.isEqual(G.min()))try{const s=await Lc(n.localStore);t.compareTo(s)>=0&&await(function(o,a){const u=o.da.Tt(a);return u.targetChanges.forEach(((d,f)=>{if(d.resumeToken.approximateByteSize()>0){const p=o.Ia.get(f);p&&o.Ia.set(f,p.withResumeToken(d.resumeToken,a))}})),u.targetMismatches.forEach(((d,f)=>{const p=o.Ia.get(d);if(!p)return;o.Ia.set(d,p.withResumeToken(xe.EMPTY_BYTE_STRING,p.snapshotVersion)),Uc(o,d);const _=new ft(p.target,d,f,p.sequenceNumber);Xi(o,_)})),o.remoteSyncer.applyRemoteEvent(u)})(n,t)}catch(s){$(jt,"Failed to raise snapshot:",s),await rr(n,s)}}async function rr(n,e,t){if(!vn(e))throw e;n.Ea.add(1),await ys(n),n.Va.set("Offline"),t||(t=()=>Lc(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{$(jt,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await _r(n)}))}function Hc(n,e){return e().catch((t=>rr(n,t,e)))}async function vr(n){const e=Q(n),t=It(e);let s=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Oi;for(;op(e);)try{const r=await Bm(e.localStore,s);if(r===null){e.Ta.length===0&&t.L_();break}s=r.batchId,ap(e,r)}catch(r){await rr(e,r)}zc(e)&&Kc(e)}function op(n){return Mt(n)&&n.Ta.length<10}function ap(n,e){n.Ta.push(e);const t=It(n);t.O_()&&t.Y_&&t.ea(e.mutations)}function zc(n){return Mt(n)&&!It(n).x_()&&n.Ta.length>0}function Kc(n){It(n).start()}async function lp(n){It(n).ra()}async function cp(n){const e=It(n);for(const t of n.Ta)e.ea(t.mutations)}async function up(n,e,t){const s=n.Ta.shift(),r=Hi.from(s,e,t);await Hc(n,(()=>n.remoteSyncer.applySuccessfulWrite(r))),await vr(n)}async function hp(n,e){e&&It(n).Y_&&await(async function(s,r){if((function(a){return zf(a)&&a!==V.ABORTED})(r.code)){const o=s.Ta.shift();It(s).B_(),await Hc(s,(()=>s.remoteSyncer.rejectFailedWrite(o.batchId,r))),await vr(s)}})(n,e),zc(n)&&Kc(n)}async function nl(n,e){const t=Q(n);t.asyncQueue.verifyOperationInProgress(),$(jt,"RemoteStore received new credentials");const s=Mt(t);t.Ea.add(3),await ys(t),s&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await _r(t)}async function dp(n,e){const t=Q(n);e?(t.Ea.delete(2),await _r(t)):e||(t.Ea.add(2),await ys(t),t.Va.set("Unknown"))}function En(n){return n.ma||(n.ma=(function(t,s,r){const o=Q(t);return o.sa(),new Qm(s,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,r)})(n.datastore,n.asyncQueue,{Zo:np.bind(null,n),Yo:sp.bind(null,n),t_:rp.bind(null,n),J_:ip.bind(null,n)}),n.Ra.push((async e=>{e?(n.ma.B_(),eo(n)?Zi(n):n.Va.set("Unknown")):(await n.ma.stop(),qc(n))}))),n.ma}function It(n){return n.fa||(n.fa=(function(t,s,r){const o=Q(t);return o.sa(),new Jm(s,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,r)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),Yo:lp.bind(null,n),t_:hp.bind(null,n),ta:cp.bind(null,n),na:up.bind(null,n)}),n.Ra.push((async e=>{e?(n.fa.B_(),await vr(n)):(await n.fa.stop(),n.Ta.length>0&&($(jt,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class to{constructor(e,t,s,r,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=o,this.deferred=new _t,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,o){const a=Date.now()+s,u=new to(e,t,a,r,o);return u.start(s),u}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new q(V.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function no(n,e){if(st("AsyncQueue",`${e}: ${n}`),vn(n))return new q(V.UNAVAILABLE,`${e}: ${n}`);throw n}class sn{static emptySet(e){return new sn(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||z.comparator(t.key,s.key):(t,s)=>z.comparator(t.key,s.key),this.keyedMap=Jn(),this.sortedSet=new ce(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,s)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof sn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,o=s.getNext().key;if(!r.isEqual(o))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const s=new sn;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}class sl{constructor(){this.ga=new ce(z.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?e.type!==0&&s.type===3?this.ga=this.ga.insert(t,e):e.type===3&&s.type!==1?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.ga=this.ga.remove(t):e.type===1&&s.type===2?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):K(63341,{Vt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,s)=>{e.push(s)})),e}}class fn{constructor(e,t,s,r,o,a,u,d,f){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=d,this.hasCachedResults=f}static fromInitialDocuments(e,t,s,r,o){const a=[];return t.forEach((u=>{a.push({type:0,doc:u})})),new fn(e,t,sn.emptySet(t),a,s,r,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&dr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}class fp{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some((e=>e.Da()))}}class mp{constructor(){this.queries=rl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,s){const r=Q(t),o=r.queries;r.queries=rl(),o.forEach(((a,u)=>{for(const d of u.ba)d.onError(s)}))})(this,new q(V.ABORTED,"Firestore shutting down"))}}function rl(){return new Ot((n=>dc(n)),dr)}async function pp(n,e){const t=Q(n);let s=3;const r=e.query;let o=t.queries.get(r);o?!o.Sa()&&e.Da()&&(s=2):(o=new fp,s=e.Da()?0:1);try{switch(s){case 0:o.wa=await t.onListen(r,!0);break;case 1:o.wa=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(a){const u=no(a,`Initialization of query '${Xt(e.query)}' failed`);return void e.onError(u)}t.queries.set(r,o),o.ba.push(e),e.va(t.onlineState),o.wa&&e.Fa(o.wa)&&so(t)}async function gp(n,e){const t=Q(n),s=e.query;let r=3;const o=t.queries.get(s);if(o){const a=o.ba.indexOf(e);a>=0&&(o.ba.splice(a,1),o.ba.length===0?r=e.Da()?0:1:!o.Sa()&&e.Da()&&(r=2))}switch(r){case 0:return t.queries.delete(s),t.onUnlisten(s,!0);case 1:return t.queries.delete(s),t.onUnlisten(s,!1);case 2:return t.onLastRemoteStoreUnlisten(s);default:return}}function yp(n,e){const t=Q(n);let s=!1;for(const r of e){const o=r.query,a=t.queries.get(o);if(a){for(const u of a.ba)u.Fa(r)&&(s=!0);a.wa=r}}s&&so(t)}function _p(n,e,t){const s=Q(n),r=s.queries.get(e);if(r)for(const o of r.ba)o.onError(t);s.queries.delete(e)}function so(n){n.Ca.forEach((e=>{e.next()}))}var Si,il;(il=Si||(Si={})).Ma="default",il.Cache="cache";class vp{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const s=[];for(const r of e.docChanges)r.type!==3&&s.push(r);e=new fn(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const s=t!=="Offline";return(!this.options.Ka||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=fn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Si.Cache}}class Wc{constructor(e){this.key=e}}class Gc{constructor(e){this.key=e}}class Ep{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=Z(),this.mutatedKeys=Z(),this.eu=fc(e),this.tu=new sn(this.eu)}get nu(){return this.Za}ru(e,t){const s=t?t.iu:new sl,r=t?t.tu:this.tu;let o=t?t.mutatedKeys:this.mutatedKeys,a=r,u=!1;const d=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,f=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((p,_)=>{const w=r.get(p),A=fr(this.query,_)?_:null,S=!!w&&this.mutatedKeys.has(w.key),N=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations);let D=!1;w&&A?w.data.isEqual(A.data)?S!==N&&(s.track({type:3,doc:A}),D=!0):this.su(w,A)||(s.track({type:2,doc:A}),D=!0,(d&&this.eu(A,d)>0||f&&this.eu(A,f)<0)&&(u=!0)):!w&&A?(s.track({type:0,doc:A}),D=!0):w&&!A&&(s.track({type:1,doc:w}),D=!0,(d||f)&&(u=!0)),D&&(A?(a=a.add(A),o=N?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),s.track({type:1,doc:p})}return{tu:a,iu:s,Ss:u,mutatedKeys:o}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const o=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((p,_)=>(function(A,S){const N=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return K(20277,{Vt:D})}};return N(A)-N(S)})(p.type,_.type)||this.eu(p.doc,_.doc))),this.ou(s),r=r??!1;const u=t&&!r?this._u():[],d=this.Ya.size===0&&this.current&&!r?1:0,f=d!==this.Xa;return this.Xa=d,a.length!==0||f?{snapshot:new fn(this.query,e.tu,o,a,e.mutatedKeys,d===0,f,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new sl,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Za=this.Za.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Za=this.Za.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=Z(),this.tu.forEach((s=>{this.uu(s.key)&&(this.Ya=this.Ya.add(s.key))}));const t=[];return e.forEach((s=>{this.Ya.has(s)||t.push(new Gc(s))})),this.Ya.forEach((s=>{e.has(s)||t.push(new Wc(s))})),t}cu(e){this.Za=e.ks,this.Ya=Z();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return fn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const ro="SyncEngine";class bp{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class Tp{constructor(e){this.key=e,this.hu=!1}}class wp{constructor(e,t,s,r,o,a){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Ot((u=>dc(u)),dr),this.Iu=new Map,this.Eu=new Set,this.Ru=new ce(z.comparator),this.Au=new Map,this.Vu=new Wi,this.du={},this.mu=new Map,this.fu=dn.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Ip(n,e,t=!0){const s=eu(n);let r;const o=s.Tu.get(e);return o?(s.sharedClientState.addLocalQueryTarget(o.targetId),r=o.view.lu()):r=await Qc(s,e,t,!0),r}async function Ap(n,e){const t=eu(n);await Qc(t,e,!0,!1)}async function Qc(n,e,t,s){const r=await $m(n.localStore,Ke(e)),o=r.targetId,a=n.sharedClientState.addLocalQueryTarget(o,t);let u;return s&&(u=await Sp(n,e,o,a==="current",r.resumeToken)),n.isPrimaryClient&&t&&$c(n.remoteStore,r),u}async function Sp(n,e,t,s,r){n.pu=(_,w,A)=>(async function(N,D,O,R){let P=D.view.ru(O);P.Ss&&(P=await Ya(N.localStore,D.query,!1).then((({documents:b})=>D.view.ru(b,P))));const U=R&&R.targetChanges.get(D.targetId),W=R&&R.targetMismatches.get(D.targetId)!=null,H=D.view.applyChanges(P,N.isPrimaryClient,U,W);return al(N,D.targetId,H.au),H.snapshot})(n,_,w,A);const o=await Ya(n.localStore,e,!0),a=new Ep(e,o.ks),u=a.ru(o.documents),d=gs.createSynthesizedTargetChangeForCurrentChange(t,s&&n.onlineState!=="Offline",r),f=a.applyChanges(u,n.isPrimaryClient,d);al(n,t,f.au);const p=new bp(e,t,a);return n.Tu.set(e,p),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),f.snapshot}async function xp(n,e,t){const s=Q(n),r=s.Tu.get(e),o=s.Iu.get(r.targetId);if(o.length>1)return s.Iu.set(r.targetId,o.filter((a=>!dr(a,e)))),void s.Tu.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await Ii(s.localStore,r.targetId,!1).then((()=>{s.sharedClientState.clearQueryState(r.targetId),t&&Yi(s.remoteStore,r.targetId),xi(s,r.targetId)})).catch(_n)):(xi(s,r.targetId),await Ii(s.localStore,r.targetId,!0))}async function Cp(n,e){const t=Q(n),s=t.Tu.get(e),r=t.Iu.get(s.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(s.targetId),Yi(t.remoteStore,s.targetId))}async function Np(n,e,t){const s=Fp(n);try{const r=await(function(a,u){const d=Q(a),f=le.now(),p=u.reduce(((A,S)=>A.add(S.key)),Z());let _,w;return d.persistence.runTransaction("Locally write mutations","readwrite",(A=>{let S=rt(),N=Z();return d.xs.getEntries(A,p).next((D=>{S=D,S.forEach(((O,R)=>{R.isValidDocument()||(N=N.add(O))}))})).next((()=>d.localDocuments.getOverlayedDocuments(A,S))).next((D=>{_=D;const O=[];for(const R of u){const P=Bf(R,_.get(R.key).overlayedDocument);P!=null&&O.push(new Lt(R.key,P,rc(P.value.mapValue),We.exists(!0)))}return d.mutationQueue.addMutationBatch(A,f,O,u)})).next((D=>{w=D;const O=D.applyToLocalDocumentSet(_,N);return d.documentOverlayCache.saveOverlays(A,D.batchId,O)}))})).then((()=>({batchId:w.batchId,changes:pc(_)})))})(s.localStore,e);s.sharedClientState.addPendingMutation(r.batchId),(function(a,u,d){let f=a.du[a.currentUser.toKey()];f||(f=new ce(X)),f=f.insert(u,d),a.du[a.currentUser.toKey()]=f})(s,r.batchId,t),await _s(s,r.changes),await vr(s.remoteStore)}catch(r){const o=no(r,"Failed to persist write");t.reject(o)}}async function Jc(n,e){const t=Q(n);try{const s=await Lm(t.localStore,e);e.targetChanges.forEach(((r,o)=>{const a=t.Au.get(o);a&&(ne(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?a.hu=!0:r.modifiedDocuments.size>0?ne(a.hu,14607):r.removedDocuments.size>0&&(ne(a.hu,42227),a.hu=!1))})),await _s(t,s,e)}catch(s){await _n(s)}}function ol(n,e,t){const s=Q(n);if(s.isPrimaryClient&&t===0||!s.isPrimaryClient&&t===1){const r=[];s.Tu.forEach(((o,a)=>{const u=a.view.va(e);u.snapshot&&r.push(u.snapshot)})),(function(a,u){const d=Q(a);d.onlineState=u;let f=!1;d.queries.forEach(((p,_)=>{for(const w of _.ba)w.va(u)&&(f=!0)})),f&&so(d)})(s.eventManager,e),r.length&&s.Pu.J_(r),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function Rp(n,e,t){const s=Q(n);s.sharedClientState.updateQueryState(e,"rejected",t);const r=s.Au.get(e),o=r&&r.key;if(o){let a=new ce(z.comparator);a=a.insert(o,Re.newNoDocument(o,G.min()));const u=Z().add(o),d=new gr(G.min(),new Map,new ce(X),a,u);await Jc(s,d),s.Ru=s.Ru.remove(o),s.Au.delete(e),io(s)}else await Ii(s.localStore,e,!1).then((()=>xi(s,e,t))).catch(_n)}async function Pp(n,e){const t=Q(n),s=e.batch.batchId;try{const r=await Om(t.localStore,e);Xc(t,s,null),Yc(t,s),t.sharedClientState.updateMutationState(s,"acknowledged"),await _s(t,r)}catch(r){await _n(r)}}async function kp(n,e,t){const s=Q(n);try{const r=await(function(a,u){const d=Q(a);return d.persistence.runTransaction("Reject batch","readwrite-primary",(f=>{let p;return d.mutationQueue.lookupMutationBatch(f,u).next((_=>(ne(_!==null,37113),p=_.keys(),d.mutationQueue.removeMutationBatch(f,_)))).next((()=>d.mutationQueue.performConsistencyCheck(f))).next((()=>d.documentOverlayCache.removeOverlaysForBatchId(f,p,u))).next((()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,p))).next((()=>d.localDocuments.getDocuments(f,p)))}))})(s.localStore,e);Xc(s,e,t),Yc(s,e),s.sharedClientState.updateMutationState(e,"rejected",t),await _s(s,r)}catch(r){await _n(r)}}function Yc(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function Xc(n,e,t){const s=Q(n);let r=s.du[s.currentUser.toKey()];if(r){const o=r.get(e);o&&(t?o.reject(t):o.resolve(),r=r.remove(e)),s.du[s.currentUser.toKey()]=r}}function xi(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const s of n.Iu.get(e))n.Tu.delete(s),t&&n.Pu.yu(s,t);n.Iu.delete(e),n.isPrimaryClient&&n.Vu.Gr(e).forEach((s=>{n.Vu.containsKey(s)||Zc(n,s)}))}function Zc(n,e){n.Eu.delete(e.path.canonicalString());const t=n.Ru.get(e);t!==null&&(Yi(n.remoteStore,t),n.Ru=n.Ru.remove(e),n.Au.delete(t),io(n))}function al(n,e,t){for(const s of t)s instanceof Wc?(n.Vu.addReference(s.key,e),Dp(n,s)):s instanceof Gc?($(ro,"Document no longer in limbo: "+s.key),n.Vu.removeReference(s.key,e),n.Vu.containsKey(s.key)||Zc(n,s.key)):K(19791,{wu:s})}function Dp(n,e){const t=e.key,s=t.path.canonicalString();n.Ru.get(t)||n.Eu.has(s)||($(ro,"New document in limbo: "+t),n.Eu.add(s),io(n))}function io(n){for(;n.Eu.size>0&&n.Ru.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new z(ae.fromString(e)),s=n.fu.next();n.Au.set(s,new Tp(t)),n.Ru=n.Ru.insert(t,s),$c(n.remoteStore,new ft(Ke(hc(t.path)),s,"TargetPurposeLimboResolution",lr.ce))}}async function _s(n,e,t){const s=Q(n),r=[],o=[],a=[];s.Tu.isEmpty()||(s.Tu.forEach(((u,d)=>{a.push(s.pu(d,e,t).then((f=>{if((f||t)&&s.isPrimaryClient){const p=f?!f.fromCache:t?.targetChanges.get(d.targetId)?.current;s.sharedClientState.updateQueryState(d.targetId,p?"current":"not-current")}if(f){r.push(f);const p=Qi.Es(d.targetId,f);o.push(p)}})))})),await Promise.all(a),s.Pu.J_(r),await(async function(d,f){const p=Q(d);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(_=>k.forEach(f,(w=>k.forEach(w.Ts,(A=>p.persistence.referenceDelegate.addReference(_,w.targetId,A))).next((()=>k.forEach(w.Is,(A=>p.persistence.referenceDelegate.removeReference(_,w.targetId,A)))))))))}catch(_){if(!vn(_))throw _;$(Ji,"Failed to update sequence numbers: "+_)}for(const _ of f){const w=_.targetId;if(!_.fromCache){const A=p.vs.get(w),S=A.snapshotVersion,N=A.withLastLimboFreeSnapshotVersion(S);p.vs=p.vs.insert(w,N)}}})(s.localStore,o))}async function Vp(n,e){const t=Q(n);if(!t.currentUser.isEqual(e)){$(ro,"User change. New user:",e.toKey());const s=await Oc(t.localStore,e);t.currentUser=e,(function(o,a){o.mu.forEach((u=>{u.forEach((d=>{d.reject(new q(V.CANCELLED,a))}))})),o.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await _s(t,s.Ns)}}function jp(n,e){const t=Q(n),s=t.Au.get(e);if(s&&s.hu)return Z().add(s.key);{let r=Z();const o=t.Iu.get(e);if(!o)return r;for(const a of o){const u=t.Tu.get(a);r=r.unionWith(u.view.nu)}return r}}function eu(n){const e=Q(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Jc.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=jp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Rp.bind(null,e),e.Pu.J_=yp.bind(null,e.eventManager),e.Pu.yu=_p.bind(null,e.eventManager),e}function Fp(n){const e=Q(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Pp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=kp.bind(null,e),e}class ir{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=yr(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Fm(this.persistence,new Dm,e.initialUser,this.serializer)}Cu(e){return new Fc(Gi.Vi,this.serializer)}Du(e){return new qm}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ir.provider={build:()=>new ir};class Op extends ir{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ne(this.persistence.referenceDelegate instanceof sr,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new _m(s,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Ve.withCacheSize(this.cacheSizeBytes):Ve.DEFAULT;return new Fc((s=>sr.Vi(s,t)),this.serializer)}}class Ci{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>ol(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Vp.bind(null,this.syncEngine),await dp(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new mp})()}createDatastore(e){const t=yr(e.databaseInfo.databaseId),s=Gm(e.databaseInfo);return Zm(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return(function(s,r,o,a,u){return new tp(s,r,o,a,u)})(this.localStore,this.datastore,e.asyncQueue,(t=>ol(this.syncEngine,t,0)),(function(){return el.v()?new el:new Hm})())}createSyncEngine(e,t){return(function(r,o,a,u,d,f,p){const _=new wp(r,o,a,u,d,f);return p&&(_.gu=!0),_})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const s=Q(t);$(jt,"RemoteStore shutting down."),s.Ea.add(5),await ys(s),s.Aa.shutdown(),s.Va.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Ci.provider={build:()=>new Ci};class Lp{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):st("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const At="FirestoreClient";class Mp{constructor(e,t,s,r,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this._databaseInfo=r,this.user=Ne.UNAUTHENTICATED,this.clientId=ji.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(s,(async a=>{$(At,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(s,(a=>($(At,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new _t;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=no(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}async function ni(n,e){n.asyncQueue.verifyOperationInProgress(),$(At,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let s=t.initialUser;n.setCredentialChangeListener((async r=>{s.isEqual(r)||(await Oc(e.localStore,r),s=r)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function ll(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Bp(n);$(At,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((s=>nl(e.remoteStore,s))),n.setAppCheckTokenChangeListener(((s,r)=>nl(e.remoteStore,r))),n._onlineComponents=e}async function Bp(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){$(At,"Using user provided OfflineComponentProvider");try{await ni(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(r){return r.name==="FirebaseError"?r.code===V.FAILED_PRECONDITION||r.code===V.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11})(t))throw t;Vt("Error using user provided cache. Falling back to memory cache: "+t),await ni(n,new ir)}}else $(At,"Using default OfflineComponentProvider"),await ni(n,new Op(void 0));return n._offlineComponents}async function tu(n){return n._onlineComponents||(n._uninitializedComponentsProvider?($(At,"Using user provided OnlineComponentProvider"),await ll(n,n._uninitializedComponentsProvider._online)):($(At,"Using default OnlineComponentProvider"),await ll(n,new Ci))),n._onlineComponents}function $p(n){return tu(n).then((e=>e.syncEngine))}async function Up(n){const e=await tu(n),t=e.eventManager;return t.onListen=Ip.bind(null,e.syncEngine),t.onUnlisten=xp.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Ap.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Cp.bind(null,e.syncEngine),t}function qp(n,e,t={}){const s=new _t;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,u,d,f){const p=new Lp({next:w=>{p.Nu(),a.enqueueAndForget((()=>gp(o,_))),w.fromCache&&d.source==="server"?f.reject(new q(V.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(w)},error:w=>f.reject(w)}),_=new vp(u,p,{includeMetadataChanges:!0,Ka:!0});return pp(o,_)})(await Up(n),n.asyncQueue,e,t,s))),s.promise}function Hp(n,e){const t=new _t;return n.asyncQueue.enqueueAndForget((async()=>Np(await $p(n),e,t))),t.promise}function nu(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const zp="ComponentProvider",cl=new Map;function Kp(n,e,t,s,r){return new lf(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,nu(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator,s)}const su="firestore.googleapis.com",ul=!0;class hl{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new q(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=su,this.ssl=ul}else this.host=e.host,this.ssl=e.ssl??ul;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=jc;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<gm)throw new q(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Jd("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=nu(e.experimentalLongPollingOptions??{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new q(V.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new q(V.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new q(V.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(s,r){return s.timeoutSeconds===r.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Er{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new q(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new q(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hl(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(s){if(!s)return new Bd;switch(s.type){case"firstParty":return new Hd(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new q(V.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const s=cl.get(t);s&&($(zp,"Removing Datastore"),cl.delete(t),s.terminate())})(this),Promise.resolve()}}function Wp(n,e,t,s={}){n=cn(n,Er);const r=ki(e),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},u=`${e}:${t}`;r&&(dh(`https://${u}`),gh("Firestore",!0)),o.host!==su&&o.host!==u&&Vt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const d={...o,host:u,ssl:r,emulatorOptions:s};if(!Ks(d,a)&&(n._setSettings(d),s.mockUserToken)){let f,p;if(typeof s.mockUserToken=="string")f=s.mockUserToken,p=Ne.MOCK_USER;else{f=fh(s.mockUserToken,n._app?.options.projectId);const _=s.mockUserToken.sub||s.mockUserToken.user_id;if(!_)throw new q(V.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Ne(_)}n._authCredentials=new $d(new Kl(f,p))}}class br{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new br(this.firestore,e,this._query)}}class we{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new vt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new we(this.firestore,e,this._key)}toJSON(){return{type:we._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(ms(t,we._jsonSchema))return new we(e,s||null,new z(ae.fromString(t.referencePath)))}}we._jsonSchemaVersion="firestore/documentReference/1.0",we._jsonSchema={type:fe("string",we._jsonSchemaVersion),referencePath:fe("string")};class vt extends br{constructor(e,t,s){super(e,t,hc(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new we(this.firestore,null,new z(e))}withConverter(e){return new vt(this.firestore,e,this._path)}}function oo(n,e,...t){if(n=is(n),Wl("collection","path",e),n instanceof Er){const s=ae.fromString(e,...t);return Aa(s),new vt(n,null,s)}{if(!(n instanceof we||n instanceof vt))throw new q(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(ae.fromString(e,...t));return Aa(s),new vt(n.firestore,null,s)}}function bn(n,e,...t){if(n=is(n),arguments.length===1&&(e=ji.newId()),Wl("doc","path",e),n instanceof Er){const s=ae.fromString(e,...t);return Ia(s),new we(n,null,new z(s))}{if(!(n instanceof we||n instanceof vt))throw new q(V.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=n._path.child(ae.fromString(e,...t));return Ia(s),new we(n.firestore,n instanceof vt?n.converter:null,new z(s))}}const dl="AsyncQueue";class fl{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Mc(this,"async_queue_retry"),this._c=()=>{const s=ti();s&&$(dl,"Visibility state changed to "+s.visibilityState),this.M_.w_()},this.ac=e;const t=ti();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=ti();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new _t;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Yu.push(e),this.lc())))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!vn(e))throw e;$(dl,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((s=>{throw this.nc=s,this.rc=!1,st("INTERNAL UNHANDLED ERROR: ",ml(s)),s})).then((s=>(this.rc=!1,s))))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=to.createAndSchedule(this,e,t,s,(o=>this.hc(o)));return this.tc.push(r),r}uc(){this.nc&&K(47125,{Pc:ml(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,s)=>t.targetTimeMs-s.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}Rc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function ml(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class Tr extends Er{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new fl,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new fl(e),this._firestoreClient=void 0,await e}}}function Gp(n,e){const t=typeof n=="object"?n:Sd(),s=typeof n=="string"?n:Js,r=bd(t,"firestore").getImmediate({identifier:s});if(!r._initialized){const o=uh("firestore");o&&Wp(r,...o)}return r}function ru(n){if(n._terminated)throw new q(V.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Qp(n),n._firestoreClient}function Qp(n){const e=n._freezeSettings(),t=Kp(n._databaseId,n._app?.options.appId||"",n._persistenceKey,n._app?.options.apiKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new Mp(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(r){const o=r?._online.build();return{_offline:r?._offline.build(o),_online:o}})(n._componentsProvider))}class Le{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Le(xe.fromBase64String(e))}catch(t){throw new q(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Le(xe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Le._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ms(e,Le._jsonSchema))return Le.fromBase64String(e.bytes)}}Le._jsonSchemaVersion="firestore/bytes/1.0",Le._jsonSchema={type:fe("string",Le._jsonSchemaVersion),bytes:fe("string")};class iu{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new q(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Se(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ou{constructor(e){this._methodName=e}}class Qe{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new q(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new q(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return X(this._lat,e._lat)||X(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Qe._jsonSchemaVersion}}static fromJSON(e){if(ms(e,Qe._jsonSchema))return new Qe(e.latitude,e.longitude)}}Qe._jsonSchemaVersion="firestore/geoPoint/1.0",Qe._jsonSchema={type:fe("string",Qe._jsonSchemaVersion),latitude:fe("number"),longitude:fe("number")};class $e{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(s,r){if(s.length!==r.length)return!1;for(let o=0;o<s.length;++o)if(s[o]!==r[o])return!1;return!0})(this._values,e._values)}toJSON(){return{type:$e._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ms(e,$e._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new $e(e.vectorValues);throw new q(V.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}$e._jsonSchemaVersion="firestore/vectorValue/1.0",$e._jsonSchema={type:fe("string",$e._jsonSchemaVersion),vectorValues:fe("object")};const Jp=/^__.*__$/;class Yp{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return this.fieldMask!==null?new Lt(e,this.data,this.fieldMask,t,this.fieldTransforms):new ps(e,this.data,t,this.fieldTransforms)}}function au(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw K(40011,{dataSource:n})}}class ao{constructor(e,t,s,r,o,a){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,o===void 0&&this.validatePath(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new ao({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){const t=this.path?.child(e),s=this.contextWith({path:t,arrayElement:!1});return s.validatePathSegment(e),s}childContextForFieldPath(e){const t=this.path?.child(e),s=this.contextWith({path:t,arrayElement:!1});return s.validatePath(),s}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return or(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(au(this.dataSource)&&Jp.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class Xp{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||yr(e)}createContext(e,t,s,r=!1){return new ao({dataSource:e,methodName:t,targetDoc:s,path:Se.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Zp(n){const e=n._freezeSettings(),t=yr(n._databaseId);return new Xp(n._databaseId,!!e.ignoreUndefinedProperties,t)}function eg(n,e,t,s,r,o={}){const a=n.createContext(o.merge||o.mergeFields?2:0,e,t,r);hu("Data must be an object, but it was:",a,s);const u=cu(s,a);let d,f;if(o.merge)d=new Be(a.fieldMask),f=a.fieldTransforms;else if(o.mergeFields){const p=[];for(const _ of o.mergeFields){const w=lo(e,_,t);if(!a.contains(w))throw new q(V.INVALID_ARGUMENT,`Field '${w}' is specified in your field mask but missing from your input data.`);sg(p,w)||p.push(w)}d=new Be(p),f=a.fieldTransforms.filter((_=>d.covers(_.field)))}else d=null,f=a.fieldTransforms;return new Yp(new Oe(u),d,f)}function lu(n,e){if(uu(n=is(n)))return hu("Unsupported field value:",e,n),cu(n,e);if(n instanceof ou)return(function(s,r){if(!au(r.dataSource))throw r.createError(`${s._methodName}() can only be used with update() and set()`);if(!r.path)throw r.createError(`${s._methodName}() is not currently supported inside arrays`);const o=s._toFieldTransform(r);o&&r.fieldTransforms.push(o)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return(function(s,r){const o=[];let a=0;for(const u of s){let d=lu(u,r.childContextForArray(a));d==null&&(d={nullValue:"NULL_VALUE"}),o.push(d),a++}return{arrayValue:{values:o}}})(n,e)}return(function(s,r){if((s=is(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return Vf(r.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const o=le.fromDate(s);return{timestampValue:nr(r.serializer,o)}}if(s instanceof le){const o=new le(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:nr(r.serializer,o)}}if(s instanceof Qe)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Le)return{bytesValue:xc(r.serializer,s._byteString)};if(s instanceof we){const o=r.databaseId,a=s.firestore._databaseId;if(!a.isEqual(o))throw r.createError(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Ki(s.firestore._databaseId||r.databaseId,s._key.path)}}if(s instanceof $e)return(function(a,u){const d=a instanceof $e?a.toArray():a;return{mapValue:{fields:{[nc]:{stringValue:sc},[Ys]:{arrayValue:{values:d.map((p=>{if(typeof p!="number")throw u.createError("VectorValues must only contain numeric values.");return Ui(u.serializer,p)}))}}}}}})(s,r);if(Vc(s))return s._toProto(r.serializer);throw r.createError(`Unsupported field value: ${Fi(s)}`)})(n,e)}function cu(n,e){const t={};return Jl(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ft(n,((s,r)=>{const o=lu(r,e.childContextForField(s));o!=null&&(t[s]=o)})),{mapValue:{fields:t}}}function uu(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof le||n instanceof Qe||n instanceof Le||n instanceof we||n instanceof ou||n instanceof $e||Vc(n))}function hu(n,e,t){if(!uu(t)||!Gl(t)){const s=Fi(t);throw s==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+s)}}function lo(n,e,t){if((e=is(e))instanceof iu)return e._internalPath;if(typeof e=="string")return ng(n,e);throw or("Field path arguments must be of type string or ",n,!1,void 0,t)}const tg=new RegExp("[~\\*/\\[\\]]");function ng(n,e,t){if(e.search(tg)>=0)throw or(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new iu(...e.split("."))._internalPath}catch{throw or(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function or(n,e,t,s,r){const o=s&&!s.isEmpty(),a=r!==void 0;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let d="";return(o||a)&&(d+=" (found",o&&(d+=` in field ${s}`),a&&(d+=` in document ${r}`),d+=")"),new q(V.INVALID_ARGUMENT,u+n+d)}function sg(n,e){return n.some((t=>t.isEqual(e)))}class rg{convertValue(e,t="none"){switch(wt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return he(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Tt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw K(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return Ft(e,((r,o)=>{s[r]=this.convertValue(o,t)})),s}convertVectorValue(e){const t=e.fields?.[Ys].arrayValue?.values?.map((s=>he(s.doubleValue)));return new $e(t)}convertGeoPoint(e){return new Qe(he(e.latitude),he(e.longitude))}convertArray(e,t){return(e.values||[]).map((s=>this.convertValue(s,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const s=ur(e);return s==null?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(cs(e));default:return null}}convertTimestamp(e){const t=bt(e);return new le(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=ae.fromString(e);ne(Dc(s),9688,{name:e});const r=new us(s.get(1),s.get(3)),o=new z(s.popFirst(5));return r.isEqual(t)||st(`Document ${o} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),o}}class ig extends rg{constructor(e){super(),this.firestore=e}convertBytes(e){return new Le(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new we(this.firestore,null,t)}}const pl="@firebase/firestore",gl="4.11.0";class du{constructor(e,t,s,r,o){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new we(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new og(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){const t=this._document.data.field(lo("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class og extends du{data(){return super.data()}}function ag(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new q(V.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function lg(n,e,t){let s;return s=n?n.toFirestore(e):e,s}class Ls{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class rn extends du{constructor(e,t,s,r,o,a){super(e,t,s,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=o}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Hs(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(lo("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new q(V.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=rn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}rn._jsonSchemaVersion="firestore/documentSnapshot/1.0",rn._jsonSchema={type:fe("string",rn._jsonSchemaVersion),bundleSource:fe("string","DocumentSnapshot"),bundleName:fe("string"),bundle:fe("string")};class Hs extends rn{data(e={}){return super.data(e)}}class on{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Ls(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((s=>{e.call(t,new Hs(this._firestore,this._userDataWriter,s.key,s,new Ls(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new q(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(r,o){if(r._snapshot.oldDocs.isEmpty()){let a=0;return r._snapshot.docChanges.map((u=>{const d=new Hs(r._firestore,r._userDataWriter,u.doc.key,u.doc,new Ls(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter);return u.doc,{type:"added",doc:d,oldIndex:-1,newIndex:a++}}))}{let a=r._snapshot.oldDocs;return r._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const d=new Hs(r._firestore,r._userDataWriter,u.doc.key,u.doc,new Ls(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter);let f=-1,p=-1;return u.type!==0&&(f=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),p=a.indexOf(u.doc.key)),{type:cg(u.type),doc:d,oldIndex:f,newIndex:p}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new q(V.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=on._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=ji.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],r=[];return this.docs.forEach((o=>{o._document!==null&&(t.push(o._document),s.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),r.push(o.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function cg(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return K(61501,{type:n})}}on._jsonSchemaVersion="firestore/querySnapshot/1.0",on._jsonSchema={type:fe("string",on._jsonSchemaVersion),bundleSource:fe("string","QuerySnapshot"),bundleName:fe("string"),bundle:fe("string")};function co(n){n=cn(n,br);const e=cn(n.firestore,Tr),t=ru(e),s=new ig(e);return ag(n._query),qp(t,n._query).then((r=>new on(e,s,n,r)))}function wr(n,e,t){n=cn(n,we);const s=cn(n.firestore,Tr),r=lg(n.converter,e),o=Zp(s);return fu(s,[eg(o,"setDoc",n._key,r,n.converter!==null,t).toMutation(n._key,We.none())])}function uo(n){return fu(cn(n.firestore,Tr),[new qi(n._key,We.none())])}function fu(n,e){const t=ru(n);return Hp(t,e)}(function(e,t=!0){Md(Ad),Gs(new os("firestore",((s,{instanceIdentifier:r,options:o})=>{const a=s.getProvider("app").getImmediate(),u=new Tr(new Ud(s.getProvider("auth-internal")),new zd(a,s.getProvider("app-check-internal")),cf(a,r),a);return o={useFetchStreams:t,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),tn(pl,gl,e),tn(pl,gl,"esm2020")})();const Ni={apiKey:"",authDomain:"",projectId:"",storageBucket:"",messagingSenderId:"",appId:""},je=!!(Ni.apiKey&&Ni.projectId);let yl=null,Xe=null;je&&(yl=Fl(Ni),Xe=Gp(yl));const mu="/Claude/",mn=`${mu}sodexo-live-logo.svg`,pu=`${mu}sodexo-dark.svg`,_l="sdx_salt",Ir="sdx_users",gu="sdx_inspection_vault",vl="sdx_device_secret",ug=600*1e3,si={name:"Joxel Da Silva",badge:"365582",department:"Safety Inspector"};async function yu(){let n=localStorage.getItem(_l);if(n)return new Uint8Array(JSON.parse(n));const e=crypto.getRandomValues(new Uint8Array(16));return localStorage.setItem(_l,JSON.stringify(Array.from(e))),e}async function hg(n){const e=new TextEncoder,t=await yu(),s=await crypto.subtle.importKey("raw",e.encode(n),"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},s,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function Ar(n){const e=new TextEncoder,t=await yu(),s=new Uint8Array([...t,...e.encode(n)]),r=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(r)).map(o=>o.toString(16).padStart(2,"0")).join("")}async function dg(n,e){const t=crypto.getRandomValues(new Uint8Array(12)),s=new TextEncoder,r=await crypto.subtle.encrypt({name:"AES-GCM",iv:t},e,s.encode(JSON.stringify(n)));return JSON.stringify({iv:Array.from(t),ct:Array.from(new Uint8Array(r))})}async function fg(n,e){if(!n)return[];try{const{iv:t,ct:s}=JSON.parse(n),r=await crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(t)},e,new Uint8Array(s));return JSON.parse(new TextDecoder().decode(r))}catch{return[]}}async function mg(){let n=localStorage.getItem(vl);if(!n){const e=crypto.getRandomValues(new Uint8Array(32));n=Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join(""),localStorage.setItem(vl,n)}return hg("sdx_master_"+n)}async function Ue(){if(je)try{return(await co(oo(Xe,"users"))).docs.map(e=>e.data())}catch{return[]}try{return JSON.parse(localStorage.getItem(Ir)||"[]")}catch{return[]}}async function vs(n){if(je){try{await wr(bn(Xe,"users",n.badgeHash),n)}catch{}return}const e=await Ue(),t=e.findIndex(s=>s.badgeHash===n.badgeHash);t>=0?e[t]=n:e.push(n),localStorage.setItem(Ir,JSON.stringify(e))}async function pg(n){if(je){try{await uo(bn(Xe,"users",n))}catch{}return}const e=await Ue();localStorage.setItem(Ir,JSON.stringify(e.filter(t=>t.badgeHash!==n)))}async function _u(){if((await Ue()).length>0)return;const e=await Ar(si.badge),t={badgeHash:e,name:si.name,department:si.department,role:"admin",approved:!0,registeredAt:new Date().toISOString()};je?await wr(bn(Xe,"users",e),t):localStorage.setItem(Ir,JSON.stringify([t]))}let pn=null,Ri=null;async function ho(){if(je)try{const t=(await co(oo(Xe,"inspections"))).docs.map(s=>s.data());return t.sort((s,r)=>(r.savedAt||"").localeCompare(s.savedAt||"")),t}catch{return[]}if(!pn)return[];const n=localStorage.getItem(gu);return fg(n,pn)}async function fo(n){if(je){try{for(const t of n)await wr(bn(Xe,"inspections",t.id),t)}catch(t){console.error("Firestore saveHistory error:",t)}return}if(!pn)return;const e=await dg(n,pn);localStorage.setItem(gu,e)}async function gg(n){if(je){try{await wr(bn(Xe,"inspections",n.id),n)}catch{}return}const e=await ho();e.unshift(n),await fo(e)}async function yg(n){if(je){try{await uo(bn(Xe,"inspections",n))}catch{}return}const e=await ho();await fo(e.filter(t=>t.id!==n))}async function _g(){if(je){try{const n=await co(oo(Xe,"inspections"));for(const e of n.docs)await uo(e.ref)}catch{}return}await fo([])}async function vg(n){await _u();const e=await Ar(n),s=(await Ue()).find(r=>r.badgeHash===e);return s?s.approved?(je||(pn=await mg()),Ri={...s},{ok:!0,user:Ri}):{ok:!1,reason:"pending"}:{ok:!1,reason:"not_found"}}async function Eg(n,e,t){const s=await Ar(n);if((await Ue()).find(a=>a.badgeHash===s))return{ok:!1,reason:"exists"};const o={badgeHash:s,name:e,department:t,role:"inspector",approved:!1,registeredAt:new Date().toISOString()};return await vs(o),{ok:!0}}function El(){pn=null,Ri=null}async function bg(n,e,t,s){const r=await Ar(n);if((await Ue()).find(u=>u.badgeHash===r))return{ok:!1,reason:"exists"};const a={badgeHash:r,name:e,department:t,role:s||"inspector",approved:!0,registeredAt:new Date().toISOString()};return await vs(a),{ok:!0}}async function Tg(n){const t=(await Ue()).find(s=>s.badgeHash===n);t&&(t.approved=!0,await vs(t))}async function bl(n){await pg(n)}async function wg(n){const t=(await Ue()).find(s=>s.badgeHash===n);t&&(t.role="admin",await vs(t))}async function Ig(n){const t=(await Ue()).find(s=>s.badgeHash===n);t&&(t.role="inspector",await vs(t))}function Ag({onUnlock:n}){const[e,t]=B.useState(""),[s,r]=B.useState("signin"),[o,a]=B.useState(""),[u,d]=B.useState(""),[f,p]=B.useState(""),[_,w]=B.useState(!1),[A,S]=B.useState(""),N=B.useRef(null);B.useEffect(()=>{_u()},[]),B.useEffect(()=>{N.current?.focus()},[s]);async function D(R){R.preventDefault(),p(""),w(!0);try{const P=await vg(e.trim());if(P.ok){n(P.user);return}P.reason==="pending"?r("pending"):p("Badge not recognized. Request access below if youre new.")}catch{p("Something went wrong. Try again.")}finally{w(!1)}}async function O(R){R.preventDefault(),p(""),w(!0);try{const P=await Eg(e.trim(),o.trim(),u.trim());P.ok?(S("Registration submitted! Ask an administrator to approve your badge."),r("pending")):P.reason==="exists"&&p("This badge is already registered. Try signing in.")}catch{p("Registration failed. Try again.")}finally{w(!1)}}return c.jsx("div",{className:"pinOverlay",children:c.jsxs("div",{className:"pinCard",children:[c.jsx("img",{src:pu,alt:"Sodexo",className:"pinLogo"}),s==="signin"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"pinTitle",children:"Badge Sign-In"}),c.jsx("div",{className:"pinSub",children:"Enter your work badge number to access inspections"}),c.jsxs("form",{onSubmit:D,className:"pinForm",children:[c.jsx("input",{ref:N,className:"pinInput badgeInput",type:"password",maxLength:20,value:e,onChange:R=>t(R.target.value),placeholder:"Badge #",autoComplete:"off"}),f&&c.jsx("div",{className:"pinError",children:f}),c.jsx("button",{className:"btn btnPrimary pinBtn",type:"submit",disabled:_||e.trim().length<3,children:_?"Verifying...":"Sign In"})]}),c.jsx("button",{className:"btnLink",type:"button",onClick:()=>{r("register"),p(""),t("")},children:"New here? Request access"})]}),s==="register"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"pinTitle",children:"Request Access"}),c.jsx("div",{className:"pinSub",children:"Fill in your details. An administrator will review your request."}),c.jsxs("form",{onSubmit:O,className:"pinForm",children:[c.jsx("input",{ref:N,className:"pinInput badgeInput",type:"password",maxLength:20,value:e,onChange:R=>t(R.target.value),placeholder:"Badge #",autoComplete:"off"}),c.jsx("input",{className:"input regInput",value:o,onChange:R=>a(R.target.value),placeholder:"Full name",autoComplete:"name"}),c.jsx("input",{className:"input regInput",value:u,onChange:R=>d(R.target.value),placeholder:"Department"}),f&&c.jsx("div",{className:"pinError",children:f}),c.jsx("button",{className:"btn btnPrimary pinBtn",type:"submit",disabled:_||e.trim().length<3||!o.trim()||!u.trim(),children:_?"Submitting...":"Request Access"})]}),c.jsx("button",{className:"btnLink",type:"button",onClick:()=>{r("signin"),p(""),t("")},children:"Already registered? Sign in"})]}),s==="pending"&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"pinTitle",children:"Pending Approval"}),c.jsx("div",{className:"pinSub",children:A||"Your access request is awaiting administrator approval."}),c.jsx("div",{className:"pendingIcon",children:""}),c.jsx("button",{className:"btnLink",type:"button",onClick:()=>{r("signin"),p(""),S(""),t("")},children:"Back to sign in"})]}),c.jsxs("div",{className:"pinFooter",children:[c.jsx("span",{className:"pinLock",children:""})," AES-256 encrypted  stored only on this device"]})]})})}function mo(n,e){const t=URL.createObjectURL(n),s=document.createElement("a");s.href=t,s.download=e,document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),URL.revokeObjectURL(t)},100)}const an={inspection:{label:"Kitchen Inspection",contextFields:[{key:"kitchen",label:"Kitchen / Location"},{key:"participants",label:"Participants"},{key:"date",label:"Date"},{key:"duration",label:"Duration"}],useCases:["Email Summary","Google Doc","Slack Update","Evaluation Scorecard"],sample:{meta:{inspectionType:"Event Day",inspectionDate:"2026-02-09",inspectorName:"J. Da Silva"},context:{kitchen:"Concourse Kitchen  North Stand",participants:"Chef Lead, Sanitation Lead, Ops Manager",date:"2026-02-09",duration:"25 min"},inspection:{facility:{ceiling:{status:"OK",notes:"",photos:[]},walls:{status:"OK",notes:"",photos:[]},floors:{status:"Needs Attention",notes:"Slip hazard near mop sink.",photos:[]},lighting:{status:"Needs Attention",notes:"Bulb out over dish station.",photos:[]}},operations:{employeePractices:{status:"Needs Attention",notes:"Coaching on hot holding.",photos:[]},handwashing:{status:"OK",notes:"Soap low at one hand sink.",photos:[]},labelingDating:{status:"Needs Attention",notes:"A few unlabeled containers.",photos:[]},logs:{status:"Needs Attention",notes:"Chemical logs missing 2/7.",photos:[]}},temps:{handSinkTempF:96,threeCompSinkTempF:110},equipment:{doubleDoorCooler:{status:"OK",notes:"38F",photos:[]},doubleDoorFreezer:{status:"OK",notes:"",photos:[]},walkInCooler:{status:"OK",notes:"",photos:[]},warmers:{status:"Needs Attention",notes:"Hot hold 142F (borderline).",photos:[]},ovens:{status:"OK",notes:"",photos:[]},threeCompSink:{status:"OK",notes:"",photos:[]},ecolab:{status:"OK",notes:"Sanitizer 150 ppm",photos:[]}}},rawNotes:"sitdown after svc. recap insp: cooler 38F ok. hot hold 142F (border). q: when calibrate therms? last wk. found: 3 cutting boards scored. chem logs missing 2/7. pest trap behind dry storage shifted. action: replace boards, backfill logs, reset trap + pic, coach hot holding. owner: chef lead. due: Fri."}}},Sg=["OK","Not Clean","Needs Attention","N/A"],ri=6,Tl=8,xg=["Event Day","Post Event","Regular Inspection"],Cg=["Floor 1","Floor 2","Floor 3"],ar={"Event Day":{headline:"Event Day Readiness",opening:"This is an Event Day inspection focused on pre-service readiness and risk control before peak volume."},"Post Event":{headline:"Post-Event Close-Out",opening:"This is a Post Event inspection focused on close-out conditions, cleanup effectiveness, and immediate corrective actions after service."},"Regular Inspection":{headline:"Routine Compliance Review",opening:"This is a Regular Inspection focused on routine compliance, sanitation standards, and repeat-risk prevention."}},Ng=[[/\bw\//gi,"with"],[/\bKM\b/g,"Kitchen Manager"],[/\bq\b/gi,"question"],[/\btemp(s?)\b/gi,"temperature$1"],[/\bok\b/gi,"OK"],[/\bchk\b/gi,"check"],[/\bwk\b/gi,"week"],[/\b(\d+)x\b/gi,"$1"],[/\binsp\b/gi,"inspection"],[/\bsvc\b/gi,"service"],[/\btherm(s?)\b/gi,"thermometer$1"],[/\bchem\b/gi,"chemical"],[/\bdocs?\b/gi,"document(s)"],[/\bpic\b/gi,"photo"],[/\bborder\b/gi,"borderline"]];function Sr(n){let e=n;for(const[t,s]of Ng)e=e.replace(t,s);return e}const Rg=[[/\bi\b/g,"I"],[/\bdoesnt\b/gi,"doesn't"],[/\bdidnt\b/gi,"didn't"],[/\bwasnt\b/gi,"wasn't"],[/\bwerent\b/gi,"weren't"],[/\bcant\b/gi,"can't"],[/\bwont\b/gi,"won't"],[/\bcouldnt\b/gi,"couldn't"],[/\bshouldnt\b/gi,"shouldn't"],[/\bwouldnt\b/gi,"wouldn't"],[/\bisnt\b/gi,"isn't"],[/\barent\b/gi,"aren't"],[/\bhasnt\b/gi,"hasn't"],[/\bhavent\b/gi,"haven't"],[/\btheyre\b/gi,"they're"],[/\btheres\b/gi,"there's"],[/\bwere\b(?!\s)/gi,"we're"],[/\bits\b(?=\s+[a-z])/gi,"it's"],[/\brecieved?\b/gi,"received"],[/\bseperately?\b/gi,"separately"],[/\boccured\b/gi,"occurred"],[/\buntill?\b/gi,"until"],[/\balot\b/gi,"a lot"],[/\bteh\b/gi,"the"],[/\bwich\b/gi,"which"],[/\bthere\s+is\b/gi,"there is"],[/\bthru\b/gi,"through"],[/\bppl\b/gi,"people"],[/\bmgr\b/gi,"manager"],[/\bmgmt\b/gi,"management"],[/\bequip\b/gi,"equipment"],[/\bmaint\b/gi,"maintenance"],[/\brefrig\b/gi,"refrigerator"],[/\binfo\b/gi,"information"],[/\bamt\b/gi,"amount"],[/\bapprox\b/gi,"approximately"],[/\bmin\b(?=\s|\.|\,|$)/gi,"minimum"],[/\bmax\b(?=\s|\.|\,|$)/gi,"maximum"],[/\bF\b(?=\s*[\.\,\)]|$)/g,"F"]],Pg=[{key:"action",patterns:[/\baction\b/i,/\breplace\b/i,/\bfix\b/i,/\brepair\b/i,/\bschedule\b/i,/\bcoach\b/i,/\bfollow\s*up\b/i,/\bbackfill\b/i,/\breset\b/i]},{key:"finding",patterns:[/\bfound\b/i,/\bnoted\b/i,/\bobserved\b/i,/\bscored\b/i,/\bmissing\b/i,/\bshifted\b/i,/\blow\b/i,/\bbroken\b/i,/\bdamaged\b/i,/\bflagged\b/i]},{key:"temp",patterns:[/\d+\s*?F/i,/\btemperature\b/i,/\bcooler\b/i,/\bfreezer\b/i,/\bhot\s*hold/i,/\bwarm/i]},{key:"question",patterns:[/\bquestion\b/i,/\basked\b/i,/\bwhen\b/i,/\?$/]},{key:"owner",patterns:[/\bowner\b/i,/\bdue\b/i,/\bassign/i,/\bchef\s*lead\b/i]},{key:"context",patterns:[/\bsitdown\b/i,/\bsit-down\b/i,/\brecap\b/i,/\bafter\b/i,/\bbefore\b/i,/\bduring\b/i]}];function kg(n){for(const e of Pg)for(const t of e.patterns)if(t.test(n))return e.key;return"general"}const xr={context:"Context",finding:"Findings",temp:"Temperatures",question:"Questions",action:"Action Items",owner:"Ownership & Deadlines",general:"Notes"},Cr=["context","temp","finding","question","action","owner","general"];function Dg(n){let e=n;for(const[t,s]of Rg)e=e.replace(t,s);return e=e.replace(/^\s*([a-z])/,(t,s)=>s.toUpperCase()),e=e.replace(/\s{2,}/g," "),e=e.trim(),e&&!/[.!?]$/.test(e)&&(e+="."),e}function Nr(n){if(!n||!n.trim())return{bullets:[],grouped:{}};const s=Sr(n).split(/(?<=\.)\s+|;\s*|\n+/).map(o=>o.trim()).filter(o=>o.length>2).map(o=>Dg(o)),r={};for(const o of s){const a=kg(o);r[a]||(r[a]=[]),r[a].push(o)}return{bullets:s,grouped:r}}function rs(n){const{grouped:e}=Nr(n),t=[];for(const s of Cr)if(!(!e[s]||!e[s].length)){t.push(`${xr[s]}:`);for(const r of e[s])t.push(`   ${r}`);t.push("")}return t.join(`
`).trim()||n||""}function pe(...n){return n.filter(Boolean).join(" ")}function wl(n){const e=an[n],t={};for(const s of e.contextFields)t[s.key]="";return t}function be(n){return{...n,photos:[]}}function ii(){return{facility:{ceiling:be({status:"OK",notes:""}),walls:be({status:"OK",notes:""}),floors:be({status:"OK",notes:""}),lighting:be({status:"OK",notes:""})},operations:{employeePractices:be({status:"OK",notes:""}),handwashing:be({status:"OK",notes:""}),labelingDating:be({status:"OK",notes:""}),logs:be({status:"OK",notes:""})},temps:{handSinkTempF:"",threeCompSinkTempF:""},equipment:{doubleDoorCooler:be({status:"OK",notes:""}),doubleDoorFreezer:be({status:"OK",notes:""}),walkInCooler:be({status:"OK",notes:""}),warmers:be({status:"OK",notes:""}),ovens:be({status:"OK",notes:""}),threeCompSink:be({status:"OK",notes:""}),ecolab:be({status:"OK",notes:""})}}}function Vg(n,e){return`${an[n].label}  ${e}`}function oi(n,e){return e.reduce((t,s)=>t?t[s]:void 0,n)}function Xn(n,e,t){const[s,...r]=e;return s?{...n,[s]:r.length?Xn(n?.[s]??{},r,t):t}:t}function Il(n){return Math.round(n/(1024*1024)*10)/10}function jg(n,e=800,t=.6){return new Promise(s=>{const r=new Image;r.onload=()=>{let{width:o,height:a}=r;if(o>e||a>e){const f=Math.min(e/o,e/a);o=Math.round(o*f),a=Math.round(a*f)}const u=document.createElement("canvas");u.width=o,u.height=a,u.getContext("2d").drawImage(r,0,0,o,a),s(u.toDataURL("image/jpeg",t))},r.onerror=()=>s(null),r.src=URL.createObjectURL(n)})}function Fg(n){let e=0;const t=s=>{if(!(!s||typeof s!="object")){if(Array.isArray(s)){s.forEach(t);return}s.photos?.length&&(e+=s.photos.length);for(const r of Object.values(s))t(r)}};return t(n),e}function mt(n){return String(n||"").trim()}function vu(n){const t=String(n||"").match(/action\s*:\s*([\s\S]+)/i);return t?t[1].split(/next\s*chk|next\s*check|follow\s*up|owner\s*:/i)[0].trim().split(",").map(r=>mt(r)).filter(Boolean).map(r=>({issue:r})):[]}function Bt(n){const e=[],t=o=>{if(!(!o||typeof o!="object")){o.status&&(o.status==="Needs Attention"||o.status==="Not Clean")&&e.push(!0);for(const a of Object.keys(o))t(o[a])}};t(n?.facility),t(n?.operations),t(n?.equipment);const s=Number(n?.temps?.handSinkTempF),r=Number(n?.temps?.threeCompSinkTempF);return!Number.isNaN(s)&&s&&s<95&&e.push(!0),!Number.isNaN(r)&&r&&r<110&&e.push(!0),e.length?"Needs Attention":"Pass"}function Og({inspectionDate:n,inspectorName:e,context:t,noteType:s,inspection:r}){const o=[];n||o.push({text:"Inspection Date is missing",fieldId:"field-inspectionDate"}),e||o.push({text:"Inspector Name is missing",fieldId:"field-inspectorName"});const a=an[s].contextFields;for(const u of a)t[u.key]?.trim()||o.push({text:`${u.label} is missing`,fieldId:`field-ctx-${u.key}`});return r.temps.handSinkTempF||o.push({text:"Hand sink temperature not recorded",fieldId:"field-handSinkTempF"}),r.temps.threeCompSinkTempF||o.push({text:"3-comp sink temperature not recorded",fieldId:"field-threeCompSinkTempF"}),o}function Lg({noteType:n,context:e,inspection:t,inspectionType:s,inspectionDate:r,siteName:o,siteNumber:a}){const u=Bt(t),d=o||e?.kitchen||"Kitchen",f=a?` (#${a})`:"",p=r||e?.date||"Date",_=s?`  ${s}`:"";return`Subject: ${d}${f} Kitchen Inspection${_}  ${p}  ${u}`}function po(n){const e=[["facility","ceiling","Facility > Ceiling"],["facility","walls","Facility > Walls"],["facility","floors","Facility > Floors"],["facility","lighting","Facility > Lighting"],["operations","employeePractices","Operations > Employee practices"],["operations","handwashing","Operations > Handwashing / supplies"],["operations","labelingDating","Operations > Labeling / dating"],["operations","logs","Operations > Logs / documentation"],["equipment","doubleDoorCooler","Equipment > Double-door cooler"],["equipment","doubleDoorFreezer","Equipment > Double-door freezer"],["equipment","walkInCooler","Equipment > Walk-in cooler"],["equipment","warmers","Equipment > Warmers / hot holding"],["equipment","ovens","Equipment > Ovens"],["equipment","threeCompSink","Equipment > 3-compartment sink"],["equipment","ecolab","Equipment > Ecolab / chemicals"]];let t=0;const s=[],r={};for(const[o,a,u]of e){const d=n?.[o]?.[a],f=d?.photos||[];if(!f.length)continue;const p=`${o}.${a}`;r[p]=[];for(const _ of f){t+=1,r[p].push(t);const w=mt(d?.notes)||mt(_?.name)||"";s.push({num:t,label:u,caption:w})}}return{index:s,mapByPath:r}}function Tn({inspection:n,rawNotes:e}){const t=[],{mapByPath:s}=po(n),r=(d,f,p)=>{p?.status&&(p.status==="Needs Attention"||p.status==="Not Clean")&&t.push({issue:`${f}: ${mt(p.notes)||"Issue noted"}`,owner:"",due:"",priority:p.status==="Not Clean"?"High":"Med",photos:s[d]||[]})};r("facility.ceiling","Ceiling",n?.facility?.ceiling),r("facility.walls","Walls",n?.facility?.walls),r("facility.floors","Floors",n?.facility?.floors),r("facility.lighting","Lighting",n?.facility?.lighting),r("operations.employeePractices","Employee practices",n?.operations?.employeePractices),r("operations.handwashing","Handwashing / supplies",n?.operations?.handwashing),r("operations.labelingDating","Labeling / dating",n?.operations?.labelingDating),r("operations.logs","Logs / documentation",n?.operations?.logs),r("equipment.doubleDoorCooler","Double-door cooler",n?.equipment?.doubleDoorCooler),r("equipment.doubleDoorFreezer","Double-door freezer",n?.equipment?.doubleDoorFreezer),r("equipment.walkInCooler","Walk-in cooler",n?.equipment?.walkInCooler),r("equipment.warmers","Warmers / hot holding",n?.equipment?.warmers),r("equipment.ovens","Ovens",n?.equipment?.ovens),r("equipment.threeCompSink","3-compartment sink",n?.equipment?.threeCompSink),r("equipment.ecolab","Ecolab / chemicals",n?.equipment?.ecolab);const o=Number(n?.temps?.handSinkTempF);!Number.isNaN(o)&&o&&o<95&&t.push({issue:`Hand sink temperature below minimum: ${o}F (min 95F)`,owner:"",due:"",priority:"High",photos:[]});const a=Number(n?.temps?.threeCompSinkTempF);!Number.isNaN(a)&&a&&a<110&&t.push({issue:`3-compartment sink wash temperature below minimum: ${a}F (min 110F)`,owner:"",due:"",priority:"High",photos:[]});for(const d of vu(e))t.push({issue:d.issue,owner:"",due:"",priority:"Med",photos:[]});const u=new Set;return t.filter(d=>{const f=d.issue.toLowerCase();return u.has(f)?!1:(u.add(f),!0)})}function Eu(n){const e=`| Issue | Owner | Due | Priority | Photo # |
|---|---|---|---|---|`,t=n.map(s=>{const r=(s.photos||[]).length?s.photos.join(", "):"";return`| ${mt(s.issue)} | ${mt(s.owner)} | ${mt(s.due)} | ${mt(s.priority)} | ${r} |`}).join(`
`);return`${e}
${t||"|  |  |  |  |  |"}`}function Al({noteType:n,context:e,inspection:t,rawNotes:s,inspectionType:r,inspectionDate:o,inspectorName:a,siteName:u,siteNumber:d,sitePhone:f,supervisorName:p,floor:_}){const w=ar[r]||ar["Regular Inspection"],A=Lg({noteType:n,context:e,inspection:t,inspectionType:r,inspectionDate:o,siteName:u,siteNumber:d}),S=Bt(t),N=Tn({inspection:t,rawNotes:s}),{index:D}=po(t),O=u||e?.kitchen||"Kitchen",R=d?` (#${d})`:"",P=o||e?.date||"",U=[`- Inspection Type: ${r||""}`,`- Site: ${O}${R}`,_?`- Floor: ${_}`:null,`- Date: ${P}`,`- Inspector: ${a||""}`,`- Supervisor: ${p||""}`,f?`- Site Phone: ${f}`:null,`- Overall Status: ${S}`].filter(Boolean).join(`
`),W=[`- siteName: ${u||""}`,`- siteNumber: ${d||""}`,`- supervisorName: ${p||""}`,f?`- sitePhone: ${f}`:null,...Object.entries(e||{}).map(([F,j])=>`- ${F}: ${j||""}`)].filter(Boolean).join(`
`),H=D.length?D.map(F=>`Photo ${F.num}  ${F.label}${F.caption?`  ${F.caption}`:""}`).join(`
`):"No photos attached.",b=[],y=(F,j)=>{j&&j.status&&j.status!=="OK"&&j.status!=="N/A"&&b.push(`- ${F}: ${j.status}${j.notes?`  ${j.notes}`:""}`)};y("Facility > Ceiling",t?.facility?.ceiling),y("Facility > Walls",t?.facility?.walls),y("Facility > Floors",t?.facility?.floors),y("Facility > Lighting",t?.facility?.lighting),y("Operations > Employee practices",t?.operations?.employeePractices),y("Operations > Handwashing / supplies",t?.operations?.handwashing),y("Operations > Labeling / dating",t?.operations?.labelingDating),y("Operations > Logs / documentation",t?.operations?.logs),y("Equipment > Double-door cooler",t?.equipment?.doubleDoorCooler),y("Equipment > Double-door freezer",t?.equipment?.doubleDoorFreezer),y("Equipment > Walk-in cooler",t?.equipment?.walkInCooler),y("Equipment > Warmers / hot holding",t?.equipment?.warmers),y("Equipment > Ovens",t?.equipment?.ovens),y("Equipment > 3-compartment sink",t?.equipment?.threeCompSink),y("Equipment > Ecolab / chemicals",t?.equipment?.ecolab);const v=Number(t?.temps?.handSinkTempF),g=Number(t?.temps?.threeCompSinkTempF);!Number.isNaN(v)&&v&&v<95&&b.push(`- Temps > Hand sink: ${v}F (below 95F minimum)`),!Number.isNaN(g)&&g&&g<110&&b.push(`- Temps > 3-comp wash: ${g}F (below 110F minimum)`);const T=b.length?b.join(`
`):"- No exceptions noted from checklist/temps.",E=N.filter(F=>F.priority==="High").map(F=>`- ${F.issue}${F.photos?.length?` (Photo ${F.photos.join(", ")})`:""}`).join(`
`)||(r==="Event Day"?"- No critical blockers identified for service.":"- No critical issues flagged.");return[A,"","Hi team,","",w.opening,"",`## ${w.headline}  Snapshot`,U,"","## Context (from sit-down notes)",W||"- ","","## Critical Risks",E,"","## Findings by Area",T,"","## Corrective Actions (please assign Owner + Due)",Eu(N),"","## Photo Index",H,"","## Inspector Notes (organized)",rs(s)||""].join(`
`)}function Mg({noteType:n,useCase:e,context:t,inspection:s,rawNotes:r,inspectionType:o,inspectionDate:a,inspectorName:u,siteName:d,siteNumber:f,sitePhone:p,supervisorName:_,floor:w}){const A=Bt(s),S=Tn({inspection:s,rawNotes:r});Sr(r);const N=d||t?.kitchen||"Kitchen",D=a||t?.date||"";if(e==="Email Summary")return Al({noteType:n,context:t,inspection:s,rawNotes:r,inspectionType:o,inspectionDate:a,inspectorName:u,siteName:d,siteNumber:f,sitePhone:p,supervisorName:_,floor:w});if(e==="Slack Update"){const O=[`*${o||"Inspection"}  ${N}  ${D}*`,`Inspector: ${u||""} | Status: *${A}*`,"","*Summary:*",rs(r),""];if(S.length){O.push(`*Action Items (${S.length}):*`);for(const R of S)O.push(`   [${R.priority}] ${R.issue}`)}else O.push("No corrective actions needed.");return O.join(`
`)}if(e==="Google Doc"){const O=[`# ${o||"Inspection"}  ${N}`,`Date: ${D} | Inspector: ${u||""} | Supervisor: ${_||""}`,`Overall Status: ${A}`,"","## Inspector Notes",rs(r),"","## Findings"],R=(P,U)=>{U?.status&&U.status!=="OK"&&U.status!=="N/A"&&O.push(`- **${P}**: ${U.status}${U.notes?`  ${U.notes}`:""}`)};return R("Ceiling",s?.facility?.ceiling),R("Walls",s?.facility?.walls),R("Floors",s?.facility?.floors),R("Lighting",s?.facility?.lighting),R("Employee practices",s?.operations?.employeePractices),R("Handwashing",s?.operations?.handwashing),R("Labeling / dating",s?.operations?.labelingDating),R("Logs",s?.operations?.logs),R("Double-door cooler",s?.equipment?.doubleDoorCooler),R("Double-door freezer",s?.equipment?.doubleDoorFreezer),R("Walk-in cooler",s?.equipment?.walkInCooler),R("Warmers",s?.equipment?.warmers),R("Ovens",s?.equipment?.ovens),R("3-compartment sink",s?.equipment?.threeCompSink),R("Ecolab / chemicals",s?.equipment?.ecolab),O[O.length-1]==="## Findings"&&O.push("- All areas OK."),O.push("","## Action Items"),S.length?O.push(Eu(S)):O.push("No corrective actions needed."),O.join(`
`)}if(e==="Evaluation Scorecard"){const O=[{title:"Facility",items:[["Ceiling",s?.facility?.ceiling],["Walls",s?.facility?.walls],["Floors",s?.facility?.floors],["Lighting",s?.facility?.lighting]]},{title:"Operations",items:[["Employee practices",s?.operations?.employeePractices],["Handwashing",s?.operations?.handwashing],["Labeling / dating",s?.operations?.labelingDating],["Logs",s?.operations?.logs]]},{title:"Equipment",items:[["Double-door cooler",s?.equipment?.doubleDoorCooler],["Double-door freezer",s?.equipment?.doubleDoorFreezer],["Walk-in cooler",s?.equipment?.walkInCooler],["Warmers",s?.equipment?.warmers],["Ovens",s?.equipment?.ovens],["3-comp sink",s?.equipment?.threeCompSink],["Ecolab",s?.equipment?.ecolab]]}],R=["EVALUATION SCORECARD",`${"=".repeat(50)}`,`${o||"Inspection"}  ${N}  ${D}`,`Inspector: ${u||""}`,`Overall: ${A}`,""];for(const W of O){R.push(`--- ${W.title.toUpperCase()} ---`);for(const[H,b]of W.items){const y=b?.status||"N/A",v=y==="OK"?"[PASS]":y==="N/A"?"[ -- ]":"[FAIL]";R.push(`  ${v} ${H}${b?.notes?`  ${b.notes}`:""}`)}R.push("")}R.push("--- TEMPERATURES ---");const P=s?.temps?.handSinkTempF,U=s?.temps?.threeCompSinkTempF;R.push(`  Hand sink: ${P||""}F ${Number(P)>=95?"[PASS]":P?"[FAIL]":""}`),R.push(`  3-comp wash: ${U||""}F ${Number(U)>=110?"[PASS]":U?"[FAIL]":""}`),R.push("",`--- ACTION ITEMS (${S.length}) ---`);for(const W of S)R.push(`  [${W.priority}] ${W.issue}`);return S.length||R.push("  None."),R.push("","--- INSPECTOR NOTES ---",rs(r)),R.join(`
`)}return Al({noteType:n,context:t,inspection:s,rawNotes:r,inspectionType:o,inspectionDate:a,inspectorName:u,siteName:d,siteNumber:f,sitePhone:p,supervisorName:_,floor:w})}function Sl({inspection:n,rawNotes:e,context:t,noteType:s}){const r=[],o=(e||"").toLowerCase(),a=(p,_)=>{_?.status==="Needs Attention"&&!_?.notes?.trim()&&r.push(`"${p}" is flagged Needs Attention but has no notes  add details so corrective actions are clear.`),_?.status==="Not Clean"&&!_?.notes?.trim()&&r.push(`"${p}" is flagged Not Clean but has no notes  describe the issue for the report.`)};a("Ceiling",n?.facility?.ceiling),a("Walls",n?.facility?.walls),a("Floors",n?.facility?.floors),a("Lighting",n?.facility?.lighting),a("Employee practices",n?.operations?.employeePractices),a("Handwashing",n?.operations?.handwashing),a("Labeling / dating",n?.operations?.labelingDating),a("Logs",n?.operations?.logs),a("Double-door cooler",n?.equipment?.doubleDoorCooler),a("Double-door freezer",n?.equipment?.doubleDoorFreezer),a("Walk-in cooler",n?.equipment?.walkInCooler),a("Warmers",n?.equipment?.warmers),a("Ovens",n?.equipment?.ovens),a("3-compartment sink",n?.equipment?.threeCompSink),a("Ecolab / chemicals",n?.equipment?.ecolab);const u=Number(n?.temps?.handSinkTempF),d=Number(n?.temps?.threeCompSinkTempF);u&&u<95&&r.push(`Hand sink temp is ${u}F (below 95F min). Flag for immediate maintenance.`),d&&d<110&&r.push(`3-comp sink wash temp is ${d}F (below 110F min). Check water heater.`),u&&u>=95&&u<100&&r.push(`Hand sink temp is ${u}F  passes but is close to the 95F minimum. Monitor.`),d&&d>=110&&d<115&&r.push(`3-comp wash temp is ${d}F  passes but is close to the 110F minimum. Monitor.`),o.includes("allergen")&&r.push("Allergen concerns detected in notes  ensure allergen training is scheduled and documented."),o.includes("haccp")&&r.push("HACCP mentioned  verify all HACCP logs are complete and signed before next inspection."),(o.includes("pest")||o.includes("trap"))&&r.push("Pest control mentioned  document trap locations and schedule pest vendor follow-up."),(o.includes("cutting board")||o.includes("scored"))&&r.push("Scored cutting boards noted  replace immediately per food safety protocol."),o.includes("calibrat")&&r.push("Thermometer calibration mentioned  document last calibration date and schedule next.");const f=vu(e);return f.length>3&&r.push(`${f.length} action items found in notes  consider prioritizing the top 3 for immediate follow-up.`),r.length||r.push("No issues detected. Inspection looks clean!"),r}function Bg({noteType:n,useCase:e,context:t,inspection:s,rawNotes:r,inspectionType:o,inspectionDate:a,inspectorName:u,siteName:d,siteNumber:f,sitePhone:p,supervisorName:_,floor:w}){const A=Bt(s),S=Tn({inspection:s,rawNotes:r});Sr(r);const N=d||t?.kitchen||"Kitchen",D=a||t?.date||new Date().toLocaleDateString(),O=ar[o]||ar["Regular Inspection"],{index:R}=po(s),P=Number(s?.temps?.handSinkTempF),U=Number(s?.temps?.threeCompSinkTempF),W=[{section:"Facility",label:"Ceiling",node:s?.facility?.ceiling},{section:"Facility",label:"Walls",node:s?.facility?.walls},{section:"Facility",label:"Floors",node:s?.facility?.floors},{section:"Facility",label:"Lighting",node:s?.facility?.lighting},{section:"Operations",label:"Employee Practices",node:s?.operations?.employeePractices},{section:"Operations",label:"Handwashing / Supplies",node:s?.operations?.handwashing},{section:"Operations",label:"Labeling / Dating",node:s?.operations?.labelingDating},{section:"Operations",label:"Logs / Documentation",node:s?.operations?.logs},{section:"Equipment",label:"Double-Door Cooler",node:s?.equipment?.doubleDoorCooler},{section:"Equipment",label:"Double-Door Freezer",node:s?.equipment?.doubleDoorFreezer},{section:"Equipment",label:"Walk-In Cooler",node:s?.equipment?.walkInCooler},{section:"Equipment",label:"Warmers / Hot Holding",node:s?.equipment?.warmers},{section:"Equipment",label:"Ovens",node:s?.equipment?.ovens},{section:"Equipment",label:"3-Compartment Sink",node:s?.equipment?.threeCompSink},{section:"Equipment",label:"Ecolab / Chemicals",node:s?.equipment?.ecolab}],H=W.filter(y=>y.node?.status&&y.node.status!=="OK"&&y.node.status!=="N/A");P&&P<95&&H.push({section:"Temperature",label:"Hand Sink",node:{status:"Not Clean",notes:`${P}F (below 95F minimum)`}}),U&&U<110&&H.push({section:"Temperature",label:"3-Comp Wash",node:{status:"Not Clean",notes:`${U}F (below 110F minimum)`}});const b=["Facility","Operations","Equipment"];return c.jsxs("div",{className:"rpt",children:[c.jsxs("div",{className:"rptHeader",children:[c.jsx("img",{src:pu,alt:"Sodexo",className:"rptLogo"}),c.jsxs("div",{className:"rptHeaderRight",children:[c.jsx("div",{className:"rptDocType",children:o||"Kitchen Inspection"}),c.jsxs("div",{className:"rptDocId",children:["Report #",Date.now().toString(36).toUpperCase()]})]})]}),c.jsxs("div",{className:"rptTitleBar",children:[c.jsxs("div",{children:[c.jsx("div",{className:"rptTitle",children:N}),c.jsx("div",{className:"rptDate",children:D})]}),c.jsx("div",{className:pe("rptStatus",A==="Pass"?"rptStatusPass":"rptStatusFail"),children:A==="Pass"?"PASSED":"NEEDS ATTENTION"})]}),c.jsxs("div",{className:"rptInfoGrid",children:[c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Inspector"}),c.jsx("div",{className:"rptInfoValue",children:u||""})]}),c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Supervisor"}),c.jsx("div",{className:"rptInfoValue",children:_||""})]}),c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Unit / Location"}),c.jsx("div",{className:"rptInfoValue",children:f||""})]}),w&&c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Floor"}),c.jsx("div",{className:"rptInfoValue",children:w})]}),p&&c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Phone"}),c.jsx("div",{className:"rptInfoValue",children:p})]}),c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"Hand Sink Temp"}),c.jsxs("div",{className:"rptInfoValue",children:[s?.temps?.handSinkTempF?`${s.temps.handSinkTempF}F`:"",P>=95&&c.jsx("span",{className:"rptCheck",children:" "}),P>0&&P<95&&c.jsx("span",{className:"rptWarn",children:"  Below 95F"})]})]}),c.jsxs("div",{className:"rptInfoItem",children:[c.jsx("div",{className:"rptInfoLabel",children:"3-Comp Wash Temp"}),c.jsxs("div",{className:"rptInfoValue",children:[s?.temps?.threeCompSinkTempF?`${s.temps.threeCompSinkTempF}F`:"",U>=110&&c.jsx("span",{className:"rptCheck",children:" "}),U>0&&U<110&&c.jsx("span",{className:"rptWarn",children:"  Below 110F"})]})]})]}),(e==="Email Summary"||e==="Google Doc")&&O.opening&&c.jsx("div",{className:"rptBlock",children:c.jsx("p",{className:"rptParagraph",children:O.opening})}),c.jsxs("div",{className:"rptBlock",children:[c.jsx("div",{className:"rptBlockTitle",children:"Inspection Scorecard"}),c.jsxs("table",{className:"rptTable",children:[c.jsx("thead",{children:c.jsxs("tr",{children:[c.jsx("th",{children:"Section"}),c.jsx("th",{children:"Item"}),c.jsx("th",{children:"Status"}),c.jsx("th",{children:"Notes"})]})}),c.jsxs("tbody",{children:[b.map(y=>{const v=W.filter(g=>g.section===y);return v.map((g,T)=>c.jsxs("tr",{className:g.node?.status==="Not Clean"?"rptRowFail":g.node?.status==="Needs Attention"?"rptRowWarn":"",children:[T===0&&c.jsx("td",{rowSpan:v.length,className:"rptSectionCell",children:y}),c.jsx("td",{children:g.label}),c.jsx("td",{children:c.jsx("span",{className:pe("rptStatusPill",g.node?.status==="OK"?"rptPillPass":g.node?.status==="Not Clean"?"rptPillFail":g.node?.status==="Needs Attention"?"rptPillWarn":"rptPillNa"),children:g.node?.status||"N/A"})}),c.jsx("td",{className:"rptNoteCell",children:g.node?.notes||""})]},g.label))}),c.jsxs("tr",{className:P>0&&P<95?"rptRowFail":"",children:[c.jsx("td",{rowSpan:2,className:"rptSectionCell",children:"Temps"}),c.jsx("td",{children:"Hand Sink"}),c.jsx("td",{children:c.jsx("span",{className:pe("rptStatusPill",P>=95?"rptPillPass":P?"rptPillFail":"rptPillNa"),children:s?.temps?.handSinkTempF?`${s.temps.handSinkTempF}F`:"N/A"})}),c.jsx("td",{className:"rptNoteCell",children:P>=95?"Meets minimum":P?"Below 95F minimum":""})]}),c.jsxs("tr",{className:U>0&&U<110?"rptRowFail":"",children:[c.jsx("td",{children:"3-Comp Wash"}),c.jsx("td",{children:c.jsx("span",{className:pe("rptStatusPill",U>=110?"rptPillPass":U?"rptPillFail":"rptPillNa"),children:s?.temps?.threeCompSinkTempF?`${s.temps.threeCompSinkTempF}F`:"N/A"})}),c.jsx("td",{className:"rptNoteCell",children:U>=110?"Meets minimum":U?"Below 110F minimum":""})]})]})]})]}),H.length>0&&c.jsxs("div",{className:"rptBlock rptBlockAlert",children:[c.jsxs("div",{className:"rptBlockTitle rptBlockTitleAlert",children:["Issues Found (",H.length,")"]}),H.map((y,v)=>c.jsxs("div",{className:"rptIssueRow",children:[c.jsx("span",{className:"rptIssueNum",children:v+1}),c.jsxs("div",{className:"rptIssueContent",children:[c.jsxs("div",{className:"rptIssueName",children:[y.label," ",c.jsxs("span",{className:"rptIssueSection",children:["(",y.section,")"]})]}),y.node?.notes&&c.jsx("div",{className:"rptIssueDetail",children:y.node.notes})]}),c.jsx("span",{className:pe("rptStatusPill",y.node?.status==="Not Clean"?"rptPillFail":"rptPillWarn"),children:y.node?.status})]},v))]}),S.length>0&&c.jsxs("div",{className:"rptBlock",children:[c.jsx("div",{className:"rptBlockTitle",children:"Corrective Actions Required"}),S.map((y,v)=>c.jsxs("div",{className:"rptActionRow",children:[c.jsx("span",{className:pe("rptPriorityDot",y.priority==="High"?"rptDotHigh":"rptDotMed")}),c.jsxs("div",{className:"rptActionContent",children:[c.jsx("span",{className:"rptActionText",children:y.issue}),c.jsxs("span",{className:pe("rptPriorityLabel",y.priority==="High"?"rptLabelHigh":"rptLabelMed"),children:[y.priority," Priority"]})]})]},v))]}),R.length>0&&c.jsxs("div",{className:"rptBlock",children:[c.jsx("div",{className:"rptBlockTitle",children:"Photo Index"}),c.jsx("div",{className:"rptPhotoList",children:R.map(y=>c.jsxs("div",{className:"rptPhotoItem",children:[c.jsxs("span",{className:"rptPhotoNum",children:["Photo #",y.num]}),c.jsxs("span",{children:[y.label,y.caption?`  ${y.caption}`:""]})]},y.num))})]}),r&&(()=>{const{grouped:y}=Nr(r);return Object.values(y).some(g=>g.length>0)?c.jsxs("div",{className:"rptBlock",children:[c.jsx("div",{className:"rptBlockTitle",children:"Inspector Notes"}),c.jsx("div",{className:"rptNotesOrganized",children:Cr.map(g=>!y[g]||!y[g].length?null:c.jsxs("div",{className:"rptNoteCategory",children:[c.jsx("div",{className:pe("rptNoteCatLabel",`rptNoteCat--${g}`),children:xr[g]}),c.jsx("ul",{className:"rptNoteBullets",children:y[g].map((T,I)=>c.jsx("li",{children:T},I))})]},g))})]}):null})(),c.jsxs("div",{className:"rptFooter",children:[c.jsxs("div",{children:["Generated ",new Date().toLocaleDateString()," ",new Date().toLocaleTimeString(),"  Sodexo Kitchen Inspection System"]}),c.jsx("div",{children:"This report is confidential and intended for internal use only."})]})]})}function $g({inspection:n,rawNotes:e,inspectionType:t,inspectionDate:s,inspectorName:r,siteName:o,siteNumber:a,supervisorName:u}){const d=[["Section","Item","Status","Notes","Priority"]],f=(p,_,w)=>{if(!w)return;const A=w.status==="Not Clean"?"High":w.status==="Needs Attention"?"Med":"";d.push([p,_,w.status||"",(w.notes||"").replace(/"/g,'""'),A])};return f("Facility","Ceiling",n?.facility?.ceiling),f("Facility","Walls",n?.facility?.walls),f("Facility","Floors",n?.facility?.floors),f("Facility","Lighting",n?.facility?.lighting),f("Operations","Employee practices",n?.operations?.employeePractices),f("Operations","Handwashing / supplies",n?.operations?.handwashing),f("Operations","Labeling / dating",n?.operations?.labelingDating),f("Operations","Logs / documentation",n?.operations?.logs),f("Equipment","Double-door cooler",n?.equipment?.doubleDoorCooler),f("Equipment","Double-door freezer",n?.equipment?.doubleDoorFreezer),f("Equipment","Walk-in cooler",n?.equipment?.walkInCooler),f("Equipment","Warmers / hot holding",n?.equipment?.warmers),f("Equipment","Ovens",n?.equipment?.ovens),f("Equipment","3-compartment sink",n?.equipment?.threeCompSink),f("Equipment","Ecolab / chemicals",n?.equipment?.ecolab),d.push(["Temps","Hand sink (F)",n?.temps?.handSinkTempF||"",Number(n?.temps?.handSinkTempF)>=95?"Pass":"Below min",""]),d.push(["Temps","3-comp wash (F)",n?.temps?.threeCompSinkTempF||"",Number(n?.temps?.threeCompSinkTempF)>=110?"Pass":"Below min",""]),d}function Ug({inspection:n,rawNotes:e,inspectionType:t,inspectionDate:s,inspectorName:r,siteName:o,siteNumber:a,supervisorName:u,floor:d}){const f=$g({inspection:n,rawNotes:e,inspectionType:t,inspectionDate:s,inspectorName:r,siteName:o,siteNumber:a,supervisorName:u}),p=Bt(n),_=Tn({inspection:n,rawNotes:e}),w=`<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
<head><meta charset="utf-8">
<!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>
<x:Name>Inspection</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions>
</x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]-->
<style>
  td, th { mso-number-format:"\\@"; padding: 6px 10px; border: 1px solid #ccc; font-family: Calibri, Arial; font-size: 11pt; }
  th { background: #2A295C; color: white; font-weight: bold; }
  .section-header { background: #F0F1F5; font-weight: bold; color: #2A295C; font-size: 12pt; }
  .pass { background: #ECFDF5; color: #15803D; font-weight: bold; }
  .fail { background: #FEF2F2; color: #DC2626; font-weight: bold; }
  .warn { background: #FFFBEB; color: #D97706; }
  .meta-label { font-weight: bold; color: #2A295C; background: #F7F8FA; }
  .title { font-size: 16pt; font-weight: bold; color: #2A295C; }
</style></head><body>
<table>
  <tr><td class="title" colspan="5">SODEXO KITCHEN INSPECTION REPORT</td></tr>
  <tr><td colspan="5" style="border-bottom: 3px solid #EE0000; padding: 0;"></td></tr>
  <tr><td class="meta-label">Inspection Type</td><td colspan="4">${t||""}</td></tr>
  <tr><td class="meta-label">Date</td><td colspan="4">${s||""}</td></tr>
  <tr><td class="meta-label">Inspector</td><td colspan="4">${r||""}</td></tr>
  <tr><td class="meta-label">Site / Location</td><td colspan="4">${o||""}</td></tr>
  <tr><td class="meta-label">Unit #</td><td colspan="4">${a||""}</td></tr>
  <tr><td class="meta-label">Floor</td><td colspan="4">${d||""}</td></tr>
  <tr><td class="meta-label">Supervisor</td><td colspan="4">${u||""}</td></tr>
  <tr><td class="meta-label">Overall Status</td><td colspan="4" class="${p==="Pass"?"pass":"fail"}">${p}</td></tr>
  <tr><td colspan="5"></td></tr>
  <tr><td class="section-header" colspan="5">INSPECTION SCORECARD</td></tr>
  <tr><th>Section</th><th>Item</th><th>Status</th><th>Notes</th><th>Priority</th></tr>
  ${f.slice(1).map(N=>{const D=N[2]==="OK"?"pass":N[2]==="Not Clean"?"fail":N[2]==="Needs Attention"?"warn":"";return`<tr><td>${N[0]}</td><td>${N[1]}</td><td class="${D}">${N[2]}</td><td>${N[3]}</td><td>${N[4]}</td></tr>`}).join(`
  `)}
  <tr><td colspan="5"></td></tr>
  ${_.length>0?`
  <tr><td class="section-header" colspan="5">CORRECTIVE ACTIONS</td></tr>
  <tr><th>#</th><th colspan="3">Issue</th><th>Priority</th></tr>
  ${_.map((N,D)=>`<tr><td>${D+1}</td><td colspan="3">${N.issue}</td><td class="${N.priority==="High"?"fail":"warn"}">${N.priority}</td></tr>`).join(`
  `)}
  <tr><td colspan="5"></td></tr>`:""}
  <tr><td class="section-header" colspan="5">INSPECTOR NOTES</td></tr>
  <tr><td colspan="5" style="white-space:pre-wrap;font-size:10pt;">${rs(e).replace(/</g,"&lt;")}</td></tr>
</table></body></html>`,A=new Blob([w],{type:"application/vnd.ms-excel"}),S=`inspection_${s||"undated"}_${(o||"site").replace(/\s+/g,"_")}.xls`;mo(A,S)}function bu({output:n,inspection:e,rawNotes:t,inspectionType:s,inspectionDate:r,siteName:o,siteNumber:a,sitePhone:u,inspectorName:d,supervisorName:f}){const p=Bt(e),_=Tn({inspection:e,rawNotes:t});Sr(t);const w=[["Facility","Ceiling",e?.facility?.ceiling],["Facility","Walls",e?.facility?.walls],["Facility","Floors",e?.facility?.floors],["Facility","Lighting",e?.facility?.lighting],["Operations","Employee Practices",e?.operations?.employeePractices],["Operations","Handwashing / Supplies",e?.operations?.handwashing],["Operations","Labeling / Dating",e?.operations?.labelingDating],["Operations","Logs / Documentation",e?.operations?.logs],["Equipment","Double-Door Cooler",e?.equipment?.doubleDoorCooler],["Equipment","Double-Door Freezer",e?.equipment?.doubleDoorFreezer],["Equipment","Walk-In Cooler",e?.equipment?.walkInCooler],["Equipment","Warmers / Hot Holding",e?.equipment?.warmers],["Equipment","Ovens",e?.equipment?.ovens],["Equipment","3-Compartment Sink",e?.equipment?.threeCompSink],["Equipment","Ecolab / Chemicals",e?.equipment?.ecolab]],A=w.filter(([,,P])=>P?.status&&P.status!=="OK"&&P.status!=="N/A"),S=Number(e?.temps?.handSinkTempF),N=Number(e?.temps?.threeCompSinkTempF),D=`<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">
<head><meta charset="utf-8">
<!--[if gte mso 9]><xml><w:WordDocument><w:View>Print</w:View><w:Zoom>100</w:Zoom></w:WordDocument></xml><![endif]-->
<style>
  @page { size: letter; margin: 1in; }
  body { font-family: Calibri, Arial, sans-serif; font-size: 11pt; color: #1F2937; line-height: 1.5; }
  h1 { color: #2A295C; font-size: 22pt; margin-bottom: 4px; }
  h2 { color: #2A295C; font-size: 14pt; border-bottom: 2px solid #2A295C; padding-bottom: 4px; margin-top: 24px; }
  .red-line { border-bottom: 3px solid #EE0000; margin-bottom: 20px; }
  .info-table { width: 100%; border-collapse: collapse; margin: 16px 0; }
  .info-table td { padding: 8px 12px; border: 1px solid #E5E7EB; font-size: 10pt; }
  .info-label { background: #F7F8FA; font-weight: bold; color: #2A295C; width: 30%; }
  .status-pass { background: #ECFDF5; color: #15803D; font-weight: bold; font-size: 12pt; text-align: center; padding: 10px; }
  .status-fail { background: #FEF2F2; color: #DC2626; font-weight: bold; font-size: 12pt; text-align: center; padding: 10px; }
  table.scorecard { width: 100%; border-collapse: collapse; margin: 12px 0; }
  table.scorecard th { background: #2A295C; color: white; padding: 8px 12px; text-align: left; font-size: 10pt; }
  table.scorecard td { padding: 7px 12px; border: 1px solid #E5E7EB; font-size: 10pt; }
  .sc-section { background: #F0F1F5; font-weight: bold; color: #2A295C; }
  .pill-pass { background: #ECFDF5; color: #15803D; font-weight: bold; padding: 2px 8px; }
  .pill-fail { background: #FEF2F2; color: #DC2626; font-weight: bold; padding: 2px 8px; }
  .pill-warn { background: #FFFBEB; color: #D97706; font-weight: bold; padding: 2px 8px; }
  .pill-na { background: #F3F4F6; color: #9CA3AF; padding: 2px 8px; }
  .issue-num { background: #DC2626; color: white; font-weight: bold; padding: 2px 8px; text-align: center; width: 30px; }
  .notes-box { background: #F7F8FA; padding: 16px; border-left: 3px solid #2A295C; white-space: pre-wrap; font-size: 10pt; line-height: 1.7; }
  .footer { margin-top: 32px; padding-top: 12px; border-top: 1px solid #E5E7EB; font-size: 8pt; color: #9CA3AF; text-align: center; }
</style></head><body>

<h1>Sodexo Kitchen Inspection Report</h1>
<div class="red-line"></div>

<table class="info-table">
  <tr><td class="info-label">Inspection Type</td><td>${s||""}</td><td class="info-label">Date</td><td>${r||""}</td></tr>
  <tr><td class="info-label">Inspector</td><td>${d||""}</td><td class="info-label">Supervisor</td><td>${f||""}</td></tr>
  <tr><td class="info-label">Site / Location</td><td>${o||""}</td><td class="info-label">Unit #</td><td>${a||""}</td></tr>
  ${u?`<tr><td class="info-label">Phone</td><td>${u}</td><td></td><td></td></tr>`:""}
  <tr><td class="info-label">Hand Sink Temp</td><td>${e?.temps?.handSinkTempF?e.temps.handSinkTempF+"F":""} ${S>=95?"":S?" Below 95F":""}</td>
      <td class="info-label">3-Comp Wash Temp</td><td>${e?.temps?.threeCompSinkTempF?e.temps.threeCompSinkTempF+"F":""} ${N>=110?"":N?" Below 110F":""}</td></tr>
  <tr><td class="info-label">Overall Status</td><td colspan="3" class="${p==="Pass"?"status-pass":"status-fail"}">${p==="Pass"?"PASSED":"NEEDS ATTENTION"}</td></tr>
</table>

<h2>Inspection Scorecard</h2>
<table class="scorecard">
  <tr><th>Section</th><th>Item</th><th>Status</th><th>Notes</th></tr>
  ${w.map(([P,U,W])=>{const H=W?.status||"N/A";return`<tr><td>${P}</td><td>${U}</td><td><span class="${H==="OK"?"pill-pass":H==="Not Clean"?"pill-fail":H==="Needs Attention"?"pill-warn":"pill-na"}">${H}</span></td><td>${W?.notes||""}</td></tr>`}).join(`
  `)}
  <tr><td>Temps</td><td>Hand Sink</td><td><span class="${S>=95?"pill-pass":S?"pill-fail":"pill-na"}">${e?.temps?.handSinkTempF?e.temps.handSinkTempF+"F":"N/A"}</span></td><td>${S>=95?"Meets minimum":S?"Below 95F minimum":""}</td></tr>
  <tr><td>Temps</td><td>3-Comp Wash</td><td><span class="${N>=110?"pill-pass":N?"pill-fail":"pill-na"}">${e?.temps?.threeCompSinkTempF?e.temps.threeCompSinkTempF+"F":"N/A"}</span></td><td>${N>=110?"Meets minimum":N?"Below 110F minimum":""}</td></tr>
</table>

${A.length>0?`
<h2>Issues Found (${A.length})</h2>
<table class="scorecard">
  <tr><th>#</th><th>Area</th><th>Item</th><th>Status</th><th>Notes</th></tr>
  ${A.map(([P,U,W],H)=>`<tr><td class="issue-num">${H+1}</td><td>${P}</td><td>${U}</td><td><span class="pill-fail">${W.status}</span></td><td>${W.notes||""}</td></tr>`).join(`
  `)}
</table>`:'<h2>Issues</h2><p style="background:#ECFDF5;padding:12px;color:#15803D;font-weight:bold;text-align:center;">All areas passed inspection</p>'}

${_.length>0?`
<h2>Corrective Actions Required</h2>
<table class="scorecard">
  <tr><th>#</th><th>Issue</th><th>Priority</th></tr>
  ${_.map((P,U)=>`<tr><td style="text-align:center">${U+1}</td><td>${P.issue}</td><td><span class="${P.priority==="High"?"pill-fail":"pill-warn"}">${P.priority}</span></td></tr>`).join(`
  `)}
</table>`:""}

<h2>Inspector Notes</h2>
${(()=>{const{grouped:P}=Nr(t),U=Cr.filter(W=>P[W]?.length);return U.length?U.map(W=>`<div style="margin-bottom:12px;"><p style="font-weight:bold;color:#2A295C;font-size:10pt;margin:0 0 4px 0;">${xr[W]}</p><ul style="margin:0;padding-left:20px;">${P[W].map(H=>`<li style="margin-bottom:4px;font-size:10pt;line-height:1.5;">${H.replace(/</g,"&lt;")}</li>`).join("")}</ul></div>`).join(""):'<div class="notes-box"></div>'})()}

<div class="footer">
  <p>Generated ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}  Sodexo Kitchen Inspection System</p>
  <p>This report is confidential and intended for internal use only.</p>
</div>
</body></html>`,O=new Blob([D],{type:"application/msword"}),R=`inspection_${r||"undated"}_${(o||"site").replace(/\s+/g,"_")}.doc`;mo(O,R)}function Tu({output:n,inspectionDate:e,siteName:t}){const s=new Blob([n||""],{type:"text/plain;charset=utf-8;"}),r=`inspection_${e||"undated"}_${(t||"site").replace(/\s+/g,"_")}.txt`;mo(s,r)}function qg({history:n}){const[e,t]=B.useState(null),[s,r]=B.useState(null),o=B.useMemo(()=>{const A={};for(const S of n){const N=`${S.siteName||S.location||"Unknown"}${S.floor?` - ${S.floor}`:""}`,D=S.siteNumber||"";A[N]||(A[N]={points:[],unitNum:D});const O=Number(S.temps?.handSinkTempF),R=Number(S.temps?.threeCompSinkTempF);(O||R)&&A[N].points.push({date:S.inspectionDate||S.savedAt?.slice(0,10)||"",handSink:O||null,threeComp:R||null,floor:S.floor||"",status:S.overallStatus||""})}for(const S of Object.keys(A))A[S].points.sort((N,D)=>N.date.localeCompare(D.date));return A},[n]),a=Object.keys(o);if(a.length===0)return null;const u=500,d=220,f=45,p=20,_=20,w=50;return c.jsxs("div",{className:"card",style:{marginBottom:24},children:[c.jsxs("div",{className:"cardHeader",children:[c.jsx("div",{className:"cardTitle",children:"Temperature Trends by Location"}),c.jsxs("div",{className:"cardSub",style:{fontSize:"0.72rem",color:"#6b7280"},children:[a.length," location",a.length!==1?"s":""," tracked"]})]}),c.jsx("div",{className:"cardBody",children:c.jsx("div",{className:"tempChartsGrid",children:a.map(A=>{const{points:S,unitNum:N}=o[A],D=S.flatMap(j=>[j.handSink,j.threeComp]).filter(Boolean);if(D.length===0)return null;const O=Math.min(...D,90)-5,R=Math.max(...D,115)+5,P=R-O||1,U=S.length>1?(u-f-p)/(S.length-1):(u-f-p)/2,W=S.length===1?(u-f-p)/2:0,H=j=>f+W+j*U,b=j=>_+(d-_-w)*(1-(j-O)/P),y=S.map((j,J)=>j.handSink?[H(J),b(j.handSink)]:null).filter(Boolean),v=S.map((j,J)=>j.threeComp?[H(J),b(j.threeComp)]:null).filter(Boolean),g=j=>j.map((J,_e)=>`${_e===0?"M":"L"}${J[0]},${J[1]}`).join(" "),T=j=>{if(j.length<2)return"";const J=d-w;return`${g(j)} L${j[j.length-1][0]},${J} L${j[0][0]},${J} Z`},I=[];for(let j=Math.ceil(O/10)*10;j<=R;j+=10)I.push(j);const E=y.length>0?Math.round(S.reduce((j,J)=>j+(J.handSink||0),0)/S.filter(j=>j.handSink).length):null,F=v.length>0?Math.round(S.reduce((j,J)=>j+(J.threeComp||0),0)/S.filter(j=>j.threeComp).length):null;return c.jsxs("div",{className:"tempChartItem",children:[c.jsxs("div",{className:"tempChartHeader",children:[c.jsx("div",{className:"tempChartLabel",children:A}),N&&c.jsxs("span",{className:"tempChartUnit",children:["#",N]})]}),c.jsxs("div",{className:"tempChartAvgs",children:[E!==null&&c.jsxs("span",{className:pe("tempAvgPill","tempAvgPillClickable",s==="hand"&&"tempAvgPillActive"),style:{background:s==="hand"?"#3b82f6":E>=95?"#dbeafe":"#fee2e2",color:s==="hand"?"#fff":E>=95?"#1d4ed8":"#dc2626"},onClick:()=>r(s==="hand"?null:"hand"),children:["Avg Hand: ",E,"F"]}),F!==null&&c.jsxs("span",{className:pe("tempAvgPill","tempAvgPillClickable",s==="three"&&"tempAvgPillActive"),style:{background:s==="three"?"#8b5cf6":F>=110?"#ede9fe":"#fee2e2",color:s==="three"?"#fff":F>=110?"#7c3aed":"#dc2626"},onClick:()=>r(s==="three"?null:"three"),children:["Avg 3-Comp: ",F,"F"]}),c.jsxs("span",{className:"tempAvgPill",style:{background:"#f0fdf4",color:"#15803d"},children:[S.length," reading",S.length!==1?"s":""]})]}),c.jsxs("svg",{viewBox:`0 0 ${u} ${d}`,className:"tempChartSvg",onMouseLeave:()=>t(null),children:[c.jsxs("defs",{children:[c.jsxs("linearGradient",{id:`handGrad-${A.replace(/\W/g,"")}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[c.jsx("stop",{offset:"0%",stopColor:"#3b82f6",stopOpacity:"0.25"}),c.jsx("stop",{offset:"100%",stopColor:"#3b82f6",stopOpacity:"0.02"})]}),c.jsxs("linearGradient",{id:`threeGrad-${A.replace(/\W/g,"")}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[c.jsx("stop",{offset:"0%",stopColor:"#8b5cf6",stopOpacity:"0.25"}),c.jsx("stop",{offset:"100%",stopColor:"#8b5cf6",stopOpacity:"0.02"})]})]}),I.map(j=>c.jsxs("g",{children:[c.jsx("line",{x1:f,y1:b(j),x2:u-p,y2:b(j),stroke:"#e5e7eb",strokeWidth:"1"}),c.jsxs("text",{x:f-6,y:b(j)+4,textAnchor:"end",fontSize:"9",fill:"#9ca3af",children:[j,""]})]},j)),[95,110].map(j=>{if(j<O||j>R)return null;const J=b(j),_e=j===95,Ze=s&&s!==(_e?"hand":"three");return c.jsxs("g",{opacity:Ze?.15:1,style:{transition:"opacity 0.3s"},children:[c.jsx("line",{x1:f,y1:J,x2:u-p,y2:J,stroke:_e?"#3b82f6":"#8b5cf6",strokeDasharray:"6,4",strokeWidth:"1.5",opacity:"0.6"}),c.jsx("rect",{x:u-p+2,y:J-8,width:"36",height:"16",rx:"3",fill:_e?"#3b82f6":"#8b5cf6",opacity:"0.9"}),c.jsxs("text",{x:u-p+20,y:J+4,textAnchor:"middle",fontSize:"8",fill:"white",fontWeight:"bold",children:[j,"F"]})]},j)}),y.length>=2&&c.jsx("path",{d:T(y),fill:`url(#handGrad-${A.replace(/\W/g,"")})`,opacity:s&&s!=="hand"?.1:1,style:{transition:"opacity 0.3s"}}),v.length>=2&&c.jsx("path",{d:T(v),fill:`url(#threeGrad-${A.replace(/\W/g,"")})`,opacity:s&&s!=="three"?.1:1,style:{transition:"opacity 0.3s"}}),y.length>1&&c.jsx("path",{d:g(y),fill:"none",stroke:"#3b82f6",strokeWidth:s==="hand"?"3.5":"2.5",strokeLinecap:"round",strokeLinejoin:"round",opacity:s&&s!=="hand"?.15:1,style:{transition:"opacity 0.3s, stroke-width 0.3s"}}),v.length>1&&c.jsx("path",{d:g(v),fill:"none",stroke:"#8b5cf6",strokeWidth:s==="three"?"3.5":"2.5",strokeLinecap:"round",strokeLinejoin:"round",opacity:s&&s!=="three"?.15:1,style:{transition:"opacity 0.3s, stroke-width 0.3s"}}),S.map((j,J)=>{const _e=`${A}-${J}`;return c.jsxs("g",{onMouseEnter:()=>t(_e),onTouchStart:()=>t(_e),children:[j.handSink&&c.jsxs("g",{opacity:s&&s!=="hand"?.15:1,style:{transition:"opacity 0.3s"},children:[c.jsx("circle",{cx:H(J),cy:b(j.handSink),r:s==="hand"?6:5,fill:"white",stroke:j.handSink>=95?"#3b82f6":"#ef4444",strokeWidth:"2.5",style:{transition:"r 0.3s"}}),(e===_e||s==="hand")&&c.jsxs("g",{children:[c.jsx("rect",{x:H(J)-30,y:b(j.handSink)-26,width:"60",height:"20",rx:"4",fill:"#1e293b",opacity:"0.9"}),c.jsxs("text",{x:H(J),y:b(j.handSink)-12,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:[j.handSink,"F"]})]})]}),j.threeComp&&c.jsxs("g",{opacity:s&&s!=="three"?.15:1,style:{transition:"opacity 0.3s"},children:[c.jsx("circle",{cx:H(J),cy:b(j.threeComp),r:s==="three"?6:5,fill:"white",stroke:j.threeComp>=110?"#8b5cf6":"#ef4444",strokeWidth:"2.5",style:{transition:"r 0.3s"}}),(e===_e||s==="three")&&c.jsxs("g",{children:[c.jsx("rect",{x:H(J)-30,y:b(j.threeComp)-26,width:"60",height:"20",rx:"4",fill:"#1e293b",opacity:"0.9"}),c.jsxs("text",{x:H(J),y:b(j.threeComp)-12,textAnchor:"middle",fontSize:"10",fill:"white",fontWeight:"bold",children:[j.threeComp,"F"]})]})]}),c.jsx("rect",{x:H(J)-15,y:_,width:"30",height:d-_-w,fill:"transparent"})]},J)}),S.map((j,J)=>c.jsx("text",{x:H(J),y:d-10,textAnchor:"middle",fontSize:"9",fill:"#6b7280",fontWeight:"500",children:j.date.slice(5)},J))]}),c.jsxs("div",{className:"tempChartLegend",children:[c.jsxs("span",{className:"tempLegendItem",children:[c.jsx("span",{className:"tempLegendDot",style:{background:"#3b82f6"}})," Hand Sink (min 95F)"]}),c.jsxs("span",{className:"tempLegendItem",children:[c.jsx("span",{className:"tempLegendDot",style:{background:"#8b5cf6"}})," 3-Comp (min 110F)"]}),c.jsxs("span",{className:"tempLegendItem",children:[c.jsx("span",{className:"tempLegendDot",style:{background:"#ef4444"}})," Below min"]})]})]},A)})})})]})}function Hg({history:n,onLocationClick:e}){const t=B.useMemo(()=>{if(n.length<2)return null;const s={},r={},o={},a={};for(const S of n){const N=`${S.siteName||S.location||"Unknown"}${S.floor?` (${S.floor})`:""}`,D=S.siteNumber||"";a[N]=(a[N]||0)+1;const O=new Set;for(const R of S.actionItems||[]){const P=R.issue?.split(":")[0]?.trim()||"Other";O.has(P)||(O.add(P),s[P]=(s[P]||0)+1,r[P]||(r[P]=[]),r[P].push({name:S.siteName||S.location||"Unknown",unit:D,floor:S.floor||"",date:S.inspectionDate||""}),o[N]||(o[N]={}),o[N][P]=(o[N][P]||0)+1)}}const u=Object.entries(s).filter(([,S])=>S>=2).sort((S,N)=>N[1]-S[1]).map(([S,N])=>{const D={};for(const R of r[S]){const P=`${R.name}${R.unit?` #${R.unit}`:""}${R.floor?` (${R.floor})`:""}`;D[P]||(D[P]={label:P,count:0,dates:[]}),D[P].count++,R.date&&D[P].dates.push(R.date)}const O=Object.values(D).sort((R,P)=>P.count-R.count);return{category:S,count:N,kitchens:O}}),d={};for(const[S,N]of Object.entries(o)){const D=a[S]||1,O=Object.entries(N).filter(([,R])=>R>=2).map(([R,P])=>({category:R,count:P,rate:Math.round(P/D*100)})).sort((R,P)=>P.rate-R.rate);O.length>0&&(d[S]=O)}let f=0,p=0;for(const S of n){const N=Number(S.temps?.handSinkTempF),D=Number(S.temps?.threeCompSinkTempF);N&&(f++,N<95&&p++),D&&(f++,D<110&&p++)}const _=f>0?Math.round((f-p)/f*100):null,w={};for(const S of n){const N=`${S.siteName||S.location||"Unknown"}${S.siteNumber?` #${S.siteNumber}`:""}${S.floor?` (${S.floor})`:""}`;w[N]=(w[N]||0)+(S.actionItems||[]).length}const A=Object.entries(w).filter(([,S])=>S>=2).sort((S,N)=>N[1]-S[1]).slice(0,5);return{recurring:u,locationRecurring:d,tempComplianceRate:_,tempChecks:f,tempFails:p,totalInspections:n.length,worstLocations:A}},[n]);return!t||t.recurring.length===0&&Object.keys(t.locationRecurring).length===0&&t.worstLocations.length===0?null:c.jsxs("div",{className:"card",style:{marginBottom:24},children:[c.jsx("div",{className:"cardHeader",children:c.jsx("div",{className:"cardTitle",children:"Recurring Issues Tracker"})}),c.jsxs("div",{className:"cardBody",children:[c.jsxs("div",{className:"analysisStatsRow",children:[c.jsxs("div",{className:"analysisStat",children:[c.jsx("div",{className:"analysisStatNum",children:t.totalInspections}),c.jsx("div",{className:"analysisStatLabel",children:"Total Inspections"})]}),t.tempComplianceRate!==null&&c.jsxs("div",{className:"analysisStat",children:[c.jsxs("div",{className:"analysisStatNum",style:{color:t.tempComplianceRate>=90?"#15803D":"#EE0000"},children:[t.tempComplianceRate,"%"]}),c.jsx("div",{className:"analysisStatLabel",children:"Temp Compliance"})]}),c.jsxs("div",{className:"analysisStat",children:[c.jsx("div",{className:"analysisStatNum",style:{color:t.recurring.length>0?"#EE0000":"#15803D"},children:t.recurring.length}),c.jsx("div",{className:"analysisStatLabel",children:"Repeat Issues"})]})]}),t.recurring.length>0&&c.jsxs("div",{style:{marginTop:16},children:[c.jsx("div",{className:"guideSectionTitle",children:"Issues That Keep Coming Back"}),c.jsx("div",{className:"recurringList",children:t.recurring.map(({category:s,count:r,kitchens:o})=>c.jsxs("div",{className:"recurringItem recurringItemExpanded",children:[c.jsx("span",{className:"recurringBar",style:{width:`${Math.min(100,r/t.totalInspections*100)}%`}}),c.jsxs("div",{className:"recurringTop",children:[c.jsx("span",{className:"recurringLabel",children:s}),c.jsxs("span",{className:"recurringBadge",children:[r,"/",t.totalInspections," (",Math.round(r/t.totalInspections*100),"%)"]})]}),c.jsx("div",{className:"recurringKitchens",children:o.map((a,u)=>c.jsxs("span",{className:"recurringKitchenTag recurringKitchenClickable",onClick:()=>e?.(a.label.split(" #")[0].split(" (")[0]),children:[a.label," ",c.jsxs("span",{className:"recurringKitchenCount",children:["",a.count]})]},u))})]},s))})]}),t.worstLocations.length>0&&c.jsxs("div",{style:{marginTop:20},children:[c.jsx("div",{className:"guideSectionTitle",children:"Locations With Most Issues"}),c.jsx("div",{className:"worstLocationsList",children:t.worstLocations.map(([s,r],o)=>c.jsxs("div",{className:"worstLocation worstLocationClickable",onClick:()=>e?.(s.split(" #")[0].split(" (")[0]),children:[c.jsxs("span",{className:"worstRank",style:{background:o===0?"#EE0000":o===1?"#f97316":"#eab308"},children:["#",o+1]}),c.jsx("span",{className:"worstName",children:s}),c.jsxs("span",{className:"worstCount",children:[r," issue",r!==1?"s":""]}),c.jsx("span",{className:"worstArrow",children:""})]},s))})]}),Object.keys(t.locationRecurring).length>0&&c.jsxs("div",{style:{marginTop:20},children:[c.jsx("div",{className:"guideSectionTitle",children:"Flagged Locations  Repeat Problems"}),Object.entries(t.locationRecurring).map(([s,r])=>c.jsxs("div",{className:"flaggedLocation",children:[c.jsx("div",{className:"flaggedLocationName",children:s}),c.jsx("div",{className:"flaggedIssuesList",children:r.map((o,a)=>c.jsxs("div",{className:"flaggedIssue",children:[c.jsx("span",{className:"flaggedIssueCat",children:o.category}),c.jsxs("span",{className:"flaggedIssueRate",style:{color:o.rate>=50?"#EE0000":"#b45309"},children:[o.count,"x (",o.rate,"% of inspections)"]})]},a))})]},s))]})]})]})}function zg({onBack:n}){const[e,t]=B.useState([]),[s,r]=B.useState(""),[o,a]=B.useState(""),[u,d]=B.useState(""),[f,p]=B.useState(""),[_,w]=B.useState(""),[A,S]=B.useState(null),[N,D]=B.useState(!1),[O,R]=B.useState("reports");B.useEffect(()=>{ho().then(g=>{t(g),D(!0)})},[]),B.useMemo(()=>{const g=new Set;for(const T of e)for(const I of T.actionItems||[])g.add(I.issue?.split(":")[0]?.trim()||"Other");return Array.from(g).sort()},[e]);const P=B.useMemo(()=>e.filter(g=>!(s&&g.inspectionDate!==s||o&&g.inspectionType!==o||u&&g.floor!==u||_&&!`${g.siteName||g.location||""}${g.siteNumber?` #${g.siteNumber}`:""}`.toLowerCase().includes(_.toLowerCase())||f&&!(g.actionItems||[]).some(I=>I.issue?.toLowerCase().includes(f.toLowerCase())))),[e,s,o,u,_,f]);function U(g){w(g),r(""),a(""),d(""),p(""),R("reports"),setTimeout(()=>{const T=document.getElementById("history-results");T&&T.scrollIntoView({behavior:"smooth",block:"start"})},100)}function W(g){const T=e.filter(I=>I.id!==g);t(T),yg(g).catch(()=>{})}function H(){confirm("Delete all inspection history? This cannot be undone.")&&(t([]),_g().catch(()=>{}))}const b=[...new Set(e.map(g=>g.inspectionDate).filter(Boolean))].sort().reverse(),y=[...new Set(e.map(g=>g.inspectionType).filter(Boolean))].sort(),v=[...new Set(e.map(g=>g.floor).filter(Boolean))].sort();return c.jsxs("div",{className:"appShell",children:[c.jsxs("header",{className:"topBar",children:[c.jsxs("div",{className:"brandLeft brandClickable",onClick:n,title:"Back to Inspector",children:[c.jsx("img",{src:mn,alt:"Sodexo",className:"brandLogo"}),c.jsxs("div",{children:[c.jsx("div",{className:"brandTitle",children:"Inspection History"}),c.jsxs("div",{className:"brandSub",children:[e.length," saved inspection",e.length!==1?"s":""]})]})]}),c.jsxs("div",{className:"topActions",children:[c.jsx("button",{className:"btn btnGhost",onClick:n,type:"button",children:"Back to Inspector"}),e.length>0&&c.jsx("button",{className:"btn btnGhost",onClick:H,type:"button",style:{color:"#EE0000",borderColor:"#EE0000"},children:"Clear All"})]})]}),c.jsx("div",{className:"topBarSpacer"}),c.jsxs("main",{className:"pageMain pageMainWide",children:[c.jsxs("div",{className:"card",style:{marginBottom:24},children:[c.jsxs("div",{className:"cardHeader",children:[c.jsx("div",{className:"cardTitle",children:"Filters"}),(s||o||u||_||f)&&c.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{r(""),a(""),d(""),w(""),p("")},children:"Clear filters"})]}),c.jsx("div",{className:"cardBody",children:c.jsxs("div",{className:"fieldGrid filterGrid",children:[c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Date"}),c.jsxs("select",{className:"select",value:s,onChange:g=>r(g.target.value),children:[c.jsx("option",{value:"",children:"All dates"}),b.map(g=>c.jsx("option",{value:g,children:g},g))]})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Inspection Type"}),c.jsxs("select",{className:"select",value:o,onChange:g=>a(g.target.value),children:[c.jsx("option",{value:"",children:"All types"}),y.map(g=>c.jsx("option",{value:g,children:g},g))]})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Floor"}),c.jsxs("select",{className:"select",value:u,onChange:g=>d(g.target.value),children:[c.jsx("option",{value:"",children:"All floors"}),v.map(g=>c.jsx("option",{value:g,children:g},g))]})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Location"}),c.jsx("input",{className:"input",value:_,onChange:g=>w(g.target.value),placeholder:"e.g., North Kitchen #204"})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Search Issues"}),c.jsx("input",{className:"input",value:f,onChange:g=>p(g.target.value),placeholder:"e.g., ceiling, temp, allergen..."})]})]})})]}),e.length>=2&&c.jsxs("div",{className:"historyTabs",children:[c.jsxs("button",{className:pe("historyTab",O==="reports"&&"historyTabActive"),onClick:()=>R("reports"),type:"button",children:["Reports (",P.length,")"]}),c.jsx("button",{className:pe("historyTab",O==="analytics"&&"historyTabActive"),onClick:()=>R("analytics"),type:"button",children:"Analytics"})]}),O==="analytics"&&e.length>=2&&c.jsxs(c.Fragment,{children:[c.jsx(qg,{history:P.length>0?P:e}),c.jsx(Hg,{history:P.length>0?P:e,onLocationClick:U})]}),O==="reports"&&(P.length===0?c.jsx("div",{className:"card",children:c.jsx("div",{className:"cardBody",children:c.jsxs("div",{className:"emptyState",children:[c.jsx("div",{className:"emptyTitle",children:e.length===0?"No inspections saved yet":"No matches"}),c.jsx("div",{className:"emptySub",children:e.length===0?"Complete an inspection and click Save to build your history.":"Try adjusting your filters."})]})})}):c.jsx("div",{className:"historyList",id:"history-results",children:P.map(g=>{const T=A===g.id,I=g.actionItems||[],E=g.overallStatus==="Pass"?"#15803D":"#EE0000";return c.jsxs("div",{className:"card historyCard",style:{marginBottom:16},children:[c.jsxs("div",{className:"cardHeader",style:{cursor:"pointer"},onClick:()=>S(T?null:g.id),children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,flex:1},children:[c.jsx("span",{className:"historyStatus",style:{background:E},children:g.overallStatus}),c.jsxs("div",{children:[c.jsx("div",{className:"cardTitle",children:g.siteName||g.location||"Inspection"}),c.jsxs("div",{className:"cardSub",children:[g.inspectionDate," "," ",c.jsx("span",{className:pe("typeBadge",g.inspectionType==="Event Day"?"typeBadgeEvent":g.inspectionType==="Post Event"?"typeBadgePost":"typeBadgeRegular"),children:g.inspectionType}),g.floor&&c.jsxs(c.Fragment,{children:[" "," ",c.jsx("span",{className:"typeBadge typeBadgeFloor",children:g.floor})]})," "," ",g.inspectorName||""]})]})]}),c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[I.length>0&&c.jsxs("span",{className:"pill",children:[I.length," issue",I.length!==1?"s":""]}),c.jsx("span",{style:{fontSize:"1.2rem",color:"var(--sdx-gray-400)"},children:T?"":""})]})]}),T&&c.jsxs("div",{className:"cardBody",children:[c.jsxs("div",{className:"historyMeta",children:[c.jsxs("div",{children:[c.jsx("strong",{children:"Inspector:"})," ",g.inspectorName||""]}),c.jsxs("div",{children:[c.jsx("strong",{children:"Supervisor:"})," ",g.supervisorName||""]}),c.jsxs("div",{children:[c.jsx("strong",{children:"Unit #:"})," ",g.siteNumber||""]}),c.jsxs("div",{children:[c.jsx("strong",{children:"Floor:"})," ",g.floor||""]}),c.jsxs("div",{children:[c.jsx("strong",{children:"Hand sink:"})," ",g.temps?.handSinkTempF||"","F"]}),c.jsxs("div",{children:[c.jsx("strong",{children:"3-comp wash:"})," ",g.temps?.threeCompSinkTempF||"","F"]})]}),I.length>0&&c.jsxs("div",{style:{marginTop:16},children:[c.jsx("div",{className:"guideSectionTitle",children:"Action Items"}),c.jsxs("table",{className:"historyTable",children:[c.jsx("thead",{children:c.jsxs("tr",{children:[c.jsx("th",{children:"Issue"}),c.jsx("th",{children:"Priority"})]})}),c.jsx("tbody",{children:I.map((F,j)=>c.jsxs("tr",{children:[c.jsx("td",{children:F.issue}),c.jsx("td",{children:c.jsx("span",{className:pe("priorityBadge",F.priority==="High"?"priorityHigh":"priorityMed"),children:F.priority})})]},j))})]})]}),g.rawNotes&&c.jsxs("div",{style:{marginTop:16},children:[c.jsx("div",{className:"guideSectionTitle",children:"Inspector Notes"}),c.jsx("div",{className:"historyNotesFormatted",style:{maxHeight:250,overflowY:"auto"},children:(()=>{const{grouped:F}=Nr(g.rawNotes);return Cr.map(j=>F[j]?.length?c.jsxs("div",{style:{marginBottom:10},children:[c.jsx("div",{className:pe("rptNoteCatLabel",`rptNoteCat--${j}`),children:xr[j]}),c.jsx("ul",{className:"rptNoteBullets",children:F[j].map((J,_e)=>c.jsx("li",{children:J},_e))})]},j):null)})()})]}),c.jsxs("div",{style:{marginTop:16,display:"flex",gap:8},children:[c.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{Tu({output:g.output||g.rawNotes||"",inspectionDate:g.inspectionDate,siteName:g.siteName})},children:"Download TXT"}),c.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{bu({output:g.output||g.rawNotes||"",inspectionType:g.inspectionType,inspectionDate:g.inspectionDate,siteName:g.siteName,inspectorName:g.inspectorName})},children:"Download HTML"}),c.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>W(g.id),style:{color:"#EE0000",borderColor:"rgba(238,0,0,.3)",marginLeft:"auto"},children:"Delete"})]})]})]},g.id)})}))]}),c.jsxs("footer",{className:"footer",children:[c.jsx("img",{src:mn,alt:"Sodexo",className:"footerLogo"}),c.jsx("span",{children:je?" Inspection history synced to cloud database.":"Inspection history is stored locally in your browser."})]})]})}function Kg({currentUser:n,onBack:e}){const[t,s]=B.useState([]),[r,o]=B.useState(!1),[a,u]=B.useState(""),[d,f]=B.useState(""),[p,_]=B.useState(""),[w,A]=B.useState("inspector"),[S,N]=B.useState(""),[D,O]=B.useState(""),[R,P]=B.useState(!1);B.useEffect(()=>{Ue().then(s)},[]);async function U(){s(await Ue())}async function W(F){await Tg(F),await U()}async function H(F){confirm("Remove this access request?")&&(await bl(F),await U())}async function b(F){await wg(F),await U()}async function y(F){await Ig(F),await U()}async function v(F){confirm("Remove this user? They will need to request access again.")&&(await bl(F),await U())}async function g(F){F.preventDefault(),N(""),O(""),P(!0);try{if(a.trim().length<3){N("Badge number must be at least 3 characters.");return}const j=await bg(a.trim(),d.trim(),p.trim(),w);j.ok?(O(`${d.trim()} added as ${w==="admin"?"Admin":"Inspector"}.`),u(""),f(""),_(""),A("inspector"),await U(),setTimeout(()=>O(""),3e3)):j.reason==="exists"&&N("This badge number is already registered.")}catch{N("Failed to add user. Try again.")}finally{P(!1)}}const T=t.filter(F=>!F.approved),I=t.filter(F=>F.approved),E=t.filter(F=>F.role==="admin"&&F.approved).length;return c.jsxs("div",{className:"appShell",children:[c.jsxs("header",{className:"topBar",children:[c.jsxs("div",{className:"brandLeft brandClickable",onClick:e,title:"Back to Inspector",children:[c.jsx("img",{src:mn,alt:"Sodexo",className:"brandLogo"}),c.jsxs("div",{children:[c.jsx("div",{className:"brandTitle",children:"Admin Panel"}),c.jsx("div",{className:"brandSub",children:"Manage user access & permissions"})]})]}),c.jsx("div",{className:"topActions",children:c.jsx("button",{className:"btn btnGhost",onClick:e,type:"button",children:"Back to Inspector"})})]}),c.jsx("div",{className:"topBarSpacer"}),c.jsxs("main",{className:"pageMain pageMainNarrow",children:[c.jsxs("div",{className:"card adminCard",style:{marginBottom:24},children:[c.jsxs("div",{className:"cardHeader",children:[c.jsx("div",{className:"cardTitle",children:"Add New User"}),c.jsx("button",{className:"btn btnGhost btnSmall",type:"button",onClick:()=>{o(!r),N(""),O("")},children:r?"Cancel":"+ Add User"})]}),r&&c.jsx("div",{className:"cardBody",children:c.jsxs("form",{onSubmit:g,className:"addUserForm",children:[c.jsxs("div",{className:"fieldGrid",children:[c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Badge Number"}),c.jsx("input",{className:"input",type:"password",value:a,onChange:F=>u(F.target.value),placeholder:"Enter badge #",autoComplete:"off"})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Full Name"}),c.jsx("input",{className:"input",value:d,onChange:F=>f(F.target.value),placeholder:"e.g., Jane Smith"})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Department"}),c.jsx("input",{className:"input",value:p,onChange:F=>_(F.target.value),placeholder:"e.g., Safety Inspector"})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Role"}),c.jsxs("select",{className:"select",value:w,onChange:F=>A(F.target.value),children:[c.jsx("option",{value:"inspector",children:"Inspector"}),c.jsx("option",{value:"admin",children:"Admin"})]})]})]}),S&&c.jsx("div",{className:"pinError",style:{marginTop:8},children:S}),D&&c.jsx("div",{className:"addUserSuccess",children:D}),c.jsx("button",{className:"btn btnPrimary",type:"submit",style:{marginTop:12},disabled:R||a.trim().length<3||!d.trim()||!p.trim(),children:R?"Adding...":`Add as ${w==="admin"?"Admin":"Inspector"}`})]})})]}),T.length>0&&c.jsxs("div",{className:"card adminCard",style:{marginBottom:24},children:[c.jsx("div",{className:"cardHeader",children:c.jsxs("div",{className:"cardTitle",children:["Pending Approvals",c.jsx("span",{className:"adminCount",children:T.length})]})}),c.jsx("div",{className:"cardBody",children:T.map(F=>c.jsxs("div",{className:"adminUserRow",children:[c.jsxs("div",{className:"adminUserInfo",children:[c.jsx("div",{className:"adminUserName",children:F.name}),c.jsxs("div",{className:"adminUserMeta",children:[F.department,"  Requested ",new Date(F.registeredAt).toLocaleDateString()]})]}),c.jsxs("div",{className:"adminUserActions",children:[c.jsx("button",{className:"btn btnPrimary btnSmall",onClick:()=>W(F.badgeHash),children:"Approve"}),c.jsx("button",{className:"btn btnGhost btnSmall adminDenyBtn",onClick:()=>H(F.badgeHash),children:"Deny"})]})]},F.badgeHash))})]}),c.jsxs("div",{className:"card adminCard",children:[c.jsx("div",{className:"cardHeader",children:c.jsxs("div",{className:"cardTitle",children:["Team Members",c.jsx("span",{className:"adminCount",children:I.length})]})}),c.jsx("div",{className:"cardBody",children:I.length===0?c.jsx("div",{className:"emptyState",children:c.jsx("div",{className:"emptyTitle",children:"No approved users"})}):I.map(F=>{const j=F.badgeHash===n?.badgeHash,J=F.role==="admin"&&E<=1;return c.jsxs("div",{className:"adminUserRow",children:[c.jsxs("div",{className:"adminUserInfo",children:[c.jsxs("div",{className:"adminUserName",children:[F.name,F.role==="admin"&&c.jsx("span",{className:"roleBadge adminRoleBadge",children:"Admin"}),F.role==="inspector"&&c.jsx("span",{className:"roleBadge inspectorRoleBadge",children:"Inspector"}),j&&c.jsx("span",{className:"roleBadge youRoleBadge",children:"You"})]}),c.jsxs("div",{className:"adminUserMeta",children:[F.department,"  Since ",new Date(F.registeredAt).toLocaleDateString()]})]}),c.jsxs("div",{className:"adminUserActions",children:[F.role==="inspector"&&c.jsx("button",{className:"btn btnGhost btnSmall",onClick:()=>b(F.badgeHash),children:"Make Admin"}),F.role==="admin"&&!J&&!j&&c.jsx("button",{className:"btn btnGhost btnSmall",onClick:()=>y(F.badgeHash),children:"Remove Admin"}),!j&&c.jsx("button",{className:"btn btnGhost btnSmall adminDenyBtn",onClick:()=>v(F.badgeHash),children:"Remove"})]})]},F.badgeHash)})})]})]}),c.jsxs("footer",{className:"footer",children:[c.jsx("img",{src:mn,alt:"Sodexo",className:"footerLogo"}),c.jsx("span",{children:je?" User accounts synced to cloud database.":"User accounts are stored locally on this device."})]})]})}function Wg({photos:n,onRemove:e}){return n?.length?c.jsx("div",{className:"photoStrip",children:n.map(t=>c.jsxs("div",{className:"photoThumb",children:[c.jsx("img",{src:t.previewUrl,alt:t.name}),c.jsx("button",{className:"thumbX",type:"button",onClick:()=>e(t.id),"aria-label":"Remove photo",children:""})]},t.id))}):null}function ai({title:n,items:e,inspection:t,setInspection:s}){const r=B.useRef({}),o=B.useRef({}),[a,u]=B.useState(null);async function d(p,_){const w=Array.from(_||[]).slice(0,ri),A=[];for(const S of w){if(!S.type.startsWith("image/")||Il(S.size)>Tl)continue;const N=await jg(S);N&&A.push({id:`${Date.now()}_${Math.random().toString(16).slice(2)}`,name:S.name,sizeMb:Il(S.size),type:"image/jpeg",previewUrl:N})}A.length!==0&&s(S=>{const N=p.split("."),D=oi(S,N)||be({status:"OK",notes:""}),O={...D,photos:[...D.photos||[],...A].slice(0,ri)};return Xn(S,N,O)})}function f(p,_){s(w=>{const A=p.split("."),S=oi(w,A)||be({status:"OK",notes:""}),N={...S,photos:(S.photos||[]).filter(D=>D.id!==_)};return Xn(w,A,N)})}return c.jsxs("div",{className:"guideSection",children:[c.jsx("div",{className:"guideSectionTitle",children:n}),c.jsx("div",{className:"guideItems",children:e.map(p=>{const _=p.path.join("."),w=oi(t,p.path)||be({status:"OK",notes:""});return c.jsxs("div",{className:"guideItem",children:[c.jsxs("div",{className:"guideItemHead",children:[c.jsx("div",{className:"guideLabel",children:p.label}),c.jsx("select",{className:"select selectSmall",value:w.status,onChange:A=>s(S=>Xn(S,p.path,{...w,status:A.target.value})),children:Sg.map(A=>c.jsx("option",{value:A,children:A},A))})]}),c.jsx("input",{className:"input inputSmall",value:w.notes,onChange:A=>s(S=>Xn(S,p.path,{...w,notes:A.target.value})),placeholder:"Issue / observation (optional)"}),c.jsxs("div",{className:"photoRow",children:[c.jsx("input",{ref:A=>o.current[_]=A,className:"fileInput",type:"file",accept:"image/*",multiple:!0,onChange:A=>{d(_,A.target.files),A.target.value="",u(null)}}),c.jsx("input",{ref:A=>r.current[_]=A,className:"fileInput",type:"file",accept:"image/*,.pdf,.heic,.heif",multiple:!0,onChange:A=>{d(_,A.target.files),A.target.value="",u(null)}}),c.jsxs("div",{className:"photoPickerWrap",children:[c.jsx("button",{className:"btn btnGhost btnSmall photoBtn",type:"button",onClick:()=>u(a===_?null:_),children:" Add photos"}),a===_&&c.jsxs("div",{className:"photoPickerMenu",children:[c.jsx("button",{className:"photoPickerItem",type:"button",onClick:()=>{o.current[_]?.click()},children:" Photo Gallery"}),c.jsx("button",{className:"photoPickerItem",type:"button",onClick:()=>{r.current[_]?.click()},children:" Browse Files"})]})]}),c.jsxs("span",{className:"hint",children:["Up to ",ri," (",Tl,"MB each)"]})]}),c.jsx(Wg,{photos:w.photos,onRemove:A=>f(_,A)})]},_)})}),c.jsx("div",{className:"guideNote",children:"Photos are stored locally for preview. For production: upload images and store URLs."})]})}function Gg(){const[n,e]=B.useState(!0),[t,s]=B.useState(null),[r,o]=B.useState("inspector"),a=B.useRef(Date.now());B.useEffect(()=>{const L=document.getElementById("splash");L&&(L.classList.add("hide"),setTimeout(()=>L.remove(),350))},[]),B.useEffect(()=>{const L="sdx_last_cache_clean";function se(){const Pe=new Date().toISOString().slice(0,10);localStorage.getItem(L)!==Pe&&(localStorage.setItem(L,Pe),navigator.serviceWorker?.controller&&navigator.serviceWorker.controller.postMessage("CLEAN_CACHE"))}se();const ie=setInterval(se,3600*1e3);return()=>clearInterval(ie)},[]);const[u,d]=B.useState("inspection"),[f,p]=B.useState(()=>wl("inspection")),[_,w]=B.useState(()=>ii()),[A,S]=B.useState(""),[N,D]=B.useState(an.inspection.useCases[0]),[O,R]=B.useState("Regular Inspection"),[P,U]=B.useState(()=>new Date().toISOString().slice(0,10)),[W,H]=B.useState(""),[b,y]=B.useState(""),[v,g]=B.useState(""),[T,I]=B.useState(""),[E,F]=B.useState(""),[j,J]=B.useState("Floor 1"),[_e,Ze]=B.useState(!1),[De,wn]=B.useState(""),[In,An]=B.useState(!1),[Sn,Me]=B.useState(""),[$t,it]=B.useState([]),[Ut,et]=B.useState([]),[tt,xn]=B.useState(!1),qt=B.useCallback(()=>{a.current=Date.now()},[]);if(B.useEffect(()=>{if(n)return;const L=["mousedown","keydown","touchstart","scroll"];L.forEach(ie=>window.addEventListener(ie,qt,{passive:!0}));const se=setInterval(()=>{Date.now()-a.current>ug&&(El(),e(!0))},3e4);return()=>{L.forEach(ie=>window.removeEventListener(ie,qt)),clearInterval(se)}},[n,qt]),B.useEffect(()=>{function L(se){A.trim()&&!tt&&(se.preventDefault(),se.returnValue="")}return window.addEventListener("beforeunload",L),()=>window.removeEventListener("beforeunload",L)},[A,tt]),n)return c.jsx(Ag,{onUnlock:L=>{s(L),e(!1),qt(),L?.name&&!W&&H(L.name)}});if(r==="history")return c.jsx(zg,{onBack:()=>o("inspector")});if(r==="admin")return c.jsx(Kg,{currentUser:t,onBack:()=>o("inspector")});const Cn=an[u];function Ht(){p(wl(u)),w(ii()),S(""),wn(""),Me(""),it([]),et([]),xn(!1),R("Regular Inspection"),U(new Date().toISOString().slice(0,10)),H(t?.name||""),y(""),g(""),I(""),F(""),J("Floor 1"),window.scrollTo({top:0,behavior:"smooth"})}function Es(){const L=an[u].sample;p({...L.context}),w(L.inspection?{...L.inspection}:ii()),S(L.rawNotes||""),R(L.meta?.inspectionType||"Regular Inspection"),U(L.meta?.inspectionDate||L.context?.date||""),H(L.meta?.inspectorName||""),y(""),g(""),I(""),F(""),wn(""),Me(""),it([]),et([])}function Rr(){Me(""),it([]),et([]);const L=Og({inspectionDate:P,inspectorName:W,context:f,noteType:u,inspection:_});if(L.length&&it(L),!A.trim()){Me("Please enter raw notes before transforming.");return}An(!0);try{const se=Mg({noteType:u,useCase:N,context:f,inspection:_,rawNotes:A,inspectionType:O,inspectionDate:P,inspectorName:W,siteName:b,siteNumber:v,sitePhone:E,supervisorName:T,floor:j});wn(se);const ie=Sl({inspection:_,rawNotes:A,context:f,noteType:u});et(ie)}catch(se){Me(se?.message||"Something went wrong")}finally{An(!1)}}async function Nn(){De&&await navigator.clipboard.writeText(De)}function Rn(){const L=Sl({inspection:_,rawNotes:A,context:f,noteType:u});et(L)}async function Pn(){function L(ie){if(!ie||typeof ie!="object")return ie;if(Array.isArray(ie))return ie.map(L);const Pe={};for(const[Kt,Wt]of Object.entries(ie))Kt==="photos"&&Array.isArray(Wt)?Pe.photos=Wt.map(ot=>({id:ot.id,name:ot.name,sizeMb:ot.sizeMb,type:ot.type})):Pe[Kt]=L(Wt);return Pe}const se={id:`${Date.now()}_${Math.random().toString(36).slice(2,8)}`,savedAt:new Date().toISOString(),noteType:u,inspectionType:O,inspectionDate:P,inspectorName:W,siteName:b,siteNumber:v,supervisorName:T,sitePhone:E,floor:j,location:b||f?.kitchen||"Kitchen",context:{...f},temps:{..._.temps},overallStatus:Bt(_),actionItems:Tn({inspection:_,rawNotes:A}),rawNotes:A,output:De,inspection:L(_),photoCount:Fg(_)};try{await gg(se),xn(!0),setTimeout(()=>xn(!1),2500)}catch(ie){console.error("Save failed:",ie),Me("Save failed  record may be too large. Try removing some photos.")}}function ve(){Ug({inspection:_,rawNotes:A,inspectionType:O,inspectionDate:P,inspectorName:W,siteName:b,siteNumber:v,supervisorName:T,floor:j})}function Ie(){bu({output:De,inspection:_,rawNotes:A,inspectionType:O,inspectionDate:P,siteName:b,siteNumber:v,sitePhone:E,inspectorName:W,supervisorName:T})}function zt(){Tu({output:De,inspectionDate:P,siteName:b})}return c.jsxs("div",{className:"appShell",children:[c.jsxs("header",{className:"topBar",children:[c.jsxs("div",{className:"brandLeft brandClickable",onClick:()=>{o("inspector"),window.scrollTo({top:0,behavior:"smooth"})},title:"Home",children:[c.jsx("img",{src:mn,alt:"Sodexo",className:"brandLogo"}),c.jsxs("div",{children:[c.jsx("div",{className:"brandTitle",children:"Kitchen Inspection"}),c.jsx("div",{className:"brandSub",children:"Turn sit-down inspection notes into organized documents"})]})]}),c.jsxs("div",{className:"topActionsHamburger",children:[c.jsx("button",{className:pe("btn","btnPrimary","btnGenHeader"),onClick:Rr,type:"button",disabled:In,children:In?"Generating...":"Generate Report"}),c.jsx("button",{className:"hamburgerBtn",onClick:()=>Ze(!_e),type:"button","aria-label":"Menu",children:c.jsxs("span",{className:pe("hamburgerIcon",_e&&"hamburgerOpen"),children:[c.jsx("span",{}),c.jsx("span",{}),c.jsx("span",{})]})})]}),_e&&c.jsxs("div",{className:"dropdownMenu",onClick:()=>Ze(!1),children:[t&&c.jsxs("div",{className:"dropdownMenuUser",children:[t.name,t.role==="admin"?" (Admin)":""]}),c.jsx("button",{className:"dropdownMenuItem",onClick:Ht,type:"button",children:"+ New Inspection"}),c.jsx("button",{className:"dropdownMenuItem",onClick:()=>o("history"),type:"button",children:"Past Reports"}),t?.role==="admin"&&c.jsx("button",{className:"dropdownMenuItem",onClick:()=>o("admin"),type:"button",children:"Admin Panel"}),c.jsx("button",{className:"dropdownMenuItem dropdownMenuDanger",onClick:()=>{El(),s(null),e(!0)},type:"button",children:"Lock App"})]})]}),c.jsx("div",{className:"topBarSpacer"}),c.jsxs("main",{className:"grid",children:[c.jsxs("section",{className:"card",children:[c.jsx("div",{className:"cardHeader",children:c.jsx("div",{className:"cardTitle",children:"Inspection Details"})}),c.jsxs("div",{className:"cardBody",children:[c.jsxs("div",{className:"fieldGrid",children:[c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Inspection Type"}),c.jsx("select",{className:"select",value:O,onChange:L=>R(L.target.value),children:xg.map(L=>c.jsx("option",{value:L,children:L},L))})]}),c.jsxs("label",{className:"field",id:"field-inspectionDate",children:[c.jsx("span",{className:"fieldLabel",children:"Inspection Date"}),c.jsx("input",{className:"input",type:"date",value:P,onChange:L=>U(L.target.value)})]}),c.jsxs("label",{className:"field",id:"field-inspectorName",children:[c.jsx("span",{className:"fieldLabel",children:"Inspector Name"}),c.jsx("input",{className:"input",value:W,onChange:L=>H(L.target.value),placeholder:"e.g., J. Da Silva"})]}),c.jsxs("label",{className:"field",id:"field-supervisorName",children:[c.jsx("span",{className:"fieldLabel",children:"Supervisor Name"}),c.jsx("input",{className:"input",value:T,onChange:L=>I(L.target.value),placeholder:"e.g., GM / Chef Lead"})]}),c.jsxs("label",{className:"field",id:"field-siteName",children:[c.jsx("span",{className:"fieldLabel",children:"Restaurant / Local Name"}),c.jsx("input",{className:"input",value:b,onChange:L=>y(L.target.value),placeholder:"e.g., North Stand Kitchen"})]}),c.jsxs("label",{className:"field",id:"field-siteNumber",children:[c.jsx("span",{className:"fieldLabel",children:"Location / Unit Number"}),c.jsx("input",{className:"input",value:v,onChange:L=>g(L.target.value),placeholder:"e.g., Unit 12 / Loc-204"})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Location Phone (optional)"}),c.jsx("input",{className:"input",value:E,onChange:L=>F(L.target.value),placeholder:"e.g., (305) 555-0123"})]}),c.jsxs("label",{className:"field",children:[c.jsx("span",{className:"fieldLabel",children:"Floor"}),c.jsx("select",{className:"select",value:j,onChange:L=>J(L.target.value),children:Cg.map(L=>c.jsx("option",{value:L,children:L},L))})]})]}),c.jsx("div",{className:"fieldGrid",children:Cn.contextFields.map(L=>c.jsxs("label",{className:"field",id:`field-ctx-${L.key}`,children:[c.jsx("span",{className:"fieldLabel",children:L.label}),c.jsx("input",{className:"input",value:f[L.key]??"",onChange:se=>p(ie=>({...ie,[L.key]:se.target.value})),placeholder:L.label})]},L.key))}),c.jsxs("div",{className:"field",children:[c.jsxs("div",{className:"fieldLabelRow",children:[c.jsx("span",{className:"fieldLabel",children:"Final output format"}),c.jsx("span",{className:"hint",children:"Adapts to the selected note type"})]}),c.jsx("select",{className:"select",value:N,onChange:L=>D(L.target.value),children:Cn.useCases.map(L=>c.jsx("option",{value:L,children:L},L))})]}),c.jsxs("div",{className:"guide",children:[c.jsxs("div",{className:"guideHeader",children:[c.jsxs("div",{children:[c.jsx("div",{className:"guideTitle",children:"Inspector guide"}),c.jsx("div",{className:"guideSub",children:"Fast checklist for sit-down kitchen inspections"})]}),c.jsxs("div",{className:"pillRow",children:[c.jsxs("span",{className:"pill",children:["Hand sink ",""," 95 F"]}),c.jsxs("span",{className:"pill",children:["3-comp wash ",""," 110 F"]})]})]}),c.jsx(ai,{title:"Facility: ceiling, walls, floors, lighting",items:[{path:["facility","ceiling"],label:"Ceiling"},{path:["facility","walls"],label:"Walls"},{path:["facility","floors"],label:"Floors"},{path:["facility","lighting"],label:"Lighting"}],inspection:_,setInspection:w}),c.jsx(ai,{title:"Operations: employees + process controls",items:[{path:["operations","employeePractices"],label:"Employee practices"},{path:["operations","handwashing"],label:"Handwashing / supplies"},{path:["operations","labelingDating"],label:"Labeling / dating"},{path:["operations","logs"],label:"Logs / documentation"}],inspection:_,setInspection:w}),c.jsxs("div",{className:"tempsRow",children:[c.jsx("div",{className:"tempsTitle",children:"Key temperatures"}),c.jsxs("div",{className:"tempsGrid",children:[c.jsxs("label",{className:"field",id:"field-handSinkTempF",style:{marginTop:0},children:[c.jsx("span",{className:"fieldLabel",children:"Hand sink temp (F)"}),c.jsx("input",{className:"input",inputMode:"numeric",value:_.temps.handSinkTempF,onChange:L=>w(se=>({...se,temps:{...se.temps,handSinkTempF:L.target.value}})),placeholder:"e.g., 97"}),c.jsx("span",{className:"hint",children:Number(_.temps.handSinkTempF)>=95?"Meets >=95 F":_.temps.handSinkTempF?"Below 95 F - flag":""})]}),c.jsxs("label",{className:"field",id:"field-threeCompSinkTempF",style:{marginTop:0},children:[c.jsx("span",{className:"fieldLabel",children:"3-comp wash temp (F)"}),c.jsx("input",{className:"input",inputMode:"numeric",value:_.temps.threeCompSinkTempF,onChange:L=>w(se=>({...se,temps:{...se.temps,threeCompSinkTempF:L.target.value}})),placeholder:"e.g., 112"}),c.jsx("span",{className:"hint",children:Number(_.temps.threeCompSinkTempF)>=110?"Meets >=110 F":_.temps.threeCompSinkTempF?"Below 110 F - flag":""})]})]})]}),c.jsx(ai,{title:"Equipment check",items:[{path:["equipment","doubleDoorCooler"],label:"Double-door cooler"},{path:["equipment","doubleDoorFreezer"],label:"Double-door freezer"},{path:["equipment","walkInCooler"],label:"Walk-in cooler"},{path:["equipment","warmers"],label:"Warmers / hot holding"},{path:["equipment","ovens"],label:"Ovens"},{path:["equipment","threeCompSink"],label:"3-compartment sink"},{path:["equipment","ecolab"],label:"Ecolab / chemicals"}],inspection:_,setInspection:w})]}),c.jsxs("div",{className:"field",children:[c.jsxs("div",{className:"fieldLabelRow",children:[c.jsx("span",{className:"fieldLabel",children:"Raw notes"}),c.jsx("span",{className:"hint",children:"Abbreviations are expanded while preserving meaning"})]}),c.jsx("textarea",{className:"textarea",value:A,onChange:L=>S(L.target.value),placeholder:"Paste quick inspection notes here...",rows:10})]}),$t.length>0&&c.jsxs("div",{className:"warningBox",children:[c.jsx("strong",{children:"Missing information:"}),c.jsx("ul",{children:$t.map((L,se)=>c.jsx("li",{className:"warningLink",onClick:()=>{const ie=document.getElementById(L.fieldId);if(ie){ie.scrollIntoView({behavior:"smooth",block:"center"});const Pe=ie.querySelector("input, select, textarea");Pe&&setTimeout(()=>Pe.focus(),400),ie.classList.add("fieldHighlight"),setTimeout(()=>ie.classList.remove("fieldHighlight"),2e3)}},children:L.text},se))})]}),Sn?c.jsx("div",{className:"errorBox",children:Sn}):null]})]}),c.jsxs("section",{className:"card",id:"report-output",children:[c.jsxs("div",{className:"cardHeader",children:[c.jsxs("div",{children:[c.jsx("div",{className:"cardTitle",children:"Output"}),c.jsx("div",{className:"cardSub",children:Vg(u,N)})]}),c.jsxs("div",{className:"outputActions",children:[c.jsx("button",{className:"btn btnGhost",type:"button",onClick:Nn,disabled:!De,children:"Copy"}),c.jsx("button",{className:pe("btn",tt?"btnSaved":"btnSave"),type:"button",onClick:Pn,disabled:!De,children:tt?"Saved!":"Save"})]})]}),c.jsxs("div",{className:"cardBody",children:[Ut.length>0&&c.jsxs("div",{className:"aiBox",children:[c.jsx("div",{className:"aiBoxTitle",children:"AI Assistant"}),c.jsx("ul",{children:Ut.map((L,se)=>c.jsx("li",{children:L},se))})]}),De?c.jsxs(c.Fragment,{children:[c.jsx(Bg,{noteType:u,useCase:N,context:f,inspection:_,rawNotes:A,inspectionType:O,inspectionDate:P,inspectorName:W,siteName:b,siteNumber:v,sitePhone:E,supervisorName:T,floor:j}),c.jsxs("div",{className:"downloadBar",children:[c.jsx("span",{className:"downloadLabel",children:"Download:"}),c.jsx("button",{className:"btn btnDownload",type:"button",onClick:ve,children:"Excel (.xls)"}),c.jsx("button",{className:"btn btnDownload",type:"button",onClick:Ie,children:"Word (.doc)"}),c.jsx("button",{className:"btn btnDownload",type:"button",onClick:zt,children:"Text (.txt)"})]})]}):c.jsxs("div",{className:"emptyState",children:[c.jsx("div",{className:"emptyIcon",children:""}),c.jsx("div",{className:"emptyTitle",children:"Ready to generate your report"}),c.jsxs("div",{className:"emptySub",children:["Fill in the inspection details on the left, then click ",c.jsx("strong",{children:"Generate Report"}),"."]})]})]})]})]}),c.jsx("button",{className:"fab fabLeft",onClick:Es,type:"button",title:"Try Example",children:" Try Example"}),c.jsx("button",{className:"fab fabRight",onClick:Rn,type:"button",title:"AI Tips",children:" AI Tips"}),De&&c.jsxs("div",{className:"stickyActionBar",children:[c.jsx("button",{className:"btn stickyBtn stickyBtnView",type:"button",onClick:()=>{const L=document.getElementById("report-output");L&&L.scrollIntoView({behavior:"smooth",block:"start"})},children:" View Report"}),c.jsx("button",{className:pe("btn stickyBtn",tt?"stickyBtnSaved":"stickyBtnSave"),type:"button",onClick:Pn,children:tt?" Saved!":"&#128190; Save Report"}),c.jsx("button",{className:"btn stickyBtn stickyBtnNew",type:"button",onClick:Ht,children:"+ New"})]}),c.jsxs("footer",{className:"footer",children:[c.jsx("img",{src:mn,alt:"Sodexo",className:"footerLogo"}),c.jsx("span",{children:je?" Cloud database connected  data syncs across all devices.":"U0001F512 Data stored locally on this device."})]})]})}Zu.createRoot(document.getElementById("root")).render(c.jsx(Ju.StrictMode,{children:c.jsx(Gg,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/Claude/sw.js").catch(()=>{})});
